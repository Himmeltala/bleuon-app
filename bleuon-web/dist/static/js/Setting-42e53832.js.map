{"version":3,"file":"Setting-42e53832.js","sources":["../../../apps/mainapp/views/user/Setting.vue"],"sourcesContent":["<script lang=\"ts\" setup>\r\n/**\r\n * @description 设置\r\n * @author zheng\r\n * @since 2023/8/23\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n\r\nimport { UserApi } from \"@mainapp/apis\";\r\nimport { ElSelectData } from \"@common/data\";\r\nimport { FormValidatorsUtil } from \"@common/utils\";\r\n\r\n// components\r\nimport CommonHeader from \"@mainapp/components/CommonHeader.vue\";\r\n\r\nconst formData = useStorage<UserData>(KeyVals.MAINAPP_USER, {});\r\n\r\nfunction renewalBasicData() {\r\n  UserApi.renewalByToken({\r\n    username: formData.value.username,\r\n    profession: formData.value.profession,\r\n    company: formData.value.company,\r\n    position: formData.value.position,\r\n    avatar: formData.value.avatar,\r\n    signature: formData.value.signature\r\n  });\r\n}\r\n\r\nfunction resetBasicData() {}\r\n\r\nlet interval: number;\r\nconst renewalPwdDialog = ref(false);\r\nconst coudButtonCount = ref(60);\r\nconst codeButtonDisabled = ref(false);\r\nconst isCodeCorrect = ref(false);\r\nconst isPasswordCorrect = ref(false);\r\nconst isRePasswdCorrect = ref(false);\r\n\r\nconst renewalPwdFormRef = ref();\r\nconst renewalPwdFormData = reactive({\r\n  captcha: \"\",\r\n  password: \"\",\r\n  rePasswd: \"\"\r\n});\r\nconst renewalPwdFormRules = reactive<FormRules>({\r\n  captcha: [\r\n    {\r\n      required: true,\r\n      message: \"请输入验证码\",\r\n      trigger: \"blur\"\r\n    },\r\n    { validator: FormValidatorsUtil.verifyCodeValidator(isCodeCorrect), trigger: \"change\" },\r\n    { validator: FormValidatorsUtil.verifyCodeValidator(isCodeCorrect), trigger: \"blur\" }\r\n  ],\r\n  password: [\r\n    {\r\n      required: true,\r\n      message: \"请输入密码\",\r\n      trigger: \"blur\"\r\n    },\r\n    { validator: FormValidatorsUtil.passwordValidator(isPasswordCorrect), trigger: \"change\" },\r\n    { validator: FormValidatorsUtil.passwordValidator(isPasswordCorrect), trigger: \"blur\" }\r\n  ],\r\n  rePasswd: [\r\n    {\r\n      required: true,\r\n      message: \"请确认密码\",\r\n      trigger: \"blur\"\r\n    },\r\n    {\r\n      validator: FormValidatorsUtil.rePasswdValidator(isRePasswdCorrect, renewalPwdFormData),\r\n      trigger: \"change\"\r\n    },\r\n    {\r\n      validator: FormValidatorsUtil.rePasswdValidator(isRePasswdCorrect, renewalPwdFormData),\r\n      trigger: \"blur\"\r\n    }\r\n  ]\r\n});\r\n\r\nfunction getRenewalPwdCode() {\r\n  FormValidatorsUtil.getVerifyCode(interval, coudButtonCount, codeButtonDisabled, callback => {\r\n    UserApi.askMailCaptcha({ email: formData.value.email }, () => callback());\r\n  });\r\n}\r\n\r\nfunction confirmRenewalPwd() {\r\n  FormValidatorsUtil.validate(renewalPwdFormRef.value, () => {\r\n    UserApi.verifyMailCaptcha(\r\n      { captcha: renewalPwdFormData.captcha, email: formData.value.email },\r\n      () => {\r\n        UserApi.renewalByToken(\r\n          {\r\n            password: renewalPwdFormData.password\r\n          },\r\n          () => {\r\n            UserApi.logout(() => {\r\n              location.reload();\r\n              ElMessage.success(\"请重新登录！\");\r\n            });\r\n          }\r\n        );\r\n      }\r\n    );\r\n  });\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"setting slim-slider h-100vh flow-auto bg-bg-page\">\r\n    <CommonHeader></CommonHeader>\r\n    <div class=\"f-c-c mt-5\">\r\n      <div class=\"w-75vw\">\r\n        <div class=\"bg-bg-overlay rd-2 p-10\">\r\n          <div class=\"font-bold text-1.5rem pb-5 mb-10 b-b-1 b-b-solid b-border-primary\">\r\n            基本信息\r\n          </div>\r\n          <div class=\"f-s-b\">\r\n            <div class=\"w-50%\">\r\n              <el-form :model=\"formData\" label-position=\"left\" label-width=\"auto\">\r\n                <el-form-item label=\"昵称\">\r\n                  <EditInput v-model:text=\"formData.username\" :base-modification=\"true\"></EditInput>\r\n                </el-form-item>\r\n                <el-form-item label=\"行业\">\r\n                  <el-select v-model=\"formData.profession\" placeholder=\"请选择您的行业\">\r\n                    <el-option\r\n                      v-for=\"item in ElSelectData.professionList\"\r\n                      :key=\"item.value\"\r\n                      :label=\"item.label\"\r\n                      :value=\"item.value\" />\r\n                  </el-select>\r\n                </el-form-item>\r\n                <el-form-item label=\"公司\">\r\n                  <el-input v-model=\"formData.company\" clearable />\r\n                </el-form-item>\r\n                <el-form-item label=\"职业（学历）\">\r\n                  <el-input v-model=\"formData.position\" clearable />\r\n                </el-form-item>\r\n                <el-form-item label=\"头像地址\">\r\n                  <el-input v-model=\"formData.avatar\" clearable />\r\n                </el-form-item>\r\n                <el-form-item label=\"个人简介\">\r\n                  <el-input\r\n                    v-model=\"formData.signature\"\r\n                    :rows=\"4\"\r\n                    clearable\r\n                    placeholder=\"请输入您的个性签名\"\r\n                    type=\"textarea\" />\r\n                </el-form-item>\r\n              </el-form>\r\n            </div>\r\n            <div class=\"w-30% text-right\">\r\n              <img :src=\"formData.avatar\" class=\"rd-50% h-40 w-40\" />\r\n            </div>\r\n          </div>\r\n          <div class=\"f-c-c mt-10\">\r\n            <el-button @click=\"resetBasicData\">重置</el-button>\r\n            <el-button type=\"primary\" @click=\"renewalBasicData\">保存资料</el-button>\r\n          </div>\r\n        </div>\r\n        <div class=\"bg-bg-overlay rd-2 my-5 p-10\">\r\n          <div class=\"font-bold text-1.5rem pb-5 mb-10 b-b-1 b-b-solid b-border-primary\">\r\n            账号安全\r\n          </div>\r\n          <div>\r\n            <div class=\"f-c-s\">\r\n              <div class=\"f-c-c\">\r\n                <div class=\"i-tabler-phone mr-2\"></div>\r\n                <div>手机</div>\r\n              </div>\r\n              <div class=\"ml-10 f-c-s\">\r\n                <div class=\"text-text-secondary mr-10\">{{ formData.phone }}</div>\r\n                <el-button size=\"small\" text bg>更换</el-button>\r\n              </div>\r\n            </div>\r\n            <div class=\"mt-5 f-c-s\">\r\n              <div class=\"f-c-c\">\r\n                <div class=\"i-tabler-at mr-2\"></div>\r\n                <div>邮箱</div>\r\n              </div>\r\n              <div class=\"ml-10 f-c-s\">\r\n                <div class=\"text-text-secondary mr-10\">{{ formData.email }}</div>\r\n                <el-button size=\"small\" text bg>更换</el-button>\r\n              </div>\r\n            </div>\r\n            <div class=\"mt-5 f-c-s\">\r\n              <div class=\"f-c-c\">\r\n                <div class=\"i-tabler-key mr-2\"></div>\r\n                <div>密码</div>\r\n              </div>\r\n              <div class=\"ml-10 f-c-s\">\r\n                <div class=\"text-text-secondary mr-10\">******</div>\r\n                <el-button\r\n                  size=\"small\"\r\n                  type=\"danger\"\r\n                  text\r\n                  bg\r\n                  @click=\"renewalPwdDialog = !renewalPwdDialog\">\r\n                  修改\r\n                </el-button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <el-dialog v-model=\"renewalPwdDialog\" title=\"修改密码\" width=\"30%\">\r\n          <el-form\r\n            ref=\"renewalPwdFormRef\"\r\n            label-width=\"80px\"\r\n            label-position=\"left\"\r\n            :model=\"renewalPwdFormData\"\r\n            :rules=\"renewalPwdFormRules\">\r\n            <el-form-item label=\"验证码\" prop=\"captcha\">\r\n              <div class=\"f-c-b flex-wrap w-100%\">\r\n                <div class=\"w-45%\">\r\n                  <el-input\r\n                    class=\"w-100%\"\r\n                    size=\"small\"\r\n                    :maxlength=\"6\"\r\n                    :minlength=\"6\"\r\n                    v-model=\"renewalPwdFormData.captcha\"\r\n                    clearable\r\n                    placeholder=\"请输入6位验证码\" />\r\n                </div>\r\n                <div class=\"w-50% f-c-s\">\r\n                  <el-button\r\n                    plain\r\n                    type=\"primary\"\r\n                    size=\"small\"\r\n                    :disabled=\"codeButtonDisabled\"\r\n                    @click=\"getRenewalPwdCode\">\r\n                    <span v-if=\"coudButtonCount < 60 && coudButtonCount >= 0\">\r\n                      请等待 {{ coudButtonCount }}s\r\n                    </span>\r\n                    <span v-else>获取验证码</span>\r\n                  </el-button>\r\n                </div>\r\n              </div>\r\n            </el-form-item>\r\n            <el-form-item label=\"新的密码\" prop=\"password\">\r\n              <el-input\r\n                v-model=\"renewalPwdFormData.password\"\r\n                :maxlength=\"16\"\r\n                :minlength=\"8\"\r\n                clearable\r\n                placeholder=\"设置密码：支持任何字符\"\r\n                show-password\r\n                size=\"small\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"确认密码\" prop=\"rePasswd\">\r\n              <el-input\r\n                v-model=\"renewalPwdFormData.rePasswd\"\r\n                :maxlength=\"16\"\r\n                :minlength=\"8\"\r\n                clearable\r\n                placeholder=\"确认密码：两次密码保持一致\"\r\n                show-password\r\n                size=\"small\" />\r\n            </el-form-item>\r\n          </el-form>\r\n          <template #footer>\r\n            <span class=\"dialog-footer\">\r\n              <el-button @click=\"renewalPwdDialog = false\">取消</el-button>\r\n              <el-button\r\n                :disabled=\"!isCodeCorrect || !isPasswordCorrect || !isRePasswdCorrect\"\r\n                type=\"primary\"\r\n                @click=\"confirmRenewalPwd\">\r\n                确认\r\n              </el-button>\r\n            </span>\r\n          </template>\r\n        </el-dialog>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n"],"names":["formData","useStorage","KeyVals.MAINAPP_USER","renewalBasicData","UserApi.renewalByToken","resetBasicData","interval","renewalPwdDialog","ref","coudButtonCount","codeButtonDisabled","isCodeCorrect","isPasswordCorrect","isRePasswdCorrect","renewalPwdFormRef","renewalPwdFormData","reactive","renewalPwdFormRules","FormValidatorsUtil.verifyCodeValidator","FormValidatorsUtil.passwordValidator","FormValidatorsUtil.rePasswdValidator","getRenewalPwdCode","FormValidatorsUtil.getVerifyCode","callback","UserApi.askMailCaptcha","confirmRenewalPwd","FormValidatorsUtil.validate","UserApi.verifyMailCaptcha","UserApi.logout","ElMessage"],"mappings":"8uEAeA,MAAAA,EAAAC,EAAAC,EAAA,CAAA,CAAA,EAEA,SAAAC,GAAA,CACEC,EAAA,CAAuB,SAAAJ,EAAA,MAAA,SACI,WAAAA,EAAA,MAAA,WACE,QAAAA,EAAA,MAAA,QACH,SAAAA,EAAA,MAAA,SACC,OAAAA,EAAA,MAAA,OACF,UAAAA,EAAA,MAAA,SACG,CAAA,CAC3B,CAGH,SAAAK,GAAA,CAA0B,CAE1B,IAAAC,EACA,MAAAC,EAAAC,EAAA,EAAA,EACAC,EAAAD,EAAA,EAAA,EACAE,EAAAF,EAAA,EAAA,EACAG,EAAAH,EAAA,EAAA,EACAI,EAAAJ,EAAA,EAAA,EACAK,EAAAL,EAAA,EAAA,EAEAM,EAAAN,IACAO,EAAAC,EAAA,CAAoC,QAAA,GACzB,SAAA,GACC,SAAA,EACA,CAAA,EAEZC,EAAAD,EAAA,CAAgD,QAAA,CACrC,CACP,SAAA,GACY,QAAA,SACD,QAAA,MACA,EACX,CAAA,UAAAE,EAAAP,CAAA,EAAA,QAAA,QAAA,EACsF,CAAA,UAAAO,EAAAP,CAAA,EAAA,QAAA,MAAA,CACF,EACtF,SAAA,CACU,CACR,SAAA,GACY,QAAA,QACD,QAAA,MACA,EACX,CAAA,UAAAQ,EAAAP,CAAA,EAAA,QAAA,QAAA,EACwF,CAAA,UAAAO,EAAAP,CAAA,EAAA,QAAA,MAAA,CACF,EACxF,SAAA,CACU,CACR,SAAA,GACY,QAAA,QACD,QAAA,MACA,EACX,CACA,UAAAQ,EAAAP,EAAAE,CAAA,EACuF,QAAA,QAC5E,EACX,CACA,UAAAK,EAAAP,EAAAE,CAAA,EACuF,QAAA,MAC5E,CACX,CACF,CAAA,EAGF,SAAAM,GAAA,CACEC,GAAAhB,EAAAG,EAAAC,EAAAa,GAAA,CACEC,EAAA,CAAA,MAAAxB,EAAA,MAAA,OAAA,IAAAuB,EAAA,CAAA,CAAwE,CAAA,CACzE,CAGH,SAAAE,GAAA,CACEC,GAAAZ,EAAA,MAAA,IAAA,CACEa,EAAQ,CAAA,QAAAZ,EAAA,QAAA,MAAAf,EAAA,MAAA,KAAA,EAC6D,IAAA,CAEjEI,EAAQ,CACN,SAAAW,EAAA,QAC+B,EAC/B,IAAA,CAEEa,EAAA,IAAA,CACE,SAAA,OAAA,EACAC,EAAA,QAAA,QAAA,CAA0B,CAAA,CAC3B,CACH,CACF,CACF,CACF,CAAA,CACD"}