{"version":3,"file":"Flowcharts-ce4eca0e.js","sources":["../../../apps/mainapp/components/home/File.vue","../../../apps/mainapp/components/home/Header.vue","../../../apps/mainapp/views/home/Flowcharts.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\n/**\r\n * @description 文件\r\n * @author 郑人滏 42020306\r\n * @since 2023/8/23\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n\r\nconst props = defineProps({\r\n  disabled: {\r\n    type: Boolean,\r\n    required: true\r\n  },\r\n  index: {\r\n    type: Number,\r\n    required: true\r\n  },\r\n  path: {\r\n    type: String,\r\n    required: true\r\n  },\r\n  lastIndex: {\r\n    type: Number,\r\n    required: true\r\n  },\r\n  fileImage: {\r\n    type: String\r\n  },\r\n  fileName: {\r\n    type: String,\r\n    required: true\r\n  },\r\n  modifyDate: {\r\n    type: String,\r\n    required: true\r\n  },\r\n  createDate: {\r\n    type: String\r\n  }\r\n});\r\n\r\nconst emits = defineEmits([\r\n  \"update:lastIndex\",\r\n  \"publish\",\r\n  \"download\",\r\n  \"copy\",\r\n  \"delete\",\r\n  \"resetFileName\",\r\n  \"share\"\r\n]);\r\nconst times = ref(1);\r\n\r\nfunction handleClick() {\r\n  if (!props.disabled) times.value = 1;\r\n  if (times.value > 0) {\r\n    times.value = 0;\r\n  } else {\r\n    times.value++;\r\n  }\r\n  emits(\"update:lastIndex\", props.index);\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"file relative\">\r\n    <div class=\"options\" :class=\"disabled && times <= 0 ? 'block' : 'hidden'\">\r\n      <div\r\n        @click=\"handleClick\"\r\n        class=\"options__icon f-c-c absolute top-2 right-2 cursor-pointer w-10 h-6 rd-2 bg-#383838cc\">\r\n        <div class=\"i-tabler-dots text-white\"></div>\r\n      </div>\r\n    </div>\r\n    <div\r\n      class=\"options__panel select-none p-1 z-2 absolute top-10 right-2 w-80% bg-white rd-2\"\r\n      :class=\"disabled && times <= 0 ? 'block' : 'hidden'\">\r\n      <div class=\"text-0.9rem f-c-s\" @click=\"$router.push(path)\">\r\n        <div class=\"i-tabler-eye mr-2\"></div>\r\n        预览\r\n      </div>\r\n      <div class=\"text-0.9rem f-c-s\" @click=\"$emit('resetFileName')\">\r\n        <div class=\"i-tabler-edit mr-2\"></div>\r\n        重命名\r\n      </div>\r\n      <div class=\"text-0.9rem f-c-s\" @click=\"$emit('share')\">\r\n        <div class=\"i-tabler-share mr-2\"></div>\r\n        分享\r\n      </div>\r\n      <div class=\"text-0.9rem f-c-s\" @click=\"$emit('publish')\">\r\n        <div class=\"i-tabler-send mr-2\"></div>\r\n        发布\r\n      </div>\r\n      <div class=\"text-0.9rem f-c-s\" @click=\"$emit('download')\">\r\n        <div class=\"i-tabler-download mr-2\"></div>\r\n        下载\r\n      </div>\r\n      <div class=\"text-0.9rem f-c-s\" @click=\"$emit('copy')\">\r\n        <div class=\"i-tabler-copy mr-2\"></div>\r\n        复制\r\n      </div>\r\n      <div class=\"text-0.9rem f-c-s\" @click=\"$emit('delete')\">\r\n        <div class=\"i-tabler-trash-x mr-2\"></div>\r\n        删除\r\n      </div>\r\n    </div>\r\n    <div class=\"image h-50 rd-2\" @click=\"$router.push(path)\">\r\n      <img\r\n        v-if=\"fileImage\"\r\n        class=\"w-100% h-100% rd-2 object-fill cursor-pointer bg-white\"\r\n        :src=\"fileImage\" />\r\n      <div v-else class=\"w-100% h-100% rd-2 cursor-pointer bg-white\"></div>\r\n    </div>\r\n    <div class=\"f-c-s flex-nowrap mt-4 w-100%\">\r\n      <div class=\"mr-2 i-tabler-chart-bubble text-theme-primary\"></div>\r\n      <div class=\"text-0.9rem text-ellipsis line-clamp-1\">{{ fileName }}</div>\r\n    </div>\r\n    <div class=\"text-text-secondary text-0.8rem mt-2 f-c-s\">\r\n      <div class=\"i-tabler-clock-edit mr-1\"></div>\r\n      更新于 {{ modifyDate }}\r\n    </div>\r\n    <div v-if=\"createDate\" class=\"text-text-secondary text-0.8rem mt-1 f-c-s\">\r\n      <div class=\"i-tabler-clock-edit mr-1\"></div>\r\n      创建于 {{ createDate }}\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n.file {\r\n  flex: 0 1 15% !important;\r\n\r\n  &:hover {\r\n    .options {\r\n      display: block;\r\n\r\n      .options__icon:hover {\r\n        --uno: bg-#383838f2;\r\n      }\r\n    }\r\n  }\r\n\r\n  .options__panel {\r\n    box-shadow: 0 6px 16px 1px rgba(0, 0, 0, 0.08), 0 9px 28px 8px rgba(0, 0, 0, 0.05);\r\n\r\n    & > div {\r\n      --uno: cursor-pointer px-4 py-2 rd-2 transition-all-300;\r\n\r\n      &:hover {\r\n        --uno: bg-#F3F5F9;\r\n      }\r\n    }\r\n  }\r\n\r\n  .image {\r\n    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.16);\r\n  }\r\n}\r\n</style>\r\n","<script setup lang=\"ts\">\r\n/**\r\n * @description 工作台头部组件\r\n * @author 郑人滏 42020306\r\n * @since 2023/8/23\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n\r\nimport MenuAvatar from \"@mainapp/components/MenuAvatar.vue\";\r\n\r\ndefineProps({\r\n  value: {\r\n    type: String,\r\n    required: true\r\n  }\r\n});\r\n\r\nconst emits = defineEmits([\"update:value\", \"enterSearch\"]);\r\n\r\nconst searchVal = ref(\"\");\r\nconst searchType = ref(\"file\");\r\n\r\nfunction onInput(value: string) {\r\n  emits(\"update:value\", value);\r\n}\r\n\r\nfunction onEnter() {\r\n  emits(\"enterSearch\", searchVal.value);\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"header f-c-b mt-5 mb-10\">\r\n    <div class=\"w-120\">\r\n      <el-input\r\n        v-model=\"searchVal\"\r\n        @keyup.enter=\"onEnter\"\r\n        @input=\"onInput\"\r\n        placeholder=\"搜索文件/文件夹\">\r\n        <template #suffix>\r\n          <div class=\"i-tabler-search\"></div>\r\n        </template>\r\n        <template #prepend>\r\n          <el-select v-model=\"searchType\" placeholder=\"搜索的类型\" style=\"width: 115px\">\r\n            <el-option label=\"文件\" value=\"file\" />\r\n            <!-- <el-option label=\"文件夹\" value=\"folder\" /> -->\r\n          </el-select>\r\n        </template>\r\n      </el-input>\r\n    </div>\r\n    <div class=\"f-c-c\">\r\n      <div class=\"mr-5\">\r\n        <el-button text bg size=\"small\">\r\n          <template #icon>\r\n            <div class=\"i-tabler-bell\"></div>\r\n          </template>\r\n        </el-button>\r\n      </div>\r\n      <MenuAvatar></MenuAvatar>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\"></style>\r\n","<script setup lang=\"ts\">\r\n/**\r\n * @description flowcharts 流程图列表\r\n * @author 郑人滏 42020306\r\n * @since 2023/8/23\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n\r\nimport File from \"@mainapp/components/home/File.vue\";\r\nimport { FlowchartApi } from \"@mainapp/apis\";\r\nimport { downloadWithDataUri } from \"@mainapp/lib/tools\";\r\nimport { formatted } from \"@common/utils/date\";\r\nimport { fileNameValidator } from \"@common/utils/form-validators\";\r\n\r\nimport Header from \"@mainapp/components/home/Header.vue\";\r\nimport FilterFilesVue from \"@mainapp/components/home/FilterFiles.vue\";\r\n\r\nconst operateFlowchart = ref<FlowchartData>({});\r\nconst flowchartList = ref(await FlowchartApi.queryAll());\r\nconst lastFileIndex = ref(-1);\r\n\r\nconst updateFileNameDialogVisible = ref(false);\r\nconst isFileNameCorrect = ref(false);\r\nconst fileNameRules = reactive({\r\n  fileName: [\r\n    { validator: fileNameValidator(isFileNameCorrect), trigger: \"blur\" },\r\n    { validator: fileNameValidator(isFileNameCorrect), trigger: \"change\" }\r\n  ]\r\n});\r\n\r\nfunction updateFileName() {\r\n  FlowchartApi.updateOne(operateFlowchart.value, () => {\r\n    updateFileNameDialogVisible.value = !updateFileNameDialogVisible.value;\r\n  });\r\n}\r\n\r\nfunction downloadFlowchart(data: FlowchartData) {\r\n  downloadWithDataUri(\r\n    data,\r\n    \"jpeg\",\r\n    () => {\r\n      ElMessage.success(\"下载成功！\");\r\n    },\r\n    () => {\r\n      ElMessage.error(\"下载失败！\");\r\n    }\r\n  );\r\n}\r\n\r\nfunction copyFlowchart(data: FlowchartData) {\r\n  data.fileName = \"复制_\" + data.fileName;\r\n  FlowchartApi.copyOne(data, async () => {\r\n    flowchartList.value = await FlowchartApi.queryAll();\r\n  });\r\n}\r\n\r\nfunction deleteFlowchart(id: string) {\r\n  FlowchartApi.deleteOne({ id }, async () => {\r\n    flowchartList.value = await FlowchartApi.queryAll();\r\n  });\r\n}\r\n\r\nconst searchVal = ref(\"\");\r\n\r\nasync function searchFiles(fileName: string) {\r\n  flowchartList.value = await FlowchartApi.queryAll({ fileName });\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"myrecent h-100%\">\r\n    <Header v-model:value=\"searchVal\" @enter-search=\"searchFiles\"></Header>\r\n    <FilterFilesVue title=\"我的流程图\" />\r\n    <div class=\"mt-5 text-text-secondary text-0.9rem\">文件</div>\r\n    <div class=\"file-list mt-5 f-c-s flex-wrap flex-gap-5\">\r\n      <File\r\n        v-for=\"(item, index) in flowchartList\"\r\n        :key=\"item.id\"\r\n        :index=\"index\"\r\n        :disabled=\"lastFileIndex == index\"\r\n        v-model:last-index=\"lastFileIndex\"\r\n        :file-name=\"item.fileName\"\r\n        :file-image=\"item.dataUri\"\r\n        :modify-date=\"formatted('MM-dd HH:mm:ss', new Date(item.modifyDate))\"\r\n        :path=\"'/flowchart/' + item.id\"\r\n        @download=\"downloadFlowchart(item)\"\r\n        @copy=\"copyFlowchart(item)\"\r\n        @delete=\"deleteFlowchart(item.id)\"\r\n        @reset-file-name=\"updateFileNameDialogVisible = !updateFileNameDialogVisible\"></File>\r\n    </div>\r\n    <el-dialog v-model=\"updateFileNameDialogVisible\" title=\"修改文件名称\" width=\"30%\">\r\n      <el-form :model=\"operateFlowchart\" :rules=\"fileNameRules\">\r\n        <el-form-item prop=\"fileName\">\r\n          <el-input v-model=\"operateFlowchart.fileName\" placeholder=\"请输入文件名称\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <span class=\"dialog-footer\">\r\n          <el-button :disabled=\"!isFileNameCorrect\" type=\"primary\" @click=\"updateFileName\">\r\n            <template #icon>\r\n              <div class=\"i-tabler-check\"></div>\r\n            </template>\r\n            确定\r\n          </el-button>\r\n          <el-button @click=\"updateFileNameDialogVisible = false\">\r\n            <template #icon>\r\n              <div class=\"i-tabler-x\"></div>\r\n            </template>\r\n            取消\r\n          </el-button>\r\n        </span>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\"></style>\r\n"],"names":["times","ref","handleClick","props","emits","searchVal","searchType","onInput","value","onEnter","operateFlowchart","flowchartList","__temp","__restore","_withAsyncContext","FlowchartApi.queryAll","lastFileIndex","updateFileNameDialogVisible","isFileNameCorrect","fileNameRules","reactive","fileNameValidator","updateFileName","FlowchartApi.updateOne","downloadFlowchart","data","downloadWithDataUri","ElMessage","copyFlowchart","FlowchartApi.copyOne","deleteFlowchart","id","FlowchartApi.deleteOne","searchFiles","fileName"],"mappings":"wnEAkDAA,EAAAC,EAAA,CAAA,EAEA,SAAAC,GAAA,CACEC,EAAA,WAAqBH,EAAA,MAAA,GACrBA,EAAA,MAAA,EACEA,EAAA,MAAA,EAEAA,EAAA,QAEFI,EAAA,mBAAAD,EAAA,KAAA,CAAqC,uvDCxCvC,MAAAE,EAAAJ,EAAA,EAAA,EACAK,EAAAL,EAAA,MAAA,EAEA,SAAAM,EAAAC,EAAA,CACEJ,EAAA,eAAAI,CAAA,CAA2B,CAG7B,SAAAC,GAAA,CACEL,EAAA,cAAAC,EAAA,KAAA,CAAoC,8wCCVtC,MAAAK,EAAAT,EAAA,CAAA,CAAA,EACAU,EAAAV,GAAA,CAAAW,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAA,CAAA,EAAAH,EAAA,MAAAA,EAAAC,EAAA,EAAAD,EAAA,EACAI,EAAAf,EAAA,EAAA,EAEAgB,EAAAhB,EAAA,EAAA,EACAiB,EAAAjB,EAAA,EAAA,EACAkB,EAAAC,EAAA,CAA+B,SAAA,CACnB,CAAA,UAAAC,EAAAH,CAAA,EAAA,QAAA,MAAA,EAC2D,CAAA,UAAAG,EAAAH,CAAA,EAAA,QAAA,QAAA,CACE,CACvE,CAAA,EAGF,SAAAI,GAAA,CACEC,GAAAb,EAAA,MAAA,IAAA,CACEO,EAAA,MAAA,CAAAA,EAAA,KAAiE,CAAA,CAClE,CAGH,SAAAO,EAAAC,EAAA,CACEC,GAAAD,EACE,OACA,IAAA,CAEEE,EAAA,QAAA,OAAA,CAAyB,EAC3B,IAAA,CAEEA,EAAA,MAAA,OAAA,CAAuB,CACzB,CACF,CAGF,SAAAC,EAAAH,EAAA,CACEA,EAAA,SAAA,MAAAA,EAAA,SACAI,GAAAJ,EAAA,SAAA,CACEd,EAAA,MAAA,MAAAI,GAAkD,CAAA,CACnD,CAGH,SAAAe,EAAAC,EAAA,CACEC,GAAA,CAAA,GAAAD,CAAA,EAAA,SAAA,CACEpB,EAAA,MAAA,MAAAI,GAAkD,CAAA,CACnD,CAGH,MAAAV,EAAAJ,EAAA,EAAA,EAEA,eAAAgC,EAAAC,EAAA,CACEvB,EAAA,MAAA,MAAAI,EAAA,CAAA,SAAAmB,CAAA,CAAA,CAA8D"}