{"version":3,"file":"FlowchartStars-54a73003.js","sources":["../../../apps/mainapp/views/workbench/FlowchartStars.vue"],"sourcesContent":["<script lang=\"ts\" setup>\r\n/**\r\n * @description 收藏的流程图\r\n * @author zheng\r\n * @since 2023/8/23\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n\r\nimport { FlowchartApi } from \"@mainapp/apis\";\r\nimport { DateUtil } from \"@common/utils\";\r\nimport { downloadWithDataUri } from \"@mainapp/lib/tools\";\r\n\r\n// components\r\nimport WorkbenchHeader from \"@mainapp/components/WorkbenchHeader.vue\";\r\nimport File from \"@mainapp/components/File.vue\";\r\n\r\nconst collect = shallowRef();\r\nconst searchVal = ref(\"\");\r\n\r\nasync function fetchData(params?: any) {\r\n  collect.value = await FlowchartApi.findAllCollectByCriteria(params);\r\n}\r\n\r\nasync function searchFiles() {\r\n  fetchData({ fileName: searchVal.value });\r\n}\r\n\r\nfunction downloadFlowchart(data: any) {\r\n  downloadWithDataUri(\r\n    data,\r\n    \"jpeg\",\r\n    (res: string) => ElMessage.success(res),\r\n    (res: string) => ElMessage.error(res)\r\n  );\r\n}\r\n\r\nfunction replicateFlowchart(data: any) {\r\n  data.fileName = \"复制_收藏_\" + data.fileName;\r\n  FlowchartApi.replicate(data, res => ElMessage.success(res.message));\r\n}\r\n\r\nfunction deleteFlowchart(flowchartId: string, index: number) {\r\n  FlowchartApi.eraseCollect({ flowchartId }, () => {\r\n    collect.value.splice(index, 1);\r\n    triggerRef(collect);\r\n  });\r\n}\r\n\r\nconst token = localStorage.getToken<TokenR>(KeyVals.MAINAPP_TOKEN_KEY);\r\n\r\nfunction isMyFlowchart(item: any) {\r\n  return item.belongUser.id == token.id;\r\n}\r\n\r\nawait fetchData();\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flowchart-stars max-h-100vh\">\r\n    <WorkbenchHeader v-model:value=\"searchVal\" @enter-search=\"searchFiles\"></WorkbenchHeader>\r\n    <div class=\"px-10 pb-10\">\r\n      <div class=\"f-c-b\">\r\n        <div>收藏的流程图</div>\r\n        <div></div>\r\n      </div>\r\n      <div class=\"mt-5 text-text-regular text-0.9rem\">文件</div>\r\n      <div class=\"file-list mt-5 f-c-s flex-wrap flex-gap-1.25rem\">\r\n        <template v-if=\"collect\">\r\n          <File\r\n            v-for=\"(item, index) in collect\"\r\n            :key=\"item.id\"\r\n            :file-image=\"item.dataUri\"\r\n            :file-name=\"item.fileName\"\r\n            :is-reset=\"false\"\r\n            :path=\"isMyFlowchart(item) ? '/flowchart/' + item.id : '/share/flowchart/' + item.id\"\r\n            @replicate=\"replicateFlowchart(item)\"\r\n            @delete=\"deleteFlowchart(item.id, index)\"\r\n            @download=\"downloadFlowchart(item)\">\r\n            <template #footer>\r\n              <div class=\"f-c-s flex-nowrap mt-4 w-100%\">\r\n                <div class=\"mr-2 i-tabler-chart-bubble text-theme-primary\"></div>\r\n                <div class=\"text-0.9rem text-ellipsis line-clamp-1\">{{ item.fileName }}</div>\r\n              </div>\r\n              <div class=\"text-text-secondary text-0.8rem mt-2 f-c-s\">\r\n                <div class=\"i-tabler-clock-edit mr-1\"></div>\r\n                {{ DateUtil.formatted(\"MM-dd HH:mm:ss\", item.modifyDate) }}\r\n              </div>\r\n              <div class=\"f-c-s text-text-secondary text-0.8rem mt-2\">\r\n                <img :src=\"item.belongUser.avatar\" class=\"mr-2 w-6 h-6 rd-50%\" />\r\n                <div>\r\n                  {{ isMyFlowchart(item) ? \"我的\" : item.belongUser.username }}\r\n                </div>\r\n              </div>\r\n            </template>\r\n          </File>\r\n        </template>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n"],"names":["collect","shallowRef","searchVal","ref","fetchData","params","FlowchartApi.findAllCollectByCriteria","searchFiles","downloadFlowchart","data","downloadWithDataUri","res","ElMessage","replicateFlowchart","FlowchartApi.replicate","deleteFlowchart","flowchartId","index","FlowchartApi.eraseCollect","triggerRef","token","KeyVals.MAINAPP_TOKEN_KEY","isMyFlowchart","item","__temp","__restore","_withAsyncContext"],"mappings":"y9CAgBA,MAAAA,EAAAC,IACAC,EAAAC,EAAA,EAAA,EAEA,eAAAC,EAAAC,EAAA,CACEL,EAAA,MAAA,MAAAM,EAAAD,CAAA,CAAkE,CAGpE,eAAAE,GAAA,CACEH,EAAA,CAAA,SAAAF,EAAA,KAAA,CAAA,CAAuC,CAGzC,SAAAM,EAAAC,EAAA,CACEC,EAAAD,EACE,OACAE,GAAAC,EAAA,QAAAD,CAAA,EACsCA,GAAAC,EAAA,MAAAD,CAAA,CACF,CACtC,CAGF,SAAAE,EAAAJ,EAAA,CACEA,EAAA,SAAA,SAAAA,EAAA,SACAK,EAAAL,EAAAE,GAAAC,EAAA,QAAAD,EAAA,OAAA,CAAA,CAAkE,CAGpE,SAAAI,EAAAC,EAAAC,EAAA,CACEC,EAAA,CAAA,YAAAF,CAAA,EAAA,IAAA,CACEhB,EAAA,MAAA,OAAAiB,EAAA,CAAA,EACAE,EAAAnB,CAAA,CAAkB,CAAA,CACnB,CAGH,MAAAoB,EAAA,aAAA,SAAAC,CAAA,EAEA,SAAAC,EAAAC,EAAA,CACE,OAAAA,EAAA,WAAA,IAAAH,EAAA,EAAmC,CAGrC,OAAAI,EAAAC,CAAA,EAAAC,EAAA,IAAAtB,EAAA,CAAA,EAAA,MAAAoB,EAAAC"}