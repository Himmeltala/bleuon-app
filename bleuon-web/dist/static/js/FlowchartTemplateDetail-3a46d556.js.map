{"version":3,"file":"FlowchartTemplateDetail-3a46d556.js","sources":["../../../apps/mainapp/views/community/template/FlowchartTemplateDetail.vue"],"sourcesContent":["<script lang=\"ts\" setup>\r\n/**\r\n * @description 社区模板详细页\r\n * @author zheng\r\n * @since 2023/10/5\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n// jointjs css\r\nimport \"jointjs/css/layout.css\";\r\nimport \"jointjs/css/themes/default.css\";\r\n\r\nimport { DateUtil } from \"@common/utils\";\r\nimport { TemplateCommunityApi } from \"@mainapp/apis\";\r\nimport { dia, initJointJs } from \"@mainapp/lib\";\r\nimport { ListenerService } from \"@mainapp/service/diagraming/flowchart\";\r\n\r\n// components\r\nimport CommonHeader from \"@mainapp/components/CommonHeader.vue\";\r\n\r\nconst paper = shallowRef<dia.Paper>();\r\nconst graph = shallowRef<dia.Graph>();\r\n\r\nconst route = useRoute();\r\nconst data = ref<TemplateFlowchartData>();\r\n\r\nasync function fetchData(params: TemplateFlowchartData) {\r\n  data.value = await TemplateCommunityApi.findById(params);\r\n}\r\n\r\nfunction replicateFlowchart() {\r\n  TemplateCommunityApi.replicate(data.value, res => ElMessage.success(res.message));\r\n}\r\n\r\nfunction collectFlowchart() {\r\n  TemplateCommunityApi.addCollect(data.value);\r\n}\r\n\r\nawait fetchData({ id: route.params.id.toString() });\r\n\r\nonMounted(() => {\r\n  const jointjs = initJointJs({\r\n    el: \"bleuon-flowchart-content\",\r\n    width: \"80vw\",\r\n    height: \"100vh\",\r\n    gridSize: data.value.flowchart.gridSize,\r\n    bgColor: data.value.flowchart.bgColor,\r\n    drawGrid: JSON.parse(data.value.flowchart.drawGrid)\r\n  });\r\n\r\n  paper.value = jointjs.paper;\r\n  graph.value = jointjs.graph;\r\n\r\n  paper.value.freeze();\r\n\r\n  if (data.value.flowchart.json) {\r\n    graph.value.fromJSON(JSON.parse(data.value.flowchart.json));\r\n  }\r\n\r\n  paper.value.options.linkConnectorConfig = JSON.parse(data.value.flowchart.connectorDefault);\r\n  paper.value.options.linkRouterConfig = JSON.parse(data.value.flowchart.routerDefault);\r\n\r\n  paper.value.unfreeze();\r\n\r\n  paper.value.on({\r\n    \"blank:mousewheel\": evt => ListenerService.onMousewheelBlank(evt, paper.value)\r\n  });\r\n\r\n  TemplateCommunityApi.renewal({ views: data.value.views + 1, id: data.value.id });\r\n});\r\n</script>\r\n\r\n<template>\r\n  <div class=\"template-community slim-slider h-100vh flow-auto bg-bg-page\">\r\n    <CommonHeader></CommonHeader>\r\n    <div class=\"content f-c-c mb-5\">\r\n      <div class=\"wrapper w-80vw mt-5\">\r\n        <div class=\"bg-bg-overlay p-5\">\r\n          <div class=\"f-c-b\">\r\n            <div>\r\n              <div class=\"font-bold text-1.2rem\">{{ data.flowchart.fileName }}</div>\r\n              <div class=\"f-c-s mt-2 text-text-secondary\">\r\n                <div class=\"i-tabler-clock-edit mr-2\"></div>\r\n                <span>\r\n                  {{ DateUtil.formatted(\"yyyy-MM-dd HH:mm:ss\", data.flowchart.modifyDate) }}\r\n                </span>\r\n              </div>\r\n            </div>\r\n            <div class=\"f-c-s\">\r\n              <div class=\"f-c-s mr-4\">\r\n                <div class=\"i-tabler-eye mr-2\"></div>\r\n                <span>{{ data.views }}</span>\r\n              </div>\r\n              <div class=\"mr-4\">\r\n                <el-button @click=\"collectFlowchart\">\r\n                  {{ data.stars }}\r\n                  <template #icon>\r\n                    <div class=\"i-tabler-star\"></div>\r\n                  </template>\r\n                </el-button>\r\n              </div>\r\n              <div>\r\n                <el-button type=\"primary\" @click=\"replicateFlowchart\">\r\n                  导入模板\r\n                  <template #icon>\r\n                    <div class=\"i-tabler-file-import\"></div>\r\n                  </template>\r\n                </el-button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"f-c-c\">\r\n            <div class=\"mt-5\" id=\"bleuon-flowchart-content\"></div>\r\n          </div>\r\n        </div>\r\n        <div class=\"information mt-5 p-5 bg-bg-overlay\">\r\n          <div class=\"font-500 text-1.2rem\">描述：{{ data.description }}</div>\r\n          <div class=\"mt-5\">\r\n            <el-tag class=\"mr-5\" v-for=\"item in JSON.parse(data.tags)\">{{ item }}</el-tag>\r\n          </div>\r\n          <router-link :to=\"'/u/profile/' + data.flowchart.user.id\">\r\n            <div class=\"cursor-pointer f-c-e mt-5\">\r\n              <img class=\"mr-4 w-10 h-10 rd-50%\" :src=\"data.flowchart.user.avatar\" />\r\n              作者：{{ data.flowchart.user.username }}\r\n            </div>\r\n          </router-link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.joint-element {\r\n  .joint-port {\r\n    circle {\r\n      fill: transparent;\r\n      stroke: transparent;\r\n      stroke-width: 0;\r\n      stroke-dasharray: none;\r\n      --uno: transition-all-300;\r\n    }\r\n  }\r\n\r\n  &:hover {\r\n    .joint-port {\r\n      circle {\r\n        fill: white !important;\r\n        stroke: black;\r\n        stroke-width: 1px;\r\n        stroke-dasharray: none;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.active [joint-selector=\"line\"] {\r\n  stroke: #4666e5;\r\n}\r\n</style>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n"],"names":["paper","shallowRef","graph","route","useRoute","data","ref","fetchData","params","TemplateCommunityApi.findById","replicateFlowchart","TemplateCommunityApi.replicate","res","ElMessage","collectFlowchart","TemplateCommunityApi.addCollect","__temp","__restore","_withAsyncContext","onMounted","jointjs","initJointJs","evt","ListenerService.onMousewheelBlank","TemplateCommunityApi.renewal"],"mappings":"qkDAmBA,MAAAA,EAAAC,IACAC,EAAAD,IAEAE,EAAAC,IACAC,EAAAC,IAEA,eAAAC,EAAAC,EAAA,CACEH,EAAA,MAAA,MAAAI,EAAAD,CAAA,CAAuD,CAGzD,SAAAE,GAAA,CACEC,EAAAN,EAAA,MAAAO,GAAAC,EAAA,QAAAD,EAAA,OAAA,CAAA,CAAgF,CAGlF,SAAAE,GAAA,CACEC,EAAAV,EAAA,KAAA,CAA0C,CAG5C,OAAAW,EAAAC,CAAA,EAAAC,EAAA,IAAAX,EAAA,CAAA,GAAAJ,EAAA,OAAA,GAAA,UAAA,CAAA,CAAA,EAAA,MAAAa,EAAAC,IAEAE,EAAA,IAAA,CACE,MAAAC,EAAAC,EAAA,CAA4B,GAAA,2BACtB,MAAA,OACG,OAAA,QACC,SAAAhB,EAAA,MAAA,UAAA,SACuB,QAAAA,EAAA,MAAA,UAAA,QACD,SAAA,KAAA,MAAAA,EAAA,MAAA,UAAA,QAAA,CACoB,CAAA,EAGpDL,EAAA,MAAAoB,EAAA,MACAlB,EAAA,MAAAkB,EAAA,MAEApB,EAAA,MAAA,SAEAK,EAAA,MAAA,UAAA,MACEH,EAAA,MAAA,SAAA,KAAA,MAAAG,EAAA,MAAA,UAAA,IAAA,CAAA,EAGFL,EAAA,MAAA,QAAA,oBAAA,KAAA,MAAAK,EAAA,MAAA,UAAA,gBAAA,EACAL,EAAA,MAAA,QAAA,iBAAA,KAAA,MAAAK,EAAA,MAAA,UAAA,aAAA,EAEAL,EAAA,MAAA,WAEAA,EAAA,MAAA,GAAA,CAAe,mBAAAsB,GAAAC,EAAAD,EAAAtB,EAAA,KAAA,CACgE,CAAA,EAG/EwB,EAAA,CAAA,MAAAnB,EAAA,MAAA,MAAA,EAAA,GAAAA,EAAA,MAAA,EAAA,CAAA,CAA+E,CAAA"}