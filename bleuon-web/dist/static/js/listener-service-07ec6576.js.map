{"version":3,"file":"listener-service-07ec6576.js","sources":["../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/attributes/calc.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/util/cloneCells.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/attributes/props.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/attributes/index.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/Cell.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/util/wrappers.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/util/getRectPoint.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/layout/ports/port.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/layout/ports/portLabel.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/Link.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/ports.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/Element.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/Graph.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/PaperLayer.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/HighlighterView.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/CellView.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/ElementView.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/routers/normal.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/routers/oneSide.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/routers/orthogonal.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/routers/manhattan.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/routers/metro.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/routers/rightAngle.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/connectors/straight.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/connectors/jumpover.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/connectors/normal.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/connectors/rounded.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/connectors/smooth.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/connectors/curve.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/LinkView.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/highlighters/stroke.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/highlighters/mask.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/highlighters/opacity.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/highlighters/addClass.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/highlighters/list.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/linkAnchors/index.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/connectionPoints/index.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/anchors/index.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/Paper.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/dia/ToolsView.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/env/index.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/shapes/basic.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/shapes/standard.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/shapes/devs.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/shapes/logic.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/shapes/chess.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/shapes/erd.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/shapes/fsa.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/shapes/org.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/shapes/pn.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/shapes/uml.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/linkTools/helpers.mjs","../../../node_modules/.pnpm/jointjs@3.7.5/node_modules/jointjs/src/linkTools/Boundary.mjs","../../../apps/mainapp/lib/namespace.ts","../../../apps/mainapp/lib/init.ts","../../../apps/mainapp/data/diagraming/flowchart/index.ts","../../../apps/mainapp/service/diagraming/flowchart/listener-service.ts"],"sourcesContent":["const props = {\n    x: 'x',\n    y: 'y',\n    width: 'w',\n    height: 'h',\n    minimum: 's',\n    maximum: 'l',\n    diagonal: 'd'\n};\nconst propsList = Object.keys(props).map(key => props[key]).join('');\nconst numberPattern = '[-+]?[0-9]*\\\\.?[0-9]+(?:[eE][-+]?[0-9]+)?';\nconst findSpacesRegex = /\\s/g;\nconst parseExpressionRegExp = new RegExp(`^(${numberPattern}\\\\*)?([${propsList}])(/${numberPattern})?([-+]{1,2}${numberPattern})?$`, 'g');\n\nfunction throwInvalid(expression) {\n    throw new Error(`Invalid calc() expression: ${expression}`);\n}\n\nexport function evalCalcExpression(expression, bbox) {\n    const match = parseExpressionRegExp.exec(expression.replace(findSpacesRegex, ''));\n    if (!match) throwInvalid(expression);\n    parseExpressionRegExp.lastIndex = 0; // reset regex results for the next run\n    const [,multiply, property, divide, add] = match;\n    const { x, y, width, height } = bbox;\n    let value = 0;\n    switch (property) {\n        case props.width: {\n            value = width;\n            break;\n        }\n        case props.height: {\n            value = height;\n            break;\n        }\n        case props.x: {\n            value = x;\n            break;\n        }\n        case props.y: {\n            value = y;\n            break;\n        }\n        case props.minimum: {\n            value = Math.min(height, width);\n            break;\n        }\n        case props.maximum: {\n            value = Math.max(height, width);\n            break;\n        }\n        case props.diagonal: {\n            value = Math.sqrt((height * height) + (width * width));\n            break;\n        }\n    }\n    if (multiply) {\n        // e.g \"2*\"\n        value *= parseFloat(multiply);\n    }\n    if (divide) {\n        // e.g \"/2\"\n        value /= parseFloat(divide.slice(1));\n    }\n    if (add) {\n        value += evalAddExpression(add);\n    }\n    return value;\n}\n\nfunction evalAddExpression(addExpression) {\n    if (!addExpression) return 0;\n    const [sign] = addExpression;\n    switch (sign) {\n        case '+': {\n            return parseFloat(addExpression.substr(1));\n        }\n        case '-': {\n            return -parseFloat(addExpression.substr(1));\n        }\n    }\n    return parseFloat(addExpression);\n}\n\nexport function isCalcAttribute(value) {\n    return typeof value === 'string' && value.includes('calc');\n}\n\nconst calcStart = 'calc(';\nconst calcStartOffset = calcStart.length;\n\nexport function evalCalcAttribute(attributeValue, refBBox) {\n    let value = attributeValue;\n    let startSearchIndex = 0;\n    do {\n        let calcIndex = value.indexOf(calcStart, startSearchIndex);\n        if (calcIndex === -1) return value;\n        let calcEndIndex = calcIndex + calcStartOffset;\n        let brackets = 1;\n        findClosingBracket: do {\n            switch (value[calcEndIndex]) {\n                case '(': {\n                    brackets++;\n                    break;\n                }\n                case ')': {\n                    brackets--;\n                    if (brackets === 0) break findClosingBracket;\n                    break;\n                }\n                case undefined: {\n                    // Could not find the closing bracket.\n                    throwInvalid(value);\n                }\n            }\n            calcEndIndex++;\n        } while (true);\n        // Get the calc() expression without nested calcs (recursion)\n        let expression = value.slice(calcIndex + calcStartOffset, calcEndIndex);\n        if (isCalcAttribute(expression)) {\n            expression = evalCalcAttribute(expression, refBBox);\n        }\n        // Eval the calc() expression without nested calcs.\n        const calcValue = String(evalCalcExpression(expression, refBBox));\n        // Replace the calc() expression and continue search\n        value = value.slice(0, calcIndex) + calcValue + value.slice(calcEndIndex + 1);\n        startSearchIndex = calcIndex + calcValue.length;\n    } while (true);\n}\n","import { uniq, toArray, isEmpty } from './util.mjs';\n\n// Clone `cells` returning an object that maps the original cell ID to the clone. The number\n// of clones is exactly the same as the `cells.length`.\n// This function simply clones all the `cells`. However, it also reconstructs\n// all the `source/target` and `parent/embed` references within the `cells`.\n// This is the main difference from the `cell.clone()` method. The\n// `cell.clone()` method works on one single cell only.\n// For example, for a graph: `A --- L ---> B`, `cloneCells([A, L, B])`\n// returns `[A2, L2, B2]` resulting to a graph: `A2 --- L2 ---> B2`, i.e.\n// the source and target of the link `L2` is changed to point to `A2` and `B2`.\nexport function cloneCells(cells) {\n\n    cells = uniq(cells);\n\n    // A map of the form [original cell ID] -> [clone] helping\n    // us to reconstruct references for source/target and parent/embeds.\n    // This is also the returned value.\n    const cloneMap = toArray(cells).reduce(function(map, cell) {\n        map[cell.id] = cell.clone();\n        return map;\n    }, {});\n\n    toArray(cells).forEach(function(cell) {\n\n        const clone = cloneMap[cell.id];\n        // assert(clone exists)\n\n        if (clone.isLink()) {\n            const source = clone.source();\n            const target = clone.target();\n            if (source.id && cloneMap[source.id]) {\n                // Source points to an element and the element is among the clones.\n                // => Update the source of the cloned link.\n                clone.prop('source/id', cloneMap[source.id].id);\n            }\n            if (target.id && cloneMap[target.id]) {\n                // Target points to an element and the element is among the clones.\n                // => Update the target of the cloned link.\n                clone.prop('target/id', cloneMap[target.id].id);\n            }\n        }\n\n        // Find the parent of the original cell\n        const parent = cell.get('parent');\n        if (parent && cloneMap[parent]) {\n            clone.set('parent', cloneMap[parent].id);\n        }\n\n        // Find the embeds of the original cell\n        const embeds = toArray(cell.get('embeds')).reduce(function(newEmbeds, embed) {\n            // Embedded cells that are not being cloned can not be carried\n            // over with other embedded cells.\n            if (cloneMap[embed]) {\n                newEmbeds.push(cloneMap[embed].id);\n            }\n            return newEmbeds;\n        }, []);\n\n        if (!isEmpty(embeds)) {\n            clone.set('embeds', embeds);\n        }\n    });\n\n    return cloneMap;\n}\n\n","import { isPlainObject } from '../../util/util.mjs';\n\nconst validPropertiesList = ['checked', 'selected', 'disabled', 'readOnly', 'contentEditable', 'value', 'indeterminate'];\n\nconst validProperties = validPropertiesList.reduce((acc, key) => {\n    acc[key] = true;\n    return acc;\n}, {});\n\nconst props = {\n    qualify: function(properties) {\n        return isPlainObject(properties);\n    },\n    set: function(properties, _, node) {\n        Object.keys(properties).forEach(function(key) {\n            if (validProperties[key] && key in node) {\n                const value = properties[key];\n                if (node.tagName === 'SELECT' && Array.isArray(value)) {\n                    Array.from(node.options).forEach(function(option, index) {\n                        option.selected = value.includes(option.value);\n                    });\n                } else {\n                    node[key] = value;\n                }\n            }\n        });\n    }\n};\n\nexport default props;\n","import { Point, Path, Polyline } from '../../g/index.mjs';\nimport { assign, isPlainObject, pick, isObject, isPercentage, breakText } from '../../util/util.mjs';\nimport { isCalcAttribute, evalCalcAttribute } from './calc.mjs';\nimport props from './props.mjs';\nimport $ from 'jquery';\nimport V from '../../V/index.mjs';\n\nfunction setWrapper(attrName, dimension) {\n    return function(value, refBBox) {\n        var isValuePercentage = isPercentage(value);\n        value = parseFloat(value);\n        if (isValuePercentage) {\n            value /= 100;\n        }\n\n        var attrs = {};\n        if (isFinite(value)) {\n            var attrValue = (isValuePercentage || value >= 0 && value <= 1)\n                ? value * refBBox[dimension]\n                : Math.max(value + refBBox[dimension], 0);\n            attrs[attrName] = attrValue;\n        }\n\n        return attrs;\n    };\n}\n\nfunction positionWrapper(axis, dimension, origin) {\n    return function(value, refBBox) {\n        var valuePercentage = isPercentage(value);\n        value = parseFloat(value);\n        if (valuePercentage) {\n            value /= 100;\n        }\n\n        var delta;\n        if (isFinite(value)) {\n            var refOrigin = refBBox[origin]();\n            if (valuePercentage || value > 0 && value < 1) {\n                delta = refOrigin[axis] + refBBox[dimension] * value;\n            } else {\n                delta = refOrigin[axis] + value;\n            }\n        }\n\n        var point = Point();\n        point[axis] = delta || 0;\n        return point;\n    };\n}\n\nfunction offsetWrapper(axis, dimension, corner) {\n    return function(value, nodeBBox) {\n        var delta;\n        if (value === 'middle') {\n            delta = nodeBBox[dimension] / 2;\n        } else if (value === corner) {\n            delta = nodeBBox[dimension];\n        } else if (isFinite(value)) {\n            // TODO: or not to do a breaking change?\n            delta = (value > -1 && value < 1) ? (-nodeBBox[dimension] * value) : -value;\n        } else if (isPercentage(value)) {\n            delta = nodeBBox[dimension] * parseFloat(value) / 100;\n        } else {\n            delta = 0;\n        }\n\n        var point = Point();\n        point[axis] = -(nodeBBox[axis] + delta);\n        return point;\n    };\n}\n\nfunction shapeWrapper(shapeConstructor, opt) {\n    var cacheName = 'joint-shape';\n    var resetOffset = opt && opt.resetOffset;\n    return function(value, refBBox, node) {\n        var $node = $(node);\n        var cache = $node.data(cacheName);\n        if (!cache || cache.value !== value) {\n            // only recalculate if value has changed\n            var cachedShape = shapeConstructor(value);\n            cache = {\n                value: value,\n                shape: cachedShape,\n                shapeBBox: cachedShape.bbox()\n            };\n            $node.data(cacheName, cache);\n        }\n\n        var shape = cache.shape.clone();\n        var shapeBBox = cache.shapeBBox.clone();\n        var shapeOrigin = shapeBBox.origin();\n        var refOrigin = refBBox.origin();\n\n        shapeBBox.x = refOrigin.x;\n        shapeBBox.y = refOrigin.y;\n\n        var fitScale = refBBox.maxRectScaleToFit(shapeBBox, refOrigin);\n        // `maxRectScaleToFit` can give Infinity if width or height is 0\n        var sx = (shapeBBox.width === 0 || refBBox.width === 0) ? 1 : fitScale.sx;\n        var sy = (shapeBBox.height === 0 || refBBox.height === 0) ? 1 : fitScale.sy;\n\n        shape.scale(sx, sy, shapeOrigin);\n        if (resetOffset) {\n            shape.translate(-shapeOrigin.x, -shapeOrigin.y);\n        }\n\n        return shape;\n    };\n}\n\n// `d` attribute for SVGPaths\nfunction dWrapper(opt) {\n    function pathConstructor(value) {\n        return new Path(V.normalizePathData(value));\n    }\n\n    var shape = shapeWrapper(pathConstructor, opt);\n    return function(value, refBBox, node) {\n        var path = shape(value, refBBox, node);\n        return {\n            d: path.serialize()\n        };\n    };\n}\n\n// `points` attribute for SVGPolylines and SVGPolygons\nfunction pointsWrapper(opt) {\n    var shape = shapeWrapper(Polyline, opt);\n    return function(value, refBBox, node) {\n        var polyline = shape(value, refBBox, node);\n        return {\n            points: polyline.serialize()\n        };\n    };\n}\n\nfunction atConnectionWrapper(method, opt) {\n    var zeroVector = new Point(1, 0);\n    return function(value) {\n        var p, angle;\n        var tangent = this[method](value);\n        if (tangent) {\n            angle = (opt.rotate) ? tangent.vector().vectorAngle(zeroVector) : 0;\n            p = tangent.start;\n        } else {\n            p = this.path.start;\n            angle = 0;\n        }\n        if (angle === 0) return { transform: 'translate(' + p.x + ',' + p.y + ')' };\n        return { transform: 'translate(' + p.x + ',' + p.y + ') rotate(' + angle + ')' };\n    };\n}\n\nfunction setIfChangedWrapper(attribute) {\n    return function setIfChanged(value, _, node) {\n        const vel = V(node);\n        if (vel.attr(attribute) === value) return;\n        vel.attr(attribute, value);\n    };\n}\n\nfunction isTextInUse(_value, _node, attrs) {\n    return (attrs.text !== undefined);\n}\n\nfunction isLinkView() {\n    return this.model.isLink();\n}\n\nfunction contextMarker(context) {\n    var marker = {};\n    // Stroke\n    // The context 'fill' is disregared here. The usual case is to use the marker with a connection\n    // (for which 'fill' attribute is set to 'none').\n    var stroke = context.stroke;\n    if (typeof stroke === 'string') {\n        marker['stroke'] = stroke;\n        marker['fill'] = stroke;\n    }\n    // Opacity\n    // Again the context 'fill-opacity' is ignored.\n    var strokeOpacity = context.strokeOpacity;\n    if (strokeOpacity === undefined) strokeOpacity = context['stroke-opacity'];\n    if (strokeOpacity === undefined) strokeOpacity = context.opacity;\n    if (strokeOpacity !== undefined) {\n        marker['stroke-opacity'] = strokeOpacity;\n        marker['fill-opacity'] = strokeOpacity;\n    }\n    return marker;\n}\n\nfunction setPaintURL(def) {\n    const { paper } = this;\n    const url = (def.type === 'pattern')\n        ? paper.definePattern(def)\n        : paper.defineGradient(def);\n    return `url(#${url})`;\n}\n\nconst attributesNS = {\n\n    xlinkShow: {\n        set: 'xlink:show'\n    },\n\n    xlinkRole: {\n        set: 'xlink:role'\n    },\n\n    xlinkType: {\n        set: 'xlink:type'\n    },\n\n    xlinkArcrole: {\n        set: 'xlink:arcrole'\n    },\n\n    xlinkTitle: {\n        set: 'xlink:title'\n    },\n\n    xlinkActuate: {\n        set: 'xlink:actuate'\n    },\n\n    xmlSpace: {\n        set: 'xml:space'\n    },\n\n    xmlBase: {\n        set: 'xml:base'\n    },\n\n    xmlLang: {\n        set: 'xml:lang'\n    },\n\n    preserveAspectRatio: {\n        set: 'preserveAspectRatio'\n    },\n\n    requiredExtension: {\n        set: 'requiredExtension'\n    },\n\n    requiredFeatures: {\n        set: 'requiredFeatures'\n    },\n\n    systemLanguage: {\n        set: 'systemLanguage'\n    },\n\n    externalResourcesRequired: {\n        set: 'externalResourceRequired'\n    },\n\n    href: {\n        set: setIfChangedWrapper('href')\n    },\n\n    xlinkHref: {\n        set: setIfChangedWrapper('xlink:href')\n    },\n\n    filter: {\n        qualify: isPlainObject,\n        set: function(filter) {\n            return 'url(#' + this.paper.defineFilter(filter) + ')';\n        }\n    },\n\n    fill: {\n        qualify: isPlainObject,\n        set: setPaintURL\n    },\n\n    stroke: {\n        qualify: isPlainObject,\n        set: setPaintURL\n    },\n\n    sourceMarker: {\n        qualify: isPlainObject,\n        set: function(marker, refBBox, node, attrs) {\n            marker = assign(contextMarker(attrs), marker);\n            return { 'marker-start': 'url(#' + this.paper.defineMarker(marker) + ')' };\n        }\n    },\n\n    targetMarker: {\n        qualify: isPlainObject,\n        set: function(marker, refBBox, node, attrs) {\n            marker = assign(contextMarker(attrs), { 'transform': 'rotate(180)' }, marker);\n            return { 'marker-end': 'url(#' + this.paper.defineMarker(marker) + ')' };\n        }\n    },\n\n    vertexMarker: {\n        qualify: isPlainObject,\n        set: function(marker, refBBox, node, attrs) {\n            marker = assign(contextMarker(attrs), marker);\n            return { 'marker-mid': 'url(#' + this.paper.defineMarker(marker) + ')' };\n        }\n    },\n\n    text: {\n        qualify: function(_text, _node, attrs) {\n            return !attrs.textWrap || !isPlainObject(attrs.textWrap);\n        },\n        set: function(text, refBBox, node, attrs) {\n            var $node = $(node);\n            var cacheName = 'joint-text';\n            var cache = $node.data(cacheName);\n            var textAttrs = pick(attrs, 'lineHeight', 'annotations', 'textPath', 'x', 'textVerticalAnchor', 'eol', 'displayEmpty');\n            // eval `x` if using calc()\n            const { x } = textAttrs;\n            if (isCalcAttribute(x)) {\n                textAttrs.x = evalCalcAttribute(x, refBBox);\n            }\n\n            let fontSizeAttr = attrs['font-size'] || attrs['fontSize'];\n            if (isCalcAttribute(fontSizeAttr)) {\n                fontSizeAttr = evalCalcAttribute(fontSizeAttr, refBBox);\n            }\n            var fontSize = textAttrs.fontSize = fontSizeAttr;\n            var textHash = JSON.stringify([text, textAttrs]);\n            // Update the text only if there was a change in the string\n            // or any of its attributes.\n            if (cache === undefined || cache !== textHash) {\n                // Chrome bug:\n                // Tspans positions defined as `em` are not updated\n                // when container `font-size` change.\n                if (fontSize) node.setAttribute('font-size', fontSize);\n                // Text Along Path Selector\n                var textPath = textAttrs.textPath;\n                if (isObject(textPath)) {\n                    var pathSelector = textPath.selector;\n                    if (typeof pathSelector === 'string') {\n                        var pathNode = this.findBySelector(pathSelector)[0];\n                        if (pathNode instanceof SVGPathElement) {\n                            textAttrs.textPath = assign({ 'xlink:href': '#' + pathNode.id }, textPath);\n                        }\n                    }\n                }\n                V(node).text('' + text, textAttrs);\n                $node.data(cacheName, textHash);\n            }\n        }\n    },\n\n    textWrap: {\n        qualify: isPlainObject,\n        set: function(value, refBBox, node, attrs) {\n            var size = {};\n            // option `width`\n            var width = value.width || 0;\n            if (isPercentage(width)) {\n                size.width = refBBox.width * parseFloat(width) / 100;\n            } else if (isCalcAttribute(width)) {\n                size.width = Number(evalCalcAttribute(width, refBBox));\n            } else {\n                if (value.width === null) {\n                    // breakText() requires width to be specified.\n                    size.width = Infinity;\n                } else if (width <= 0) {\n                    size.width = refBBox.width + width;\n                } else {\n                    size.width = width;\n                }\n            }\n            // option `height`\n            var height = value.height || 0;\n            if (isPercentage(height)) {\n                size.height = refBBox.height * parseFloat(height) / 100;\n            } else if (isCalcAttribute(height)) {\n                size.height = Number(evalCalcAttribute(height, refBBox));\n            } else {\n                if (value.height === null) {\n                    // if height is not specified breakText() does not\n                    // restrict the height of the text.\n                } else if (height <= 0) {\n                    size.height = refBBox.height + height;\n                } else {\n                    size.height = height;\n                }\n            }\n            // option `text`\n            var wrappedText;\n            var text = value.text;\n            if (text === undefined) text = attrs.text;\n            if (text !== undefined) {\n                const breakTextFn = value.breakText || breakText;\n                const fontSizeAttr = attrs['font-size'] || attrs.fontSize;\n                wrappedText = breakTextFn('' + text, size, {\n                    'font-weight': attrs['font-weight'] || attrs.fontWeight,\n                    'font-size': isCalcAttribute(fontSizeAttr) ? evalCalcAttribute(fontSizeAttr, refBBox) : fontSizeAttr,\n                    'font-family': attrs['font-family'] || attrs.fontFamily,\n                    'lineHeight': attrs.lineHeight,\n                    'letter-spacing': 'letter-spacing' in attrs ? attrs['letter-spacing'] : attrs.letterSpacing\n                }, {\n                    // Provide an existing SVG Document here\n                    // instead of creating a temporary one over again.\n                    svgDocument: this.paper.svg,\n                    ellipsis: value.ellipsis,\n                    hyphen: value.hyphen,\n                    maxLineCount: value.maxLineCount,\n                    preserveSpaces: value.preserveSpaces\n                });\n            } else {\n                wrappedText = '';\n            }\n            attributesNS.text.set.call(this, wrappedText, refBBox, node, attrs);\n        }\n    },\n\n    title: {\n        qualify: function(title, node) {\n            // HTMLElement title is specified via an attribute (i.e. not an element)\n            return node instanceof SVGElement;\n        },\n        set: function(title, refBBox, node) {\n            var $node = $(node);\n            var cacheName = 'joint-title';\n            var cache = $node.data(cacheName);\n            if (cache === undefined || cache !== title) {\n                $node.data(cacheName, title);\n                if (node.tagName === 'title') {\n                    // The target node is a <title> element.\n                    node.textContent = title;\n                    return;\n                }\n                // Generally <title> element should be the first child element of its parent.\n                var firstChild = node.firstElementChild;\n                if (firstChild && firstChild.tagName === 'title') {\n                    // Update an existing title\n                    firstChild.textContent = title;\n                } else {\n                    // Create a new title\n                    var titleNode = document.createElementNS(node.namespaceURI, 'title');\n                    titleNode.textContent = title;\n                    node.insertBefore(titleNode, firstChild);\n                }\n            }\n        }\n    },\n\n    lineHeight: {\n        qualify: isTextInUse\n    },\n\n    textVerticalAnchor: {\n        qualify: isTextInUse\n    },\n\n    textPath: {\n        qualify: isTextInUse\n    },\n\n    annotations: {\n        qualify: isTextInUse\n    },\n\n    eol: {\n        qualify: isTextInUse\n    },\n\n    displayEmpty: {\n        qualify: isTextInUse\n    },\n\n    // `port` attribute contains the `id` of the port that the underlying magnet represents.\n    port: {\n        set: function(port) {\n            return (port === null || port.id === undefined) ? port : port.id;\n        }\n    },\n\n    // `style` attribute is special in the sense that it sets the CSS style of the subelement.\n    style: {\n        qualify: isPlainObject,\n        set: function(styles, refBBox, node) {\n            $(node).css(styles);\n        }\n    },\n\n    html: {\n        set: function(html, refBBox, node) {\n            $(node).html(html + '');\n        }\n    },\n\n    // Properties setter (set various properties on the node)\n    props,\n\n    ref: {\n        // We do not set `ref` attribute directly on an element.\n        // The attribute itself does not qualify for relative positioning.\n    },\n\n    // if `refX` is in [0, 1] then `refX` is a fraction of bounding box width\n    // if `refX` is < 0 then `refX`'s absolute values is the right coordinate of the bounding box\n    // otherwise, `refX` is the left coordinate of the bounding box\n\n    refX: {\n        position: positionWrapper('x', 'width', 'origin')\n    },\n\n    refY: {\n        position: positionWrapper('y', 'height', 'origin')\n    },\n\n    // `ref-dx` and `ref-dy` define the offset of the subelement relative to the right and/or bottom\n    // coordinate of the reference element.\n\n    refDx: {\n        position: positionWrapper('x', 'width', 'corner')\n    },\n\n    refDy: {\n        position: positionWrapper('y', 'height', 'corner')\n    },\n\n    // 'ref-width'/'ref-height' defines the width/height of the subelement relatively to\n    // the reference element size\n    // val in 0..1         ref-width = 0.75 sets the width to 75% of the ref. el. width\n    // val < 0 || val > 1  ref-height = -20 sets the height to the ref. el. height shorter by 20\n\n    refWidth: {\n        set: setWrapper('width', 'width')\n    },\n\n    refHeight: {\n        set: setWrapper('height', 'height')\n    },\n\n    refRx: {\n        set: setWrapper('rx', 'width')\n    },\n\n    refRy: {\n        set: setWrapper('ry', 'height')\n    },\n\n    refRInscribed: {\n        set: (function(attrName) {\n            var widthFn = setWrapper(attrName, 'width');\n            var heightFn = setWrapper(attrName, 'height');\n            return function(value, refBBox) {\n                var fn = (refBBox.height > refBBox.width) ? widthFn : heightFn;\n                return fn(value, refBBox);\n            };\n        })('r')\n    },\n\n    refRCircumscribed: {\n        set: function(value, refBBox) {\n            var isValuePercentage = isPercentage(value);\n            value = parseFloat(value);\n            if (isValuePercentage) {\n                value /= 100;\n            }\n\n            var diagonalLength = Math.sqrt((refBBox.height * refBBox.height) + (refBBox.width * refBBox.width));\n\n            var rValue;\n            if (isFinite(value)) {\n                if (isValuePercentage || value >= 0 && value <= 1) rValue = value * diagonalLength;\n                else rValue = Math.max(value + diagonalLength, 0);\n            }\n\n            return { r: rValue };\n        }\n    },\n\n    refCx: {\n        set: setWrapper('cx', 'width')\n    },\n\n    refCy: {\n        set: setWrapper('cy', 'height')\n    },\n\n    // `x-alignment` when set to `middle` causes centering of the subelement around its new x coordinate.\n    // `x-alignment` when set to `right` uses the x coordinate as referenced to the right of the bbox.\n\n    xAlignment: {\n        offset: offsetWrapper('x', 'width', 'right')\n    },\n\n    // `y-alignment` when set to `middle` causes centering of the subelement around its new y coordinate.\n    // `y-alignment` when set to `bottom` uses the y coordinate as referenced to the bottom of the bbox.\n\n    yAlignment: {\n        offset: offsetWrapper('y', 'height', 'bottom')\n    },\n\n    resetOffset: {\n        offset: function(val, nodeBBox) {\n            return (val)\n                ? { x: -nodeBBox.x, y: -nodeBBox.y }\n                : { x: 0, y: 0 };\n        }\n\n    },\n\n    refDResetOffset: {\n        set: dWrapper({ resetOffset: true })\n    },\n\n    refDKeepOffset: {\n        set: dWrapper({ resetOffset: false })\n    },\n\n    refPointsResetOffset: {\n        set: pointsWrapper({ resetOffset: true })\n    },\n\n    refPointsKeepOffset: {\n        set: pointsWrapper({ resetOffset: false })\n    },\n\n    // LinkView Attributes\n\n    connection: {\n        qualify: isLinkView,\n        set: function({ stubs = 0 }) {\n            let d;\n            if (isFinite(stubs) && stubs !== 0) {\n                let offset;\n                if (stubs < 0) {\n                    offset = (this.getConnectionLength() + stubs) / 2;\n                } else {\n                    offset = stubs;\n                }\n                const path = this.getConnection();\n                const segmentSubdivisions = this.getConnectionSubdivisions();\n                const sourceParts = path.divideAtLength(offset, { segmentSubdivisions });\n                const targetParts = path.divideAtLength(-offset, { segmentSubdivisions });\n                if (sourceParts && targetParts) {\n                    d = `${sourceParts[0].serialize()} ${targetParts[1].serialize()}`;\n                }\n            }\n\n            return { d: d || this.getSerializedConnection() };\n        }\n    },\n\n    atConnectionLengthKeepGradient: {\n        qualify: isLinkView,\n        set: atConnectionWrapper('getTangentAtLength', { rotate: true })\n    },\n\n    atConnectionLengthIgnoreGradient: {\n        qualify: isLinkView,\n        set: atConnectionWrapper('getTangentAtLength', { rotate: false })\n    },\n\n    atConnectionRatioKeepGradient: {\n        qualify: isLinkView,\n        set: atConnectionWrapper('getTangentAtRatio', { rotate: true })\n    },\n\n    atConnectionRatioIgnoreGradient: {\n        qualify: isLinkView,\n        set: atConnectionWrapper('getTangentAtRatio', { rotate: false })\n    }\n};\n\nattributesNS['xlink:href'] = attributesNS.xlinkHref;\n\n// Support `calc()` with the following SVG attributes\n[\n    'transform', // g\n    'd', // path\n    'points', // polyline / polygon\n    'cx', 'cy', // circle / ellipse\n    'x1', 'x2', 'y1', 'y2', // line\n    'x', 'y', // rect / text / image\n    'dx', 'dy' // text\n].forEach(attribute => {\n    attributesNS[attribute] = {\n        qualify: isCalcAttribute,\n        set: function setCalcAttribute(value, refBBox) {\n            return { [attribute]: evalCalcAttribute(value, refBBox) };\n        }\n    };\n});\n\n// Prevent \"A negative value is not valid\" error.\n[\n    'width', 'height', // rect / image\n    'r', // circle\n    'rx', 'ry', // rect / ellipse\n    'font-size', // text\n    'stroke-width' // elements\n].forEach(attribute => {\n    attributesNS[attribute] = {\n        qualify: isCalcAttribute,\n        set: function setCalcAttribute(value, refBBox) {\n            return { [attribute]: Math.max(0, evalCalcAttribute(value, refBBox)) };\n        }\n    };\n});\n\n// Aliases\nattributesNS.refR = attributesNS.refRInscribed;\nattributesNS.refD = attributesNS.refDResetOffset;\nattributesNS.refPoints = attributesNS.refPointsResetOffset;\nattributesNS.atConnectionLength = attributesNS.atConnectionLengthKeepGradient;\nattributesNS.atConnectionRatio = attributesNS.atConnectionRatioKeepGradient;\nattributesNS.fontSize = attributesNS['font-size'];\nattributesNS.strokeWidth = attributesNS['stroke-width'];\n\n// This allows to combine both absolute and relative positioning\n// refX: 50%, refX2: 20\nattributesNS.refX2 = attributesNS.refX;\nattributesNS.refY2 = attributesNS.refY;\nattributesNS.refWidth2 = attributesNS.refWidth;\nattributesNS.refHeight2 = attributesNS.refHeight;\n\n// Aliases for backwards compatibility\nattributesNS['ref-x'] = attributesNS.refX;\nattributesNS['ref-y'] = attributesNS.refY;\nattributesNS['ref-dy'] = attributesNS.refDy;\nattributesNS['ref-dx'] = attributesNS.refDx;\nattributesNS['ref-width'] = attributesNS.refWidth;\nattributesNS['ref-height'] = attributesNS.refHeight;\nattributesNS['x-alignment'] = attributesNS.xAlignment;\nattributesNS['y-alignment'] = attributesNS.yAlignment;\n\nexport const attributes = attributesNS;\n\n","import Backbone from 'backbone';\nimport {\n    uniqueId,\n    union,\n    result,\n    merge,\n    forIn,\n    isObject,\n    isEqual,\n    isString,\n    cloneDeep,\n    omit,\n    uuid,\n    isEmpty,\n    assign,\n    uniq,\n    toArray,\n    setByPath,\n    unsetByPath,\n    getByPath,\n    timing,\n    interpolate,\n    nextFrame,\n    without,\n    cancelFrame,\n    defaultsDeep,\n    has,\n    sortBy,\n    defaults\n} from '../util/util.mjs';\nimport { cloneCells } from '../util/cloneCells.mjs';\nimport { attributes } from './attributes/index.mjs';\nimport * as g from '../g/index.mjs';\n\n\n// Cell base model.\n// --------------------------\n\nexport const Cell = Backbone.Model.extend({\n\n    // This is the same as Backbone.Model with the only difference that is uses util.merge\n    // instead of just _.extend. The reason is that we want to mixin attributes set in upper classes.\n    constructor: function(attributes, options) {\n\n        var defaults;\n        var attrs = attributes || {};\n        if (typeof this.preinitialize === 'function') {\n            // Check to support an older version of Backbone (prior v1.4)\n            this.preinitialize.apply(this, arguments);\n        }\n        this.cid = uniqueId('c');\n        this.attributes = {};\n        if (options && options.collection) this.collection = options.collection;\n        if (options && options.parse) attrs = this.parse(attrs, options) || {};\n        if ((defaults = result(this, 'defaults'))) {\n            //<custom code>\n            // Replaced the call to _.defaults with util.merge.\n            attrs = merge({}, defaults, attrs);\n            //</custom code>\n        }\n        this.set(attrs, options);\n        this.changed = {};\n        this.initialize.apply(this, arguments);\n    },\n\n    translate: function(dx, dy, opt) {\n\n        throw new Error('Must define a translate() method.');\n    },\n\n    toJSON: function() {\n\n        const defaults = result(this.constructor.prototype, 'defaults');\n        const defaultAttrs = defaults.attrs || {};\n        const attrs = this.attributes.attrs;\n        const finalAttrs = {};\n\n        // Loop through all the attributes and\n        // omit the default attributes as they are implicitly reconstructible by the cell 'type'.\n        forIn(attrs, function(attr, selector) {\n\n            const defaultAttr = defaultAttrs[selector];\n\n            forIn(attr, function(value, name) {\n\n                // attr is mainly flat though it might have one more level (consider the `style` attribute).\n                // Check if the `value` is object and if yes, go one level deep.\n                if (isObject(value) && !Array.isArray(value)) {\n\n                    forIn(value, function(value2, name2) {\n\n                        if (!defaultAttr || !defaultAttr[name] || !isEqual(defaultAttr[name][name2], value2)) {\n\n                            finalAttrs[selector] = finalAttrs[selector] || {};\n                            (finalAttrs[selector][name] || (finalAttrs[selector][name] = {}))[name2] = value2;\n                        }\n                    });\n\n                } else if (!defaultAttr || !isEqual(defaultAttr[name], value)) {\n                    // `value` is not an object, default attribute for such a selector does not exist\n                    // or it is different than the attribute value set on the model.\n\n                    finalAttrs[selector] = finalAttrs[selector] || {};\n                    finalAttrs[selector][name] = value;\n                }\n            });\n        });\n\n        const attributes = cloneDeep(omit(this.attributes, 'attrs'));\n        attributes.attrs = finalAttrs;\n\n        return attributes;\n    },\n\n    initialize: function(options) {\n\n        const idAttribute = this.getIdAttribute();\n        if (!options || options[idAttribute] === undefined) {\n            this.set(idAttribute, this.generateId(), { silent: true });\n        }\n\n        this._transitionIds = {};\n        this._scheduledTransitionIds = {};\n\n        // Collect ports defined in `attrs` and keep collecting whenever `attrs` object changes.\n        this.processPorts();\n        this.on('change:attrs', this.processPorts, this);\n    },\n\n    getIdAttribute: function() {\n        return this.idAttribute || 'id';\n    },\n\n    generateId: function() {\n        return uuid();\n    },\n\n    /**\n     * @deprecated\n     */\n    processPorts: function() {\n\n        // Whenever `attrs` changes, we extract ports from the `attrs` object and store it\n        // in a more accessible way. Also, if any port got removed and there were links that had `target`/`source`\n        // set to that port, we remove those links as well (to follow the same behaviour as\n        // with a removed element).\n\n        var previousPorts = this.ports;\n\n        // Collect ports from the `attrs` object.\n        var ports = {};\n        forIn(this.get('attrs'), function(attrs, selector) {\n\n            if (attrs && attrs.port) {\n\n                // `port` can either be directly an `id` or an object containing an `id` (and potentially other data).\n                if (attrs.port.id !== undefined) {\n                    ports[attrs.port.id] = attrs.port;\n                } else {\n                    ports[attrs.port] = { id: attrs.port };\n                }\n            }\n        });\n\n        // Collect ports that have been removed (compared to the previous ports) - if any.\n        // Use hash table for quick lookup.\n        var removedPorts = {};\n        forIn(previousPorts, function(port, id) {\n\n            if (!ports[id]) removedPorts[id] = true;\n        });\n\n        // Remove all the incoming/outgoing links that have source/target port set to any of the removed ports.\n        if (this.graph && !isEmpty(removedPorts)) {\n\n            var inboundLinks = this.graph.getConnectedLinks(this, { inbound: true });\n            inboundLinks.forEach(function(link) {\n\n                if (removedPorts[link.get('target').port]) link.remove();\n            });\n\n            var outboundLinks = this.graph.getConnectedLinks(this, { outbound: true });\n            outboundLinks.forEach(function(link) {\n\n                if (removedPorts[link.get('source').port]) link.remove();\n            });\n        }\n\n        // Update the `ports` object.\n        this.ports = ports;\n    },\n\n    remove: function(opt = {}) {\n\n        // Store the graph in a variable because `this.graph` won't be accessible\n        // after `this.trigger('remove', ...)` down below.\n        const { graph, collection } = this;\n        if (!graph) {\n            // The collection is a common Backbone collection (not the graph collection).\n            if (collection) collection.remove(this, opt);\n            return this;\n        }\n\n        graph.startBatch('remove');\n\n        // First, unembed this cell from its parent cell if there is one.\n        const parentCell = this.getParentCell();\n        if (parentCell) {\n            parentCell.unembed(this, opt);\n        }\n\n        // Remove also all the cells, which were embedded into this cell\n        const embeddedCells = this.getEmbeddedCells();\n        for (let i = 0, n = embeddedCells.length; i < n; i++) {\n            const embed = embeddedCells[i];\n            if (embed) {\n                embed.remove(opt);\n            }\n        }\n\n        this.trigger('remove', this, graph.attributes.cells, opt);\n\n        graph.stopBatch('remove');\n\n        return this;\n    },\n\n    toFront: function(opt) {\n        var graph = this.graph;\n        if (graph) {\n            opt = defaults(opt || {}, { foregroundEmbeds: true });\n\n            let cells;\n            if (opt.deep) {\n                cells = this.getEmbeddedCells({ deep: true, breadthFirst: opt.breadthFirst !== false, sortSiblings: opt.foregroundEmbeds });\n                cells.unshift(this);\n            } else {\n                cells = [this];\n            }\n\n            const sortedCells = opt.foregroundEmbeds ? cells : sortBy(cells, cell => cell.z());\n\n            const maxZ = graph.maxZIndex();\n            let z = maxZ - cells.length + 1;\n\n            const collection = graph.get('cells');\n\n            let shouldUpdate = (collection.indexOf(sortedCells[0]) !== (collection.length - cells.length));\n            if (!shouldUpdate) {\n                shouldUpdate = sortedCells.some(function(cell, index) {\n                    return cell.z() !== z + index;\n                });\n            }\n\n            if (shouldUpdate) {\n                this.startBatch('to-front');\n\n                z = z + cells.length;\n\n                sortedCells.forEach(function(cell, index) {\n                    cell.set('z', z + index, opt);\n                });\n\n                this.stopBatch('to-front');\n            }\n        }\n\n        return this;\n    },\n\n    toBack: function(opt) {\n        var graph = this.graph;\n        if (graph) {\n            opt = defaults(opt || {}, { foregroundEmbeds: true });\n\n            let cells;\n            if (opt.deep) {\n                cells = this.getEmbeddedCells({ deep: true, breadthFirst: opt.breadthFirst !== false, sortSiblings: opt.foregroundEmbeds });\n                cells.unshift(this);\n            } else {\n                cells = [this];\n            }\n\n            const sortedCells = opt.foregroundEmbeds ? cells : sortBy(cells, cell => cell.z());\n\n            let z = graph.minZIndex();\n\n            var collection = graph.get('cells');\n\n            let shouldUpdate = (collection.indexOf(sortedCells[0]) !== 0);\n            if (!shouldUpdate) {\n                shouldUpdate = sortedCells.some(function(cell, index) {\n                    return cell.z() !== z + index;\n                });\n            }\n\n            if (shouldUpdate) {\n                this.startBatch('to-back');\n\n                z -= cells.length;\n\n                sortedCells.forEach(function(cell, index) {\n                    cell.set('z', z + index, opt);\n                });\n\n                this.stopBatch('to-back');\n            }\n        }\n\n        return this;\n    },\n\n    parent: function(parent, opt) {\n\n        // getter\n        if (parent === undefined) return this.get('parent');\n        // setter\n        return this.set('parent', parent, opt);\n    },\n\n    embed: function(cell, opt) {\n        const cells = Array.isArray(cell) ? cell : [cell];\n        if (!this.canEmbed(cells)) {\n            throw new Error('Recursive embedding not allowed.');\n        }\n        if (cells.some(c => c.isEmbedded() && this.id !== c.parent())) {\n            throw new Error('Embedding of already embedded cells is not allowed.');\n        }\n        this._embedCells(cells, opt);\n        return this;\n    },\n\n    unembed: function(cell, opt) {\n        const cells = Array.isArray(cell) ? cell : [cell];\n        this._unembedCells(cells, opt);\n        return this;\n    },\n\n    canEmbed: function(cell) {\n        const cells = Array.isArray(cell) ? cell : [cell];\n        return cells.every(c => this !== c && !this.isEmbeddedIn(c));\n    },\n\n    _embedCells: function(cells, opt) {\n        const batchName = 'embed';\n        this.startBatch(batchName);\n        const embeds = assign([], this.get('embeds'));\n        cells.forEach(cell => {\n            // We keep all element ids after link ids.\n            embeds[cell.isLink() ? 'unshift' : 'push'](cell.id);\n            cell.parent(this.id, opt);\n        });\n        this.set('embeds', uniq(embeds), opt);\n        this.stopBatch(batchName);\n    },\n\n    _unembedCells: function(cells, opt) {\n        const batchName = 'unembed';\n        this.startBatch(batchName);\n        cells.forEach(cell => cell.unset('parent', opt));\n        this.set('embeds', without(this.get('embeds'), ...cells.map(cell => cell.id)), opt);\n        this.stopBatch(batchName);\n    },\n\n    getParentCell: function() {\n\n        // unlike link.source/target, cell.parent stores id directly as a string\n        var parentId = this.parent();\n        var graph = this.graph;\n\n        return (parentId && graph && graph.getCell(parentId)) || null;\n    },\n\n    // Return an array of ancestor cells.\n    // The array is ordered from the parent of the cell\n    // to the most distant ancestor.\n    getAncestors: function() {\n\n        var ancestors = [];\n\n        if (!this.graph) {\n            return ancestors;\n        }\n\n        var parentCell = this.getParentCell();\n        while (parentCell) {\n            ancestors.push(parentCell);\n            parentCell = parentCell.getParentCell();\n        }\n\n        return ancestors;\n    },\n\n    getEmbeddedCells: function(opt) {\n\n        opt = opt || {};\n\n        // Cell models can only be retrieved when this element is part of a collection.\n        // There is no way this element knows about other cells otherwise.\n        // This also means that calling e.g. `translate()` on an element with embeds before\n        // adding it to a graph does not translate its embeds.\n        if (!this.graph) {\n            return [];\n        }\n\n        if (opt.deep) {\n            if (opt.breadthFirst) {\n                return this._getEmbeddedCellsBfs(opt.sortSiblings);\n            } else {\n                return this._getEmbeddedCellsDfs(opt.sortSiblings);\n            }\n        }\n\n        const embeddedIds = this.get('embeds');\n        if (isEmpty(embeddedIds)) {\n            return [];\n        }\n\n        let cells = embeddedIds.map(this.graph.getCell, this.graph);\n        if (opt.sortSiblings) {\n            cells = sortBy(cells, cell => cell.z());\n        }\n\n        return cells;\n    },\n\n    _getEmbeddedCellsBfs: function(sortSiblings) {\n        const cells = [];\n\n        const queue = [];\n        queue.push(this);\n\n        while (queue.length > 0) {\n            const current = queue.shift();\n            cells.push(current);\n\n            const embeddedCells = current.getEmbeddedCells({ sortSiblings: sortSiblings });\n\n            queue.push(...embeddedCells);\n        }\n        cells.shift();\n\n        return cells;\n    },\n\n    _getEmbeddedCellsDfs: function(sortSiblings) {\n        const cells = [];\n\n        const stack = [];\n        stack.push(this);\n\n        while (stack.length > 0) {\n            const current = stack.pop();\n            cells.push(current);\n\n            const embeddedCells = current.getEmbeddedCells({ sortSiblings: sortSiblings });\n\n            // When using the stack, cells that are embedded last are processed first.\n            // To maintain the original order, we need to push the cells in reverse order\n            for (let i = embeddedCells.length - 1; i >= 0; --i) {\n                stack.push(embeddedCells[i]);\n            }\n        }\n        cells.shift();\n\n        return cells;\n    },\n\n    isEmbeddedIn: function(cell, opt) {\n\n        var cellId = isString(cell) ? cell : cell.id;\n        var parentId = this.parent();\n\n        opt = assign({ deep: true }, opt);\n\n        // See getEmbeddedCells().\n        if (this.graph && opt.deep) {\n\n            while (parentId) {\n                if (parentId === cellId) {\n                    return true;\n                }\n                parentId = this.graph.getCell(parentId).parent();\n            }\n\n            return false;\n\n        } else {\n\n            // When this cell is not part of a collection check\n            // at least whether it's a direct child of given cell.\n            return parentId === cellId;\n        }\n    },\n\n    // Whether or not the cell is embedded in any other cell.\n    isEmbedded: function() {\n\n        return !!this.parent();\n    },\n\n    // Isolated cloning. Isolated cloning has two versions: shallow and deep (pass `{ deep: true }` in `opt`).\n    // Shallow cloning simply clones the cell and returns a new cell with different ID.\n    // Deep cloning clones the cell and all its embedded cells recursively.\n    clone: function(opt) {\n\n        opt = opt || {};\n\n        if (!opt.deep) {\n            // Shallow cloning.\n\n            var clone = Backbone.Model.prototype.clone.apply(this, arguments);\n            // We don't want the clone to have the same ID as the original.\n            clone.set(this.getIdAttribute(), this.generateId());\n            // A shallow cloned element does not carry over the original embeds.\n            clone.unset('embeds');\n            // And can not be embedded in any cell\n            // as the clone is not part of the graph.\n            clone.unset('parent');\n\n            return clone;\n\n        } else {\n            // Deep cloning.\n\n            // For a deep clone, simply call `graph.cloneCells()` with the cell and all its embedded cells.\n            return toArray(cloneCells([this].concat(this.getEmbeddedCells({ deep: true }))));\n        }\n    },\n\n    // A convenient way to set nested properties.\n    // This method merges the properties you'd like to set with the ones\n    // stored in the cell and makes sure change events are properly triggered.\n    // You can either set a nested property with one object\n    // or use a property path.\n    // The most simple use case is:\n    // `cell.prop('name/first', 'John')` or\n    // `cell.prop({ name: { first: 'John' } })`.\n    // Nested arrays are supported too:\n    // `cell.prop('series/0/data/0/degree', 50)` or\n    // `cell.prop({ series: [ { data: [ { degree: 50 } ] } ] })`.\n    prop: function(props, value, opt) {\n\n        var delim = '/';\n        var _isString = isString(props);\n\n        if (_isString || Array.isArray(props)) {\n            // Get/set an attribute by a special path syntax that delimits\n            // nested objects by the colon character.\n\n            if (arguments.length > 1) {\n\n                var path;\n                var pathArray;\n\n                if (_isString) {\n                    path = props;\n                    pathArray = path.split('/');\n                } else {\n                    path = props.join(delim);\n                    pathArray = props.slice();\n                }\n\n                var property = pathArray[0];\n                var pathArrayLength = pathArray.length;\n\n                const options = opt || {};\n                options.propertyPath = path;\n                options.propertyValue = value;\n                options.propertyPathArray = pathArray;\n                if (!('rewrite' in options)) {\n                    options.rewrite = false;\n                }\n\n                var update = {};\n                // Initialize the nested object. Sub-objects are either arrays or objects.\n                // An empty array is created if the sub-key is an integer. Otherwise, an empty object is created.\n                // Note that this imposes a limitation on object keys one can use with Inspector.\n                // Pure integer keys will cause issues and are therefore not allowed.\n                var initializer = update;\n                var prevProperty = property;\n\n                for (var i = 1; i < pathArrayLength; i++) {\n                    var pathItem = pathArray[i];\n                    var isArrayIndex = Number.isFinite(_isString ? Number(pathItem) : pathItem);\n                    initializer = initializer[prevProperty] = isArrayIndex ? [] : {};\n                    prevProperty = pathItem;\n                }\n\n                // Fill update with the `value` on `path`.\n                update = setByPath(update, pathArray, value, '/');\n\n                var baseAttributes = merge({}, this.attributes);\n                // if rewrite mode enabled, we replace value referenced by path with\n                // the new one (we don't merge).\n                options.rewrite && unsetByPath(baseAttributes, path, '/');\n\n                // Merge update with the model attributes.\n                var attributes = merge(baseAttributes, update);\n                // Finally, set the property to the updated attributes.\n                return this.set(property, attributes[property], options);\n\n            } else {\n\n                return getByPath(this.attributes, props, delim);\n            }\n        }\n\n        const options = value || {};\n        // Note: '' is not the path to the root. It's a path with an empty string i.e. { '': {}}.\n        options.propertyPath = null;\n        options.propertyValue = props;\n        options.propertyPathArray = [];\n        if (!('rewrite' in options)) {\n            options.rewrite = false;\n        }\n\n        return this.set(merge({}, this.attributes, props), options);\n    },\n\n    // A convenient way to unset nested properties\n    removeProp: function(path, opt) {\n\n        opt = opt || {};\n\n        var pathArray = Array.isArray(path) ? path : path.split('/');\n\n        // Once a property is removed from the `attrs` attribute\n        // the cellView will recognize a `dirty` flag and re-render itself\n        // in order to remove the attribute from SVG element.\n        var property = pathArray[0];\n        if (property === 'attrs') opt.dirty = true;\n\n        if (pathArray.length === 1) {\n            // A top level property\n            return this.unset(path, opt);\n        }\n\n        // A nested property\n        var nestedPath = pathArray.slice(1);\n        var propertyValue = this.get(property);\n        if (propertyValue === undefined || propertyValue === null) return this;\n        propertyValue = cloneDeep(propertyValue);\n\n        unsetByPath(propertyValue, nestedPath, '/');\n\n        return this.set(property, propertyValue, opt);\n    },\n\n    // A convenient way to set nested attributes.\n    attr: function(attrs, value, opt) {\n\n        var args = Array.from(arguments);\n        if (args.length === 0) {\n            return this.get('attrs');\n        }\n\n        if (Array.isArray(attrs)) {\n            args[0] = ['attrs'].concat(attrs);\n        } else if (isString(attrs)) {\n            // Get/set an attribute by a special path syntax that delimits\n            // nested objects by the colon character.\n            args[0] = 'attrs/' + attrs;\n\n        } else {\n\n            args[0] = { 'attrs' : attrs };\n        }\n\n        return this.prop.apply(this, args);\n    },\n\n    // A convenient way to unset nested attributes\n    removeAttr: function(path, opt) {\n\n        if (Array.isArray(path)) {\n\n            return this.removeProp(['attrs'].concat(path));\n        }\n\n        return this.removeProp('attrs/' + path, opt);\n    },\n\n    transition: function(path, value, opt, delim) {\n\n        delim = delim || '/';\n\n        var defaults = {\n            duration: 100,\n            delay: 10,\n            timingFunction: timing.linear,\n            valueFunction: interpolate.number\n        };\n\n        opt = assign(defaults, opt);\n\n        var firstFrameTime = 0;\n        var interpolatingFunction;\n\n        var setter = function(runtime) {\n\n            var id, progress, propertyValue;\n\n            firstFrameTime = firstFrameTime || runtime;\n            runtime -= firstFrameTime;\n            progress = runtime / opt.duration;\n\n            if (progress < 1) {\n                this._transitionIds[path] = id = nextFrame(setter);\n            } else {\n                progress = 1;\n                delete this._transitionIds[path];\n            }\n\n            propertyValue = interpolatingFunction(opt.timingFunction(progress));\n\n            opt.transitionId = id;\n\n            this.prop(path, propertyValue, opt);\n\n            if (!id) this.trigger('transition:end', this, path);\n\n        }.bind(this);\n\n        const { _scheduledTransitionIds } = this;\n        let initialId;\n\n        var initiator = (callback) => {\n\n            if (_scheduledTransitionIds[path]) {\n                _scheduledTransitionIds[path] = without(_scheduledTransitionIds[path], initialId);\n                if (_scheduledTransitionIds[path].length === 0) {\n                    delete _scheduledTransitionIds[path];\n                }\n            }\n\n            this.stopPendingTransitions(path, delim);\n\n            interpolatingFunction = opt.valueFunction(getByPath(this.attributes, path, delim), value);\n\n            this._transitionIds[path] = nextFrame(callback);\n\n            this.trigger('transition:start', this, path);\n\n        };\n\n        initialId = setTimeout(initiator, opt.delay, setter);\n\n        _scheduledTransitionIds[path] || (_scheduledTransitionIds[path] = []);\n        _scheduledTransitionIds[path].push(initialId);\n\n        return initialId;\n    },\n\n    getTransitions: function() {\n        return union(\n            Object.keys(this._transitionIds),\n            Object.keys(this._scheduledTransitionIds)\n        );\n    },\n\n    stopScheduledTransitions: function(path, delim = '/') {\n        const { _scheduledTransitionIds = {}} = this;\n        let transitions = Object.keys(_scheduledTransitionIds);\n        if (path) {\n            const pathArray = path.split(delim);\n            transitions = transitions.filter((key) => {\n                return isEqual(pathArray, key.split(delim).slice(0, pathArray.length));\n            });\n        }\n        transitions.forEach((key) => {\n            const transitionIds = _scheduledTransitionIds[key];\n            // stop the initiator\n            transitionIds.forEach(transitionId => clearTimeout(transitionId));\n            delete _scheduledTransitionIds[key];\n            // Note: we could trigger transition:cancel` event here\n        });\n        return this;\n    },\n\n    stopPendingTransitions(path, delim = '/') {\n        const { _transitionIds = {}} = this;\n        let transitions = Object.keys(_transitionIds);\n        if (path) {\n            const pathArray = path.split(delim);\n            transitions = transitions.filter((key) => {\n                return isEqual(pathArray, key.split(delim).slice(0, pathArray.length));\n            });\n        }\n        transitions.forEach((key) => {\n            const transitionId = _transitionIds[key];\n            // stop the setter\n            cancelFrame(transitionId);\n            delete _transitionIds[key];\n            this.trigger('transition:end', this, key);\n        });\n    },\n\n    stopTransitions: function(path, delim = '/') {\n        this.stopScheduledTransitions(path, delim);\n        this.stopPendingTransitions(path, delim);\n        return this;\n    },\n\n    // A shorcut making it easy to create constructs like the following:\n    // `var el = (new joint.shapes.basic.Rect).addTo(graph)`.\n    addTo: function(graph, opt) {\n\n        graph.addCell(this, opt);\n        return this;\n    },\n\n    // A shortcut for an equivalent call: `paper.findViewByModel(cell)`\n    // making it easy to create constructs like the following:\n    // `cell.findView(paper).highlight()`\n    findView: function(paper) {\n\n        return paper.findViewByModel(this);\n    },\n\n    isElement: function() {\n\n        return false;\n    },\n\n    isLink: function() {\n\n        return false;\n    },\n\n    startBatch: function(name, opt) {\n\n        if (this.graph) { this.graph.startBatch(name, assign({}, opt, { cell: this })); }\n        return this;\n    },\n\n    stopBatch: function(name, opt) {\n\n        if (this.graph) { this.graph.stopBatch(name, assign({}, opt, { cell: this })); }\n        return this;\n    },\n\n    getChangeFlag: function(attributes) {\n\n        var flag = 0;\n        if (!attributes) return flag;\n        for (var key in attributes) {\n            if (!attributes.hasOwnProperty(key) || !this.hasChanged(key)) continue;\n            flag |= attributes[key];\n        }\n        return flag;\n    },\n\n    angle: function() {\n\n        // To be overridden.\n        return 0;\n    },\n\n    position: function() {\n\n        // To be overridden.\n        return new g.Point(0, 0);\n    },\n\n    z: function() {\n        return this.get('z') || 0;\n    },\n\n    getPointFromConnectedLink: function() {\n\n        // To be overridden\n        return new g.Point();\n    },\n\n    getBBox: function() {\n\n        // To be overridden\n        return new g.Rect(0, 0, 0, 0);\n    },\n\n    getPointRotatedAroundCenter(angle, x, y) {\n        const point = new g.Point(x, y);\n        if (angle) point.rotate(this.getBBox().center(), angle);\n        return point;\n    },\n\n    getAbsolutePointFromRelative(x, y) {\n        // Rotate the position to take the model angle into account\n        return this.getPointRotatedAroundCenter(\n            -this.angle(),\n            // Transform the relative position to absolute\n            this.position().offset(x, y)\n        );\n    },\n\n    getRelativePointFromAbsolute(x, y) {\n        return this\n            // Rotate the coordinates to mitigate the element's rotation.\n            .getPointRotatedAroundCenter(this.angle(), x, y)\n            // Transform the absolute position into relative\n            .difference(this.position());\n    }\n\n}, {\n\n    getAttributeDefinition: function(attrName) {\n\n        var defNS = this.attributes;\n        var globalDefNS = attributes;\n        return (defNS && defNS[attrName]) || globalDefNS[attrName];\n    },\n\n    define: function(type, defaults, protoProps, staticProps) {\n\n        protoProps = assign({\n            defaults: defaultsDeep({ type: type }, defaults, this.prototype.defaults)\n        }, protoProps);\n\n        var Cell = this.extend(protoProps, staticProps);\n        // es5 backward compatibility\n        /* eslint-disable no-undef */\n        if (typeof joint !== 'undefined' && has(joint, 'shapes')) {\n            setByPath(joint.shapes, type, Cell, '.');\n        }\n        /* eslint-enable no-undef */\n        return Cell;\n    }\n});\n\n","import { Cell } from '../dia/Cell.mjs';\nimport { isFunction, isString, toArray } from './util.mjs';\n\nexport const wrapWith = function(object, methods, wrapper) {\n\n    if (isString(wrapper)) {\n\n        if (!wrappers[wrapper]) {\n            throw new Error('Unknown wrapper: \"' + wrapper + '\"');\n        }\n\n        wrapper = wrappers[wrapper];\n    }\n\n    if (!isFunction(wrapper)) {\n        throw new Error('Wrapper must be a function.');\n    }\n\n    toArray(methods).forEach(function(method) {\n        object[method] = wrapper(object[method]);\n    });\n};\n\nexport const wrappers = {\n\n    cells: function(fn) {\n\n        return function() {\n\n            var args = Array.from(arguments);\n            var n = args.length;\n            var cells = n > 0 && args[0] || [];\n            var opt = n > 1 && args[n - 1] || {};\n\n            if (!Array.isArray(cells)) {\n\n                if (opt instanceof Cell) {\n                    cells = args;\n                } else if (cells instanceof Cell) {\n                    if (args.length > 1) {\n                        args.pop();\n                    }\n                    cells = args;\n                }\n            }\n\n            if (opt instanceof Cell) {\n                opt = {};\n            }\n\n            return fn.call(this, cells, opt);\n        };\n    }\n\n};\n\n","import * as g from '../g/index.mjs';\n\nexport const Positions = {\n    TOP: 'top',\n    RIGHT: 'right',\n    BOTTOM: 'bottom',\n    LEFT: 'left',\n    TOP_LEFT: 'top-left',\n    TOP_RIGHT: 'top-right',\n    BOTTOM_LEFT: 'bottom-left',\n    BOTTOM_RIGHT: 'bottom-right',\n    CENTER: 'center',\n};\n\nexport function getRectPoint(rect, position) {\n    const r = new g.Rect(rect);\n    switch (position) {\n        case undefined:\n            throw new Error('Position required');\n\n        // Middle Points\n        case Positions.LEFT:\n        case 'leftMiddle':\n            return r.leftMiddle();\n\n        case Positions.RIGHT:\n        case 'rightMiddle':\n            return r.rightMiddle();\n\n        case Positions.TOP:\n        case 'topMiddle':\n            return r.topMiddle();\n\n        case Positions.BOTTOM:\n        case 'bottomMiddle':\n            return r.bottomMiddle();\n\n        // Corners\n        case Positions.TOP_LEFT:\n        case 'topLeft':\n        case 'origin':\n            return r.topLeft();\n\n        case Positions.TOP_RIGHT:\n        case 'topRight':\n            return r.topRight();\n\n        case Positions.BOTTOM_LEFT:\n        case 'bottomLeft':\n            return r.bottomLeft();\n\n        case Positions.BOTTOM_RIGHT:\n        case 'bottomRight':\n        case 'corner':\n            return r.bottomRight();\n\n        // Center\n        case Positions.CENTER:\n            return r.center();\n\n        // TODO: calc(), percentage etc.\n        default:\n            throw new Error(`Unknown position: ${position}`);\n    }\n}\n","import { evalCalcAttribute, isCalcAttribute } from '../../dia/attributes/calc.mjs';\nimport * as g from '../../g/index.mjs';\nimport * as util from '../../util/index.mjs';\n\nfunction portTransformAttrs(point, angle, opt) {\n\n    var trans = point.toJSON();\n\n    trans.angle = angle || 0;\n\n    return util.defaults({}, opt, trans);\n}\n\nfunction lineLayout(ports, p1, p2, elBBox) {\n    return ports.map(function(port, index, ports) {\n        var p = this.pointAt(((index + 0.5) / ports.length));\n        // `dx`,`dy` per port offset option\n        if (port.dx || port.dy) {\n            p.offset(port.dx || 0, port.dy || 0);\n        }\n        return portTransformAttrs(p.round(), 0, argTransform(elBBox, port));\n    }, g.line(p1, p2));\n}\n\nfunction ellipseLayout(ports, elBBox, startAngle, stepFn) {\n\n    var center = elBBox.center();\n    var ratio = elBBox.width / elBBox.height;\n    var p1 = elBBox.topMiddle();\n\n    var ellipse = g.Ellipse.fromRect(elBBox);\n\n    return ports.map(function(port, index, ports) {\n\n        var angle = startAngle + stepFn(index, ports.length);\n        var p2 = p1.clone()\n            .rotate(center, -angle)\n            .scale(ratio, 1, center);\n\n        var theta = port.compensateRotation ? -ellipse.tangentTheta(p2) : 0;\n\n        // `dx`,`dy` per port offset option\n        if (port.dx || port.dy) {\n            p2.offset(port.dx || 0, port.dy || 0);\n        }\n\n        // `dr` delta radius option\n        if (port.dr) {\n            p2.move(center, port.dr);\n        }\n\n        return portTransformAttrs(p2.round(), theta, argTransform(elBBox, port));\n    });\n}\n\n\nfunction argTransform(bbox, args) {\n    let { x, y, angle } = args;\n    if (util.isPercentage(x)) {\n        x = parseFloat(x) / 100 * bbox.width;\n    } else if (isCalcAttribute(x)) {\n        x = Number(evalCalcAttribute(x, bbox));\n    }\n    if (util.isPercentage(y)) {\n        y = parseFloat(y) / 100 * bbox.height;\n    } else if (isCalcAttribute(y)) {\n        y = Number(evalCalcAttribute(y, bbox));\n    }\n    return { x, y, angle };\n}\n\n// Creates a point stored in arguments\nfunction argPoint(bbox, args) {\n    const { x, y } = argTransform(bbox, args);\n    return new g.Point(x || 0, y || 0);\n}\n\n\n/**\n * @param {Array<Object>} ports\n * @param {g.Rect} elBBox\n * @param {Object=} opt opt Group options\n * @returns {Array<g.Point>}\n */\nexport const absolute = function(ports, elBBox) {\n    return ports.map(port => {\n        const transformation = argPoint(elBBox, port).round().toJSON();\n        transformation.angle = port.angle || 0;\n        return transformation;\n    });\n};\n\n/**\n * @param {Array<Object>} ports\n * @param {g.Rect} elBBox\n * @param {Object=} opt opt Group options\n * @returns {Array<g.Point>}\n */\nexport const fn = function(ports, elBBox, opt) {\n    return opt.fn(ports, elBBox, opt);\n};\n\n/**\n * @param {Array<Object>} ports\n * @param {g.Rect} elBBox\n * @param {Object=} opt opt Group options\n * @returns {Array<g.Point>}\n */\nexport const line = function(ports, elBBox, opt) {\n\n    var start = argPoint(elBBox, opt.start || elBBox.origin());\n    var end = argPoint(elBBox, opt.end || elBBox.corner());\n\n    return lineLayout(ports, start, end, elBBox);\n};\n\n/**\n * @param {Array<Object>} ports\n * @param {g.Rect} elBBox\n * @param {Object=} opt opt Group options\n * @returns {Array<g.Point>}\n */\nexport const left = function(ports, elBBox, opt) {\n    return lineLayout(ports, elBBox.origin(), elBBox.bottomLeft(), elBBox);\n};\n\n/**\n * @param {Array<Object>} ports\n * @param {g.Rect} elBBox\n * @param {Object=} opt opt Group options\n * @returns {Array<g.Point>}\n */\nexport const right = function(ports, elBBox, opt) {\n    return lineLayout(ports, elBBox.topRight(), elBBox.corner(), elBBox);\n};\n\n/**\n * @param {Array<Object>} ports\n * @param {g.Rect} elBBox\n * @param {Object=} opt opt Group options\n * @returns {Array<g.Point>}\n */\nexport const top = function(ports, elBBox, opt) {\n    return lineLayout(ports, elBBox.origin(), elBBox.topRight(), elBBox);\n};\n\n/**\n * @param {Array<Object>} ports\n * @param {g.Rect} elBBox\n * @param {Object=} opt opt Group options\n * @returns {Array<g.Point>}\n */\nexport const bottom = function(ports, elBBox, opt) {\n    return lineLayout(ports, elBBox.bottomLeft(), elBBox.corner(), elBBox);\n};\n\n/**\n * @param {Array<Object>} ports\n * @param {g.Rect} elBBox\n * @param {Object=} opt Group options\n * @returns {Array<g.Point>}\n */\nexport const ellipseSpread = function(ports, elBBox, opt) {\n\n    var startAngle = opt.startAngle || 0;\n    var stepAngle = opt.step || 360 / ports.length;\n\n    return ellipseLayout(ports, elBBox, startAngle, function(index) {\n        return index * stepAngle;\n    });\n};\n\n/**\n * @param {Array<Object>} ports\n * @param {g.Rect} elBBox\n * @param {Object=} opt Group options\n * @returns {Array<g.Point>}\n */\nexport const ellipse = function(ports, elBBox, opt) {\n\n    var startAngle = opt.startAngle || 0;\n    var stepAngle = opt.step || 20;\n\n    return ellipseLayout(ports, elBBox, startAngle, function(index, count) {\n        return (index + 0.5 - count / 2) * stepAngle;\n    });\n};\n\n","import * as g from '../../g/index.mjs';\nimport * as util from '../../util/index.mjs';\n\nfunction labelAttributes(opt1, opt2) {\n\n    // use value from `opt2` if it is missing in `opt1`\n    // use value from this object if it is missing in `opt2` as well\n    return util.defaultsDeep({}, opt1, opt2, {\n        x: 0,\n        y: 0,\n        angle: 0,\n        attrs: {}\n    });\n}\n\nfunction getBBoxAngles(elBBox) {\n\n    var center = elBBox.center();\n\n    var tl = center.theta(elBBox.origin());\n    var bl = center.theta(elBBox.bottomLeft());\n    var br = center.theta(elBBox.corner());\n    var tr = center.theta(elBBox.topRight());\n\n    return [tl, tr, br, bl];\n}\n\nfunction outsideLayout(portPosition, elBBox, autoOrient, opt) {\n\n    opt = util.defaults({}, opt, { offset: 15 });\n    var angle = elBBox.center().theta(portPosition);\n\n    var tx, ty, y, textAnchor;\n    var offset = opt.offset;\n    var orientAngle = 0;\n\n    const [topLeftAngle, bottomLeftAngle, bottomRightAngle, topRightAngle] = getBBoxAngles(elBBox);\n    if ((angle < bottomLeftAngle) || (angle > bottomRightAngle)) {\n        y = '.3em';\n        tx = offset;\n        ty = 0;\n        textAnchor = 'start';\n    } else if (angle < topLeftAngle) {\n        tx = 0;\n        ty = -offset;\n        if (autoOrient) {\n            orientAngle = -90;\n            textAnchor = 'start';\n            y = '.3em';\n        } else {\n            textAnchor = 'middle';\n            y = '0';\n        }\n    } else if (angle < topRightAngle) {\n        y = '.3em';\n        tx = -offset;\n        ty = 0;\n        textAnchor = 'end';\n    } else {\n        tx = 0;\n        ty = offset;\n        if (autoOrient) {\n            orientAngle = 90;\n            textAnchor = 'start';\n            y = '.3em';\n        } else {\n            textAnchor = 'middle';\n            y = '.6em';\n        }\n    }\n\n    var round = Math.round;\n    return labelAttributes(opt, {\n        x: round(tx),\n        y: round(ty),\n        angle: orientAngle,\n        attrs: { labelText: { y, textAnchor }}\n    });\n}\n\nfunction insideLayout(portPosition, elBBox, autoOrient, opt) {\n\n    opt = util.defaults({}, opt, { offset: 15 });\n    var angle = elBBox.center().theta(portPosition);\n\n    var tx, ty, y, textAnchor;\n    var offset = opt.offset;\n    var orientAngle = 0;\n\n    const [topLeftAngle, bottomLeftAngle, bottomRightAngle, topRightAngle] = getBBoxAngles(elBBox);\n    if ((angle < bottomLeftAngle) || (angle > bottomRightAngle)) {\n        y = '.3em';\n        tx = -offset;\n        ty = 0;\n        textAnchor = 'end';\n    } else if (angle < topLeftAngle) {\n        tx = 0;\n        ty = offset;\n        if (autoOrient) {\n            orientAngle = 90;\n            textAnchor = 'start';\n            y = '.3em';\n        } else {\n            textAnchor = 'middle';\n            y = '.6em';\n        }\n    } else if (angle < topRightAngle) {\n        y = '.3em';\n        tx = offset;\n        ty = 0;\n        textAnchor = 'start';\n    } else {\n        tx = 0;\n        ty = -offset;\n        if (autoOrient) {\n            orientAngle = -90;\n            textAnchor = 'start';\n            y = '.3em';\n        } else {\n            textAnchor = 'middle';\n            y = '0';\n        }\n    }\n\n    var round = Math.round;\n    return labelAttributes(opt, {\n        x: round(tx),\n        y: round(ty),\n        angle: orientAngle,\n        attrs: { labelText: { y, textAnchor }}\n    });\n}\n\nfunction radialLayout(portCenterOffset, autoOrient, opt) {\n\n    opt = util.defaults({}, opt, { offset: 20 });\n\n    var origin = g.point(0, 0);\n    var angle = -portCenterOffset.theta(origin);\n    var orientAngle = angle;\n    var offset = portCenterOffset.clone()\n        .move(origin, opt.offset)\n        .difference(portCenterOffset)\n        .round();\n\n    var y = '.3em';\n    var textAnchor;\n\n    if ((angle + 90) % 180 === 0) {\n        textAnchor = autoOrient ? 'end' : 'middle';\n        if (!autoOrient && angle === -270) {\n            y = '0em';\n        }\n    } else if (angle > -270 && angle < -90) {\n        textAnchor = 'start';\n        orientAngle = angle - 180;\n    } else {\n        textAnchor = 'end';\n    }\n\n    var round = Math.round;\n    return labelAttributes(opt, {\n        x: round(offset.x),\n        y: round(offset.y),\n        angle: ((autoOrient) ? orientAngle : 0),\n        attrs: { labelText: { y, textAnchor }}\n    });\n}\n\nexport const manual = function(_portPosition, _elBBox, opt) {\n    return labelAttributes(opt);\n};\n\nexport const left = function(portPosition, elBBox, opt) {\n    return labelAttributes(opt, {\n        x: -15,\n        attrs: { labelText: { y: '.3em', textAnchor: 'end' }},\n    });\n};\n\nexport const right = function(portPosition, elBBox, opt) {\n    return labelAttributes(opt, {\n        x: 15,\n        attrs: { labelText: { y: '.3em', textAnchor: 'start' }},\n    });\n};\n\nexport const top = function(portPosition, elBBox, opt) {\n    return labelAttributes(opt, {\n        y: -15,\n        attrs: { labelText: { y: '0', textAnchor: 'middle' }},\n    });\n};\n\nexport const bottom = function(portPosition, elBBox, opt) {\n    return labelAttributes(opt, {\n        y: 15,\n        attrs: { labelText: { y: '.6em', textAnchor: 'middle' }},\n    });\n};\n\nexport const outsideOriented = function(portPosition, elBBox, opt) {\n    return outsideLayout(portPosition, elBBox, true, opt);\n};\n\nexport const outside = function(portPosition, elBBox, opt) {\n    return outsideLayout(portPosition, elBBox, false, opt);\n};\n\nexport const insideOriented = function(portPosition, elBBox, opt) {\n    return insideLayout(portPosition, elBBox, true, opt);\n};\n\nexport const inside = function(portPosition, elBBox, opt) {\n    return insideLayout(portPosition, elBBox, false, opt);\n};\n\nexport const radial = function(portPosition, elBBox, opt) {\n    return radialLayout(portPosition.difference(elBBox.center()), false, opt);\n};\n\nexport const radialOriented = function(portPosition, elBBox, opt) {\n    return radialLayout(portPosition.difference(elBBox.center()), true, opt);\n};\n","import { Cell } from './Cell.mjs';\nimport { clone, isPlainObject, isFunction, isString, isNumber } from '../util/index.mjs';\nimport { Point, Polyline } from '../g/index.mjs';\n\n// Link base model.\n// --------------------------\n\nexport const Link = Cell.extend({\n\n    // The default markup for links.\n    markup: [\n        '<path class=\"connection\" stroke=\"black\" d=\"M 0 0 0 0\"/>',\n        '<path class=\"marker-source\" fill=\"black\" stroke=\"black\" d=\"M 0 0 0 0\"/>',\n        '<path class=\"marker-target\" fill=\"black\" stroke=\"black\" d=\"M 0 0 0 0\"/>',\n        '<path class=\"connection-wrap\" d=\"M 0 0 0 0\"/>',\n        '<g class=\"labels\"/>',\n        '<g class=\"marker-vertices\"/>',\n        '<g class=\"marker-arrowheads\"/>',\n        '<g class=\"link-tools\"/>'\n    ].join(''),\n\n    toolMarkup: [\n        '<g class=\"link-tool\">',\n        '<g class=\"tool-remove\" event=\"remove\">',\n        '<circle r=\"11\" />',\n        '<path transform=\"scale(.8) translate(-16, -16)\" d=\"M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z\" />',\n        '<title>Remove link.</title>',\n        '</g>',\n        '<g class=\"tool-options\" event=\"link:options\">',\n        '<circle r=\"11\" transform=\"translate(25)\"/>',\n        '<path fill=\"white\" transform=\"scale(.55) translate(29, -16)\" d=\"M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z\"/>',\n        '<title>Link options.</title>',\n        '</g>',\n        '</g>'\n    ].join(''),\n\n    doubleToolMarkup: undefined,\n\n    // The default markup for showing/removing vertices. These elements are the children of the .marker-vertices element (see `this.markup`).\n    // Only .marker-vertex and .marker-vertex-remove element have special meaning. The former is used for\n    // dragging vertices (changing their position). The latter is used for removing vertices.\n    vertexMarkup: [\n        '<g class=\"marker-vertex-group\" transform=\"translate(<%= x %>, <%= y %>)\">',\n        '<circle class=\"marker-vertex\" idx=\"<%= idx %>\" r=\"10\" />',\n        '<path class=\"marker-vertex-remove-area\" idx=\"<%= idx %>\" d=\"M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z\" transform=\"translate(5, -33)\"/>',\n        '<path class=\"marker-vertex-remove\" idx=\"<%= idx %>\" transform=\"scale(.8) translate(9.5, -37)\" d=\"M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z\">',\n        '<title>Remove vertex.</title>',\n        '</path>',\n        '</g>'\n    ].join(''),\n\n    arrowheadMarkup: [\n        '<g class=\"marker-arrowhead-group marker-arrowhead-group-<%= end %>\">',\n        '<path class=\"marker-arrowhead\" end=\"<%= end %>\" d=\"M 26 0 L 0 13 L 26 26 z\" />',\n        '</g>'\n    ].join(''),\n\n    // may be overwritten by user to change default label (its markup, size, attrs, position)\n    defaultLabel: undefined,\n\n    // deprecated\n    // may be overwritten by user to change default label markup\n    // lower priority than defaultLabel.markup\n    labelMarkup: undefined,\n\n    // private\n    _builtins: {\n        defaultLabel: {\n            // builtin default markup:\n            // used if neither defaultLabel.markup\n            // nor label.markup is set\n            markup: [\n                {\n                    tagName: 'rect',\n                    selector: 'rect' // faster than tagName CSS selector\n                }, {\n                    tagName: 'text',\n                    selector: 'text' // faster than tagName CSS selector\n                }\n            ],\n            // builtin default attributes:\n            // applied only if builtin default markup is used\n            attrs: {\n                text: {\n                    fill: '#000000',\n                    fontSize: 14,\n                    textAnchor: 'middle',\n                    yAlignment: 'middle',\n                    pointerEvents: 'none'\n                },\n                rect: {\n                    ref: 'text',\n                    fill: '#ffffff',\n                    rx: 3,\n                    ry: 3,\n                    refWidth: 1,\n                    refHeight: 1,\n                    refX: 0,\n                    refY: 0\n                }\n            },\n            // builtin default position:\n            // used if neither defaultLabel.position\n            // nor label.position is set\n            position: {\n                distance: 0.5\n            }\n        }\n    },\n\n    defaults: {\n        type: 'link',\n        source: {},\n        target: {}\n    },\n\n    isLink: function() {\n\n        return true;\n    },\n\n    disconnect: function(opt) {\n\n        return this.set({\n            source: { x: 0, y: 0 },\n            target: { x: 0, y: 0 }\n        }, opt);\n    },\n\n    source: function(source, args, opt) {\n\n        // getter\n        if (source === undefined) {\n            return clone(this.get('source'));\n        }\n\n        // setter\n        var setSource;\n        var setOpt;\n\n        // `source` is a cell\n        // take only its `id` and combine with `args`\n        var isCellProvided = source instanceof Cell;\n        if (isCellProvided) { // three arguments\n            setSource = clone(args) || {};\n            setSource.id = source.id;\n            setOpt = opt;\n            return this.set('source', setSource, setOpt);\n        }\n\n        // `source` is a point-like object\n        // for example, a g.Point\n        // take only its `x` and `y` and combine with `args`\n        var isPointProvided = !isPlainObject(source);\n        if (isPointProvided) { // three arguments\n            setSource = clone(args) || {};\n            setSource.x = source.x;\n            setSource.y = source.y;\n            setOpt = opt;\n            return this.set('source', setSource, setOpt);\n        }\n\n        // `source` is an object\n        // no checking\n        // two arguments\n        setSource = source;\n        setOpt = args;\n        return this.set('source', setSource, setOpt);\n    },\n\n    target: function(target, args, opt) {\n\n        // getter\n        if (target === undefined) {\n            return clone(this.get('target'));\n        }\n\n        // setter\n        var setTarget;\n        var setOpt;\n\n        // `target` is a cell\n        // take only its `id` argument and combine with `args`\n        var isCellProvided = target instanceof Cell;\n        if (isCellProvided) { // three arguments\n            setTarget = clone(args) || {};\n            setTarget.id = target.id;\n            setOpt = opt;\n            return this.set('target', setTarget, setOpt);\n        }\n\n        // `target` is a point-like object\n        // for example, a g.Point\n        // take only its `x` and `y` and combine with `args`\n        var isPointProvided = !isPlainObject(target);\n        if (isPointProvided) { // three arguments\n            setTarget = clone(args) || {};\n            setTarget.x = target.x;\n            setTarget.y = target.y;\n            setOpt = opt;\n            return this.set('target', setTarget, setOpt);\n        }\n\n        // `target` is an object\n        // no checking\n        // two arguments\n        setTarget = target;\n        setOpt = args;\n        return this.set('target', setTarget, setOpt);\n    },\n\n    router: function(name, args, opt) {\n\n        // getter\n        if (name === undefined) {\n            var router = this.get('router');\n            if (!router) {\n                if (this.get('manhattan')) return { name: 'orthogonal' }; // backwards compatibility\n                return null;\n            }\n            if (typeof router === 'object') return clone(router);\n            return router; // e.g. a function\n        }\n\n        // setter\n        var isRouterProvided = ((typeof name === 'object') || (typeof name === 'function'));\n        var localRouter = isRouterProvided ? name : { name: name, args: args };\n        var localOpt = isRouterProvided ? args : opt;\n\n        return this.set('router', localRouter, localOpt);\n    },\n\n    connector: function(name, args, opt) {\n\n        // getter\n        if (name === undefined) {\n            var connector = this.get('connector');\n            if (!connector) {\n                if (this.get('smooth')) return { name: 'smooth' }; // backwards compatibility\n                return null;\n            }\n            if (typeof connector === 'object') return clone(connector);\n            return connector; // e.g. a function\n        }\n\n        // setter\n        var isConnectorProvided = ((typeof name === 'object' || typeof name === 'function'));\n        var localConnector = isConnectorProvided ? name : { name: name, args: args };\n        var localOpt = isConnectorProvided ? args : opt;\n\n        return this.set('connector', localConnector, localOpt);\n    },\n\n    // Labels API\n\n    // A convenient way to set labels. Currently set values will be mixined with `value` if used as a setter.\n    label: function(idx, label, opt) {\n\n        var labels = this.labels();\n\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : 0;\n        if (idx < 0) idx = labels.length + idx;\n\n        // getter\n        if (arguments.length <= 1) return this.prop(['labels', idx]);\n        // setter\n        return this.prop(['labels', idx], label, opt);\n    },\n\n    labels: function(labels, opt) {\n\n        // getter\n        if (arguments.length === 0) {\n            labels = this.get('labels');\n            if (!Array.isArray(labels)) return [];\n            return labels.slice();\n        }\n        // setter\n        if (!Array.isArray(labels)) labels = [];\n        return this.set('labels', labels, opt);\n    },\n\n    hasLabels: function() {\n        const { labels } = this.attributes;\n        return Array.isArray(labels) && labels.length > 0;\n    },\n\n    insertLabel: function(idx, label, opt) {\n\n        if (!label) throw new Error('dia.Link: no label provided');\n\n        var labels = this.labels();\n        var n = labels.length;\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : n;\n        if (idx < 0) idx = n + idx + 1;\n\n        labels.splice(idx, 0, label);\n        return this.labels(labels, opt);\n    },\n\n    // convenience function\n    // add label to end of labels array\n    appendLabel: function(label, opt) {\n\n        return this.insertLabel(-1, label, opt);\n    },\n\n    removeLabel: function(idx, opt) {\n\n        var labels = this.labels();\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : -1;\n\n        labels.splice(idx, 1);\n        return this.labels(labels, opt);\n    },\n\n    // Vertices API\n\n    vertex: function(idx, vertex, opt) {\n\n        var vertices = this.vertices();\n\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : 0;\n        if (idx < 0) idx = vertices.length + idx;\n\n        // getter\n        if (arguments.length <= 1) return this.prop(['vertices', idx]);\n\n        // setter\n        var setVertex = this._normalizeVertex(vertex);\n        return this.prop(['vertices', idx], setVertex, opt);\n    },\n\n    vertices: function(vertices, opt) {\n\n        // getter\n        if (arguments.length === 0) {\n            vertices = this.get('vertices');\n            if (!Array.isArray(vertices)) return [];\n            return vertices.slice();\n        }\n\n        // setter\n        if (!Array.isArray(vertices)) vertices = [];\n        var setVertices = [];\n        for (var i = 0; i < vertices.length; i++) {\n            var vertex = vertices[i];\n            var setVertex = this._normalizeVertex(vertex);\n            setVertices.push(setVertex);\n        }\n        return this.set('vertices', setVertices, opt);\n    },\n\n    insertVertex: function(idx, vertex, opt) {\n\n        if (!vertex) throw new Error('dia.Link: no vertex provided');\n\n        var vertices = this.vertices();\n        var n = vertices.length;\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : n;\n        if (idx < 0) idx = n + idx + 1;\n\n        var setVertex = this._normalizeVertex(vertex);\n        vertices.splice(idx, 0, setVertex);\n        return this.vertices(vertices, opt);\n    },\n\n    removeVertex: function(idx, opt) {\n\n        var vertices = this.vertices();\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : -1;\n\n        vertices.splice(idx, 1);\n        return this.vertices(vertices, opt);\n    },\n\n    _normalizeVertex: function(vertex) {\n\n        // is vertex a point-like object?\n        // for example, a g.Point\n        var isPointProvided = !isPlainObject(vertex);\n        if (isPointProvided) return { x: vertex.x, y: vertex.y };\n\n        // else: return vertex unchanged\n        return vertex;\n    },\n\n    // Transformations\n\n    translate: function(tx, ty, opt) {\n\n        // enrich the option object\n        opt = opt || {};\n        opt.translateBy = opt.translateBy || this.id;\n        opt.tx = tx;\n        opt.ty = ty;\n\n        return this.applyToPoints(function(p) {\n            return { x: (p.x || 0) + tx, y: (p.y || 0) + ty };\n        }, opt);\n    },\n\n    scale: function(sx, sy, origin, opt) {\n\n        return this.applyToPoints(function(p) {\n            return Point(p).scale(sx, sy, origin).toJSON();\n        }, opt);\n    },\n\n    applyToPoints: function(fn, opt) {\n\n        if (!isFunction(fn)) {\n            throw new TypeError('dia.Link: applyToPoints expects its first parameter to be a function.');\n        }\n\n        var attrs = {};\n\n        var { source, target } = this.attributes;\n        if (!source.id) {\n            attrs.source = fn(source);\n        }\n        if (!target.id) {\n            attrs.target = fn(target);\n        }\n\n        var vertices = this.vertices();\n        if (vertices.length > 0) {\n            attrs.vertices = vertices.map(fn);\n        }\n\n        return this.set(attrs, opt);\n    },\n\n    getSourcePoint: function() {\n        var sourceCell = this.getSourceCell();\n        if (!sourceCell) return new Point(this.source());\n        return sourceCell.getPointFromConnectedLink(this, 'source');\n    },\n\n    getTargetPoint: function() {\n        var targetCell = this.getTargetCell();\n        if (!targetCell) return new Point(this.target());\n        return targetCell.getPointFromConnectedLink(this, 'target');\n    },\n\n    getPointFromConnectedLink: function(/* link, endType */) {\n        return this.getPolyline().pointAt(0.5);\n    },\n\n    getPolyline: function() {\n        const points = [\n            this.getSourcePoint(),\n            ...this.vertices().map(Point),\n            this.getTargetPoint()\n        ];\n        return new Polyline(points);\n    },\n\n    getBBox: function() {\n        return this.getPolyline().bbox();\n    },\n\n    reparent: function(opt) {\n\n        var newParent;\n\n        if (this.graph) {\n\n            var source = this.getSourceElement();\n            var target = this.getTargetElement();\n            var prevParent = this.getParentCell();\n\n            if (source && target) {\n                if (source === target || source.isEmbeddedIn(target)) {\n                    newParent = target;\n                } else if (target.isEmbeddedIn(source)) {\n                    newParent = source;\n                } else {\n                    newParent = this.graph.getCommonAncestor(source, target);\n                }\n            }\n\n            if (prevParent && (!newParent || newParent.id !== prevParent.id)) {\n                // Unembed the link if source and target has no common ancestor\n                // or common ancestor changed\n                prevParent.unembed(this, opt);\n            }\n\n            if (newParent) {\n                newParent.embed(this, opt);\n            }\n        }\n\n        return newParent;\n    },\n\n    hasLoop: function(opt) {\n\n        opt = opt || {};\n\n        var { source, target } = this.attributes;\n        var sourceId = source.id;\n        var targetId = target.id;\n\n        if (!sourceId || !targetId) {\n            // Link \"pinned\" to the paper does not have a loop.\n            return false;\n        }\n\n        var loop = sourceId === targetId;\n\n        // Note that there in the deep mode a link can have a loop,\n        // even if it connects only a parent and its embed.\n        // A loop \"target equals source\" is valid in both shallow and deep mode.\n        if (!loop && opt.deep && this.graph) {\n\n            var sourceElement = this.getSourceCell();\n            var targetElement = this.getTargetCell();\n\n            loop = sourceElement.isEmbeddedIn(targetElement) || targetElement.isEmbeddedIn(sourceElement);\n        }\n\n        return loop;\n    },\n\n    // unlike source(), this method returns null if source is a point\n    getSourceCell: function() {\n\n        const { graph, attributes } = this;\n        var source = attributes.source;\n        return (source && source.id && graph && graph.getCell(source.id)) || null;\n    },\n\n    getSourceElement: function() {\n        var cell = this;\n        var visited = {};\n        do {\n            if (visited[cell.id]) return null;\n            visited[cell.id] = true;\n            cell = cell.getSourceCell();\n        } while (cell && cell.isLink());\n        return cell;\n    },\n\n    // unlike target(), this method returns null if target is a point\n    getTargetCell: function() {\n\n        const { graph, attributes } = this;\n        var target = attributes.target;\n        return (target && target.id && graph && graph.getCell(target.id)) || null;\n    },\n\n    getTargetElement: function() {\n        var cell = this;\n        var visited = {};\n        do {\n            if (visited[cell.id]) return null;\n            visited[cell.id] = true;\n            cell = cell.getTargetCell();\n        } while (cell && cell.isLink());\n        return cell;\n    },\n\n    // Returns the common ancestor for the source element,\n    // target element and the link itself.\n    getRelationshipAncestor: function() {\n\n        var connectionAncestor;\n\n        if (this.graph) {\n\n            var cells = [\n                this,\n                this.getSourceElement(), // null if source is a point\n                this.getTargetElement() // null if target is a point\n            ].filter(function(item) {\n                return !!item;\n            });\n\n            connectionAncestor = this.graph.getCommonAncestor.apply(this.graph, cells);\n        }\n\n        return connectionAncestor || null;\n    },\n\n    // Is source, target and the link itself embedded in a given cell?\n    isRelationshipEmbeddedIn: function(cell) {\n\n        var cellId = (isString(cell) || isNumber(cell)) ? cell : cell.id;\n        var ancestor = this.getRelationshipAncestor();\n\n        return !!ancestor && (ancestor.id === cellId || ancestor.isEmbeddedIn(cellId));\n    },\n\n    // Get resolved default label.\n    _getDefaultLabel: function() {\n\n        var defaultLabel = this.get('defaultLabel') || this.defaultLabel || {};\n\n        var label = {};\n        label.markup = defaultLabel.markup || this.get('labelMarkup') || this.labelMarkup;\n        label.position = defaultLabel.position;\n        label.attrs = defaultLabel.attrs;\n        label.size = defaultLabel.size;\n\n        return label;\n    }\n}, {\n\n    endsEqual: function(a, b) {\n\n        var portsEqual = a.port === b.port || !a.port && !b.port;\n        return a.id === b.id && portsEqual;\n    }\n});\n\n","import * as util from '../util/index.mjs';\nimport V from '../V/index.mjs';\nimport { Rect, Point } from '../g/index.mjs';\nimport * as Port from '../layout/ports/port.mjs';\nimport * as PortLabel from '../layout/ports/portLabel.mjs';\n\nvar PortData = function(data) {\n\n    var clonedData = util.cloneDeep(data) || {};\n    this.ports = [];\n    this.groups = {};\n    this.portLayoutNamespace = Port;\n    this.portLabelLayoutNamespace = PortLabel;\n\n    this._init(clonedData);\n};\n\nPortData.prototype = {\n\n    getPorts: function() {\n        return this.ports;\n    },\n\n    getGroup: function(name) {\n        return this.groups[name] || {};\n    },\n\n    getPortsByGroup: function(groupName) {\n\n        return this.ports.filter(function(port) {\n            return port.group === groupName;\n        });\n    },\n\n    getGroupPortsMetrics: function(groupName, elBBox) {\n\n        var group = this.getGroup(groupName);\n        var ports = this.getPortsByGroup(groupName);\n\n        var groupPosition = group.position || {};\n        var groupPositionName = groupPosition.name;\n        var namespace = this.portLayoutNamespace;\n        if (!namespace[groupPositionName]) {\n            groupPositionName = 'left';\n        }\n\n        var groupArgs = groupPosition.args || {};\n        var portsArgs = ports.map(function(port) {\n            return port && port.position && port.position.args;\n        });\n        var groupPortTransformations = namespace[groupPositionName](portsArgs, elBBox, groupArgs);\n\n        var accumulator = {\n            ports: ports,\n            result: []\n        };\n\n        util.toArray(groupPortTransformations).reduce(function(res, portTransformation, index) {\n            var port = res.ports[index];\n            res.result.push({\n                portId: port.id,\n                portTransformation: portTransformation,\n                labelTransformation: this._getPortLabelLayout(port, Point(portTransformation), elBBox),\n                portAttrs: port.attrs,\n                portSize: port.size,\n                labelSize: port.label.size\n            });\n            return res;\n        }.bind(this), accumulator);\n\n        return accumulator.result;\n    },\n\n    _getPortLabelLayout: function(port, portPosition, elBBox) {\n\n        var namespace = this.portLabelLayoutNamespace;\n        var labelPosition = port.label.position.name || 'left';\n\n        if (namespace[labelPosition]) {\n            return namespace[labelPosition](portPosition, elBBox, port.label.position.args);\n        }\n\n        return null;\n    },\n\n    _init: function(data) {\n\n        // prepare groups\n        if (util.isObject(data.groups)) {\n            var groups = Object.keys(data.groups);\n            for (var i = 0, n = groups.length; i < n; i++) {\n                var key = groups[i];\n                this.groups[key] = this._evaluateGroup(data.groups[key]);\n            }\n        }\n\n        // prepare ports\n        var ports = util.toArray(data.items);\n        for (var j = 0, m = ports.length; j < m; j++) {\n            this.ports.push(this._evaluatePort(ports[j]));\n        }\n    },\n\n    _evaluateGroup: function(group) {\n\n        return util.merge(group, {\n            position: this._getPosition(group.position, true),\n            label: this._getLabel(group, true)\n        });\n    },\n\n    _evaluatePort: function(port) {\n\n        var evaluated = util.assign({}, port);\n\n        var group = this.getGroup(port.group);\n\n        evaluated.markup = evaluated.markup || group.markup;\n        evaluated.attrs = util.merge({}, group.attrs, evaluated.attrs);\n        evaluated.position = this._createPositionNode(group, evaluated);\n        evaluated.label = util.merge({}, group.label, this._getLabel(evaluated));\n        evaluated.z = this._getZIndex(group, evaluated);\n        evaluated.size = util.assign({}, group.size, evaluated.size);\n\n        return evaluated;\n    },\n\n    _getZIndex: function(group, port) {\n\n        if (util.isNumber(port.z)) {\n            return port.z;\n        }\n        if (util.isNumber(group.z) || group.z === 'auto') {\n            return group.z;\n        }\n        return 'auto';\n    },\n\n    _createPositionNode: function(group, port) {\n\n        return util.merge({\n            name: 'left',\n            args: {}\n        }, group.position, { args: port.args });\n    },\n\n    _getPosition: function(position, setDefault) {\n\n        var args = {};\n        var positionName;\n\n        if (util.isFunction(position)) {\n            positionName = 'fn';\n            args.fn = position;\n        } else if (util.isString(position)) {\n            positionName = position;\n        } else if (position === undefined) {\n            positionName = setDefault ? 'left' : null;\n        } else if (Array.isArray(position)) {\n            positionName = 'absolute';\n            args.x = position[0];\n            args.y = position[1];\n        } else if (util.isObject(position)) {\n            positionName = position.name;\n            util.assign(args, position.args);\n        }\n\n        var result = { args: args };\n\n        if (positionName) {\n            result.name = positionName;\n        }\n        return result;\n    },\n\n    _getLabel: function(item, setDefaults) {\n\n        var label = item.label || {};\n\n        var ret = label;\n        ret.position = this._getPosition(label.position, setDefaults);\n\n        return ret;\n    }\n};\n\nexport const elementPortPrototype = {\n\n    _initializePorts: function() {\n\n        this._createPortData();\n        this.on('change:ports', function() {\n\n            this._processRemovedPort();\n            this._createPortData();\n        }, this);\n    },\n\n    /**\n     * remove links tied wiht just removed element\n     * @private\n     */\n    _processRemovedPort: function() {\n\n        var current = this.get('ports') || {};\n        var currentItemsMap = {};\n\n        util.toArray(current.items).forEach(function(item) {\n            currentItemsMap[item.id] = true;\n        });\n\n        var previous = this.previous('ports') || {};\n        var removed = {};\n\n        util.toArray(previous.items).forEach(function(item) {\n            if (!currentItemsMap[item.id]) {\n                removed[item.id] = true;\n            }\n        });\n\n        var graph = this.graph;\n        if (graph && !util.isEmpty(removed)) {\n\n            var inboundLinks = graph.getConnectedLinks(this, { inbound: true });\n            inboundLinks.forEach(function(link) {\n\n                if (removed[link.get('target').port]) link.remove();\n            });\n\n            var outboundLinks = graph.getConnectedLinks(this, { outbound: true });\n            outboundLinks.forEach(function(link) {\n\n                if (removed[link.get('source').port]) link.remove();\n            });\n        }\n    },\n\n    /**\n     * @returns {boolean}\n     */\n    hasPorts: function() {\n\n        var ports = this.prop('ports/items');\n        return Array.isArray(ports) && ports.length > 0;\n    },\n\n    /**\n     * @param {string} id\n     * @returns {boolean}\n     */\n    hasPort: function(id) {\n\n        return this.getPortIndex(id) !== -1;\n    },\n\n    /**\n     * @returns {Array<object>}\n     */\n    getPorts: function() {\n\n        return util.cloneDeep(this.prop('ports/items')) || [];\n    },\n\n    /**\n     * @returns {Array<object>}\n     */\n    getGroupPorts: function(groupName) {\n        const groupPorts = util.toArray(this.prop(['ports','items'])).filter(port => port.group === groupName);\n        return util.cloneDeep(groupPorts);\n    },\n\n    /**\n     * @param {string} id\n     * @returns {object}\n     */\n    getPort: function(id) {\n\n        return util.cloneDeep(util.toArray(this.prop('ports/items')).find(function(port) {\n            return port.id && port.id === id;\n        }));\n    },\n\n    /**\n     * @param {string} groupName\n     * @returns {Object<portId, {x: number, y: number, angle: number}>}\n     */\n    getPortsPositions: function(groupName) {\n\n        var portsMetrics = this._portSettingsData.getGroupPortsMetrics(groupName, Rect(this.size()));\n\n        return portsMetrics.reduce(function(positions, metrics) {\n            var transformation = metrics.portTransformation;\n            positions[metrics.portId] = {\n                x: transformation.x,\n                y: transformation.y,\n                angle: transformation.angle\n            };\n            return positions;\n        }, {});\n    },\n\n    /**\n     * @param {string|Port} port port id or port\n     * @returns {number} port index\n     */\n    getPortIndex: function(port) {\n\n        var id = util.isObject(port) ? port.id : port;\n\n        if (!this._isValidPortId(id)) {\n            return -1;\n        }\n\n        return util.toArray(this.prop('ports/items')).findIndex(function(item) {\n            return item.id === id;\n        });\n    },\n\n    /**\n     * @param {object} port\n     * @param {object} [opt]\n     * @returns {joint.dia.Element}\n     */\n    addPort: function(port, opt) {\n\n        if (!util.isObject(port) || Array.isArray(port)) {\n            throw new Error('Element: addPort requires an object.');\n        }\n\n        var ports = util.assign([], this.prop('ports/items'));\n        ports.push(port);\n        this.prop('ports/items', ports, opt);\n\n        return this;\n    },\n\n    /**\n     * @param {string|Port|number} before\n     * @param {object} port\n     * @param {object} [opt]\n     * @returns {joint.dia.Element}\n     */\n    insertPort: function(before, port, opt) {\n        const index = (typeof before === 'number') ? before : this.getPortIndex(before);\n\n        if (!util.isObject(port) || Array.isArray(port)) {\n            throw new Error('dia.Element: insertPort requires an object.');\n        }\n\n        const ports = util.assign([], this.prop('ports/items'));\n        ports.splice(index, 0, port);\n        this.prop('ports/items', ports, opt);\n\n        return this;\n    },\n\n    /**\n     * @param {string} portId\n     * @param {string|object=} path\n     * @param {*=} value\n     * @param {object=} opt\n     * @returns {joint.dia.Element}\n     */\n    portProp: function(portId, path, value, opt) {\n\n        var index = this.getPortIndex(portId);\n\n        if (index === -1) {\n            throw new Error('Element: unable to find port with id ' + portId);\n        }\n\n        var args = Array.prototype.slice.call(arguments, 1);\n        if (Array.isArray(path)) {\n            args[0] = ['ports', 'items', index].concat(path);\n        } else if (util.isString(path)) {\n\n            // Get/set an attribute by a special path syntax that delimits\n            // nested objects by the colon character.\n            args[0] = ['ports/items/', index, '/', path].join('');\n\n        } else {\n\n            args = ['ports/items/' + index];\n            if (util.isPlainObject(path)) {\n                args.push(path);\n                args.push(value);\n            }\n        }\n\n        return this.prop.apply(this, args);\n    },\n\n    _validatePorts: function() {\n\n        var portsAttr = this.get('ports') || {};\n\n        var errorMessages = [];\n        portsAttr = portsAttr || {};\n        var ports = util.toArray(portsAttr.items);\n\n        ports.forEach(function(p) {\n\n            if (typeof p !== 'object') {\n                errorMessages.push('Element: invalid port ', p);\n            }\n\n            if (!this._isValidPortId(p.id)) {\n                p.id = this.generatePortId();\n            }\n        }, this);\n\n        if (util.uniq(ports, 'id').length !== ports.length) {\n            errorMessages.push('Element: found id duplicities in ports.');\n        }\n\n        return errorMessages;\n    },\n\n    generatePortId: function() {\n        return this.generateId();\n    },\n\n    /**\n     * @param {string} id port id\n     * @returns {boolean}\n     * @private\n     */\n    _isValidPortId: function(id) {\n\n        return id !== null && id !== undefined && !util.isObject(id);\n    },\n\n    addPorts: function(ports, opt) {\n\n        if (ports.length) {\n            this.prop('ports/items', util.assign([], this.prop('ports/items')).concat(ports), opt);\n        }\n\n        return this;\n    },\n\n    removePort: function(port, opt) {\n        const options = opt || {};\n        const index = this.getPortIndex(port);\n        if (index !== -1) {\n            const ports = util.assign([], this.prop(['ports', 'items']));\n            ports.splice(index, 1);\n            options.rewrite = true;\n            this.startBatch('port-remove');\n            this.prop(['ports', 'items'], ports, options);\n            this.stopBatch('port-remove');\n        }\n        return this;\n    },\n\n    removePorts: function(portsForRemoval, opt) {\n        let options, newPorts;\n        if (Array.isArray(portsForRemoval)) {\n            options = opt || {};\n            if (portsForRemoval.length === 0) return this.this;\n            const currentPorts = util.assign([], this.prop(['ports', 'items']));\n            newPorts = currentPorts.filter(function(cp) {\n                return !portsForRemoval.some(function(rp) {\n                    const rpId = util.isObject(rp) ? rp.id : rp;\n                    return cp.id === rpId;\n                });\n            });\n        } else {\n            options = portsForRemoval || {};\n            newPorts = [];\n        }\n        this.startBatch('port-remove');\n        options.rewrite = true;\n        this.prop(['ports', 'items'], newPorts, options);\n        this.stopBatch('port-remove');\n        return this;\n    },\n\n    /**\n     * @private\n     */\n    _createPortData: function() {\n\n        var err = this._validatePorts();\n\n        if (err.length > 0) {\n            this.set('ports', this.previous('ports'));\n            throw new Error(err.join(' '));\n        }\n\n        var prevPortData;\n\n        if (this._portSettingsData) {\n\n            prevPortData = this._portSettingsData.getPorts();\n        }\n\n        this._portSettingsData = new PortData(this.get('ports'));\n\n        var curPortData = this._portSettingsData.getPorts();\n\n        if (prevPortData) {\n\n            var added = curPortData.filter(function(item) {\n                if (!prevPortData.find(function(prevPort) {\n                    return prevPort.id === item.id;\n                })) {\n                    return item;\n                }\n            });\n\n            var removed = prevPortData.filter(function(item) {\n                if (!curPortData.find(function(curPort) {\n                    return curPort.id === item.id;\n                })) {\n                    return item;\n                }\n            });\n\n            if (removed.length > 0) {\n                this.trigger('ports:remove', this, removed);\n            }\n\n            if (added.length > 0) {\n                this.trigger('ports:add', this, added);\n            }\n        }\n    }\n};\n\nexport const elementViewPortPrototype = {\n\n    portContainerMarkup: 'g',\n    portMarkup: [{\n        tagName: 'circle',\n        selector: 'circle',\n        attributes: {\n            'r': 10,\n            'fill': '#FFFFFF',\n            'stroke': '#000000'\n        }\n    }],\n    portLabelMarkup: [{\n        tagName: 'text',\n        selector: 'text',\n        attributes: {\n            'fill': '#000000'\n        }\n    }],\n    /** @type {Object<string, {portElement: Vectorizer, portLabelElement: Vectorizer}>} */\n    _portElementsCache: null,\n\n    /**\n     * @private\n     */\n    _initializePorts: function() {\n        this._cleanPortsCache();\n    },\n\n    /**\n     * @typedef {Object} Port\n     *\n     * @property {string} id\n     * @property {Object} position\n     * @property {Object} label\n     * @property {Object} attrs\n     * @property {string} markup\n     * @property {string} group\n     */\n\n    /**\n     * @private\n     */\n    _refreshPorts: function() {\n\n        this._removePorts();\n        this._cleanPortsCache();\n        this._renderPorts();\n    },\n\n    _cleanPortsCache: function() {\n        this._portElementsCache = {};\n    },\n\n    /**\n     * @private\n     */\n    _renderPorts: function() {\n\n        // references to rendered elements without z-index\n        var elementReferences = [];\n        var elem = this._getContainerElement();\n\n        for (var i = 0, count = elem.node.childNodes.length; i < count; i++) {\n            elementReferences.push(elem.node.childNodes[i]);\n        }\n\n        var portsGropsByZ = util.groupBy(this.model._portSettingsData.getPorts(), 'z');\n        var withoutZKey = 'auto';\n\n        // render non-z first\n        util.toArray(portsGropsByZ[withoutZKey]).forEach(function(port) {\n            var portElement = this._getPortElement(port);\n            elem.append(portElement);\n            elementReferences.push(portElement);\n        }, this);\n\n        var groupNames = Object.keys(portsGropsByZ);\n        for (var k = 0; k < groupNames.length; k++) {\n            var groupName = groupNames[k];\n            if (groupName !== withoutZKey) {\n                var z = parseInt(groupName, 10);\n                this._appendPorts(portsGropsByZ[groupName], z, elementReferences);\n            }\n        }\n\n        this._updatePorts();\n    },\n\n    /**\n     * @returns {V}\n     * @private\n     */\n    _getContainerElement: function() {\n\n        return this.rotatableNode || this.vel;\n    },\n\n    /**\n     * @param {Array<Port>}ports\n     * @param {number} z\n     * @param refs\n     * @private\n     */\n    _appendPorts: function(ports, z, refs) {\n\n        var containerElement = this._getContainerElement();\n        var portElements = util.toArray(ports).map(this._getPortElement, this);\n\n        if (refs[z] || z < 0) {\n            V(refs[Math.max(z, 0)]).before(portElements);\n        } else {\n            containerElement.append(portElements);\n        }\n    },\n\n    /**\n     * Try to get element from cache,\n     * @param port\n     * @returns {*}\n     * @private\n     */\n    _getPortElement: function(port) {\n\n        if (this._portElementsCache[port.id]) {\n            return this._portElementsCache[port.id].portElement;\n        }\n        return this._createPortElement(port);\n    },\n\n    findPortNode: function(portId, selector) {\n        const portCache = this._portElementsCache[portId];\n        if (!portCache) return null;\n        if (!selector) return portCache.portContentElement.node;\n        const portRoot = portCache.portElement.node;\n        const portSelectors = portCache.portSelectors;\n        const [node = null] = this.findBySelector(selector, portRoot, portSelectors);\n        return node;\n    },\n\n    /**\n     * @private\n     */\n    _updatePorts: function() {\n\n        // layout ports without group\n        this._updatePortGroup(undefined);\n        // layout ports with explicit group\n        var groupsNames = Object.keys(this.model._portSettingsData.groups);\n        groupsNames.forEach(this._updatePortGroup, this);\n    },\n\n    /**\n     * @private\n     */\n    _removePorts: function() {\n        util.invoke(this._portElementsCache, 'portElement.remove');\n    },\n\n    /**\n     * @param {Port} port\n     * @returns {V}\n     * @private\n     */\n    _createPortElement: function(port) {\n\n        let portElement;\n        let labelElement;\n        let labelSelectors;\n        let portSelectors;\n\n        var portContainerElement = V(this.portContainerMarkup).addClass('joint-port');\n\n        var portMarkup = this._getPortMarkup(port);\n        if (Array.isArray(portMarkup)) {\n            var portDoc = this.parseDOMJSON(portMarkup, portContainerElement.node);\n            var portFragment = portDoc.fragment;\n            if (portFragment.childNodes.length > 1) {\n                portElement = V('g').append(portFragment);\n            } else {\n                portElement = V(portFragment.firstChild);\n            }\n            portSelectors = portDoc.selectors;\n        } else {\n            portElement = V(portMarkup);\n            if (Array.isArray(portElement)) {\n                portElement = V('g').append(portElement);\n            }\n        }\n\n        if (!portElement) {\n            throw new Error('ElementView: Invalid port markup.');\n        }\n\n        portElement.attr({\n            'port': port.id,\n            'port-group': port.group\n        });\n\n        const labelMarkupDef = this._getPortLabelMarkup(port.label);\n        if (Array.isArray(labelMarkupDef)) {\n            // JSON Markup\n            const { fragment, selectors } = this.parseDOMJSON(labelMarkupDef, portContainerElement.node);\n            const childCount = fragment.childNodes.length;\n            if (childCount > 0) {\n                labelSelectors = selectors;\n                labelElement = (childCount === 1) ? V(fragment.firstChild) : V('g').append(fragment);\n            }\n        } else {\n            // String Markup\n            labelElement = V(labelMarkupDef);\n            if (Array.isArray(labelElement)) {\n                labelElement = V('g').append(labelElement);\n            }\n        }\n\n        var portContainerSelectors;\n        if (portSelectors && labelSelectors) {\n            for (var key in labelSelectors) {\n                if (portSelectors[key] && key !== this.selector) throw new Error('ElementView: selectors within port must be unique.');\n            }\n            portContainerSelectors = util.assign({}, portSelectors, labelSelectors);\n        } else {\n            portContainerSelectors = portSelectors || labelSelectors || {};\n        }\n\n        // The `portRootSelector` points to the root SVGNode of the port.\n        // Either the implicit wrapping group <g/> in case the port consist of multiple SVGNodes.\n        // Or the single SVGNode of the port.\n        const portRootSelector = 'portRoot';\n        // The `labelRootSelector` points to the root SVGNode of the label.\n        const labelRootSelector = 'labelRoot';\n        // The `labelTextSelector` points to all text SVGNodes of the label.\n        const labelTextSelector = 'labelText';\n\n        if (!(portRootSelector in portContainerSelectors)) {\n            portContainerSelectors[portRootSelector] = portElement.node;\n        }\n\n        if (labelElement) {\n            const labelNode = labelElement.node;\n            if (!(labelRootSelector in portContainerSelectors)) {\n                portContainerSelectors[labelRootSelector] = labelNode;\n            }\n            if (!(labelTextSelector in portContainerSelectors)) {\n                // If the label is a <text> element, we can use it directly.\n                // Otherwise, we need to find the <text> element within the label.\n                const labelTextNode = (labelElement.tagName() === 'TEXT')\n                    ? labelNode\n                    : Array.from(labelNode.querySelectorAll('text'));\n                portContainerSelectors[labelTextSelector] = labelTextNode;\n                if (!labelSelectors) labelSelectors = {};\n                labelSelectors[labelTextSelector] = labelTextNode;\n            }\n        }\n\n        portContainerElement.append(portElement.addClass('joint-port-body'));\n        if (labelElement) {\n            portContainerElement.append(labelElement.addClass('joint-port-label'));\n        }\n\n        this._portElementsCache[port.id] = {\n            portElement: portContainerElement,\n            portLabelElement: labelElement,\n            portSelectors: portContainerSelectors,\n            portLabelSelectors: labelSelectors,\n            portContentElement: portElement,\n            portContentSelectors: portSelectors\n        };\n\n        return portContainerElement;\n    },\n\n    /**\n     * @param {string=} groupName\n     * @private\n     */\n    _updatePortGroup: function(groupName) {\n\n        var elementBBox = Rect(this.model.size());\n        var portsMetrics = this.model._portSettingsData.getGroupPortsMetrics(groupName, elementBBox);\n\n        for (var i = 0, n = portsMetrics.length; i < n; i++) {\n            var metrics = portsMetrics[i];\n            var portId = metrics.portId;\n            var cached = this._portElementsCache[portId] || {};\n            var portTransformation = metrics.portTransformation;\n            var labelTransformation = metrics.labelTransformation;\n            if (labelTransformation && cached.portLabelElement) {\n                this.updateDOMSubtreeAttributes(cached.portLabelElement.node, labelTransformation.attrs, {\n                    rootBBox: new Rect(metrics.labelSize),\n                    selectors: cached.portLabelSelectors\n                });\n                this.applyPortTransform(cached.portLabelElement, labelTransformation, (-portTransformation.angle || 0));\n            }\n            this.updateDOMSubtreeAttributes(cached.portElement.node, metrics.portAttrs, {\n                rootBBox: new Rect(metrics.portSize),\n                selectors: cached.portSelectors\n            });\n            this.applyPortTransform(cached.portElement, portTransformation);\n        }\n    },\n\n    /**\n     * @param {Vectorizer} element\n     * @param {{dx:number, dy:number, angle: number, attrs: Object, x:number: y:number}} transformData\n     * @param {number=} initialAngle\n     * @constructor\n     */\n    applyPortTransform: function(element, transformData, initialAngle) {\n\n        var matrix = V.createSVGMatrix()\n            .rotate(initialAngle || 0)\n            .translate(transformData.x || 0, transformData.y || 0)\n            .rotate(transformData.angle || 0);\n\n        element.transform(matrix, { absolute: true });\n    },\n\n    /**\n     * @param {Port} port\n     * @returns {string}\n     * @private\n     */\n    _getPortMarkup: function(port) {\n\n        return port.markup || this.model.get('portMarkup') || this.model.portMarkup || this.portMarkup;\n    },\n\n    /**\n     * @param {Object} label\n     * @returns {string}\n     * @private\n     */\n    _getPortLabelMarkup: function(label) {\n\n        return label.markup || this.model.get('portLabelMarkup') || this.model.portLabelMarkup || this.portLabelMarkup;\n    }\n};\n\n","import { Cell } from './Cell.mjs';\nimport { Point, toRad, normalizeAngle, Rect } from '../g/index.mjs';\nimport { isNumber, isObject, interpolate, assign, invoke, normalizeSides } from '../util/index.mjs';\nimport { elementPortPrototype } from './ports.mjs';\n\n// Element base model.\n// -----------------------------\n\nexport const Element = Cell.extend({\n\n    defaults: {\n        position: { x: 0, y: 0 },\n        size: { width: 1, height: 1 },\n        angle: 0\n    },\n\n    initialize: function() {\n\n        this._initializePorts();\n        Cell.prototype.initialize.apply(this, arguments);\n    },\n\n    /**\n     * @abstract\n     */\n    _initializePorts: function() {\n        // implemented in ports.js\n    },\n\n    _refreshPorts: function() {\n        // implemented in ports.js\n    },\n\n    isElement: function() {\n\n        return true;\n    },\n\n    position: function(x, y, opt) {\n\n        const isSetter = isNumber(y);\n        opt = (isSetter ? opt : x) || {};\n        const { parentRelative, deep, restrictedArea } = opt;\n\n\n        // option `parentRelative` for setting the position relative to the element's parent.\n        let parentPosition;\n        if (parentRelative) {\n\n            // Getting the parent's position requires the collection.\n            // Cell.parent() holds cell id only.\n            if (!this.graph) throw new Error('Element must be part of a graph.');\n\n            const parent = this.getParentCell();\n            if (parent && !parent.isLink()) {\n                parentPosition = parent.get('position');\n            }\n        }\n\n        if (isSetter) {\n\n            if (parentPosition) {\n                x += parentPosition.x;\n                y += parentPosition.y;\n            }\n\n            if (deep || restrictedArea) {\n                const { x: x0, y: y0 } = this.get('position');\n                this.translate(x - x0, y - y0, opt);\n            } else {\n                this.set('position', { x, y }, opt);\n            }\n\n            return this;\n\n        } else { // Getter returns a geometry point.\n\n            const elementPosition = Point(this.get('position'));\n            return parentRelative\n                ? elementPosition.difference(parentPosition)\n                : elementPosition;\n        }\n    },\n\n    translate: function(tx, ty, opt) {\n\n        tx = tx || 0;\n        ty = ty || 0;\n\n        if (tx === 0 && ty === 0) {\n            // Like nothing has happened.\n            return this;\n        }\n\n        opt = opt || {};\n        // Pass the initiator of the translation.\n        opt.translateBy = opt.translateBy || this.id;\n\n        var position = this.get('position') || { x: 0, y: 0 };\n        var ra = opt.restrictedArea;\n        if (ra && opt.translateBy === this.id) {\n\n            if (typeof ra === 'function') {\n\n                var newPosition = ra.call(this, position.x + tx, position.y + ty, opt);\n\n                tx = newPosition.x - position.x;\n                ty = newPosition.y - position.y;\n\n            } else  {\n                // We are restricting the translation for the element itself only. We get\n                // the bounding box of the element including all its embeds.\n                // All embeds have to be translated the exact same way as the element.\n                var bbox = this.getBBox({ deep: true });\n                //- - - - - - - - - - - - -> ra.x + ra.width\n                // - - - -> position.x      |\n                // -> bbox.x\n                //                   |\n                //         \n                //                 |\n                //   \n                //                  |\n                //   <-dx->                     | restricted area right border\n                //         <-width->        |    translated element\n                //   <- - bbox.width - ->        embedded element\n                var dx = position.x - bbox.x;\n                var dy = position.y - bbox.y;\n                // Find the maximal/minimal coordinates that the element can be translated\n                // while complies the restrictions.\n                var x = Math.max(ra.x + dx, Math.min(ra.x + ra.width + dx - bbox.width, position.x + tx));\n                var y = Math.max(ra.y + dy, Math.min(ra.y + ra.height + dy - bbox.height, position.y + ty));\n                // recalculate the translation taking the restrictions into account.\n                tx = x - position.x;\n                ty = y - position.y;\n            }\n        }\n\n        var translatedPosition = {\n            x: position.x + tx,\n            y: position.y + ty\n        };\n\n        // To find out by how much an element was translated in event 'change:position' handlers.\n        opt.tx = tx;\n        opt.ty = ty;\n\n        if (opt.transition) {\n\n            if (!isObject(opt.transition)) opt.transition = {};\n\n            this.transition('position', translatedPosition, assign({}, opt.transition, {\n                valueFunction: interpolate.object\n            }));\n\n            // Recursively call `translate()` on all the embeds cells.\n            invoke(this.getEmbeddedCells(), 'translate', tx, ty, opt);\n\n        } else {\n\n            this.startBatch('translate', opt);\n            this.set('position', translatedPosition, opt);\n            invoke(this.getEmbeddedCells(), 'translate', tx, ty, opt);\n            this.stopBatch('translate', opt);\n        }\n\n        return this;\n    },\n\n    size: function(width, height, opt) {\n\n        var currentSize = this.get('size');\n        // Getter\n        // () signature\n        if (width === undefined) {\n            return {\n                width: currentSize.width,\n                height: currentSize.height\n            };\n        }\n        // Setter\n        // (size, opt) signature\n        if (isObject(width)) {\n            opt = height;\n            height = isNumber(width.height) ? width.height : currentSize.height;\n            width = isNumber(width.width) ? width.width : currentSize.width;\n        }\n\n        return this.resize(width, height, opt);\n    },\n\n    resize: function(width, height, opt) {\n\n        opt = opt || {};\n\n        this.startBatch('resize', opt);\n\n        if (opt.direction) {\n\n            var currentSize = this.get('size');\n\n            switch (opt.direction) {\n\n                case 'left':\n                case 'right':\n                    // Don't change height when resizing horizontally.\n                    height = currentSize.height;\n                    break;\n\n                case 'top':\n                case 'bottom':\n                    // Don't change width when resizing vertically.\n                    width = currentSize.width;\n                    break;\n            }\n\n            // Get the angle and clamp its value between 0 and 360 degrees.\n            var angle = normalizeAngle(this.get('angle') || 0);\n\n            // This is a rectangle in size of the un-rotated element.\n            var bbox = this.getBBox();\n\n            var origin;\n\n            if (angle) {\n\n                var quadrant = {\n                    'top-right': 0,\n                    'right': 0,\n                    'top-left': 1,\n                    'top': 1,\n                    'bottom-left': 2,\n                    'left': 2,\n                    'bottom-right': 3,\n                    'bottom': 3\n                }[opt.direction];\n\n                if (opt.absolute) {\n\n                    // We are taking the element's rotation into account\n                    quadrant += Math.floor((angle + 45) / 90);\n                    quadrant %= 4;\n                }\n\n                // Pick the corner point on the element, which meant to stay on its place before and\n                // after the rotation.\n                var fixedPoint = bbox[['bottomLeft', 'corner', 'topRight', 'origin'][quadrant]]();\n\n                // Find  an image of the previous indent point. This is the position, where is the\n                // point actually located on the screen.\n                var imageFixedPoint = Point(fixedPoint).rotate(bbox.center(), -angle);\n\n                // Every point on the element rotates around a circle with the centre of rotation\n                // in the middle of the element while the whole element is being rotated. That means\n                // that the distance from a point in the corner of the element (supposed its always rect) to\n                // the center of the element doesn't change during the rotation and therefore it equals\n                // to a distance on un-rotated element.\n                // We can find the distance as DISTANCE = (ELEMENTWIDTH/2)^2 + (ELEMENTHEIGHT/2)^2)^0.5.\n                var radius = Math.sqrt((width * width) + (height * height)) / 2;\n\n                // Now we are looking for an angle between x-axis and the line starting at image of fixed point\n                // and ending at the center of the element. We call this angle `alpha`.\n\n                // The image of a fixed point is located in n-th quadrant. For each quadrant passed\n                // going anti-clockwise we have to add 90 degrees. Note that the first quadrant has index 0.\n                //\n                // 3 | 2\n                // --c-- Quadrant positions around the element's center `c`\n                // 0 | 1\n                //\n                var alpha = quadrant * Math.PI / 2;\n\n                // Add an angle between the beginning of the current quadrant (line parallel with x-axis or y-axis\n                // going through the center of the element) and line crossing the indent of the fixed point and the center\n                // of the element. This is the angle we need but on the un-rotated element.\n                alpha += Math.atan(quadrant % 2 == 0 ? height / width : width / height);\n\n                // Lastly we have to deduct the original angle the element was rotated by and that's it.\n                alpha -= toRad(angle);\n\n                // With this angle and distance we can easily calculate the centre of the un-rotated element.\n                // Note that fromPolar constructor accepts an angle in radians.\n                var center = Point.fromPolar(radius, alpha, imageFixedPoint);\n\n                // The top left corner on the un-rotated element has to be half a width on the left\n                // and half a height to the top from the center. This will be the origin of rectangle\n                // we were looking for.\n                origin = Point(center).offset(width / -2, height / -2);\n\n            } else {\n                // calculation for the origin Point when there is no rotation of the element\n                origin = bbox.topLeft();\n\n                switch (opt.direction) {\n                    case 'top':\n                    case 'top-right':\n                        origin.offset(0, bbox.height - height);\n                        break;\n                    case 'left':\n                    case 'bottom-left':\n                        origin.offset(bbox.width -width, 0);\n                        break;\n                    case 'top-left':\n                        origin.offset(bbox.width - width, bbox.height - height);\n                        break;\n                }\n            }\n\n            // Resize the element (before re-positioning it).\n            this.set('size', { width: width, height: height }, opt);\n\n            // Finally, re-position the element.\n            this.position(origin.x, origin.y, opt);\n\n        } else {\n\n            // Resize the element.\n            this.set('size', { width: width, height: height }, opt);\n        }\n\n        this.stopBatch('resize', opt);\n\n        return this;\n    },\n\n    scale: function(sx, sy, origin, opt) {\n\n        var scaledBBox = this.getBBox().scale(sx, sy, origin);\n        this.startBatch('scale', opt);\n        this.position(scaledBBox.x, scaledBBox.y, opt);\n        this.resize(scaledBBox.width, scaledBBox.height, opt);\n        this.stopBatch('scale');\n        return this;\n    },\n\n    fitEmbeds: function(opt) {\n\n        return this.fitToChildren(opt);\n    },\n\n    fitToChildren: function(opt = {}) {\n\n        // Getting the children's size and position requires the collection.\n        // Cell.get('embeds') holds an array of cell ids only.\n        const { graph } = this;\n        if (!graph) throw new Error('Element must be part of a graph.');\n\n        const childElements = this.getEmbeddedCells().filter(cell => cell.isElement());\n        if (childElements.length === 0) return this;\n\n        this.startBatch('fit-embeds', opt);\n\n        if (opt.deep) {\n            // `opt.deep = true` means \"fit to all descendants\".\n            // As the first action of the fitting algorithm, recursively apply `fitToChildren()` on all descendants.\n            // - i.e. the algorithm is applied in reverse-depth order - start from deepest descendant, then go up (= this element).\n            invoke(childElements, 'fitToChildren', opt);\n        }\n\n        // Set new size and position of this element, based on:\n        // - union of bboxes of all children\n        // - inflated by given `opt.padding`\n        this._fitToElements(Object.assign({ elements: childElements }, opt));\n\n        this.stopBatch('fit-embeds');\n\n        return this;\n    },\n\n    fitParent: function(opt = {}) {\n\n        const { graph } = this;\n        if (!graph) throw new Error('Element must be part of a graph.');\n\n        // When `opt.deep = true`, we want `opt.terminator` to be the last ancestor processed.\n        // If the current element is `opt.terminator`, it means that this element has already been processed as parent so we can exit now.\n        if (opt.deep && opt.terminator && ((opt.terminator === this) || (opt.terminator === this.id))) return this;\n\n        const parentElement = this.getParentCell();\n        if (!parentElement || !parentElement.isElement()) return this;\n\n        // Get all children of parent element (i.e. this element + any sibling elements).\n        const siblingElements = parentElement.getEmbeddedCells().filter(cell => cell.isElement());\n        if (siblingElements.length === 0) return this;\n\n        this.startBatch('fit-parent', opt);\n\n        // Set new size and position of parent element, based on:\n        // - union of bboxes of all children of parent element (i.e. this element + any sibling elements)\n        // - inflated by given `opt.padding`\n        parentElement._fitToElements(Object.assign({ elements: siblingElements }, opt));\n\n        if (opt.deep) {\n            // `opt.deep = true` means \"fit all ancestors to their respective children\".\n            // As the last action of the fitting algorithm, recursively apply `fitParent()` on all ancestors.\n            // - i.e. the algorithm is applied in reverse-depth order - start from deepest descendant (= this element), then go up.\n            parentElement.fitParent(opt);\n        }\n\n        this.stopBatch('fit-parent');\n\n        return this;\n    },\n\n    // Assumption: This element is part of a graph.\n    _fitToElements: function(opt = {}) {\n\n        const elementsBBox = this.graph.getCellsBBox(opt.elements);\n        // If no `opt.elements` were provided, do nothing.\n        if (!elementsBBox) return;\n\n        const { expandOnly, shrinkOnly } = opt;\n        // This combination is meaningless, do nothing.\n        if (expandOnly && shrinkOnly) return;\n\n        // Calculate new size and position of this element based on:\n        // - union of bboxes of `opt.elements`\n        // - inflated by `opt.padding` (if not provided, all four properties = 0)\n        let { x, y, width, height } = elementsBBox;\n        const { left, right, top, bottom } = normalizeSides(opt.padding);\n        x -= left;\n        y -= top;\n        width += left + right;\n        height += bottom + top;\n        let resultBBox = new Rect(x, y, width, height);\n\n        if (expandOnly) {\n            // Non-shrinking is enforced by taking union of this element's current bbox with bbox calculated from `opt.elements`.\n            resultBBox = this.getBBox().union(resultBBox);\n\n        } else if (shrinkOnly) {\n            // Non-expansion is enforced by taking intersection of this element's current bbox with bbox calculated from `opt.elements`.\n            const intersectionBBox = this.getBBox().intersect(resultBBox);\n            // If all children are outside this element's current bbox, then `intersectionBBox` is `null` - does not make sense, do nothing.\n            if (!intersectionBBox) return;\n\n            resultBBox =  intersectionBBox;\n        }\n\n        // Set the new size and position of this element.\n        this.set({\n            position: { x: resultBBox.x, y: resultBBox.y },\n            size: { width: resultBBox.width, height: resultBBox.height }\n        }, opt);\n    },\n\n    // Rotate element by `angle` degrees, optionally around `origin` point.\n    // If `origin` is not provided, it is considered to be the center of the element.\n    // If `absolute` is `true`, the `angle` is considered is absolute, i.e. it is not\n    // the difference from the previous angle.\n    rotate: function(angle, absolute, origin, opt) {\n\n        if (origin) {\n\n            var center = this.getBBox().center();\n            var size = this.get('size');\n            var position = this.get('position');\n            center.rotate(origin, this.get('angle') - angle);\n            var dx = center.x - size.width / 2 - position.x;\n            var dy = center.y - size.height / 2 - position.y;\n            this.startBatch('rotate', { angle: angle, absolute: absolute, origin: origin });\n            this.position(position.x + dx, position.y + dy, opt);\n            this.rotate(angle, absolute, null, opt);\n            this.stopBatch('rotate');\n\n        } else {\n\n            this.set('angle', absolute ? angle : (this.get('angle') + angle) % 360, opt);\n        }\n\n        return this;\n    },\n\n    angle: function() {\n        return normalizeAngle(this.get('angle') || 0);\n    },\n\n    getBBox: function(opt = {}) {\n\n        const { graph, attributes } = this;\n        const { deep, rotate } = opt;\n\n        if (deep && graph) {\n            // Get all the embedded elements using breadth first algorithm.\n            const elements = this.getEmbeddedCells({ deep: true, breadthFirst: true });\n            // Add the model itself.\n            elements.push(this);\n            // Note: the default of getCellsBBox() is rotate=true and can't be\n            // changed without a breaking change\n            return graph.getCellsBBox(elements, opt);\n        }\n\n        const { angle = 0, position: { x, y }, size: { width, height }} = attributes;\n        const bbox = new Rect(x, y, width, height);\n        if (rotate) {\n            bbox.rotateAroundCenter(angle);\n        }\n        return bbox;\n    },\n\n    getPointFromConnectedLink: function(link, endType) {\n        // Center of the model\n        var bbox = this.getBBox();\n        var center = bbox.center();\n        // Center of a port\n        var endDef = link.get(endType);\n        if (!endDef) return center;\n        var portId = endDef.port;\n        if (!portId || !this.hasPort(portId)) return center;\n        var portGroup = this.portProp(portId, ['group']);\n        var portsPositions = this.getPortsPositions(portGroup);\n        var portCenter = new Point(portsPositions[portId]).offset(bbox.origin());\n        var angle = this.angle();\n        if (angle) portCenter.rotate(center, -angle);\n        return portCenter;\n    }\n});\n\nassign(Element.prototype, elementPortPrototype);\n\n","import Backbone from 'backbone';\nimport * as util from '../util/index.mjs';\nimport * as g from '../g/index.mjs';\n\nimport { Link } from './Link.mjs';\nimport { Element } from './Element.mjs';\nimport { wrappers, wrapWith } from '../util/wrappers.mjs';\nimport { cloneCells } from '../util/index.mjs';\n\nconst GraphCells = Backbone.Collection.extend({\n\n    initialize: function(models, opt) {\n\n        // Set the optional namespace where all model classes are defined.\n        if (opt.cellNamespace) {\n            this.cellNamespace = opt.cellNamespace;\n        } else {\n            /* eslint-disable no-undef */\n            this.cellNamespace = typeof joint !== 'undefined' && util.has(joint, 'shapes') ? joint.shapes : null;\n            /* eslint-enable no-undef */\n        }\n\n\n        this.graph = opt.graph;\n    },\n\n    model: function(attrs, opt) {\n\n        var collection = opt.collection;\n        var namespace = collection.cellNamespace;\n\n        // Find the model class in the namespace or use the default one.\n        var ModelClass = (attrs.type === 'link')\n            ? Link\n            : util.getByPath(namespace, attrs.type, '.') || Element;\n\n        var cell = new ModelClass(attrs, opt);\n        // Add a reference to the graph. It is necessary to do this here because this is the earliest place\n        // where a new model is created from a plain JS object. For other objects, see `joint.dia.Graph>>_prepareCell()`.\n        if (!opt.dry) {\n            cell.graph = collection.graph;\n        }\n\n        return cell;\n    },\n\n    // `comparator` makes it easy to sort cells based on their `z` index.\n    comparator: function(model) {\n\n        return model.get('z') || 0;\n    }\n});\n\n\nexport const Graph = Backbone.Model.extend({\n\n    initialize: function(attrs, opt) {\n\n        opt = opt || {};\n\n        // Passing `cellModel` function in the options object to graph allows for\n        // setting models based on attribute objects. This is especially handy\n        // when processing JSON graphs that are in a different than JointJS format.\n        var cells = new GraphCells([], {\n            model: opt.cellModel,\n            cellNamespace: opt.cellNamespace,\n            graph: this\n        });\n        Backbone.Model.prototype.set.call(this, 'cells', cells);\n\n        // Make all the events fired in the `cells` collection available.\n        // to the outside world.\n        cells.on('all', this.trigger, this);\n\n        // Backbone automatically doesn't trigger re-sort if models attributes are changed later when\n        // they're already in the collection. Therefore, we're triggering sort manually here.\n        this.on('change:z', this._sortOnChangeZ, this);\n\n        // `joint.dia.Graph` keeps an internal data structure (an adjacency list)\n        // for fast graph queries. All changes that affect the structure of the graph\n        // must be reflected in the `al` object. This object provides fast answers to\n        // questions such as \"what are the neighbours of this node\" or \"what\n        // are the sibling links of this link\".\n\n        // Outgoing edges per node. Note that we use a hash-table for the list\n        // of outgoing edges for a faster lookup.\n        // [nodeId] -> Object [edgeId] -> true\n        this._out = {};\n        // Ingoing edges per node.\n        // [nodeId] -> Object [edgeId] -> true\n        this._in = {};\n        // `_nodes` is useful for quick lookup of all the elements in the graph, without\n        // having to go through the whole cells array.\n        // [node ID] -> true\n        this._nodes = {};\n        // `_edges` is useful for quick lookup of all the links in the graph, without\n        // having to go through the whole cells array.\n        // [edgeId] -> true\n        this._edges = {};\n\n        this._batches = {};\n\n        cells.on('add', this._restructureOnAdd, this);\n        cells.on('remove', this._restructureOnRemove, this);\n        cells.on('reset', this._restructureOnReset, this);\n        cells.on('change:source', this._restructureOnChangeSource, this);\n        cells.on('change:target', this._restructureOnChangeTarget, this);\n        cells.on('remove', this._removeCell, this);\n    },\n\n    _sortOnChangeZ: function() {\n\n        this.get('cells').sort();\n    },\n\n    _restructureOnAdd: function(cell) {\n\n        if (cell.isLink()) {\n            this._edges[cell.id] = true;\n            var { source, target } = cell.attributes;\n            if (source.id) {\n                (this._out[source.id] || (this._out[source.id] = {}))[cell.id] = true;\n            }\n            if (target.id) {\n                (this._in[target.id] || (this._in[target.id] = {}))[cell.id] = true;\n            }\n        } else {\n            this._nodes[cell.id] = true;\n        }\n    },\n\n    _restructureOnRemove: function(cell) {\n\n        if (cell.isLink()) {\n            delete this._edges[cell.id];\n            var { source, target } = cell.attributes;\n            if (source.id && this._out[source.id] && this._out[source.id][cell.id]) {\n                delete this._out[source.id][cell.id];\n            }\n            if (target.id && this._in[target.id] && this._in[target.id][cell.id]) {\n                delete this._in[target.id][cell.id];\n            }\n        } else {\n            delete this._nodes[cell.id];\n        }\n    },\n\n    _restructureOnReset: function(cells) {\n\n        // Normalize into an array of cells. The original `cells` is GraphCells Backbone collection.\n        cells = cells.models;\n\n        this._out = {};\n        this._in = {};\n        this._nodes = {};\n        this._edges = {};\n\n        cells.forEach(this._restructureOnAdd, this);\n    },\n\n    _restructureOnChangeSource: function(link) {\n\n        var prevSource = link.previous('source');\n        if (prevSource.id && this._out[prevSource.id]) {\n            delete this._out[prevSource.id][link.id];\n        }\n        var source = link.attributes.source;\n        if (source.id) {\n            (this._out[source.id] || (this._out[source.id] = {}))[link.id] = true;\n        }\n    },\n\n    _restructureOnChangeTarget: function(link) {\n\n        var prevTarget = link.previous('target');\n        if (prevTarget.id && this._in[prevTarget.id]) {\n            delete this._in[prevTarget.id][link.id];\n        }\n        var target = link.get('target');\n        if (target.id) {\n            (this._in[target.id] || (this._in[target.id] = {}))[link.id] = true;\n        }\n    },\n\n    // Return all outbound edges for the node. Return value is an object\n    // of the form: [edgeId] -> true\n    getOutboundEdges: function(node) {\n\n        return (this._out && this._out[node]) || {};\n    },\n\n    // Return all inbound edges for the node. Return value is an object\n    // of the form: [edgeId] -> true\n    getInboundEdges: function(node) {\n\n        return (this._in && this._in[node]) || {};\n    },\n\n    toJSON: function() {\n\n        // Backbone does not recursively call `toJSON()` on attributes that are themselves models/collections.\n        // It just clones the attributes. Therefore, we must call `toJSON()` on the cells collection explicitly.\n        var json = Backbone.Model.prototype.toJSON.apply(this, arguments);\n        json.cells = this.get('cells').toJSON();\n        return json;\n    },\n\n    fromJSON: function(json, opt) {\n\n        if (!json.cells) {\n\n            throw new Error('Graph JSON must contain cells array.');\n        }\n\n        return this.set(json, opt);\n    },\n\n    set: function(key, val, opt) {\n\n        var attrs;\n\n        // Handle both `key`, value and {key: value} style arguments.\n        if (typeof key === 'object') {\n            attrs = key;\n            opt = val;\n        } else {\n            (attrs = {})[key] = val;\n        }\n\n        // Make sure that `cells` attribute is handled separately via resetCells().\n        if (attrs.hasOwnProperty('cells')) {\n            this.resetCells(attrs.cells, opt);\n            attrs = util.omit(attrs, 'cells');\n        }\n\n        // The rest of the attributes are applied via original set method.\n        return Backbone.Model.prototype.set.call(this, attrs, opt);\n    },\n\n    clear: function(opt) {\n\n        opt = util.assign({}, opt, { clear: true });\n\n        var collection = this.get('cells');\n\n        if (collection.length === 0) return this;\n\n        this.startBatch('clear', opt);\n\n        // The elements come after the links.\n        var cells = collection.sortBy(function(cell) {\n            return cell.isLink() ? 1 : 2;\n        });\n\n        do {\n\n            // Remove all the cells one by one.\n            // Note that all the links are removed first, so it's\n            // safe to remove the elements without removing the connected\n            // links first.\n            cells.shift().remove(opt);\n\n        } while (cells.length > 0);\n\n        this.stopBatch('clear');\n\n        return this;\n    },\n\n    _prepareCell: function(cell, opt) {\n\n        var attrs;\n        if (cell instanceof Backbone.Model) {\n            attrs = cell.attributes;\n            if (!cell.graph && (!opt || !opt.dry)) {\n                // An element can not be member of more than one graph.\n                // A cell stops being the member of the graph after it's explicitly removed.\n                cell.graph = this;\n            }\n        } else {\n            // In case we're dealing with a plain JS object, we have to set the reference\n            // to the `graph` right after the actual model is created. This happens in the `model()` function\n            // of `joint.dia.GraphCells`.\n            attrs = cell;\n        }\n\n        if (!util.isString(attrs.type)) {\n            throw new TypeError('dia.Graph: cell type must be a string.');\n        }\n\n        return cell;\n    },\n\n    minZIndex: function() {\n\n        var firstCell = this.get('cells').first();\n        return firstCell ? (firstCell.get('z') || 0) : 0;\n    },\n\n    maxZIndex: function() {\n\n        var lastCell = this.get('cells').last();\n        return lastCell ? (lastCell.get('z') || 0) : 0;\n    },\n\n    addCell: function(cell, opt) {\n\n        if (Array.isArray(cell)) {\n\n            return this.addCells(cell, opt);\n        }\n\n        if (cell instanceof Backbone.Model) {\n\n            if (!cell.has('z')) {\n                cell.set('z', this.maxZIndex() + 1);\n            }\n\n        } else if (cell.z === undefined) {\n\n            cell.z = this.maxZIndex() + 1;\n        }\n\n        this.get('cells').add(this._prepareCell(cell, opt), opt || {});\n\n        return this;\n    },\n\n    addCells: function(cells, opt) {\n\n        if (cells.length === 0) return this;\n\n        cells = util.flattenDeep(cells);\n        opt.maxPosition = opt.position = cells.length - 1;\n\n        this.startBatch('add', opt);\n        cells.forEach(function(cell) {\n            this.addCell(cell, opt);\n            opt.position--;\n        }, this);\n        this.stopBatch('add', opt);\n\n        return this;\n    },\n\n    // When adding a lot of cells, it is much more efficient to\n    // reset the entire cells collection in one go.\n    // Useful for bulk operations and optimizations.\n    resetCells: function(cells, opt) {\n\n        var preparedCells = util.toArray(cells).map(function(cell) {\n            return this._prepareCell(cell, opt);\n        }, this);\n        this.get('cells').reset(preparedCells, opt);\n\n        return this;\n    },\n\n    removeCells: function(cells, opt) {\n\n        if (cells.length) {\n\n            this.startBatch('remove');\n            util.invoke(cells, 'remove', opt);\n            this.stopBatch('remove');\n        }\n\n        return this;\n    },\n\n    _removeCell: function(cell, collection, options) {\n\n        options = options || {};\n\n        if (!options.clear) {\n            // Applications might provide a `disconnectLinks` option set to `true` in order to\n            // disconnect links when a cell is removed rather then removing them. The default\n            // is to remove all the associated links.\n            if (options.disconnectLinks) {\n\n                this.disconnectLinks(cell, options);\n\n            } else {\n\n                this.removeLinks(cell, options);\n            }\n        }\n        // Silently remove the cell from the cells collection. Silently, because\n        // `joint.dia.Cell.prototype.remove` already triggers the `remove` event which is\n        // then propagated to the graph model. If we didn't remove the cell silently, two `remove` events\n        // would be triggered on the graph model.\n        this.get('cells').remove(cell, { silent: true });\n\n        if (cell.graph === this) {\n            // Remove the element graph reference only if the cell is the member of this graph.\n            cell.graph = null;\n        }\n    },\n\n    // Get a cell by `id`.\n    getCell: function(id) {\n\n        return this.get('cells').get(id);\n    },\n\n    getCells: function() {\n\n        return this.get('cells').toArray();\n    },\n\n    getElements: function() {\n\n        return this.get('cells').filter(cell => cell.isElement());\n    },\n\n    getLinks: function() {\n\n        return this.get('cells').filter(cell => cell.isLink());\n    },\n\n    getFirstCell: function() {\n\n        return this.get('cells').first();\n    },\n\n    getLastCell: function() {\n\n        return this.get('cells').last();\n    },\n\n    // Get all inbound and outbound links connected to the cell `model`.\n    getConnectedLinks: function(model, opt) {\n\n        opt = opt || {};\n\n        var indirect = opt.indirect;\n        var inbound = opt.inbound;\n        var outbound = opt.outbound;\n        if ((inbound === undefined) && (outbound === undefined)) {\n            inbound = outbound = true;\n        }\n\n        // the final array of connected link models\n        var links = [];\n        // a hash table of connected edges of the form: [edgeId] -> true\n        // used for quick lookups to check if we already added a link\n        var edges = {};\n\n        if (outbound) {\n            addOutbounds(this, model);\n        }\n        if (inbound) {\n            addInbounds(this, model);\n        }\n\n        function addOutbounds(graph, model) {\n            util.forIn(graph.getOutboundEdges(model.id), function(_, edge) {\n                // skip links that were already added\n                // (those must be self-loop links)\n                // (because they are inbound and outbound edges of the same two elements)\n                if (edges[edge]) return;\n                var link = graph.getCell(edge);\n                links.push(link);\n                edges[edge] = true;\n                if (indirect) {\n                    if (inbound) addInbounds(graph, link);\n                    if (outbound) addOutbounds(graph, link);\n                }\n            }.bind(graph));\n            if (indirect && model.isLink()) {\n                var outCell = model.getTargetCell();\n                if (outCell && outCell.isLink()) {\n                    if (!edges[outCell.id]) {\n                        links.push(outCell);\n                        addOutbounds(graph, outCell);\n                    }\n                }\n            }\n        }\n\n        function addInbounds(graph, model) {\n            util.forIn(graph.getInboundEdges(model.id), function(_, edge) {\n                // skip links that were already added\n                // (those must be self-loop links)\n                // (because they are inbound and outbound edges of the same two elements)\n                if (edges[edge]) return;\n                var link = graph.getCell(edge);\n                links.push(link);\n                edges[edge] = true;\n                if (indirect) {\n                    if (inbound) addInbounds(graph, link);\n                    if (outbound) addOutbounds(graph, link);\n                }\n            }.bind(graph));\n            if (indirect && model.isLink()) {\n                var inCell = model.getSourceCell();\n                if (inCell && inCell.isLink()) {\n                    if (!edges[inCell.id]) {\n                        links.push(inCell);\n                        addInbounds(graph, inCell);\n                    }\n                }\n            }\n        }\n\n        // if `deep` option is `true`, check also all the links that are connected to any of the descendant cells\n        if (opt.deep) {\n\n            var embeddedCells = model.getEmbeddedCells({ deep: true });\n\n            // in the first round, we collect all the embedded elements\n            var embeddedElements = {};\n            embeddedCells.forEach(function(cell) {\n                if (cell.isElement()) {\n                    embeddedElements[cell.id] = true;\n                }\n            });\n\n            embeddedCells.forEach(function(cell) {\n                if (cell.isLink()) return;\n                if (outbound) {\n                    util.forIn(this.getOutboundEdges(cell.id), function(exists, edge) {\n                        if (!edges[edge]) {\n                            var edgeCell = this.getCell(edge);\n                            var { source, target } = edgeCell.attributes;\n                            var sourceId = source.id;\n                            var targetId = target.id;\n\n                            // if `includeEnclosed` option is falsy, skip enclosed links\n                            if (!opt.includeEnclosed\n                                && (sourceId && embeddedElements[sourceId])\n                                && (targetId && embeddedElements[targetId])) {\n                                return;\n                            }\n\n                            links.push(this.getCell(edge));\n                            edges[edge] = true;\n                        }\n                    }.bind(this));\n                }\n                if (inbound) {\n                    util.forIn(this.getInboundEdges(cell.id), function(exists, edge) {\n                        if (!edges[edge]) {\n                            var edgeCell = this.getCell(edge);\n                            var { source, target } = edgeCell.attributes;\n                            var sourceId = source.id;\n                            var targetId = target.id;\n\n                            // if `includeEnclosed` option is falsy, skip enclosed links\n                            if (!opt.includeEnclosed\n                                && (sourceId && embeddedElements[sourceId])\n                                && (targetId && embeddedElements[targetId])) {\n                                return;\n                            }\n\n                            links.push(this.getCell(edge));\n                            edges[edge] = true;\n                        }\n                    }.bind(this));\n                }\n            }, this);\n        }\n\n        return links;\n    },\n\n    getNeighbors: function(model, opt) {\n\n        opt || (opt = {});\n\n        var inbound = opt.inbound;\n        var outbound = opt.outbound;\n        if (inbound === undefined && outbound === undefined) {\n            inbound = outbound = true;\n        }\n\n        var neighbors = this.getConnectedLinks(model, opt).reduce(function(res, link) {\n\n            var { source, target } = link.attributes;\n            var loop = link.hasLoop(opt);\n\n            // Discard if it is a point, or if the neighbor was already added.\n            if (inbound && util.has(source, 'id') && !res[source.id]) {\n\n                var sourceElement = this.getCell(source.id);\n                if (sourceElement.isElement()) {\n                    if (loop || (sourceElement && sourceElement !== model && (!opt.deep || !sourceElement.isEmbeddedIn(model)))) {\n                        res[source.id] = sourceElement;\n                    }\n                }\n            }\n\n            // Discard if it is a point, or if the neighbor was already added.\n            if (outbound && util.has(target, 'id') && !res[target.id]) {\n\n                var targetElement = this.getCell(target.id);\n                if (targetElement.isElement()) {\n                    if (loop || (targetElement && targetElement !== model && (!opt.deep || !targetElement.isEmbeddedIn(model)))) {\n                        res[target.id] = targetElement;\n                    }\n                }\n            }\n\n            return res;\n        }.bind(this), {});\n\n        if (model.isLink()) {\n            if (inbound) {\n                var sourceCell = model.getSourceCell();\n                if (sourceCell && sourceCell.isElement() && !neighbors[sourceCell.id]) {\n                    neighbors[sourceCell.id] = sourceCell;\n                }\n            }\n            if (outbound) {\n                var targetCell = model.getTargetCell();\n                if (targetCell && targetCell.isElement() && !neighbors[targetCell.id]) {\n                    neighbors[targetCell.id] = targetCell;\n                }\n            }\n        }\n\n        return util.toArray(neighbors);\n    },\n\n    getCommonAncestor: function(/* cells */) {\n\n        var cellsAncestors = Array.from(arguments).map(function(cell) {\n\n            var ancestors = [];\n            var parentId = cell.get('parent');\n\n            while (parentId) {\n\n                ancestors.push(parentId);\n                parentId = this.getCell(parentId).get('parent');\n            }\n\n            return ancestors;\n\n        }, this);\n\n        cellsAncestors = cellsAncestors.sort(function(a, b) {\n            return a.length - b.length;\n        });\n\n        var commonAncestor = util.toArray(cellsAncestors.shift()).find(function(ancestor) {\n            return cellsAncestors.every(function(cellAncestors) {\n                return cellAncestors.includes(ancestor);\n            });\n        });\n\n        return this.getCell(commonAncestor);\n    },\n\n    // Find the whole branch starting at `element`.\n    // If `opt.deep` is `true`, take into account embedded elements too.\n    // If `opt.breadthFirst` is `true`, use the Breadth-first search algorithm, otherwise use Depth-first search.\n    getSuccessors: function(element, opt) {\n\n        opt = opt || {};\n        var res = [];\n        // Modify the options so that it includes the `outbound` neighbors only. In other words, search forwards.\n        this.search(element, function(el) {\n            if (el !== element) {\n                res.push(el);\n            }\n        }, util.assign({}, opt, { outbound: true }));\n        return res;\n    },\n\n    cloneCells: cloneCells,\n    // Clone the whole subgraph (including all the connected links whose source/target is in the subgraph).\n    // If `opt.deep` is `true`, also take into account all the embedded cells of all the subgraph cells.\n    // Return a map of the form: [original cell ID] -> [clone].\n    cloneSubgraph: function(cells, opt) {\n\n        var subgraph = this.getSubgraph(cells, opt);\n        return this.cloneCells(subgraph);\n    },\n\n    // Return `cells` and all the connected links that connect cells in the `cells` array.\n    // If `opt.deep` is `true`, return all the cells including all their embedded cells\n    // and all the links that connect any of the returned cells.\n    // For example, for a single shallow element, the result is that very same element.\n    // For two elements connected with a link: `A --- L ---> B`, the result for\n    // `getSubgraph([A, B])` is `[A, L, B]`. The same goes for `getSubgraph([L])`, the result is again `[A, L, B]`.\n    getSubgraph: function(cells, opt) {\n\n        opt = opt || {};\n\n        var subgraph = [];\n        // `cellMap` is used for a quick lookup of existence of a cell in the `cells` array.\n        var cellMap = {};\n        var elements = [];\n        var links = [];\n\n        util.toArray(cells).forEach(function(cell) {\n            if (!cellMap[cell.id]) {\n                subgraph.push(cell);\n                cellMap[cell.id] = cell;\n                if (cell.isLink()) {\n                    links.push(cell);\n                } else {\n                    elements.push(cell);\n                }\n            }\n\n            if (opt.deep) {\n                var embeds = cell.getEmbeddedCells({ deep: true });\n                embeds.forEach(function(embed) {\n                    if (!cellMap[embed.id]) {\n                        subgraph.push(embed);\n                        cellMap[embed.id] = embed;\n                        if (embed.isLink()) {\n                            links.push(embed);\n                        } else {\n                            elements.push(embed);\n                        }\n                    }\n                });\n            }\n        });\n\n        links.forEach(function(link) {\n            // For links, return their source & target (if they are elements - not points).\n            var { source, target } = link.attributes;\n            if (source.id && !cellMap[source.id]) {\n                var sourceElement = this.getCell(source.id);\n                subgraph.push(sourceElement);\n                cellMap[sourceElement.id] = sourceElement;\n                elements.push(sourceElement);\n            }\n            if (target.id && !cellMap[target.id]) {\n                var targetElement = this.getCell(target.id);\n                subgraph.push(this.getCell(target.id));\n                cellMap[targetElement.id] = targetElement;\n                elements.push(targetElement);\n            }\n        }, this);\n\n        elements.forEach(function(element) {\n            // For elements, include their connected links if their source/target is in the subgraph;\n            var links = this.getConnectedLinks(element, opt);\n            links.forEach(function(link) {\n                var { source, target } = link.attributes;\n                if (!cellMap[link.id] && source.id && cellMap[source.id] && target.id && cellMap[target.id]) {\n                    subgraph.push(link);\n                    cellMap[link.id] = link;\n                }\n            });\n        }, this);\n\n        return subgraph;\n    },\n\n    // Find all the predecessors of `element`. This is a reverse operation of `getSuccessors()`.\n    // If `opt.deep` is `true`, take into account embedded elements too.\n    // If `opt.breadthFirst` is `true`, use the Breadth-first search algorithm, otherwise use Depth-first search.\n    getPredecessors: function(element, opt) {\n\n        opt = opt || {};\n        var res = [];\n        // Modify the options so that it includes the `inbound` neighbors only. In other words, search backwards.\n        this.search(element, function(el) {\n            if (el !== element) {\n                res.push(el);\n            }\n        }, util.assign({}, opt, { inbound: true }));\n        return res;\n    },\n\n    // Perform search on the graph.\n    // If `opt.breadthFirst` is `true`, use the Breadth-first Search algorithm, otherwise use Depth-first search.\n    // By setting `opt.inbound` to `true`, you can reverse the direction of the search.\n    // If `opt.deep` is `true`, take into account embedded elements too.\n    // `iteratee` is a function of the form `function(element) {}`.\n    // If `iteratee` explicitly returns `false`, the searching stops.\n    search: function(element, iteratee, opt) {\n\n        opt = opt || {};\n        if (opt.breadthFirst) {\n            this.bfs(element, iteratee, opt);\n        } else {\n            this.dfs(element, iteratee, opt);\n        }\n    },\n\n    // Breadth-first search.\n    // If `opt.deep` is `true`, take into account embedded elements too.\n    // If `opt.inbound` is `true`, reverse the search direction (it's like reversing all the link directions).\n    // `iteratee` is a function of the form `function(element, distance) {}`.\n    // where `element` is the currently visited element and `distance` is the distance of that element\n    // from the root `element` passed the `bfs()`, i.e. the element we started the search from.\n    // Note that the `distance` is not the shortest or longest distance, it is simply the number of levels\n    // crossed till we visited the `element` for the first time. It is especially useful for tree graphs.\n    // If `iteratee` explicitly returns `false`, the searching stops.\n    bfs: function(element, iteratee, opt = {}) {\n\n        const visited = {};\n        const distance = {};\n        const queue = [];\n\n        queue.push(element);\n        distance[element.id] = 0;\n\n        while (queue.length > 0) {\n            var next = queue.shift();\n            if (visited[next.id]) continue;\n            visited[next.id] = true;\n            if (iteratee.call(this, next, distance[next.id]) === false) continue;\n            const neighbors = this.getNeighbors(next, opt);\n            for (let i = 0, n = neighbors.length; i < n; i++) {\n                const neighbor = neighbors[i];\n                distance[neighbor.id] = distance[next.id] + 1;\n                queue.push(neighbor);\n            }\n        }\n    },\n\n    // Depth-first search.\n    // If `opt.deep` is `true`, take into account embedded elements too.\n    // If `opt.inbound` is `true`, reverse the search direction (it's like reversing all the link directions).\n    // `iteratee` is a function of the form `function(element, distance) {}`.\n    // If `iteratee` explicitly returns `false`, the search stops.\n    dfs: function(element, iteratee, opt = {}) {\n\n        const visited = {};\n        const distance = {};\n        const queue = [];\n\n        queue.push(element);\n        distance[element.id] = 0;\n\n        while (queue.length > 0) {\n            const next = queue.pop();\n            if (visited[next.id]) continue;\n            visited[next.id] = true;\n            if (iteratee.call(this, next, distance[next.id]) === false) continue;\n            const neighbors = this.getNeighbors(next, opt);\n            const lastIndex = queue.length;\n            for (let i = 0, n = neighbors.length; i < n; i++) {\n                const neighbor = neighbors[i];\n                distance[neighbor.id] = distance[next.id] + 1;\n                queue.splice(lastIndex, 0, neighbor);\n            }\n        }\n    },\n\n    // Get all the roots of the graph. Time complexity: O(|V|).\n    getSources: function() {\n\n        var sources = [];\n        util.forIn(this._nodes, function(exists, node) {\n            if (!this._in[node] || util.isEmpty(this._in[node])) {\n                sources.push(this.getCell(node));\n            }\n        }.bind(this));\n        return sources;\n    },\n\n    // Get all the leafs of the graph. Time complexity: O(|V|).\n    getSinks: function() {\n\n        var sinks = [];\n        util.forIn(this._nodes, function(exists, node) {\n            if (!this._out[node] || util.isEmpty(this._out[node])) {\n                sinks.push(this.getCell(node));\n            }\n        }.bind(this));\n        return sinks;\n    },\n\n    // Return `true` if `element` is a root. Time complexity: O(1).\n    isSource: function(element) {\n\n        return !this._in[element.id] || util.isEmpty(this._in[element.id]);\n    },\n\n    // Return `true` if `element` is a leaf. Time complexity: O(1).\n    isSink: function(element) {\n\n        return !this._out[element.id] || util.isEmpty(this._out[element.id]);\n    },\n\n    // Return `true` is `elementB` is a successor of `elementA`. Return `false` otherwise.\n    isSuccessor: function(elementA, elementB) {\n\n        var isSuccessor = false;\n        this.search(elementA, function(element) {\n            if (element === elementB && element !== elementA) {\n                isSuccessor = true;\n                return false;\n            }\n        }, { outbound: true });\n        return isSuccessor;\n    },\n\n    // Return `true` is `elementB` is a predecessor of `elementA`. Return `false` otherwise.\n    isPredecessor: function(elementA, elementB) {\n\n        var isPredecessor = false;\n        this.search(elementA, function(element) {\n            if (element === elementB && element !== elementA) {\n                isPredecessor = true;\n                return false;\n            }\n        }, { inbound: true });\n        return isPredecessor;\n    },\n\n    // Return `true` is `elementB` is a neighbor of `elementA`. Return `false` otherwise.\n    // `opt.deep` controls whether to take into account embedded elements as well. See `getNeighbors()`\n    // for more details.\n    // If `opt.outbound` is set to `true`, return `true` only if `elementB` is a successor neighbor.\n    // Similarly, if `opt.inbound` is set to `true`, return `true` only if `elementB` is a predecessor neighbor.\n    isNeighbor: function(elementA, elementB, opt) {\n\n        opt = opt || {};\n\n        var inbound = opt.inbound;\n        var outbound = opt.outbound;\n        if ((inbound === undefined) && (outbound === undefined)) {\n            inbound = outbound = true;\n        }\n\n        var isNeighbor = false;\n\n        this.getConnectedLinks(elementA, opt).forEach(function(link) {\n\n            var { source, target } = link.attributes;\n\n            // Discard if it is a point.\n            if (inbound && util.has(source, 'id') && (source.id === elementB.id)) {\n                isNeighbor = true;\n                return false;\n            }\n\n            // Discard if it is a point, or if the neighbor was already added.\n            if (outbound && util.has(target, 'id') && (target.id === elementB.id)) {\n                isNeighbor = true;\n                return false;\n            }\n        });\n\n        return isNeighbor;\n    },\n\n    // Disconnect links connected to the cell `model`.\n    disconnectLinks: function(model, opt) {\n\n        this.getConnectedLinks(model).forEach(function(link) {\n\n            link.set((link.attributes.source.id === model.id ? 'source' : 'target'), { x: 0, y: 0 }, opt);\n        });\n    },\n\n    // Remove links connected to the cell `model` completely.\n    removeLinks: function(model, opt) {\n\n        util.invoke(this.getConnectedLinks(model), 'remove', opt);\n    },\n\n    // Find all elements at given point\n    findModelsFromPoint: function(p) {\n        return this.getElements().filter(el => el.getBBox({ rotate: true }).containsPoint(p));\n    },\n\n    // Find all elements in given area\n    findModelsInArea: function(rect, opt = {}) {\n        const r = new g.Rect(rect);\n        const { strict = false } = opt;\n        const method = strict ? 'containsRect' : 'intersect';\n        return this.getElements().filter(el => r[method](el.getBBox({ rotate: true })));\n    },\n\n    // Find all elements under the given element.\n    findModelsUnderElement: function(element, opt = {}) {\n        const { searchBy = 'bbox' } = opt;\n        const bbox = element.getBBox().rotateAroundCenter(element.angle());\n        const elements = (searchBy === 'bbox')\n            ? this.findModelsInArea(bbox)\n            : this.findModelsFromPoint(util.getRectPoint(bbox, searchBy));\n        // don't account element itself or any of its descendants\n        return elements.filter(el => element.id !== el.id && !el.isEmbeddedIn(element));\n    },\n\n    // Return bounding box of all elements.\n    getBBox: function() {\n\n        return this.getCellsBBox(this.getCells());\n    },\n\n    // Return the bounding box of all cells in array provided.\n    getCellsBBox: function(cells, opt = {}) {\n        const { rotate = true } = opt;\n        return util.toArray(cells).reduce(function(memo, cell) {\n            const rect = cell.getBBox({ rotate });\n            if (!rect) return memo;\n            if (memo) {\n                return memo.union(rect);\n            }\n            return rect;\n        }, null);\n    },\n\n    translate: function(dx, dy, opt) {\n\n        // Don't translate cells that are embedded in any other cell.\n        var cells = this.getCells().filter(function(cell) {\n            return !cell.isEmbedded();\n        });\n\n        util.invoke(cells, 'translate', dx, dy, opt);\n\n        return this;\n    },\n\n    resize: function(width, height, opt) {\n\n        return this.resizeCells(width, height, this.getCells(), opt);\n    },\n\n    resizeCells: function(width, height, cells, opt) {\n\n        // `getBBox` method returns `null` if no elements provided.\n        // i.e. cells can be an array of links\n        var bbox = this.getCellsBBox(cells);\n        if (bbox) {\n            var sx = Math.max(width / bbox.width, 0);\n            var sy = Math.max(height / bbox.height, 0);\n            util.invoke(cells, 'scale', sx, sy, bbox.origin(), opt);\n        }\n\n        return this;\n    },\n\n    startBatch: function(name, data) {\n\n        data = data || {};\n        this._batches[name] = (this._batches[name] || 0) + 1;\n\n        return this.trigger('batch:start', util.assign({}, data, { batchName: name }));\n    },\n\n    stopBatch: function(name, data) {\n\n        data = data || {};\n        this._batches[name] = (this._batches[name] || 0) - 1;\n\n        return this.trigger('batch:stop', util.assign({}, data, { batchName: name }));\n    },\n\n    hasActiveBatch: function(name) {\n\n        const batches = this._batches;\n        let names;\n\n        if (arguments.length === 0) {\n            names = Object.keys(batches);\n        } else if (Array.isArray(name)) {\n            names = name;\n        } else {\n            names = [name];\n        }\n\n        return names.some((batch) => batches[batch] > 0);\n    }\n\n}, {\n\n    validations: {\n\n        multiLinks: function(graph, link) {\n\n            // Do not allow multiple links to have the same source and target.\n            var { source, target } = link.attributes;\n\n            if (source.id && target.id) {\n\n                var sourceModel = link.getSourceCell();\n                if (sourceModel) {\n\n                    var connectedLinks = graph.getConnectedLinks(sourceModel, { outbound: true });\n                    var sameLinks = connectedLinks.filter(function(_link) {\n\n                        var { source: _source, target: _target } = _link.attributes;\n                        return _source && _source.id === source.id &&\n                            (!_source.port || (_source.port === source.port)) &&\n                            _target && _target.id === target.id &&\n                            (!_target.port || (_target.port === target.port));\n\n                    });\n\n                    if (sameLinks.length > 1) {\n                        return false;\n                    }\n                }\n            }\n\n            return true;\n        },\n\n        linkPinning: function(_graph, link) {\n            var { source, target } = link.attributes;\n            return source.id && target.id;\n        }\n    }\n\n});\n\nwrapWith(Graph.prototype, ['resetCells', 'addCells', 'removeCells'], wrappers.cells);\n","import { View } from '../mvc/index.mjs';\nimport { addClassNamePrefix } from '../util/util.mjs';\n\nexport const LayersNames = {\n    CELLS: 'cells',\n    BACK: 'back',\n    FRONT: 'front',\n    TOOLS: 'tools',\n    LABELS: 'labels'\n};\n\nexport const PaperLayer = View.extend({\n\n    tagName: 'g',\n    svgElement: true,\n    pivotNodes: null,\n    defaultTheme: null,\n\n    options: {\n        name: ''\n    },\n\n    className: function() {\n        return addClassNamePrefix(`${this.options.name}-layer`);\n    },\n\n    init: function() {\n        this.pivotNodes = {};\n    },\n\n    insertSortedNode: function(node, z) {\n        this.el.insertBefore(node, this.insertPivot(z));\n    },\n\n    insertNode: function(node) {\n        const { el } = this;\n        if (node.parentNode !== el) {\n            el.appendChild(node);\n        }\n    },\n\n    insertPivot: function(z) {\n        const { el, pivotNodes } = this;\n        z = +z;\n        z || (z = 0);\n        let pivotNode = pivotNodes[z];\n        if (pivotNode) return pivotNode;\n        pivotNode = pivotNodes[z] = document.createComment('z-index:' + (z + 1));\n        let neighborZ = -Infinity;\n        for (let currentZ in pivotNodes) {\n            currentZ = +currentZ;\n            if (currentZ < z && currentZ > neighborZ) {\n                neighborZ = currentZ;\n                if (neighborZ === z - 1) continue;\n            }\n        }\n        if (neighborZ !== -Infinity) {\n            const neighborPivot = pivotNodes[neighborZ];\n            // Insert After\n            el.insertBefore(pivotNode, neighborPivot.nextSibling);\n        } else {\n            // First Child\n            el.insertBefore(pivotNode, el.firstChild);\n        }\n        return pivotNode;\n    },\n\n    removePivots: function() {\n        const { el, pivotNodes } = this;\n        for (let z in pivotNodes) el.removeChild(pivotNodes[z]);\n        this.pivotNodes = {};\n    }\n\n});\n","import * as mvc from '../mvc/index.mjs';\nimport V from '../V/index.mjs';\nimport { isPlainObject, result } from '../util/util.mjs';\n\nfunction toArray(obj) {\n    if (!obj) return [];\n    if (Array.isArray(obj)) return obj;\n    return [obj];\n}\n\nexport const HighlighterView = mvc.View.extend({\n\n    tagName: 'g',\n    svgElement: true,\n    className: 'highlight',\n\n    HIGHLIGHT_FLAG: 1,\n    UPDATE_PRIORITY: 3,\n    DETACHABLE: false,\n    UPDATABLE: true,\n    MOUNTABLE: true,\n\n    cellView: null,\n    nodeSelector: null,\n    node: null,\n    updateRequested: false,\n    postponedUpdate: false,\n    transformGroup: null,\n    detachedTransformGroup: null,\n\n    requestUpdate(cellView, nodeSelector) {\n        const { paper } = cellView;\n        this.cellView = cellView;\n        this.nodeSelector = nodeSelector;\n        if (paper) {\n            this.updateRequested = true;\n            paper.requestViewUpdate(this, this.HIGHLIGHT_FLAG, this.UPDATE_PRIORITY);\n        }\n    },\n\n    confirmUpdate() {\n        // The cellView is now rendered/updated since it has a higher update priority.\n        this.updateRequested = false;\n        const { cellView, nodeSelector } = this;\n        if (!cellView.isMounted()) {\n            this.postponedUpdate = true;\n            return 0;\n        }\n        this.update(cellView, nodeSelector);\n        this.mount();\n        this.transform();\n        return 0;\n    },\n\n    findNode(cellView, nodeSelector = null) {\n        let el;\n        if (typeof nodeSelector === 'string') {\n            [el] = cellView.findBySelector(nodeSelector);\n        } else if (isPlainObject(nodeSelector)) {\n            const isLink = cellView.model.isLink();\n            const { label = null, port, selector } = nodeSelector;\n            if (isLink && label !== null) {\n                // Link Label Selector\n                el = cellView.findLabelNode(label, selector);\n            } else if (!isLink && port) {\n                // Element Port Selector\n                el = cellView.findPortNode(port, selector);\n            } else {\n                // Cell Selector\n                [el] = cellView.findBySelector(selector);\n            }\n        } else if (nodeSelector) {\n            el = V.toNode(nodeSelector);\n            if (!(el instanceof SVGElement)) el = null;\n        }\n        return el ? el : null;\n    },\n\n    getNodeMatrix(cellView, node) {\n        const { options } = this;\n        const { layer } = options;\n        const { rotatableNode } = cellView;\n        const nodeMatrix = cellView.getNodeMatrix(node);\n        if (rotatableNode) {\n            if (layer) {\n                if (rotatableNode.contains(node)) {\n                    return nodeMatrix;\n                }\n                // The node is outside of the rotatable group.\n                // Compensate the rotation set by transformGroup.\n                return cellView.getRootRotateMatrix().inverse().multiply(nodeMatrix);\n            } else {\n                return cellView.getNodeRotateMatrix(node).multiply(nodeMatrix);\n            }\n        }\n        return nodeMatrix;\n    },\n\n    mount() {\n        const { MOUNTABLE, cellView, el, options, transformGroup, detachedTransformGroup, postponedUpdate, nodeSelector } = this;\n        if (!MOUNTABLE || transformGroup) return;\n        if (postponedUpdate) {\n            // The cellView was not mounted when the update was requested.\n            // The update was postponed until the cellView is mounted.\n            this.update(cellView, nodeSelector);\n            this.transform();\n            return;\n        }\n        const { vel: cellViewRoot, paper } = cellView;\n        const { layer: layerName } = options;\n        if (layerName) {\n            let vGroup;\n            if (detachedTransformGroup) {\n                vGroup = detachedTransformGroup;\n                this.detachedTransformGroup = null;\n            } else {\n                vGroup = V('g').addClass('highlight-transform').append(el);\n            }\n            this.transformGroup = vGroup;\n            paper.getLayerView(layerName).insertSortedNode(vGroup.node, options.z);\n        } else {\n            // TODO: prepend vs append\n            if (!el.parentNode || el.nextSibling) {\n                // Not appended yet or not the last child\n                cellViewRoot.append(el);\n            }\n        }\n    },\n\n    unmount() {\n        const { MOUNTABLE, transformGroup, vel } = this;\n        if (!MOUNTABLE) return;\n        if (transformGroup) {\n            this.transformGroup = null;\n            this.detachedTransformGroup = transformGroup;\n            transformGroup.remove();\n        } else {\n            vel.remove();\n        }\n    },\n\n    transform() {\n        const { transformGroup, cellView, updateRequested } = this;\n        if (!transformGroup || cellView.model.isLink() || updateRequested) return;\n        const translateMatrix = cellView.getRootTranslateMatrix();\n        const rotateMatrix = cellView.getRootRotateMatrix();\n        const transformMatrix = translateMatrix.multiply(rotateMatrix);\n        transformGroup.attr('transform', V.matrixToTransformString(transformMatrix));\n    },\n\n    update() {\n        const { node: prevNode, cellView, nodeSelector, updateRequested, id } = this;\n        if (updateRequested) return;\n        this.postponedUpdate = false;\n        const node = this.node = this.findNode(cellView, nodeSelector);\n        if (prevNode) {\n            this.unhighlight(cellView, prevNode);\n        }\n        if (node) {\n            this.highlight(cellView, node);\n            this.mount();\n        } else {\n            this.unmount();\n            cellView.notify('cell:highlight:invalid', id, this);\n        }\n    },\n\n    onRemove() {\n        const { node, cellView, id, constructor } = this;\n        if (node) {\n            this.unhighlight(cellView, node);\n        }\n        this.unmount();\n        constructor._removeRef(cellView, id);\n    },\n\n    highlight(_cellView, _node) {\n        // to be overridden\n    },\n\n    unhighlight(_cellView, _node) {\n        // to be overridden\n    },\n\n    // Update Attributes\n\n    listenToUpdateAttributes(cellView) {\n        const attributes = result(this, 'UPDATE_ATTRIBUTES');\n        if (!Array.isArray(attributes) || attributes.length === 0) return;\n        this.listenTo(cellView.model, 'change', this.onCellAttributeChange);\n    },\n\n    onCellAttributeChange() {\n        const { cellView } = this;\n        if (!cellView) return;\n        const { model, paper } = cellView;\n        const attributes = result(this, 'UPDATE_ATTRIBUTES');\n        if (!attributes.some(attribute => model.hasChanged(attribute))) return;\n        paper.requestViewUpdate(this, this.HIGHLIGHT_FLAG, this.UPDATE_PRIORITY);\n    }\n\n}, {\n\n    _views: {},\n\n    // Used internally by CellView highlight()\n    highlight: function(cellView, node, opt) {\n        const id = this.uniqueId(node, opt);\n        this.add(cellView, node, id, opt);\n    },\n\n    // Used internally by CellView unhighlight()\n    unhighlight: function(cellView, node, opt) {\n        const id = this.uniqueId(node, opt);\n        this.remove(cellView, id);\n    },\n\n    get(cellView, id = null) {\n        const { cid } = cellView;\n        const { _views } = this;\n        const refs = _views[cid];\n        if (id === null) {\n            // all highlighters\n            const views = [];\n            if (!refs) return views;\n            for (let hid in refs) {\n                const ref = refs[hid];\n                if (ref instanceof this) {\n                    views.push(ref);\n                }\n            }\n            return views;\n        } else {\n            // single highlighter\n            if (!refs) return null;\n            if (id in refs) {\n                const ref = refs[id];\n                if (ref instanceof this) return ref;\n            }\n            return null;\n        }\n    },\n\n    add(cellView, nodeSelector, id, opt = {}) {\n        if (!id) throw new Error('dia.HighlighterView: An ID required.');\n        // Search the existing view amongst all the highlighters\n        const previousView = HighlighterView.get(cellView, id);\n        if (previousView) previousView.remove();\n        const view = new this(opt);\n        view.id = id;\n        this._addRef(cellView, id, view);\n        view.requestUpdate(cellView, nodeSelector);\n        view.listenToUpdateAttributes(cellView);\n        return view;\n    },\n\n    _addRef(cellView, id, view) {\n        const { cid } = cellView;\n        const { _views } = this;\n        let refs = _views[cid];\n        if (!refs) refs = _views[cid] = {};\n        refs[id] = view;\n    },\n\n    _removeRef(cellView, id) {\n        const { cid } = cellView;\n        const { _views } = this;\n        const refs = _views[cid];\n        if (!refs) return;\n        if (id) delete refs[id];\n        for (let _ in refs) return;\n        delete _views[cid];\n    },\n\n    remove(cellView, id = null) {\n        toArray(this.get(cellView, id)).forEach(view => {\n            view.remove();\n        });\n    },\n\n    removeAll(paper, id = null) {\n        const { _views } = this;\n\n        for (let cid in _views) {\n            for (let hid in _views[cid]) {\n                const view = _views[cid][hid];\n\n                if (view.cellView.paper === paper && view instanceof this && (id === null || hid === id)) {\n                    view.remove();\n                }\n            }\n        }\n    },\n\n    update(cellView, id = null, dirty = false) {\n        toArray(this.get(cellView, id)).forEach(view => {\n            if (dirty || view.UPDATABLE) view.update();\n        });\n    },\n\n    transform(cellView, id = null) {\n        toArray(this.get(cellView, id)).forEach(view => {\n            if (view.UPDATABLE) view.transform();\n        });\n    },\n\n    unmount(cellView, id = null) {\n        toArray(this.get(cellView, id)).forEach(view => view.unmount());\n    },\n\n    mount(cellView, id = null) {\n        toArray(this.get(cellView, id)).forEach(view => view.mount());\n    },\n\n    uniqueId(node, opt = '') {\n        return V.ensureId(node) + JSON.stringify(opt);\n    }\n\n});\n","import { config } from '../config/index.mjs';\nimport { View } from '../mvc/index.mjs';\nimport {\n    assign,\n    guid,\n    omit,\n    parseDOMJSON,\n    isFunction,\n    isObject,\n    isPlainObject,\n    isBoolean,\n    isEmpty,\n    isString,\n    toKebabCase,\n    result,\n    sortedIndex,\n    merge,\n    uniq\n} from '../util/index.mjs';\nimport { Point, Rect } from '../g/index.mjs';\nimport V from '../V/index.mjs';\nimport $ from 'jquery';\nimport { HighlighterView } from './HighlighterView.mjs';\n\nconst HighlightingTypes = {\n    DEFAULT: 'default',\n    EMBEDDING: 'embedding',\n    CONNECTING: 'connecting',\n    MAGNET_AVAILABILITY: 'magnetAvailability',\n    ELEMENT_AVAILABILITY: 'elementAvailability'\n};\n\nconst Flags = {\n    TOOLS: 'TOOLS',\n};\n\n// CellView base view and controller.\n// --------------------------------------------\n\n// This is the base view and controller for `ElementView` and `LinkView`.\nexport const CellView = View.extend({\n\n    tagName: 'g',\n\n    svgElement: true,\n\n    selector: 'root',\n\n    metrics: null,\n\n    className: function() {\n\n        var classNames = ['cell'];\n        var type = this.model.get('type');\n\n        if (type) {\n\n            type.toLowerCase().split('.').forEach(function(value, index, list) {\n                classNames.push('type-' + list.slice(0, index + 1).join('-'));\n            });\n        }\n\n        return classNames.join(' ');\n    },\n\n    _presentationAttributes: null,\n    _flags: null,\n\n    setFlags: function() {\n        var flags = {};\n        var attributes = {};\n        var shift = 0;\n        var i, n, label;\n        var presentationAttributes = result(this, 'presentationAttributes');\n        for (var attribute in presentationAttributes) {\n            if (!presentationAttributes.hasOwnProperty(attribute)) continue;\n            var labels = presentationAttributes[attribute];\n            if (!Array.isArray(labels)) labels = [labels];\n            for (i = 0, n = labels.length; i < n; i++) {\n                label = labels[i];\n                var flag = flags[label];\n                if (!flag) {\n                    flag = flags[label] = 1<<(shift++);\n                }\n                attributes[attribute] |= flag;\n            }\n        }\n        var initFlag = result(this, 'initFlag');\n        if (!Array.isArray(initFlag)) initFlag = [initFlag];\n        for (i = 0, n = initFlag.length; i < n; i++) {\n            label = initFlag[i];\n            if (!flags[label]) flags[label] = 1<<(shift++);\n        }\n\n        // 26 - 30 are reserved for paper flags\n        // 31+ overflows maximal number\n        if (shift > 25) throw new Error('dia.CellView: Maximum number of flags exceeded.');\n\n        this._flags = flags;\n        this._presentationAttributes = attributes;\n    },\n\n    hasFlag: function(flag, label) {\n        return flag & this.getFlag(label);\n    },\n\n    removeFlag: function(flag, label) {\n        return flag ^ (flag & this.getFlag(label));\n    },\n\n    getFlag: function(label) {\n        var flags = this._flags;\n        if (!flags) return 0;\n        var flag = 0;\n        if (Array.isArray(label)) {\n            for (var i = 0, n = label.length; i < n; i++) flag |= flags[label[i]];\n        } else {\n            flag |= flags[label];\n        }\n        return flag;\n    },\n\n    attributes: function() {\n        var cell = this.model;\n        return {\n            'model-id': cell.id,\n            'data-type': cell.attributes.type\n        };\n    },\n\n    constructor: function(options) {\n\n        // Make sure a global unique id is assigned to this view. Store this id also to the properties object.\n        // The global unique id makes sure that the same view can be rendered on e.g. different machines and\n        // still be associated to the same object among all those clients. This is necessary for real-time\n        // collaboration mechanism.\n        options.id = options.id || guid(this);\n\n        View.call(this, options);\n    },\n\n    initialize: function() {\n\n        this.setFlags();\n\n        View.prototype.initialize.apply(this, arguments);\n\n        this.cleanNodesCache();\n\n        // Store reference to this to the <g> DOM element so that the view is accessible through the DOM tree.\n        this.$el.data('view', this);\n\n        this.startListening();\n    },\n\n    startListening: function() {\n        this.listenTo(this.model, 'change', this.onAttributesChange);\n    },\n\n    onAttributesChange: function(model, opt) {\n        var flag = model.getChangeFlag(this._presentationAttributes);\n        if (opt.updateHandled || !flag) return;\n        if (opt.dirty && this.hasFlag(flag, 'UPDATE')) flag |= this.getFlag('RENDER');\n        // TODO: tool changes does not need to be sync\n        // Fix Segments tools\n        if (opt.tool) opt.async = false;\n        this.requestUpdate(flag, opt);\n    },\n\n    requestUpdate: function(flags, opt) {\n        const { paper } = this;\n        if (paper && flags > 0) {\n            paper.requestViewUpdate(this, flags, this.UPDATE_PRIORITY, opt);\n        }\n    },\n\n    parseDOMJSON: function(markup, root) {\n\n        var doc = parseDOMJSON(markup);\n        var selectors = doc.selectors;\n        var groups = doc.groupSelectors;\n        for (var group in groups) {\n            if (selectors[group]) throw new Error('dia.CellView: ambiguous group selector');\n            selectors[group] = groups[group];\n        }\n        if (root) {\n            var rootSelector = this.selector;\n            if (selectors[rootSelector]) throw new Error('dia.CellView: ambiguous root selector.');\n            selectors[rootSelector] = root;\n        }\n        return { fragment: doc.fragment, selectors: selectors };\n    },\n\n    // Return `true` if cell link is allowed to perform a certain UI `feature`.\n    // Example: `can('vertexMove')`, `can('labelMove')`.\n    can: function(feature) {\n\n        var interactive = isFunction(this.options.interactive)\n            ? this.options.interactive(this)\n            : this.options.interactive;\n\n        return (isObject(interactive) && interactive[feature] !== false) ||\n            (isBoolean(interactive) && interactive !== false);\n    },\n\n    findBySelector: function(selector, root, selectors) {\n\n        root || (root = this.el);\n        selectors || (selectors = this.selectors);\n\n        // These are either descendants of `this.$el` of `this.$el` itself.\n        // `.` is a special selector used to select the wrapping `<g>` element.\n        if (!selector || selector === '.') return [root];\n        if (selectors) {\n            var nodes = selectors[selector];\n            if (nodes) {\n                if (Array.isArray(nodes)) return nodes;\n                return [nodes];\n            }\n        }\n\n        // Maintaining backwards compatibility\n        // e.g. `circle:first` would fail with querySelector() call\n        if (config.useCSSSelectors) return $(root).find(selector).toArray();\n\n        return [];\n    },\n\n    notify: function(eventName) {\n\n        if (this.paper) {\n\n            var args = Array.prototype.slice.call(arguments, 1);\n\n            // Trigger the event on both the element itself and also on the paper.\n            this.trigger.apply(this, [eventName].concat(args));\n\n            // Paper event handlers receive the view object as the first argument.\n            this.paper.trigger.apply(this.paper, [eventName, this].concat(args));\n        }\n    },\n\n    getBBox: function(opt) {\n\n        var bbox;\n        if (opt && opt.useModelGeometry) {\n            var model = this.model;\n            bbox = model.getBBox().bbox(model.angle());\n        } else {\n            bbox = this.getNodeBBox(this.el);\n        }\n\n        return this.paper.localToPaperRect(bbox);\n    },\n\n    getNodeBBox: function(magnet) {\n\n        const rect = this.getNodeBoundingRect(magnet);\n        const transformMatrix = this.getRootTranslateMatrix().multiply(this.getNodeRotateMatrix(magnet));\n        const magnetMatrix = this.getNodeMatrix(magnet);\n        return V.transformRect(rect, transformMatrix.multiply(magnetMatrix));\n    },\n\n    getNodeRotateMatrix(node) {\n        if (!this.rotatableNode || this.rotatableNode.contains(node)) {\n            // Rotate transformation is applied to all nodes when no rotatableGroup\n            // is present or to nodes inside the rotatableGroup only.\n            return this.getRootRotateMatrix();\n        }\n        // Nodes outside the rotatable group\n        return V.createSVGMatrix();\n    },\n\n    getNodeUnrotatedBBox: function(magnet) {\n\n        var rect = this.getNodeBoundingRect(magnet);\n        var magnetMatrix = this.getNodeMatrix(magnet);\n        var translateMatrix = this.getRootTranslateMatrix();\n        return V.transformRect(rect, translateMatrix.multiply(magnetMatrix));\n    },\n\n    getRootTranslateMatrix: function() {\n\n        var model = this.model;\n        var position = model.position();\n        var mt = V.createSVGMatrix().translate(position.x, position.y);\n        return mt;\n    },\n\n    getRootRotateMatrix: function() {\n\n        var mr = V.createSVGMatrix();\n        var model = this.model;\n        var angle = model.angle();\n        if (angle) {\n            var bbox = model.getBBox();\n            var cx = bbox.width / 2;\n            var cy = bbox.height / 2;\n            mr = mr.translate(cx, cy).rotate(angle).translate(-cx, -cy);\n        }\n        return mr;\n    },\n\n    _notifyHighlight: function(eventName, el, opt = {}) {\n        const { el: rootNode } = this;\n        let node;\n        if (typeof el === 'string') {\n            [node = rootNode] = this.findBySelector(el);\n        } else {\n            [node = rootNode] = this.$(el);\n        }\n        // set partial flag if the highlighted element is not the entire view.\n        opt.partial = (node !== rootNode);\n        // translate type flag into a type string\n        if (opt.type === undefined) {\n            let type;\n            switch (true) {\n                case opt.embedding:\n                    type = HighlightingTypes.EMBEDDING;\n                    break;\n                case opt.connecting:\n                    type = HighlightingTypes.CONNECTING;\n                    break;\n                case opt.magnetAvailability:\n                    type = HighlightingTypes.MAGNET_AVAILABILITY;\n                    break;\n                case opt.elementAvailability:\n                    type = HighlightingTypes.ELEMENT_AVAILABILITY;\n                    break;\n                default:\n                    type = HighlightingTypes.DEFAULT;\n                    break;\n            }\n            opt.type = type;\n        }\n        this.notify(eventName, node, opt);\n        return this;\n    },\n\n    highlight: function(el, opt) {\n        return this._notifyHighlight('cell:highlight', el, opt);\n    },\n\n    unhighlight: function(el, opt = {}) {\n        return this._notifyHighlight('cell:unhighlight', el, opt);\n    },\n\n    // Find the closest element that has the `magnet` attribute set to `true`. If there was not such\n    // an element found, return the root element of the cell view.\n    findMagnet: function(el) {\n\n        const root = this.el;\n        let magnet = this.$(el)[0];\n        if (!magnet) {\n            magnet = root;\n        }\n\n        do {\n            const magnetAttribute = magnet.getAttribute('magnet');\n            const isMagnetRoot = (magnet === root);\n            if ((magnetAttribute || isMagnetRoot) && magnetAttribute !== 'false') {\n                return magnet;\n            }\n            if (isMagnetRoot) {\n                // If the overall cell has set `magnet === false`, then return `undefined` to\n                // announce there is no magnet found for this cell.\n                // This is especially useful to set on cells that have 'ports'. In this case,\n                // only the ports have set `magnet === true` and the overall element has `magnet === false`.\n                return undefined;\n            }\n            magnet = magnet.parentNode;\n        } while (magnet);\n\n        return undefined;\n    },\n\n    findProxyNode: function(el, type) {\n        el || (el = this.el);\n        const nodeSelector = el.getAttribute(`${type}-selector`);\n        if (nodeSelector) {\n            const [proxyNode] = this.findBySelector(nodeSelector);\n            if (proxyNode) return proxyNode;\n        }\n        return el;\n    },\n\n    // Construct a unique selector for the `el` element within this view.\n    // `prevSelector` is being collected through the recursive call.\n    // No value for `prevSelector` is expected when using this method.\n    getSelector: function(el, prevSelector) {\n\n        var selector;\n\n        if (el === this.el) {\n            if (typeof prevSelector === 'string') selector = '> ' + prevSelector;\n            return selector;\n        }\n\n        if (el) {\n\n            var nthChild = V(el).index() + 1;\n            selector = el.tagName + ':nth-child(' + nthChild + ')';\n\n            if (prevSelector) {\n                selector += ' > ' + prevSelector;\n            }\n\n            selector = this.getSelector(el.parentNode, selector);\n        }\n\n        return selector;\n    },\n\n    addLinkFromMagnet: function(magnet, x, y) {\n\n        var paper = this.paper;\n        var graph = paper.model;\n\n        var link = paper.getDefaultLink(this, magnet);\n        link.set({\n            source: this.getLinkEnd(magnet, x, y, link, 'source'),\n            target: { x: x, y: y }\n        }).addTo(graph, {\n            async: false,\n            ui: true\n        });\n\n        return link.findView(paper);\n    },\n\n    getLinkEnd: function(magnet, ...args) {\n\n        var model = this.model;\n        var id = model.id;\n        var port = this.findAttribute('port', magnet);\n        // Find a unique `selector` of the element under pointer that is a magnet.\n        var selector = magnet.getAttribute('joint-selector');\n\n        var end = { id: id };\n        if (selector != null) end.magnet = selector;\n        if (port != null) {\n            end.port = port;\n            if (!model.hasPort(port) && !selector) {\n                // port created via the `port` attribute (not API)\n                end.selector = this.getSelector(magnet);\n            }\n        } else if (selector == null && this.el !== magnet) {\n            end.selector = this.getSelector(magnet);\n        }\n\n        return this.customizeLinkEnd(end, magnet, ...args);\n    },\n\n    customizeLinkEnd: function(end, magnet, x, y, link, endType) {\n        const { paper } = this;\n        const { connectionStrategy } = paper.options;\n        if (typeof connectionStrategy === 'function') {\n            var strategy = connectionStrategy.call(paper, end, this, magnet, new Point(x, y), link, endType, paper);\n            if (strategy) return strategy;\n        }\n        return end;\n    },\n\n    getMagnetFromLinkEnd: function(end) {\n\n        var root = this.el;\n        var port = end.port;\n        var selector = end.magnet;\n        var model = this.model;\n        var magnet;\n        if (port != null && model.isElement() && model.hasPort(port)) {\n            magnet = this.findPortNode(port, selector) || root;\n        } else {\n            if (!selector) selector = end.selector;\n            if (!selector && port != null) {\n                // link end has only `id` and `port` property referencing\n                // a port created via the `port` attribute (not API).\n                selector = '[port=\"' + port + '\"]';\n            }\n            magnet = this.findBySelector(selector, root, this.selectors)[0];\n        }\n\n        return this.findProxyNode(magnet, 'magnet');\n    },\n\n    dragLinkStart: function(evt, magnet, x, y) {\n        this.model.startBatch('add-link');\n        const linkView = this.addLinkFromMagnet(magnet, x, y);\n        // backwards compatibility events\n        linkView.notifyPointerdown(evt, x, y);\n        linkView.eventData(evt, linkView.startArrowheadMove('target', { whenNotAllowed: 'remove' }));\n        this.eventData(evt, { linkView });\n    },\n\n    dragLink: function(evt, x, y) {\n        var data = this.eventData(evt);\n        var linkView = data.linkView;\n        if (linkView) {\n            linkView.pointermove(evt, x, y);\n        } else {\n            var paper = this.paper;\n            var magnetThreshold = paper.options.magnetThreshold;\n            var currentTarget = this.getEventTarget(evt);\n            var targetMagnet = data.targetMagnet;\n            if (magnetThreshold === 'onleave') {\n                // magnetThreshold when the pointer leaves the magnet\n                if (targetMagnet === currentTarget || V(targetMagnet).contains(currentTarget)) return;\n            } else {\n                // magnetThreshold defined as a number of movements\n                if (paper.eventData(evt).mousemoved <= magnetThreshold) return;\n            }\n            this.dragLinkStart(evt, targetMagnet, x, y);\n        }\n    },\n\n    dragLinkEnd: function(evt, x, y) {\n        var data = this.eventData(evt);\n        var linkView = data.linkView;\n        if (!linkView) return;\n        linkView.pointerup(evt, x, y);\n        this.model.stopBatch('add-link');\n    },\n\n    getAttributeDefinition: function(attrName) {\n\n        return this.model.constructor.getAttributeDefinition(attrName);\n    },\n\n    setNodeAttributes: function(node, attrs) {\n\n        if (!isEmpty(attrs)) {\n            if (node instanceof SVGElement) {\n                V(node).attr(attrs);\n            } else {\n                $(node).attr(attrs);\n            }\n        }\n    },\n\n    processNodeAttributes: function(node, attrs) {\n\n        var attrName, attrVal, def, i, n;\n        var normalAttrs, setAttrs, positionAttrs, offsetAttrs;\n        var relatives = [];\n        // divide the attributes between normal and special\n        for (attrName in attrs) {\n            if (!attrs.hasOwnProperty(attrName)) continue;\n            attrVal = attrs[attrName];\n            def = this.getAttributeDefinition(attrName);\n            if (def && (!isFunction(def.qualify) || def.qualify.call(this, attrVal, node, attrs, this))) {\n                if (isString(def.set)) {\n                    normalAttrs || (normalAttrs = {});\n                    normalAttrs[def.set] = attrVal;\n                }\n                if (attrVal !== null) {\n                    relatives.push(attrName, def);\n                }\n            } else {\n                normalAttrs || (normalAttrs = {});\n                normalAttrs[toKebabCase(attrName)] = attrVal;\n            }\n        }\n\n        // handle the rest of attributes via related method\n        // from the special attributes namespace.\n        for (i = 0, n = relatives.length; i < n; i+=2) {\n            attrName = relatives[i];\n            def = relatives[i+1];\n            attrVal = attrs[attrName];\n            if (isFunction(def.set)) {\n                setAttrs || (setAttrs = {});\n                setAttrs[attrName] = attrVal;\n            }\n            if (isFunction(def.position)) {\n                positionAttrs || (positionAttrs = {});\n                positionAttrs[attrName] = attrVal;\n            }\n            if (isFunction(def.offset)) {\n                offsetAttrs || (offsetAttrs = {});\n                offsetAttrs[attrName] = attrVal;\n            }\n        }\n\n        return {\n            raw: attrs,\n            normal: normalAttrs,\n            set: setAttrs,\n            position: positionAttrs,\n            offset: offsetAttrs\n        };\n    },\n\n    updateRelativeAttributes: function(node, attrs, refBBox, opt) {\n\n        opt || (opt = {});\n\n        var attrName, attrVal, def;\n        var rawAttrs = attrs.raw || {};\n        var nodeAttrs = attrs.normal || {};\n        var setAttrs = attrs.set;\n        var positionAttrs = attrs.position;\n        var offsetAttrs = attrs.offset;\n\n        for (attrName in setAttrs) {\n            attrVal = setAttrs[attrName];\n            def = this.getAttributeDefinition(attrName);\n            // SET - set function should return attributes to be set on the node,\n            // which will affect the node dimensions based on the reference bounding\n            // box. e.g. `width`, `height`, `d`, `rx`, `ry`, `points\n            var setResult = def.set.call(this, attrVal, refBBox.clone(), node, rawAttrs, this);\n            if (isObject(setResult)) {\n                assign(nodeAttrs, setResult);\n            } else if (setResult !== undefined) {\n                nodeAttrs[attrName] = setResult;\n            }\n        }\n\n        if (node instanceof HTMLElement) {\n            // TODO: setting the `transform` attribute on HTMLElements\n            // via `node.style.transform = 'matrix(...)';` would introduce\n            // a breaking change (e.g. basic.TextBlock).\n            this.setNodeAttributes(node, nodeAttrs);\n            return;\n        }\n\n        // The final translation of the subelement.\n        var nodeTransform = nodeAttrs.transform;\n        var nodeMatrix = V.transformStringToMatrix(nodeTransform);\n        var nodePosition = Point(nodeMatrix.e, nodeMatrix.f);\n        if (nodeTransform) {\n            nodeAttrs = omit(nodeAttrs, 'transform');\n            nodeMatrix.e = nodeMatrix.f = 0;\n        }\n\n        // Calculate node scale determined by the scalable group\n        // only if later needed.\n        var sx, sy, translation;\n        if (positionAttrs || offsetAttrs) {\n            var nodeScale = this.getNodeScale(node, opt.scalableNode);\n            sx = nodeScale.sx;\n            sy = nodeScale.sy;\n        }\n\n        var positioned = false;\n        for (attrName in positionAttrs) {\n            attrVal = positionAttrs[attrName];\n            def = this.getAttributeDefinition(attrName);\n            // POSITION - position function should return a point from the\n            // reference bounding box. The default position of the node is x:0, y:0 of\n            // the reference bounding box or could be further specify by some\n            // SVG attributes e.g. `x`, `y`\n            translation = def.position.call(this, attrVal, refBBox.clone(), node, rawAttrs, this);\n            if (translation) {\n                nodePosition.offset(Point(translation).scale(sx, sy));\n                positioned || (positioned = true);\n            }\n        }\n\n        // The node bounding box could depend on the `size` set from the previous loop.\n        // Here we know, that all the size attributes have been already set.\n        this.setNodeAttributes(node, nodeAttrs);\n\n        var offseted = false;\n        if (offsetAttrs) {\n            // Check if the node is visible\n            var nodeBoundingRect = this.getNodeBoundingRect(node);\n            if (nodeBoundingRect.width > 0 && nodeBoundingRect.height > 0) {\n                var nodeBBox = V.transformRect(nodeBoundingRect, nodeMatrix).scale(1 / sx, 1 / sy);\n                for (attrName in offsetAttrs) {\n                    attrVal = offsetAttrs[attrName];\n                    def = this.getAttributeDefinition(attrName);\n                    // OFFSET - offset function should return a point from the element\n                    // bounding box. The default offset point is x:0, y:0 (origin) or could be further\n                    // specify with some SVG attributes e.g. `text-anchor`, `cx`, `cy`\n                    translation = def.offset.call(this, attrVal, nodeBBox, node, rawAttrs, this);\n                    if (translation) {\n                        nodePosition.offset(Point(translation).scale(sx, sy));\n                        offseted || (offseted = true);\n                    }\n                }\n            }\n        }\n\n        // Do not touch node's transform attribute if there is no transformation applied.\n        if (nodeTransform !== undefined || positioned || offseted) {\n            // Round the coordinates to 1 decimal point.\n            nodePosition.round(1);\n            nodeMatrix.e = nodePosition.x;\n            nodeMatrix.f = nodePosition.y;\n            node.setAttribute('transform', V.matrixToTransformString(nodeMatrix));\n            // TODO: store nodeMatrix metrics?\n        }\n    },\n\n    getNodeScale: function(node, scalableNode) {\n\n        // Check if the node is a descendant of the scalable group.\n        var sx, sy;\n        if (scalableNode && scalableNode.contains(node)) {\n            var scale = scalableNode.scale();\n            sx = 1 / scale.sx;\n            sy = 1 / scale.sy;\n        } else {\n            sx = 1;\n            sy = 1;\n        }\n\n        return { sx: sx, sy: sy };\n    },\n\n    cleanNodesCache: function() {\n        this.metrics = {};\n    },\n\n    nodeCache: function(magnet) {\n\n        var metrics = this.metrics;\n        // Don't use cache? It most likely a custom view with overridden update.\n        if (!metrics) return {};\n        var id = V.ensureId(magnet);\n        var value = metrics[id];\n        if (!value) value = metrics[id] = {};\n        return value;\n    },\n\n    getNodeData: function(magnet) {\n\n        var metrics = this.nodeCache(magnet);\n        if (!metrics.data) metrics.data = {};\n        return metrics.data;\n    },\n\n    getNodeBoundingRect: function(magnet) {\n\n        var metrics = this.nodeCache(magnet);\n        if (metrics.boundingRect === undefined) metrics.boundingRect = V(magnet).getBBox();\n        return new Rect(metrics.boundingRect);\n    },\n\n    getNodeMatrix: function(magnet) {\n\n        const metrics = this.nodeCache(magnet);\n        if (metrics.magnetMatrix === undefined) {\n            const { rotatableNode, el } = this;\n            let target;\n            if (rotatableNode && rotatableNode.contains(magnet)) {\n                target = rotatableNode;\n            } else {\n                target = el;\n            }\n            metrics.magnetMatrix = V(magnet).getTransformToElement(target);\n        }\n        return V.createSVGMatrix(metrics.magnetMatrix);\n    },\n\n    getNodeShape: function(magnet) {\n\n        var metrics = this.nodeCache(magnet);\n        if (metrics.geometryShape === undefined) metrics.geometryShape = V(magnet).toGeometryShape();\n        return metrics.geometryShape.clone();\n    },\n\n    isNodeConnection: function(node) {\n        return this.model.isLink() && (!node || node === this.el);\n    },\n\n    findNodesAttributes: function(attrs, root, selectorCache, selectors) {\n\n        var i, n, nodeAttrs, nodeId;\n        var nodesAttrs = {};\n        var mergeIds = [];\n        for (var selector in attrs) {\n            if (!attrs.hasOwnProperty(selector)) continue;\n            nodeAttrs = attrs[selector];\n            if (!isPlainObject(nodeAttrs)) continue; // Not a valid selector-attributes pair\n            var selected = selectorCache[selector] = this.findBySelector(selector, root, selectors);\n            for (i = 0, n = selected.length; i < n; i++) {\n                var node = selected[i];\n                nodeId = V.ensureId(node);\n                // \"unique\" selectors are selectors that referencing a single node (defined by `selector`)\n                // groupSelector referencing a single node is not \"unique\"\n                var unique = (selectors && selectors[selector] === node);\n                var prevNodeAttrs = nodesAttrs[nodeId];\n                if (prevNodeAttrs) {\n                    // Note, that nodes referenced by deprecated `CSS selectors` are not taken into account.\n                    // e.g. css:`.circle` and selector:`circle` can be applied in a random order\n                    if (!prevNodeAttrs.array) {\n                        mergeIds.push(nodeId);\n                        prevNodeAttrs.array = true;\n                        prevNodeAttrs.attributes = [prevNodeAttrs.attributes];\n                        prevNodeAttrs.selectedLength = [prevNodeAttrs.selectedLength];\n                    }\n                    var attributes = prevNodeAttrs.attributes;\n                    var selectedLength = prevNodeAttrs.selectedLength;\n                    if (unique) {\n                        // node referenced by `selector`\n                        attributes.unshift(nodeAttrs);\n                        selectedLength.unshift(-1);\n                    } else {\n                        // node referenced by `groupSelector`\n                        var sortIndex = sortedIndex(selectedLength, n);\n                        attributes.splice(sortIndex, 0, nodeAttrs);\n                        selectedLength.splice(sortIndex, 0, n);\n                    }\n                } else {\n                    nodesAttrs[nodeId] = {\n                        attributes: nodeAttrs,\n                        selectedLength: unique ? -1 : n,\n                        node: node,\n                        array: false\n                    };\n                }\n            }\n        }\n\n        for (i = 0, n = mergeIds.length; i < n; i++) {\n            nodeId = mergeIds[i];\n            nodeAttrs = nodesAttrs[nodeId];\n            nodeAttrs.attributes = merge({}, ...nodeAttrs.attributes.reverse());\n        }\n\n        return nodesAttrs;\n    },\n\n    getEventTarget: function(evt, opt = {}) {\n        const { target, type, clientX = 0, clientY = 0 } = evt;\n        if (\n            // Explicitly defined `fromPoint` option\n            opt.fromPoint ||\n            // Touchmove/Touchend event's target is not reflecting the element under the coordinates as mousemove does.\n            // It holds the element when a touchstart triggered.\n            type === 'touchmove' || type === 'touchend' ||\n            // Pointermove/Pointerup event with the pointer captured\n            ('pointerId' in evt && target.hasPointerCapture(evt.pointerId))\n        ) {\n            return document.elementFromPoint(clientX, clientY);\n        }\n\n        return target;\n    },\n\n    // Default is to process the `model.attributes.attrs` object and set attributes on subelements based on the selectors,\n    // unless `attrs` parameter was passed.\n    updateDOMSubtreeAttributes: function(rootNode, attrs, opt) {\n\n        opt || (opt = {});\n        opt.rootBBox || (opt.rootBBox = Rect());\n        opt.selectors || (opt.selectors = this.selectors); // selector collection to use\n\n        // Cache table for query results and bounding box calculation.\n        // Note that `selectorCache` needs to be invalidated for all\n        // `updateAttributes` calls, as the selectors might pointing\n        // to nodes designated by an attribute or elements dynamically\n        // created.\n        var selectorCache = {};\n        var bboxCache = {};\n        var relativeItems = [];\n        var relativeRefItems = [];\n        var item, node, nodeAttrs, nodeData, processedAttrs;\n\n        var roAttrs = opt.roAttributes;\n        var nodesAttrs = this.findNodesAttributes(roAttrs || attrs, rootNode, selectorCache, opt.selectors);\n        // `nodesAttrs` are different from all attributes, when\n        // rendering only  attributes sent to this method.\n        var nodesAllAttrs = (roAttrs)\n            ? this.findNodesAttributes(attrs, rootNode, selectorCache, opt.selectors)\n            : nodesAttrs;\n\n        for (var nodeId in nodesAttrs) {\n            nodeData = nodesAttrs[nodeId];\n            nodeAttrs = nodeData.attributes;\n            node = nodeData.node;\n            processedAttrs = this.processNodeAttributes(node, nodeAttrs);\n\n            if (!processedAttrs.set && !processedAttrs.position && !processedAttrs.offset) {\n                // Set all the normal attributes right on the SVG/HTML element.\n                this.setNodeAttributes(node, processedAttrs.normal);\n\n            } else {\n\n                var nodeAllAttrs = nodesAllAttrs[nodeId] && nodesAllAttrs[nodeId].attributes;\n                var refSelector = (nodeAllAttrs && (nodeAttrs.ref === undefined))\n                    ? nodeAllAttrs.ref\n                    : nodeAttrs.ref;\n\n                var refNode;\n                if (refSelector) {\n                    refNode = (selectorCache[refSelector] || this.findBySelector(refSelector, rootNode, opt.selectors))[0];\n                    if (!refNode) {\n                        throw new Error('dia.CellView: \"' + refSelector + '\" reference does not exist.');\n                    }\n                } else {\n                    refNode = null;\n                }\n\n                item = {\n                    node: node,\n                    refNode: refNode,\n                    processedAttributes: processedAttrs,\n                    allAttributes: nodeAllAttrs\n                };\n\n                if (refNode) {\n                    // If an element in the list is positioned relative to this one, then\n                    // we want to insert this one before it in the list.\n                    var itemIndex = relativeRefItems.findIndex(function(item) {\n                        return item.refNode === node;\n                    });\n\n                    if (itemIndex > -1) {\n                        relativeRefItems.splice(itemIndex, 0, item);\n                    } else {\n                        relativeRefItems.push(item);\n                    }\n                } else {\n                    // A node with no ref attribute. To be updated before the nodes referencing other nodes.\n                    // The order of no-ref-items is not specified/important.\n                    relativeItems.push(item);\n                }\n            }\n        }\n\n        relativeItems.push(...relativeRefItems);\n\n        for (let i = 0, n = relativeItems.length; i < n; i++) {\n            item = relativeItems[i];\n            node = item.node;\n            refNode = item.refNode;\n\n            // Find the reference element bounding box. If no reference was provided, we\n            // use the optional bounding box.\n            const refNodeId = refNode ? V.ensureId(refNode) : '';\n            let refBBox = bboxCache[refNodeId];\n            if (!refBBox) {\n                // Get the bounding box of the reference element using to the common ancestor\n                // transformation space.\n                //\n                // @example 1\n                // <g transform=\"translate(11, 13)\">\n                //     <rect @selector=\"b\" x=\"1\" y=\"2\" width=\"3\" height=\"4\"/>\n                //     <rect @selector=\"a\"/>\n                // </g>\n                //\n                // In this case, the reference bounding box can not be affected\n                // by the `transform` attribute of the `<g>` element,\n                // because the exact transformation will be applied to the `a` element\n                // as well as to the `b` element.\n                //\n                // @example 2\n                // <g transform=\"translate(11, 13)\">\n                //     <rect @selector=\"b\" x=\"1\" y=\"2\" width=\"3\" height=\"4\"/>\n                // </g>\n                // <rect @selector=\"a\"/>\n                //\n                // In this case, the reference bounding box have to be affected by the\n                // `transform` attribute of the `<g>` element, because the `a` element\n                // is not descendant of the `<g>` element and will not be affected\n                // by the transformation.\n                refBBox = bboxCache[refNodeId] = (refNode)\n                    ? V(refNode).getBBox({ target: getCommonAncestorNode(node, refNode) })\n                    : opt.rootBBox;\n            }\n\n            if (roAttrs) {\n                // if there was a special attribute affecting the position amongst passed-in attributes\n                // we have to merge it with the rest of the element's attributes as they are necessary\n                // to update the position relatively (i.e `ref-x` && 'ref-dx')\n                processedAttrs = this.processNodeAttributes(node, item.allAttributes);\n                this.mergeProcessedAttributes(processedAttrs, item.processedAttributes);\n\n            } else {\n                processedAttrs = item.processedAttributes;\n            }\n\n            this.updateRelativeAttributes(node, processedAttrs, refBBox, opt);\n        }\n    },\n\n    mergeProcessedAttributes: function(processedAttrs, roProcessedAttrs) {\n\n        processedAttrs.set || (processedAttrs.set = {});\n        processedAttrs.position || (processedAttrs.position = {});\n        processedAttrs.offset || (processedAttrs.offset = {});\n\n        assign(processedAttrs.set, roProcessedAttrs.set);\n        assign(processedAttrs.position, roProcessedAttrs.position);\n        assign(processedAttrs.offset, roProcessedAttrs.offset);\n\n        // Handle also the special transform property.\n        var transform = processedAttrs.normal && processedAttrs.normal.transform;\n        if (transform !== undefined && roProcessedAttrs.normal) {\n            roProcessedAttrs.normal.transform = transform;\n        }\n        processedAttrs.normal = roProcessedAttrs.normal;\n    },\n\n    // Lifecycle methods\n\n    // Called when the view is attached to the DOM,\n    // as result of `cell.addTo(graph)` being called (isInitialMount === true)\n    // or `paper.options.viewport` returning `true` (isInitialMount === false).\n    onMount(isInitialMount) {\n        if (isInitialMount) return;\n        this.mountTools();\n        HighlighterView.mount(this);\n    },\n\n    // Called when the view is detached from the DOM,\n    // as result of `paper.options.viewport` returning `false`.\n    onDetach() {\n        this.unmountTools();\n        HighlighterView.unmount(this);\n    },\n\n    // Called when the view is removed from the DOM\n    // as result of `cell.remove()`.\n    onRemove: function() {\n        this.removeTools();\n        this.removeHighlighters();\n    },\n\n    _toolsView: null,\n\n    hasTools: function(name) {\n        var toolsView = this._toolsView;\n        if (!toolsView) return false;\n        if (!name) return true;\n        return (toolsView.getName() === name);\n    },\n\n    addTools: function(toolsView) {\n\n        this.removeTools();\n\n        if (toolsView) {\n            this._toolsView = toolsView;\n            toolsView.configure({ relatedView: this });\n            toolsView.listenTo(this.paper, 'tools:event', this.onToolEvent.bind(this));\n        }\n        return this;\n    },\n\n    unmountTools() {\n        const toolsView = this._toolsView;\n        if (toolsView) toolsView.unmount();\n        return this;\n    },\n\n    mountTools() {\n        const toolsView = this._toolsView;\n        // Prevent unnecessary re-appending of the tools.\n        if (toolsView && !toolsView.isMounted()) toolsView.mount();\n        return this;\n    },\n\n    updateTools: function(opt) {\n\n        var toolsView = this._toolsView;\n        if (toolsView) toolsView.update(opt);\n        return this;\n    },\n\n    removeTools: function() {\n\n        var toolsView = this._toolsView;\n        if (toolsView) {\n            toolsView.remove();\n            this._toolsView = null;\n        }\n        return this;\n    },\n\n    hideTools: function() {\n\n        var toolsView = this._toolsView;\n        if (toolsView) toolsView.hide();\n        return this;\n    },\n\n    showTools: function() {\n\n        var toolsView = this._toolsView;\n        if (toolsView) toolsView.show();\n        return this;\n    },\n\n    onToolEvent: function(event) {\n        switch (event) {\n            case 'remove':\n                this.removeTools();\n                break;\n            case 'hide':\n                this.hideTools();\n                break;\n            case 'show':\n                this.showTools();\n                break;\n        }\n    },\n\n    removeHighlighters: function() {\n        HighlighterView.remove(this);\n    },\n\n    updateHighlighters: function(dirty = false) {\n        HighlighterView.update(this, null, dirty);\n    },\n\n    transformHighlighters: function() {\n        HighlighterView.transform(this);\n    },\n\n    // Interaction. The controller part.\n    // ---------------------------------\n\n    preventDefaultInteraction(evt) {\n        this.eventData(evt, { defaultInteractionPrevented: true  });\n    },\n\n    isDefaultInteractionPrevented(evt) {\n        const { defaultInteractionPrevented = false } = this.eventData(evt);\n        return defaultInteractionPrevented;\n    },\n\n    // Interaction is handled by the paper and delegated to the view in interest.\n    // `x` & `y` parameters passed to these functions represent the coordinates already snapped to the paper grid.\n    // If necessary, real coordinates can be obtained from the `evt` event object.\n\n    // These functions are supposed to be overridden by the views that inherit from `joint.dia.Cell`,\n    // i.e. `joint.dia.Element` and `joint.dia.Link`.\n\n    pointerdblclick: function(evt, x, y) {\n\n        this.notify('cell:pointerdblclick', evt, x, y);\n    },\n\n    pointerclick: function(evt, x, y) {\n\n        this.notify('cell:pointerclick', evt, x, y);\n    },\n\n    contextmenu: function(evt, x, y) {\n\n        this.notify('cell:contextmenu', evt, x, y);\n    },\n\n    pointerdown: function(evt, x, y) {\n\n        const { model } = this;\n        const { graph } = model;\n        if (graph) {\n            model.startBatch('pointer');\n            this.eventData(evt, { graph });\n        }\n\n        this.notify('cell:pointerdown', evt, x, y);\n    },\n\n    pointermove: function(evt, x, y) {\n\n        this.notify('cell:pointermove', evt, x, y);\n    },\n\n    pointerup: function(evt, x, y) {\n\n        const { graph } = this.eventData(evt);\n\n        this.notify('cell:pointerup', evt, x, y);\n\n        if (graph) {\n            // we don't want to trigger event on model as model doesn't\n            // need to be member of collection anymore (remove)\n            graph.stopBatch('pointer', { cell: this.model });\n        }\n    },\n\n    mouseover: function(evt) {\n\n        this.notify('cell:mouseover', evt);\n    },\n\n    mouseout: function(evt) {\n\n        this.notify('cell:mouseout', evt);\n    },\n\n    mouseenter: function(evt) {\n\n        this.notify('cell:mouseenter', evt);\n    },\n\n    mouseleave: function(evt) {\n\n        this.notify('cell:mouseleave', evt);\n    },\n\n    mousewheel: function(evt, x, y, delta) {\n\n        this.notify('cell:mousewheel', evt, x, y, delta);\n    },\n\n    onevent: function(evt, eventName, x, y) {\n\n        this.notify(eventName, evt, x, y);\n    },\n\n    onmagnet: function() {\n\n        // noop\n    },\n\n    magnetpointerdblclick: function() {\n\n        // noop\n    },\n\n    magnetcontextmenu: function() {\n\n        // noop\n    },\n\n    checkMouseleave(evt) {\n        const { paper, model } = this;\n        if (paper.isAsync()) {\n            // Make sure the source/target views are updated before this view.\n            // It's not 100% bulletproof (see below) but it's a good enough solution for now.\n            // The connected cells could be links as well. In that case, we would\n            // need to recursively go through all the connected links and update\n            // their source/target views as well.\n            if (model.isLink()) {\n                // The `this.sourceView` and `this.targetView` might not be updated yet.\n                // We need to find the view by the model.\n                const sourceElement = model.getSourceElement();\n                if (sourceElement) {\n                    const sourceView = paper.findViewByModel(sourceElement);\n                    if (sourceView) {\n                        paper.dumpView(sourceView);\n                        paper.checkViewVisibility(sourceView);\n                    }\n                }\n                const targetElement = model.getTargetElement();\n                if (targetElement) {\n                    const targetView = paper.findViewByModel(targetElement);\n                    if (targetView) {\n                        paper.dumpView(targetView);\n                        paper.checkViewVisibility(targetView);\n                    }\n                }\n            }\n            // Do the updates of the current view synchronously now\n            paper.dumpView(this);\n            paper.checkViewVisibility(this);\n        }\n        const target = this.getEventTarget(evt, { fromPoint: true });\n        const view = paper.findView(target);\n        if (view === this) return;\n        // Leaving the current view\n        this.mouseleave(evt);\n        if (!view) return;\n        // Entering another view\n        view.mouseenter(evt);\n    },\n\n    setInteractivity: function(value) {\n\n        this.options.interactive = value;\n    }\n}, {\n\n    Flags,\n\n    Highlighting: HighlightingTypes,\n\n    addPresentationAttributes: function(presentationAttributes) {\n        return merge({}, result(this.prototype, 'presentationAttributes'), presentationAttributes, function(a, b) {\n            if (!a || !b) return;\n            if (typeof a === 'string') a = [a];\n            if (typeof b === 'string') b = [b];\n            if (Array.isArray(a) && Array.isArray(b)) return uniq(a.concat(b));\n        });\n    }\n});\n\n// TODO: Move to Vectorizer library.\nfunction getCommonAncestorNode(node1, node2) {\n    let parent = node1;\n    do {\n        if (parent.contains(node2)) return parent;\n        parent = parent.parentNode;\n    } while (parent);\n    return null;\n}\n\n","import { config } from '../config/index.mjs';\nimport { assign, isFunction, toArray } from '../util/index.mjs';\nimport { CellView } from './CellView.mjs';\nimport { Cell } from './Cell.mjs';\nimport V from '../V/index.mjs';\nimport { elementViewPortPrototype } from './ports.mjs';\nimport { Rect, snapToGrid } from '../g/index.mjs';\n\nconst Flags = {\n    TOOLS: CellView.Flags.TOOLS,\n    UPDATE: 'UPDATE',\n    TRANSLATE: 'TRANSLATE',\n    RESIZE: 'RESIZE',\n    PORTS: 'PORTS',\n    ROTATE: 'ROTATE',\n    RENDER: 'RENDER'\n};\n\nconst DragActions = {\n    MOVE: 'move',\n    MAGNET: 'magnet',\n};\n// Element base view and controller.\n// -------------------------------------------\n\nexport const ElementView = CellView.extend({\n\n    /**\n     * @abstract\n     */\n    _removePorts: function() {\n        // implemented in ports.js\n    },\n\n    /**\n     *\n     * @abstract\n     */\n    _renderPorts: function() {\n        // implemented in ports.js\n    },\n\n    className: function() {\n\n        var classNames = CellView.prototype.className.apply(this).split(' ');\n\n        classNames.push('element');\n\n        return classNames.join(' ');\n    },\n\n    initialize: function() {\n\n        CellView.prototype.initialize.apply(this, arguments);\n\n        this._initializePorts();\n    },\n\n    presentationAttributes: {\n        'attrs': [Flags.UPDATE],\n        'position': [Flags.TRANSLATE, Flags.TOOLS],\n        'size': [Flags.RESIZE, Flags.PORTS, Flags.TOOLS],\n        'angle': [Flags.ROTATE, Flags.TOOLS],\n        'markup': [Flags.RENDER],\n        'ports': [Flags.PORTS],\n    },\n\n    initFlag: [Flags.RENDER],\n\n    UPDATE_PRIORITY: 0,\n\n    confirmUpdate: function(flag, opt) {\n\n        const { useCSSSelectors } = config;\n        if (this.hasFlag(flag, Flags.PORTS)) {\n            this._removePorts();\n            this._cleanPortsCache();\n        }\n        let transformHighlighters = false;\n        if (this.hasFlag(flag, Flags.RENDER)) {\n            this.render();\n            this.updateTools(opt);\n            this.updateHighlighters(true);\n            transformHighlighters = true;\n            flag = this.removeFlag(flag, [Flags.RENDER, Flags.UPDATE, Flags.RESIZE, Flags.TRANSLATE, Flags.ROTATE, Flags.PORTS, Flags.TOOLS]);\n        } else {\n            let updateHighlighters = false;\n\n            // Skip this branch if render is required\n            if (this.hasFlag(flag, Flags.RESIZE)) {\n                this.resize(opt);\n                updateHighlighters = true;\n                // Resize method is calling `update()` internally\n                flag = this.removeFlag(flag, [Flags.RESIZE, Flags.UPDATE]);\n                if (useCSSSelectors) {\n                    // `resize()` rendered the ports when useCSSSelectors are enabled\n                    flag = this.removeFlag(flag, Flags.PORTS);\n                }\n            }\n            if (this.hasFlag(flag, Flags.UPDATE)) {\n                this.update(this.model, null, opt);\n                flag = this.removeFlag(flag, Flags.UPDATE);\n                updateHighlighters = true;\n                if (useCSSSelectors) {\n                    // `update()` will render ports when useCSSSelectors are enabled\n                    flag = this.removeFlag(flag, Flags.PORTS);\n                }\n            }\n            if (this.hasFlag(flag, Flags.TRANSLATE)) {\n                this.translate();\n                flag = this.removeFlag(flag, Flags.TRANSLATE);\n                transformHighlighters = true;\n            }\n            if (this.hasFlag(flag, Flags.ROTATE)) {\n                this.rotate();\n                flag = this.removeFlag(flag, Flags.ROTATE);\n                transformHighlighters = true;\n            }\n            if (this.hasFlag(flag, Flags.PORTS)) {\n                this._renderPorts();\n                updateHighlighters = true;\n                flag = this.removeFlag(flag, Flags.PORTS);\n            }\n\n            if (updateHighlighters) {\n                this.updateHighlighters(false);\n            }\n        }\n\n        if (transformHighlighters) {\n            this.transformHighlighters();\n        }\n\n        if (this.hasFlag(flag, Flags.TOOLS)) {\n            this.updateTools(opt);\n            flag = this.removeFlag(flag, Flags.TOOLS);\n        }\n\n        return flag;\n    },\n\n    /**\n     * @abstract\n     */\n    _initializePorts: function() {\n\n    },\n\n    update: function(_, renderingOnlyAttrs) {\n\n        this.cleanNodesCache();\n\n        // When CSS selector strings are used, make sure no rule matches port nodes.\n        const { useCSSSelectors } = config;\n        if (useCSSSelectors) this._removePorts();\n\n        var model = this.model;\n        var modelAttrs = model.attr();\n        this.updateDOMSubtreeAttributes(this.el, modelAttrs, {\n            rootBBox: new Rect(model.size()),\n            selectors: this.selectors,\n            scalableNode: this.scalableNode,\n            rotatableNode: this.rotatableNode,\n            // Use rendering only attributes if they differs from the model attributes\n            roAttributes: (renderingOnlyAttrs === modelAttrs) ? null : renderingOnlyAttrs\n        });\n\n        if (useCSSSelectors) {\n            this._renderPorts();\n        }\n    },\n\n    rotatableSelector: 'rotatable',\n    scalableSelector: 'scalable',\n    scalableNode: null,\n    rotatableNode: null,\n\n    // `prototype.markup` is rendered by default. Set the `markup` attribute on the model if the\n    // default markup is not desirable.\n    renderMarkup: function() {\n\n        var element = this.model;\n        var markup = element.get('markup') || element.markup;\n        if (!markup) throw new Error('dia.ElementView: markup required');\n        if (Array.isArray(markup)) return this.renderJSONMarkup(markup);\n        if (typeof markup === 'string') return this.renderStringMarkup(markup);\n        throw new Error('dia.ElementView: invalid markup');\n    },\n\n    renderJSONMarkup: function(markup) {\n\n        var doc = this.parseDOMJSON(markup, this.el);\n        var selectors = this.selectors = doc.selectors;\n        this.rotatableNode = V(selectors[this.rotatableSelector]) || null;\n        this.scalableNode = V(selectors[this.scalableSelector]) || null;\n        // Fragment\n        this.vel.append(doc.fragment);\n    },\n\n    renderStringMarkup: function(markup) {\n\n        var vel = this.vel;\n        vel.append(V(markup));\n        // Cache transformation groups\n        this.rotatableNode = vel.findOne('.rotatable');\n        this.scalableNode = vel.findOne('.scalable');\n\n        var selectors = this.selectors = {};\n        selectors[this.selector] = this.el;\n    },\n\n    render: function() {\n\n        this.vel.empty();\n        this.renderMarkup();\n        if (this.scalableNode) {\n            // Double update is necessary for elements with the scalable group only\n            // Note the resize() triggers the other `update`.\n            this.update();\n        }\n        this.resize();\n        if (this.rotatableNode) {\n            // Translate transformation is applied on `this.el` while the rotation transformation\n            // on `this.rotatableNode`\n            this.rotate();\n            this.translate();\n        } else {\n            this.updateTransformation();\n        }\n        if (!config.useCSSSelectors) this._renderPorts();\n        return this;\n    },\n\n    resize: function(opt) {\n\n        if (this.scalableNode) return this.sgResize(opt);\n        if (this.model.attributes.angle) this.rotate();\n        this.update();\n    },\n\n    translate: function() {\n\n        if (this.rotatableNode) return this.rgTranslate();\n        this.updateTransformation();\n    },\n\n    rotate: function() {\n\n        if (this.rotatableNode) {\n            this.rgRotate();\n            // It's necessary to call the update for the nodes outside\n            // the rotatable group referencing nodes inside the group\n            this.update();\n            return;\n        }\n        this.updateTransformation();\n    },\n\n    updateTransformation: function() {\n\n        var transformation = this.getTranslateString();\n        var rotateString = this.getRotateString();\n        if (rotateString) transformation += ' ' + rotateString;\n        this.vel.attr('transform', transformation);\n    },\n\n    getTranslateString: function() {\n\n        var position = this.model.attributes.position;\n        return 'translate(' + position.x + ',' + position.y + ')';\n    },\n\n    getRotateString: function() {\n        var attributes = this.model.attributes;\n        var angle = attributes.angle;\n        if (!angle) return null;\n        var size = attributes.size;\n        return 'rotate(' + angle + ',' + (size.width / 2) + ',' + (size.height / 2) + ')';\n    },\n\n    // Rotatable & Scalable Group\n    // always slower, kept mainly for backwards compatibility\n\n    rgRotate: function() {\n\n        this.rotatableNode.attr('transform', this.getRotateString());\n    },\n\n    rgTranslate: function() {\n\n        this.vel.attr('transform', this.getTranslateString());\n    },\n\n    sgResize: function(opt) {\n\n        var model = this.model;\n        var angle = model.angle();\n        var size = model.size();\n        var scalable = this.scalableNode;\n\n        // Getting scalable group's bbox.\n        // Due to a bug in webkit's native SVG .getBBox implementation, the bbox of groups with path children includes the paths' control points.\n        // To work around the issue, we need to check whether there are any path elements inside the scalable group.\n        var recursive = false;\n        if (scalable.node.getElementsByTagName('path').length > 0) {\n            // If scalable has at least one descendant that is a path, we need to switch to recursive bbox calculation.\n            // If there are no path descendants, group bbox calculation works and so we can use the (faster) native function directly.\n            recursive = true;\n        }\n        var scalableBBox = scalable.getBBox({ recursive: recursive });\n\n        // Make sure `scalableBbox.width` and `scalableBbox.height` are not zero which can happen if the element does not have any content. By making\n        // the width/height 1, we prevent HTML errors of the type `scale(Infinity, Infinity)`.\n        var sx = (size.width / (scalableBBox.width || 1));\n        var sy = (size.height / (scalableBBox.height || 1));\n        scalable.attr('transform', 'scale(' + sx + ',' + sy + ')');\n\n        // Now the interesting part. The goal is to be able to store the object geometry via just `x`, `y`, `angle`, `width` and `height`\n        // Order of transformations is significant but we want to reconstruct the object always in the order:\n        // resize(), rotate(), translate() no matter of how the object was transformed. For that to work,\n        // we must adjust the `x` and `y` coordinates of the object whenever we resize it (because the origin of the\n        // rotation changes). The new `x` and `y` coordinates are computed by canceling the previous rotation\n        // around the center of the resized object (which is a different origin then the origin of the previous rotation)\n        // and getting the top-left corner of the resulting object. Then we clean up the rotation back to what it originally was.\n\n        // Cancel the rotation but now around a different origin, which is the center of the scaled object.\n        var rotatable = this.rotatableNode;\n        var rotation = rotatable && rotatable.attr('transform');\n        if (rotation) {\n\n            rotatable.attr('transform', rotation + ' rotate(' + (-angle) + ',' + (size.width / 2) + ',' + (size.height / 2) + ')');\n            var rotatableBBox = scalable.getBBox({ target: this.paper.cells });\n\n            // Store new x, y and perform rotate() again against the new rotation origin.\n            model.set('position', { x: rotatableBBox.x, y: rotatableBBox.y }, assign({ updateHandled: true }, opt));\n            this.translate();\n            this.rotate();\n        }\n\n        // Update must always be called on non-rotated element. Otherwise, relative positioning\n        // would work with wrong (rotated) bounding boxes.\n        this.update();\n    },\n\n    // Embedding mode methods.\n    // -----------------------\n\n    prepareEmbedding: function(data = {}) {\n\n        const element = data.model || this.model;\n        const paper = data.paper || this.paper;\n        const graph = paper.model;\n\n        const initialZIndices = data.initialZIndices = {};\n        const embeddedCells = element.getEmbeddedCells({ deep: true });\n        const connectedLinks = graph.getConnectedLinks(element, { deep: true, includeEnclosed: true });\n\n        // Note: an embedded cell can be a connect link, but it's fine\n        // to iterate over the cell twice.\n        [\n            element,\n            ...embeddedCells,\n            ...connectedLinks\n        ].forEach(cell => initialZIndices[cell.id] = cell.attributes.z);\n\n        element.startBatch('to-front');\n\n        // Bring the model to the front with all his embeds.\n        element.toFront({ deep: true, ui: true });\n\n        // Note that at this point cells in the collection are not sorted by z index (it's running in the batch, see\n        // the dia.Graph._sortOnChangeZ), so we can't assume that the last cell in the collection has the highest z.\n        const maxZ = graph.getElements().reduce((max, cell) => Math.max(max, cell.attributes.z || 0), 0);\n\n        // Move to front also all the inbound and outbound links that are connected\n        // to any of the element descendant. If we bring to front only embedded elements,\n        // links connected to them would stay in the background.\n        connectedLinks.forEach((link) => {\n            if (link.attributes.z <= maxZ) {\n                link.set('z', maxZ + 1, { ui: true });\n            }\n        });\n\n        element.stopBatch('to-front');\n\n        // Before we start looking for suitable parent we remove the current one.\n        const parentId = element.parent();\n        if (parentId) {\n            const parent = graph.getCell(parentId);\n            parent.unembed(element, { ui: true });\n            data.initialParentId = parentId;\n        } else {\n            data.initialParentId = null;\n        }\n    },\n\n    processEmbedding: function(data = {}, evt, x, y) {\n\n        const model = data.model || this.model;\n        const paper = data.paper || this.paper;\n        const graph = paper.model;\n        const { findParentBy, frontParentOnly, validateEmbedding } = paper.options;\n\n        let candidates;\n        if (isFunction(findParentBy)) {\n            candidates = toArray(findParentBy.call(graph, this, evt, x, y));\n        } else if (findParentBy === 'pointer') {\n            candidates = toArray(graph.findModelsFromPoint({ x, y }));\n        } else {\n            candidates = graph.findModelsUnderElement(model, { searchBy: findParentBy });\n        }\n\n        candidates = candidates.filter((el) => {\n            return (el instanceof Cell) && (model.id !== el.id) && !el.isEmbeddedIn(model);\n        });\n\n        if (frontParentOnly) {\n            // pick the element with the highest `z` index\n            candidates = candidates.slice(-1);\n        }\n\n        let newCandidateView = null;\n        const prevCandidateView = data.candidateEmbedView;\n\n        // iterate over all candidates starting from the last one (has the highest z-index).\n        for (let i = candidates.length - 1; i >= 0; i--) {\n            const candidate = candidates[i];\n            if (prevCandidateView && prevCandidateView.model.id == candidate.id) {\n                // candidate remains the same\n                newCandidateView = prevCandidateView;\n                break;\n            } else {\n                const view = candidate.findView(paper);\n                if (!isFunction(validateEmbedding) || validateEmbedding.call(paper, this, view)) {\n                    // flip to the new candidate\n                    newCandidateView = view;\n                    break;\n                }\n            }\n        }\n\n        if (newCandidateView && newCandidateView != prevCandidateView) {\n            // A new candidate view found. Highlight the new one.\n            this.clearEmbedding(data);\n            data.candidateEmbedView = newCandidateView.highlight(\n                newCandidateView.findProxyNode(null, 'container'),\n                { embedding: true }\n            );\n        }\n\n        if (!newCandidateView && prevCandidateView) {\n            // No candidate view found. Unhighlight the previous candidate.\n            this.clearEmbedding(data);\n        }\n    },\n\n    clearEmbedding: function(data) {\n\n        data || (data = {});\n\n        var candidateView = data.candidateEmbedView;\n        if (candidateView) {\n            // No candidate view found. Unhighlight the previous candidate.\n            candidateView.unhighlight(\n                candidateView.findProxyNode(null, 'container'),\n                { embedding: true }\n            );\n            data.candidateEmbedView = null;\n        }\n    },\n\n    finalizeEmbedding: function(data = {}) {\n\n        const candidateView = data.candidateEmbedView;\n        const element = data.model || this.model;\n        const paper = data.paper || this.paper;\n\n        if (candidateView) {\n\n            // We finished embedding. Candidate view is chosen to become the parent of the model.\n            candidateView.model.embed(element, { ui: true });\n            candidateView.unhighlight(candidateView.findProxyNode(null, 'container'), { embedding: true });\n\n            data.candidateEmbedView = null;\n\n        } else {\n\n            const { validateUnembedding } = paper.options;\n            const { initialParentId } = data;\n            // The element was originally embedded into another element.\n            // The interaction would unembed the element. Let's validate\n            // if the element can be unembedded.\n            if (\n                initialParentId &&\n                typeof validateUnembedding === 'function' &&\n                !validateUnembedding.call(paper, this)\n            ) {\n                this._disallowUnembed(data);\n                return;\n            }\n        }\n\n        paper.model.getConnectedLinks(element, { deep: true }).forEach(link => {\n            link.reparent({ ui: true });\n        });\n    },\n\n    _disallowUnembed: function(data) {\n        const { model, whenNotAllowed = 'revert' } = data;\n        const element = model || this.model;\n        const paper = data.paper || this.paper;\n        const graph = paper.model;\n        switch (whenNotAllowed) {\n            case 'remove': {\n                element.remove({ ui: true });\n                break;\n            }\n            case 'revert': {\n                const { initialParentId, initialPosition, initialZIndices } = data;\n                // Revert the element's position (and the position of its embedded cells if any)\n                if (initialPosition) {\n                    const { x, y } = initialPosition;\n                    element.position(x, y, { deep: true, ui: true });\n                }\n                // Revert all the z-indices changed during the embedding\n                if (initialZIndices) {\n                    Object.keys(initialZIndices).forEach(id => {\n                        const cell = graph.getCell(id);\n                        if (cell) {\n                            cell.set('z', initialZIndices[id], { ui: true });\n                        }\n                    });\n                }\n                // Revert the original parent\n                const parent = graph.getCell(initialParentId);\n                if (parent) {\n                    parent.embed(element, { ui: true });\n                }\n                break;\n            }\n        }\n    },\n\n    getDelegatedView: function() {\n\n        var view = this;\n        var model = view.model;\n        var paper = view.paper;\n\n        while (view) {\n            if (model.isLink()) break;\n            if (!model.isEmbedded() || view.can('stopDelegation')) return view;\n            model = model.getParentCell();\n            view = paper.findViewByModel(model);\n        }\n\n        return null;\n    },\n\n    findProxyNode: function(el, type) {\n        el || (el = this.el);\n        const nodeSelector = el.getAttribute(`${type}-selector`);\n        if (nodeSelector) {\n            const port = this.findAttribute('port', el);\n            if (port) {\n                const proxyPortNode = this.findPortNode(port, nodeSelector);\n                if (proxyPortNode) return proxyPortNode;\n            } else {\n                const [proxyNode] = this.findBySelector(nodeSelector);\n                if (proxyNode) return proxyNode;\n            }\n        }\n        return el;\n    },\n\n    // Interaction. The controller part.\n    // ---------------------------------\n\n    notifyPointerdown(evt, x, y) {\n        CellView.prototype.pointerdown.call(this, evt, x, y);\n        this.notify('element:pointerdown', evt, x, y);\n    },\n\n    notifyPointermove(evt, x, y) {\n        CellView.prototype.pointermove.call(this, evt, x, y);\n        this.notify('element:pointermove', evt, x, y);\n    },\n\n    notifyPointerup(evt, x, y) {\n        this.notify('element:pointerup', evt, x, y);\n        CellView.prototype.pointerup.call(this, evt, x, y);\n    },\n\n    pointerdblclick: function(evt, x, y) {\n\n        CellView.prototype.pointerdblclick.apply(this, arguments);\n        this.notify('element:pointerdblclick', evt, x, y);\n    },\n\n    pointerclick: function(evt, x, y) {\n\n        CellView.prototype.pointerclick.apply(this, arguments);\n        this.notify('element:pointerclick', evt, x, y);\n    },\n\n    contextmenu: function(evt, x, y) {\n\n        CellView.prototype.contextmenu.apply(this, arguments);\n        this.notify('element:contextmenu', evt, x, y);\n    },\n\n    pointerdown: function(evt, x, y) {\n\n        this.notifyPointerdown(evt, x, y);\n        this.dragStart(evt, x, y);\n    },\n\n    pointermove: function(evt, x, y) {\n\n        const data = this.eventData(evt);\n        const { targetMagnet, action, delegatedView } = data;\n\n        if (targetMagnet) {\n            this.magnetpointermove(evt, targetMagnet, x, y);\n        }\n\n        switch (action) {\n            case DragActions.MAGNET:\n                this.dragMagnet(evt, x, y);\n                break;\n            case DragActions.MOVE:\n                (delegatedView || this).drag(evt, x, y);\n            // eslint: no-fallthrough=false\n            default:\n                if (data.preventPointerEvents) break;\n                this.notifyPointermove(evt, x, y);\n                break;\n        }\n\n        // Make sure the element view data is passed along.\n        // It could have been wiped out in the handlers above.\n        this.eventData(evt, data);\n    },\n\n    pointerup: function(evt, x, y) {\n\n        const data = this.eventData(evt);\n        const { targetMagnet, action, delegatedView } = data;\n\n        if (targetMagnet) {\n            this.magnetpointerup(evt, targetMagnet, x, y);\n        }\n\n        switch (action) {\n            case DragActions.MAGNET:\n                this.dragMagnetEnd(evt, x, y);\n                break;\n            case DragActions.MOVE:\n                (delegatedView || this).dragEnd(evt, x, y);\n            // eslint: no-fallthrough=false\n            default:\n                if (data.preventPointerEvents) break;\n                this.notifyPointerup(evt, x, y);\n        }\n\n        if (targetMagnet) {\n            this.magnetpointerclick(evt, targetMagnet, x, y);\n        }\n\n        this.checkMouseleave(evt);\n    },\n\n    mouseover: function(evt) {\n\n        CellView.prototype.mouseover.apply(this, arguments);\n        this.notify('element:mouseover', evt);\n    },\n\n    mouseout: function(evt) {\n\n        CellView.prototype.mouseout.apply(this, arguments);\n        this.notify('element:mouseout', evt);\n    },\n\n    mouseenter: function(evt) {\n\n        CellView.prototype.mouseenter.apply(this, arguments);\n        this.notify('element:mouseenter', evt);\n    },\n\n    mouseleave: function(evt) {\n\n        CellView.prototype.mouseleave.apply(this, arguments);\n        this.notify('element:mouseleave', evt);\n    },\n\n    mousewheel: function(evt, x, y, delta) {\n\n        CellView.prototype.mousewheel.apply(this, arguments);\n        this.notify('element:mousewheel', evt, x, y, delta);\n    },\n\n    onmagnet: function(evt, x, y) {\n\n        const { currentTarget: targetMagnet } = evt;\n        this.magnetpointerdown(evt, targetMagnet, x, y);\n        this.eventData(evt, { targetMagnet });\n        this.dragMagnetStart(evt, x, y);\n    },\n\n    magnetpointerdown: function(evt, magnet, x, y) {\n\n        this.notify('element:magnet:pointerdown', evt, magnet, x, y);\n    },\n\n    magnetpointermove: function(evt, magnet, x, y) {\n\n        this.notify('element:magnet:pointermove', evt, magnet, x, y);\n    },\n\n    magnetpointerup: function(evt, magnet, x, y) {\n\n        this.notify('element:magnet:pointerup', evt, magnet, x, y);\n    },\n\n    magnetpointerdblclick: function(evt, magnet, x, y) {\n\n        this.notify('element:magnet:pointerdblclick', evt, magnet, x, y);\n    },\n\n    magnetcontextmenu: function(evt, magnet, x, y) {\n\n        this.notify('element:magnet:contextmenu', evt, magnet, x, y);\n    },\n\n    // Drag Start Handlers\n\n    dragStart: function(evt, x, y) {\n\n        if (this.isDefaultInteractionPrevented(evt)) return;\n\n        var view = this.getDelegatedView();\n        if (!view || !view.can('elementMove')) return;\n\n        this.eventData(evt, {\n            action: DragActions.MOVE,\n            delegatedView: view\n        });\n\n        const position = view.model.position();\n        view.eventData(evt, {\n            initialPosition: position,\n            pointerOffset: position.difference(x, y),\n            restrictedArea: this.paper.getRestrictedArea(view, x, y)\n        });\n    },\n\n    dragMagnetStart: function(evt, x, y) {\n\n        const { paper } = this;\n        const isPropagationAlreadyStopped = evt.isPropagationStopped();\n        if (isPropagationAlreadyStopped) {\n            // Special case when the propagation was already stopped\n            // on the `element:magnet:pointerdown` event.\n            // Do not trigger any `element:pointer*` events\n            // but still start the magnet dragging.\n            this.eventData(evt, { preventPointerEvents: true });\n        }\n\n        if (this.isDefaultInteractionPrevented(evt) || !this.can('addLinkFromMagnet')) {\n            // Stop the default action, which is to start dragging a link.\n            return;\n        }\n\n        const { targetMagnet = evt.currentTarget } = this.eventData(evt);\n        evt.stopPropagation();\n\n        // Invalid (Passive) magnet. Start dragging the element.\n        if (!paper.options.validateMagnet.call(paper, this, targetMagnet, evt)) {\n            if (isPropagationAlreadyStopped) {\n                // Do not trigger `element:pointerdown` and start element dragging\n                // if the propagation was stopped.\n                this.dragStart(evt, x, y);\n                // The `element:pointerdown` event is not triggered because\n                // of `preventPointerEvents` flag.\n            } else {\n                // We need to reset the action\n                // to `MOVE` so that the element is dragged.\n                this.pointerdown(evt, x, y);\n            }\n            return;\n        }\n\n        // Valid magnet. Start dragging a link.\n        if (paper.options.magnetThreshold <= 0) {\n            this.dragLinkStart(evt, targetMagnet, x, y);\n        }\n        this.eventData(evt, { action: DragActions.MAGNET });\n    },\n\n    // Drag Handlers\n\n    drag: function(evt, x, y) {\n\n        var paper = this.paper;\n        var grid = paper.options.gridSize;\n        var element = this.model;\n        var data = this.eventData(evt);\n        var { pointerOffset, restrictedArea, embedding } = data;\n\n        // Make sure the new element's position always snaps to the current grid\n        var elX = snapToGrid(x + pointerOffset.x, grid);\n        var elY = snapToGrid(y + pointerOffset.y, grid);\n\n        element.position(elX, elY, { restrictedArea, deep: true, ui: true });\n\n        if (paper.options.embeddingMode) {\n            if (!embedding) {\n                // Prepare the element for embedding only if the pointer moves.\n                // We don't want to do unnecessary action with the element\n                // if an user only clicks/dblclicks on it.\n                this.prepareEmbedding(data);\n                embedding = true;\n            }\n            this.processEmbedding(data, evt, x, y);\n        }\n\n        this.eventData(evt, {\n            embedding\n        });\n    },\n\n    dragMagnet: function(evt, x, y) {\n        this.dragLink(evt, x, y);\n    },\n\n    // Drag End Handlers\n\n    dragEnd: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        if (data.embedding) this.finalizeEmbedding(data);\n    },\n\n    dragMagnetEnd: function(evt, x, y) {\n        this.dragLinkEnd(evt, x, y);\n    },\n\n    magnetpointerclick: function(evt, magnet, x, y) {\n        var paper = this.paper;\n        if (paper.eventData(evt).mousemoved > paper.options.clickThreshold) return;\n        this.notify('element:magnet:pointerclick', evt, magnet, x, y);\n    }\n\n}, {\n\n    Flags: Flags,\n});\n\nassign(ElementView.prototype, elementViewPortPrototype);\n","// Does not make any changes to vertices.\n// Returns the arguments that are passed to it, unchanged.\nexport const normal = function(vertices, opt, linkView) {\n\n    return vertices;\n};\n","import * as util from '../util/index.mjs';\n\n// Routes the link always to/from a certain side\n//\n// Arguments:\n//   padding ... gap between the element and the first vertex. :: Default 40.\n//   side ... 'left' | 'right' | 'top' | 'bottom' :: Default 'bottom'.\n//\nexport const oneSide = function(vertices, opt, linkView) {\n\n    var side = opt.side || 'bottom';\n    var padding = util.normalizeSides(opt.padding || 40);\n\n    // LinkView contains cached source an target bboxes.\n    // Note that those are Geometry rectangle objects.\n    var sourceBBox = linkView.sourceBBox;\n    var targetBBox = linkView.targetBBox;\n    var sourcePoint = sourceBBox.center();\n    var targetPoint = targetBBox.center();\n\n    var coordinate, dimension, direction;\n\n    switch (side) {\n        case 'bottom':\n            direction = 1;\n            coordinate = 'y';\n            dimension = 'height';\n            break;\n        case 'top':\n            direction = -1;\n            coordinate = 'y';\n            dimension = 'height';\n            break;\n        case 'left':\n            direction = -1;\n            coordinate = 'x';\n            dimension = 'width';\n            break;\n        case 'right':\n            direction = 1;\n            coordinate = 'x';\n            dimension = 'width';\n            break;\n        default:\n            throw new Error('Router: invalid side');\n    }\n\n    // move the points from the center of the element to outside of it.\n    sourcePoint[coordinate] += direction * (sourceBBox[dimension] / 2 + padding[side]);\n    targetPoint[coordinate] += direction * (targetBBox[dimension] / 2 + padding[side]);\n\n    // make link orthogonal (at least the first and last vertex).\n    if ((direction * (sourcePoint[coordinate] - targetPoint[coordinate])) > 0) {\n        targetPoint[coordinate] = sourcePoint[coordinate];\n    } else {\n        sourcePoint[coordinate] = targetPoint[coordinate];\n    }\n\n    return [sourcePoint].concat(vertices, targetPoint);\n};\n","import * as g from '../g/index.mjs';\nimport * as util from '../util/index.mjs';\n\n// bearing -> opposite bearing\nvar opposites = {\n    N: 'S',\n    S: 'N',\n    E: 'W',\n    W: 'E'\n};\n\n// bearing -> radians\nvar radians = {\n    N: -Math.PI / 2 * 3,\n    S: -Math.PI / 2,\n    E: 0,\n    W: Math.PI\n};\n\n// HELPERS //\n\n// returns a point `p` where lines p,p1 and p,p2 are perpendicular and p is not contained\n// in the given box\nfunction freeJoin(p1, p2, bbox) {\n\n    var p = new g.Point(p1.x, p2.y);\n    if (bbox.containsPoint(p)) p = new g.Point(p2.x, p1.y);\n    // kept for reference\n    // if (bbox.containsPoint(p)) p = null;\n\n    return p;\n}\n\n// returns either width or height of a bbox based on the given bearing\nfunction getBBoxSize(bbox, bearing) {\n\n    return bbox[(bearing === 'W' || bearing === 'E') ? 'width' : 'height'];\n}\n\n// simple bearing method (calculates only orthogonal cardinals)\nfunction getBearing(from, to) {\n\n    if (from.x === to.x) return (from.y > to.y) ? 'N' : 'S';\n    if (from.y === to.y) return (from.x > to.x) ? 'W' : 'E';\n    return null;\n}\n\n// transform point to a rect\nfunction getPointBox(p) {\n\n    return new g.Rect(p.x, p.y, 0, 0);\n}\n\nfunction getPaddingBox(opt) {\n\n    // if both provided, opt.padding wins over opt.elementPadding\n    var sides = util.normalizeSides(opt.padding || opt.elementPadding || 20);\n\n    return {\n        x: -sides.left,\n        y: -sides.top,\n        width: sides.left + sides.right,\n        height: sides.top + sides.bottom\n    };\n}\n\n// return source bbox\nfunction getSourceBBox(linkView, opt) {\n\n    return linkView.sourceBBox.clone().moveAndExpand(getPaddingBox(opt));\n}\n\n// return target bbox\nfunction getTargetBBox(linkView, opt) {\n\n    return linkView.targetBBox.clone().moveAndExpand(getPaddingBox(opt));\n}\n\n// return source anchor\nfunction getSourceAnchor(linkView, opt) {\n\n    if (linkView.sourceAnchor) return linkView.sourceAnchor;\n\n    // fallback: center of bbox\n    var sourceBBox = getSourceBBox(linkView, opt);\n    return sourceBBox.center();\n}\n\n// return target anchor\nfunction getTargetAnchor(linkView, opt) {\n\n    if (linkView.targetAnchor) return linkView.targetAnchor;\n\n    // fallback: center of bbox\n    var targetBBox = getTargetBBox(linkView, opt);\n    return targetBBox.center(); // default\n}\n\n// PARTIAL ROUTERS //\n\nfunction vertexVertex(from, to, bearing) {\n\n    var p1 = new g.Point(from.x, to.y);\n    var p2 = new g.Point(to.x, from.y);\n    var d1 = getBearing(from, p1);\n    var d2 = getBearing(from, p2);\n    var opposite = opposites[bearing];\n\n    var p = (d1 === bearing || (d1 !== opposite && (d2 === opposite || d2 !== bearing))) ? p1 : p2;\n\n    return { points: [p], direction: getBearing(p, to) };\n}\n\nfunction elementVertex(from, to, fromBBox) {\n\n    var p = freeJoin(from, to, fromBBox);\n\n    return { points: [p], direction: getBearing(p, to) };\n}\n\nfunction vertexElement(from, to, toBBox, bearing) {\n\n    var route = {};\n\n    var points = [new g.Point(from.x, to.y), new g.Point(to.x, from.y)];\n    var freePoints = points.filter(function(pt) {\n        return !toBBox.containsPoint(pt);\n    });\n    var freeBearingPoints = freePoints.filter(function(pt) {\n        return getBearing(pt, from) !== bearing;\n    });\n\n    var p;\n\n    if (freeBearingPoints.length > 0) {\n        // Try to pick a point which bears the same direction as the previous segment.\n\n        p = freeBearingPoints.filter(function(pt) {\n            return getBearing(from, pt) === bearing;\n        }).pop();\n        p = p || freeBearingPoints[0];\n\n        route.points = [p];\n        route.direction = getBearing(p, to);\n\n    } else {\n        // Here we found only points which are either contained in the element or they would create\n        // a link segment going in opposite direction from the previous one.\n        // We take the point inside element and move it outside the element in the direction the\n        // route is going. Now we can join this point with the current end (using freeJoin).\n\n        p = util.difference(points, freePoints)[0];\n\n        var p2 = (new g.Point(to)).move(p, -getBBoxSize(toBBox, bearing) / 2);\n        var p1 = freeJoin(p2, from, toBBox);\n\n        route.points = [p1, p2];\n        route.direction = getBearing(p2, to);\n    }\n\n    return route;\n}\n\nfunction elementElement(from, to, fromBBox, toBBox) {\n\n    var route = elementVertex(to, from, toBBox);\n    var p1 = route.points[0];\n\n    if (fromBBox.containsPoint(p1)) {\n\n        route = elementVertex(from, to, fromBBox);\n        var p2 = route.points[0];\n\n        if (toBBox.containsPoint(p2)) {\n\n            var fromBorder = (new g.Point(from)).move(p2, -getBBoxSize(fromBBox, getBearing(from, p2)) / 2);\n            var toBorder = (new g.Point(to)).move(p1, -getBBoxSize(toBBox, getBearing(to, p1)) / 2);\n            var mid = (new g.Line(fromBorder, toBorder)).midpoint();\n\n            var startRoute = elementVertex(from, mid, fromBBox);\n            var endRoute = vertexVertex(mid, to, startRoute.direction);\n\n            route.points = [startRoute.points[0], endRoute.points[0]];\n            route.direction = endRoute.direction;\n        }\n    }\n\n    return route;\n}\n\n// Finds route for situations where one element is inside the other.\n// Typically the route is directed outside the outer element first and\n// then back towards the inner element.\nfunction insideElement(from, to, fromBBox, toBBox, bearing) {\n\n    var route = {};\n    var boundary = fromBBox.union(toBBox).inflate(1);\n\n    // start from the point which is closer to the boundary\n    var reversed = boundary.center().distance(to) > boundary.center().distance(from);\n    var start = reversed ? to : from;\n    var end = reversed ? from : to;\n\n    var p1, p2, p3;\n\n    if (bearing) {\n        // Points on circle with radius equals 'W + H` are always outside the rectangle\n        // with width W and height H if the center of that circle is the center of that rectangle.\n        p1 = g.Point.fromPolar(boundary.width + boundary.height, radians[bearing], start);\n        p1 = boundary.pointNearestToPoint(p1).move(p1, -1);\n\n    } else {\n        p1 = boundary.pointNearestToPoint(start).move(start, 1);\n    }\n\n    p2 = freeJoin(p1, end, boundary);\n\n    if (p1.round().equals(p2.round())) {\n        p2 = g.Point.fromPolar(boundary.width + boundary.height, g.toRad(p1.theta(start)) + Math.PI / 2, end);\n        p2 = boundary.pointNearestToPoint(p2).move(end, 1).round();\n        p3 = freeJoin(p1, p2, boundary);\n        route.points = reversed ? [p2, p3, p1] : [p1, p3, p2];\n\n    } else {\n        route.points = reversed ? [p2, p1] : [p1, p2];\n    }\n\n    route.direction = reversed ? getBearing(p1, to) : getBearing(p2, to);\n\n    return route;\n}\n\n// MAIN ROUTER //\n\n// Return points through which a connection needs to be drawn in order to obtain an orthogonal link\n// routing from source to target going through `vertices`.\nexport function orthogonal(vertices, opt, linkView) {\n\n    var sourceBBox = getSourceBBox(linkView, opt);\n    var targetBBox = getTargetBBox(linkView, opt);\n\n    var sourceAnchor = getSourceAnchor(linkView, opt);\n    var targetAnchor = getTargetAnchor(linkView, opt);\n\n    // if anchor lies outside of bbox, the bbox expands to include it\n    sourceBBox = sourceBBox.union(getPointBox(sourceAnchor));\n    targetBBox = targetBBox.union(getPointBox(targetAnchor));\n\n    vertices = util.toArray(vertices).map(g.Point);\n    vertices.unshift(sourceAnchor);\n    vertices.push(targetAnchor);\n\n    var bearing; // bearing of previous route segment\n\n    var orthogonalVertices = []; // the array of found orthogonal vertices to be returned\n    for (var i = 0, max = vertices.length - 1; i < max; i++) {\n\n        var route = null;\n\n        var from = vertices[i];\n        var to = vertices[i + 1];\n\n        var isOrthogonal = !!getBearing(from, to);\n\n        if (i === 0) { // source\n\n            if (i + 1 === max) { // route source -> target\n\n                // Expand one of the elements by 1px to detect situations when the two\n                // elements are positioned next to each other with no gap in between.\n                if (sourceBBox.intersect(targetBBox.clone().inflate(1))) {\n                    route = insideElement(from, to, sourceBBox, targetBBox);\n\n                } else if (!isOrthogonal) {\n                    route = elementElement(from, to, sourceBBox, targetBBox);\n                }\n\n            } else { // route source -> vertex\n\n                if (sourceBBox.containsPoint(to)) {\n                    route = insideElement(from, to, sourceBBox, getPointBox(to).moveAndExpand(getPaddingBox(opt)));\n\n                } else if (!isOrthogonal) {\n                    route = elementVertex(from, to, sourceBBox);\n                }\n            }\n\n        } else if (i + 1 === max) { // route vertex -> target\n\n            // prevent overlaps with previous line segment\n            var isOrthogonalLoop = isOrthogonal && getBearing(to, from) === bearing;\n\n            if (targetBBox.containsPoint(from) || isOrthogonalLoop) {\n                route = insideElement(from, to, getPointBox(from).moveAndExpand(getPaddingBox(opt)), targetBBox, bearing);\n\n            } else if (!isOrthogonal) {\n                route = vertexElement(from, to, targetBBox, bearing);\n            }\n\n        } else if (!isOrthogonal) { // route vertex -> vertex\n            route = vertexVertex(from, to, bearing);\n        }\n\n        // applicable to all routes:\n\n        // set bearing for next iteration\n        if (route) {\n            Array.prototype.push.apply(orthogonalVertices, route.points);\n            bearing = route.direction;\n\n        } else {\n            // orthogonal route and not looped\n            bearing = getBearing(from, to);\n        }\n\n        // push `to` point to identified orthogonal vertices array\n        if (i + 1 < max) {\n            orthogonalVertices.push(to);\n        }\n    }\n\n    return orthogonalVertices;\n}\n","import * as g from '../g/index.mjs';\nimport * as util from '../util/index.mjs';\nimport { orthogonal } from './orthogonal.mjs';\n\nvar config = {\n\n    // size of the step to find a route (the grid of the manhattan pathfinder)\n    step: 10,\n\n    // the number of route finding loops that cause the router to abort\n    // returns fallback route instead\n    maximumLoops: 2000,\n\n    // the number of decimal places to round floating point coordinates\n    precision: 1,\n\n    // maximum change of direction\n    maxAllowedDirectionChange: 90,\n\n    // should the router use perpendicular linkView option?\n    // does not connect anchor of element but rather a point close-by that is orthogonal\n    // this looks much better\n    perpendicular: true,\n\n    // should the source and/or target not be considered as obstacles?\n    excludeEnds: [], // 'source', 'target'\n\n    // should certain types of elements not be considered as obstacles?\n    excludeTypes: ['basic.Text'],\n\n    // possible starting directions from an element\n    startDirections: ['top', 'right', 'bottom', 'left'],\n\n    // possible ending directions to an element\n    endDirections: ['top', 'right', 'bottom', 'left'],\n\n    // specify the directions used above and what they mean\n    directionMap: {\n        top: { x: 0, y: -1 },\n        right: { x: 1, y: 0 },\n        bottom: { x: 0, y: 1 },\n        left: { x: -1, y: 0 }\n    },\n\n    // cost of an orthogonal step\n    cost: function() {\n\n        return this.step;\n    },\n\n    // an array of directions to find next points on the route\n    // different from start/end directions\n    directions: function() {\n\n        var step = this.step;\n        var cost = this.cost();\n\n        return [\n            { offsetX: step, offsetY: 0, cost: cost },\n            { offsetX: -step, offsetY: 0, cost: cost },\n            { offsetX: 0, offsetY: step, cost: cost },\n            { offsetX: 0, offsetY: -step, cost: cost }\n        ];\n    },\n\n    // a penalty received for direction change\n    penalties: function() {\n\n        return {\n            0: 0,\n            45: this.step / 2,\n            90: this.step / 2\n        };\n    },\n\n    // padding applied on the element bounding boxes\n    paddingBox: function() {\n\n        var step = this.step;\n\n        return {\n            x: -step,\n            y: -step,\n            width: 2 * step,\n            height: 2 * step\n        };\n    },\n\n    // A function that determines whether a given point is an obstacle or not.\n    // If used, the `padding`, `excludeEnds`and `excludeTypes` options are ignored.\n    // (point: dia.Point) => boolean;\n    isPointObstacle: null,\n\n    // a router to use when the manhattan router fails\n    // (one of the partial routes returns null)\n    fallbackRouter: function(vertices, opt, linkView) {\n\n        if (!util.isFunction(orthogonal)) {\n            throw new Error('Manhattan requires the orthogonal router as default fallback.');\n        }\n\n        return orthogonal(vertices, util.assign({}, config, opt), linkView);\n    },\n\n    /* Deprecated */\n    // a simple route used in situations when main routing method fails\n    // (exceed max number of loop iterations, inaccessible)\n    fallbackRoute: function(from, to, opt) {\n\n        return null; // null result will trigger the fallbackRouter\n\n        // left for reference:\n        /*// Find an orthogonal route ignoring obstacles.\n\n        var point = ((opt.previousDirAngle || 0) % 180 === 0)\n                ? new g.Point(from.x, to.y)\n                : new g.Point(to.x, from.y);\n\n        return [point];*/\n    },\n\n    // if a function is provided, it's used to route the link while dragging an end\n    // i.e. function(from, to, opt) { return []; }\n    draggingRoute: null\n};\n\n// HELPER CLASSES //\n\n// Map of obstacles\n// Helper structure to identify whether a point lies inside an obstacle.\nfunction ObstacleMap(opt) {\n\n    this.map = {};\n    this.options = opt;\n    // tells how to divide the paper when creating the elements map\n    this.mapGridSize = 100;\n}\n\nObstacleMap.prototype.build = function(graph, link) {\n\n    var opt = this.options;\n\n    // source or target element could be excluded from set of obstacles\n    var excludedEnds = util.toArray(opt.excludeEnds).reduce(function(res, item) {\n\n        var end = link.get(item);\n        if (end) {\n            var cell = graph.getCell(end.id);\n            if (cell) {\n                res.push(cell);\n            }\n        }\n\n        return res;\n    }, []);\n\n    // Exclude any embedded elements from the source and the target element.\n    var excludedAncestors = [];\n\n    var source = graph.getCell(link.get('source').id);\n    if (source) {\n        excludedAncestors = util.union(excludedAncestors, source.getAncestors().map(function(cell) {\n            return cell.id;\n        }));\n    }\n\n    var target = graph.getCell(link.get('target').id);\n    if (target) {\n        excludedAncestors = util.union(excludedAncestors, target.getAncestors().map(function(cell) {\n            return cell.id;\n        }));\n    }\n\n    // Builds a map of all elements for quicker obstacle queries (i.e. is a point contained\n    // in any obstacle?) (a simplified grid search).\n    // The paper is divided into smaller cells, where each holds information about which\n    // elements belong to it. When we query whether a point lies inside an obstacle we\n    // don't need to go through all obstacles, we check only those in a particular cell.\n    var mapGridSize = this.mapGridSize;\n\n    graph.getElements().reduce(function(map, element) {\n\n        var isExcludedType = util.toArray(opt.excludeTypes).includes(element.get('type'));\n        var isExcludedEnd = excludedEnds.find(function(excluded) {\n            return excluded.id === element.id;\n        });\n        var isExcludedAncestor = excludedAncestors.includes(element.id);\n\n        var isExcluded = isExcludedType || isExcludedEnd || isExcludedAncestor;\n        if (!isExcluded) {\n            var bbox = element.getBBox().moveAndExpand(opt.paddingBox);\n\n            var origin = bbox.origin().snapToGrid(mapGridSize);\n            var corner = bbox.corner().snapToGrid(mapGridSize);\n\n            for (var x = origin.x; x <= corner.x; x += mapGridSize) {\n                for (var y = origin.y; y <= corner.y; y += mapGridSize) {\n                    var gridKey = x + '@' + y;\n                    map[gridKey] = map[gridKey] || [];\n                    map[gridKey].push(bbox);\n                }\n            }\n        }\n\n        return map;\n    }, this.map);\n\n    return this;\n};\n\nObstacleMap.prototype.isPointAccessible = function(point) {\n\n    var mapKey = point.clone().snapToGrid(this.mapGridSize).toString();\n\n    return util.toArray(this.map[mapKey]).every(function(obstacle) {\n        return !obstacle.containsPoint(point);\n    });\n};\n\n// Sorted Set\n// Set of items sorted by given value.\nfunction SortedSet() {\n    this.items = [];\n    this.hash = {};\n    this.values = {};\n    this.OPEN = 1;\n    this.CLOSE = 2;\n}\n\nSortedSet.prototype.add = function(item, value) {\n\n    if (this.hash[item]) {\n        // item removal\n        this.items.splice(this.items.indexOf(item), 1);\n    } else {\n        this.hash[item] = this.OPEN;\n    }\n\n    this.values[item] = value;\n\n    var index = util.sortedIndex(this.items, item, function(i) {\n        return this.values[i];\n    }.bind(this));\n\n    this.items.splice(index, 0, item);\n};\n\nSortedSet.prototype.remove = function(item) {\n\n    this.hash[item] = this.CLOSE;\n};\n\nSortedSet.prototype.isOpen = function(item) {\n\n    return this.hash[item] === this.OPEN;\n};\n\nSortedSet.prototype.isClose = function(item) {\n\n    return this.hash[item] === this.CLOSE;\n};\n\nSortedSet.prototype.isEmpty = function() {\n\n    return this.items.length === 0;\n};\n\nSortedSet.prototype.pop = function() {\n\n    var item = this.items.shift();\n    this.remove(item);\n    return item;\n};\n\n// HELPERS //\n\n// return source bbox\nfunction getSourceBBox(linkView, opt) {\n\n    // expand by padding box\n    if (opt && opt.paddingBox) return linkView.sourceBBox.clone().moveAndExpand(opt.paddingBox);\n\n    return linkView.sourceBBox.clone();\n}\n\n// return target bbox\nfunction getTargetBBox(linkView, opt) {\n\n    // expand by padding box\n    if (opt && opt.paddingBox) return linkView.targetBBox.clone().moveAndExpand(opt.paddingBox);\n\n    return linkView.targetBBox.clone();\n}\n\n// return source anchor\nfunction getSourceAnchor(linkView, opt) {\n\n    if (linkView.sourceAnchor) return linkView.sourceAnchor;\n\n    // fallback: center of bbox\n    var sourceBBox = getSourceBBox(linkView, opt);\n    return sourceBBox.center();\n}\n\n// return target anchor\nfunction getTargetAnchor(linkView, opt) {\n\n    if (linkView.targetAnchor) return linkView.targetAnchor;\n\n    // fallback: center of bbox\n    var targetBBox = getTargetBBox(linkView, opt);\n    return targetBBox.center(); // default\n}\n\n// returns a direction index from start point to end point\n// corrects for grid deformation between start and end\nfunction getDirectionAngle(start, end, numDirections, grid, opt) {\n\n    var quadrant = 360 / numDirections;\n    var angleTheta = start.theta(fixAngleEnd(start, end, grid, opt));\n    var normalizedAngle = g.normalizeAngle(angleTheta + (quadrant / 2));\n    return quadrant * Math.floor(normalizedAngle / quadrant);\n}\n\n// helper function for getDirectionAngle()\n// corrects for grid deformation\n// (if a point is one grid steps away from another in both dimensions,\n// it is considered to be 45 degrees away, even if the real angle is different)\n// this causes visible angle discrepancies if `opt.step` is much larger than `paper.gridSize`\nfunction fixAngleEnd(start, end, grid, opt) {\n\n    var step = opt.step;\n\n    var diffX = end.x - start.x;\n    var diffY = end.y - start.y;\n\n    var gridStepsX = diffX / grid.x;\n    var gridStepsY = diffY / grid.y;\n\n    var distanceX = gridStepsX * step;\n    var distanceY = gridStepsY * step;\n\n    return new g.Point(start.x + distanceX, start.y + distanceY);\n}\n\n// return the change in direction between two direction angles\nfunction getDirectionChange(angle1, angle2) {\n\n    var directionChange = Math.abs(angle1 - angle2);\n    return (directionChange > 180) ? (360 - directionChange) : directionChange;\n}\n\n// fix direction offsets according to current grid\nfunction getGridOffsets(directions, grid, opt) {\n\n    var step = opt.step;\n\n    util.toArray(opt.directions).forEach(function(direction) {\n\n        direction.gridOffsetX = (direction.offsetX / step) * grid.x;\n        direction.gridOffsetY = (direction.offsetY / step) * grid.y;\n    });\n}\n\n// get grid size in x and y dimensions, adapted to source and target positions\nfunction getGrid(step, source, target) {\n\n    return {\n        source: source.clone(),\n        x: getGridDimension(target.x - source.x, step),\n        y: getGridDimension(target.y - source.y, step)\n    };\n}\n\n// helper function for getGrid()\nfunction getGridDimension(diff, step) {\n\n    // return step if diff = 0\n    if (!diff) return step;\n\n    var absDiff = Math.abs(diff);\n    var numSteps = Math.round(absDiff / step);\n\n    // return absDiff if less than one step apart\n    if (!numSteps) return absDiff;\n\n    // otherwise, return corrected step\n    var roundedDiff = numSteps * step;\n    var remainder = absDiff - roundedDiff;\n    var stepCorrection = remainder / numSteps;\n\n    return step + stepCorrection;\n}\n\n// return a clone of point snapped to grid\nfunction snapToGrid(point, grid) {\n\n    var source = grid.source;\n\n    var snappedX = g.snapToGrid(point.x - source.x, grid.x) + source.x;\n    var snappedY = g.snapToGrid(point.y - source.y, grid.y) + source.y;\n\n    return new g.Point(snappedX, snappedY);\n}\n\n// round the point to opt.precision\nfunction round(point, precision) {\n\n    return point.round(precision);\n}\n\n// snap to grid and then round the point\nfunction align(point, grid, precision) {\n\n    return round(snapToGrid(point.clone(), grid), precision);\n}\n\n// return a string representing the point\n// string is rounded in both dimensions\nfunction getKey(point) {\n\n    return point.clone().toString();\n}\n\n// return a normalized vector from given point\n// used to determine the direction of a difference of two points\nfunction normalizePoint(point) {\n\n    return new g.Point(\n        point.x === 0 ? 0 : Math.abs(point.x) / point.x,\n        point.y === 0 ? 0 : Math.abs(point.y) / point.y\n    );\n}\n\n// PATHFINDING //\n\n// reconstructs a route by concatenating points with their parents\nfunction reconstructRoute(parents, points, tailPoint, from, to, grid, opt) {\n\n    var route = [];\n\n    var prevDiff = normalizePoint(to.difference(tailPoint));\n\n    // tailPoint is assumed to be aligned already\n    var currentKey = getKey(tailPoint);\n    var parent = parents[currentKey];\n\n    var point;\n    while (parent) {\n\n        // point is assumed to be aligned already\n        point = points[currentKey];\n\n        var diff = normalizePoint(point.difference(parent));\n        if (!diff.equals(prevDiff)) {\n            route.unshift(point);\n            prevDiff = diff;\n        }\n\n        // parent is assumed to be aligned already\n        currentKey = getKey(parent);\n        parent = parents[currentKey];\n    }\n\n    // leadPoint is assumed to be aligned already\n    var leadPoint = points[currentKey];\n\n    var fromDiff = normalizePoint(leadPoint.difference(from));\n    if (!fromDiff.equals(prevDiff)) {\n        route.unshift(leadPoint);\n    }\n\n    return route;\n}\n\n// heuristic method to determine the distance between two points\nfunction estimateCost(from, endPoints) {\n\n    var min = Infinity;\n\n    for (var i = 0, len = endPoints.length; i < len; i++) {\n        var cost = from.manhattanDistance(endPoints[i]);\n        if (cost < min) min = cost;\n    }\n\n    return min;\n}\n\n// find points around the bbox taking given directions into account\n// lines are drawn from anchor in given directions, intersections recorded\n// if anchor is outside bbox, only those directions that intersect get a rect point\n// the anchor itself is returned as rect point (representing some directions)\n// (since those directions are unobstructed by the bbox)\nfunction getRectPoints(anchor, bbox, directionList, grid, opt) {\n\n    var precision = opt.precision;\n    var directionMap = opt.directionMap;\n\n    var anchorCenterVector = anchor.difference(bbox.center());\n\n    var keys = util.isObject(directionMap) ? Object.keys(directionMap) : [];\n    var dirList = util.toArray(directionList);\n    var rectPoints = keys.reduce(function(res, key) {\n\n        if (dirList.includes(key)) {\n            var direction = directionMap[key];\n\n            // create a line that is guaranteed to intersect the bbox if bbox is in the direction\n            // even if anchor lies outside of bbox\n            var endpoint = new g.Point(\n                anchor.x + direction.x * (Math.abs(anchorCenterVector.x) + bbox.width),\n                anchor.y + direction.y * (Math.abs(anchorCenterVector.y) + bbox.height)\n            );\n            var intersectionLine = new g.Line(anchor, endpoint);\n\n            // get the farther intersection, in case there are two\n            // (that happens if anchor lies next to bbox)\n            var intersections = intersectionLine.intersect(bbox) || [];\n            var numIntersections = intersections.length;\n            var farthestIntersectionDistance;\n            var farthestIntersection = null;\n            for (var i = 0; i < numIntersections; i++) {\n                var currentIntersection = intersections[i];\n                var distance = anchor.squaredDistance(currentIntersection);\n                if ((farthestIntersectionDistance === undefined) || (distance > farthestIntersectionDistance)) {\n                    farthestIntersectionDistance = distance;\n                    farthestIntersection = currentIntersection;\n                }\n            }\n\n            // if an intersection was found in this direction, it is our rectPoint\n            if (farthestIntersection) {\n                var point = align(farthestIntersection, grid, precision);\n\n                // if the rectPoint lies inside the bbox, offset it by one more step\n                if (bbox.containsPoint(point)) {\n                    point = align(point.offset(direction.x * grid.x, direction.y * grid.y), grid, precision);\n                }\n\n                // then add the point to the result array\n                // aligned\n                res.push(point);\n            }\n        }\n\n        return res;\n    }, []);\n\n    // if anchor lies outside of bbox, add it to the array of points\n    if (!bbox.containsPoint(anchor)) {\n        // aligned\n        rectPoints.push(align(anchor, grid, precision));\n    }\n\n    return rectPoints;\n}\n\n// finds the route between two points/rectangles (`from`, `to`) implementing A* algorithm\n// rectangles get rect points assigned by getRectPoints()\nfunction findRoute(from, to, isPointObstacle, opt) {\n\n    var precision = opt.precision;\n\n    // Get grid for this route.\n\n    var sourceAnchor, targetAnchor;\n\n    if (from instanceof g.Rect) { // `from` is sourceBBox\n        sourceAnchor = round(getSourceAnchor(this, opt).clone(), precision);\n    } else {\n        sourceAnchor = round(from.clone(), precision);\n    }\n\n    if (to instanceof g.Rect) { // `to` is targetBBox\n        targetAnchor = round(getTargetAnchor(this, opt).clone(), precision);\n    } else {\n        targetAnchor = round(to.clone(), precision);\n    }\n\n    var grid = getGrid(opt.step, sourceAnchor, targetAnchor);\n\n    // Get pathfinding points.\n\n    var start, end; // aligned with grid by definition\n    var startPoints, endPoints; // assumed to be aligned with grid already\n\n    // set of points we start pathfinding from\n    if (from instanceof g.Rect) { // `from` is sourceBBox\n        start = sourceAnchor;\n        startPoints = getRectPoints(start, from, opt.startDirections, grid, opt);\n\n    } else {\n        start = sourceAnchor;\n        startPoints = [start];\n    }\n\n    // set of points we want the pathfinding to finish at\n    if (to instanceof g.Rect) { // `to` is targetBBox\n        end = targetAnchor;\n        endPoints = getRectPoints(targetAnchor, to, opt.endDirections, grid, opt);\n\n    } else {\n        end = targetAnchor;\n        endPoints = [end];\n    }\n\n    // take into account only accessible rect points (those not under obstacles)\n    startPoints = startPoints.filter(p => !isPointObstacle(p));\n    endPoints = endPoints.filter(p => !isPointObstacle(p));\n\n    // Check that there is an accessible route point on both sides.\n    // Otherwise, use fallbackRoute().\n    if (startPoints.length > 0 && endPoints.length > 0) {\n\n        // The set of tentative points to be evaluated, initially containing the start points.\n        // Rounded to nearest integer for simplicity.\n        var openSet = new SortedSet();\n        // Keeps reference to actual points for given elements of the open set.\n        var points = {};\n        // Keeps reference to a point that is immediate predecessor of given element.\n        var parents = {};\n        // Cost from start to a point along best known path.\n        var costs = {};\n\n        for (var i = 0, n = startPoints.length; i < n; i++) {\n            // startPoint is assumed to be aligned already\n            var startPoint = startPoints[i];\n\n            var key = getKey(startPoint);\n\n            openSet.add(key, estimateCost(startPoint, endPoints));\n            points[key] = startPoint;\n            costs[key] = 0;\n        }\n\n        var previousRouteDirectionAngle = opt.previousDirectionAngle; // undefined for first route\n        var isPathBeginning = (previousRouteDirectionAngle === undefined);\n\n        // directions\n        var direction, directionChange;\n        var directions = opt.directions;\n        getGridOffsets(directions, grid, opt);\n\n        var numDirections = directions.length;\n\n        var endPointsKeys = util.toArray(endPoints).reduce(function(res, endPoint) {\n            // endPoint is assumed to be aligned already\n\n            var key = getKey(endPoint);\n            res.push(key);\n            return res;\n        }, []);\n\n        // main route finding loop\n        var loopsRemaining = opt.maximumLoops;\n        while (!openSet.isEmpty() && loopsRemaining > 0) {\n\n            // remove current from the open list\n            var currentKey = openSet.pop();\n            var currentPoint = points[currentKey];\n            var currentParent = parents[currentKey];\n            var currentCost = costs[currentKey];\n\n            var isRouteBeginning = (currentParent === undefined); // undefined for route starts\n            var isStart = currentPoint.equals(start); // (is source anchor or `from` point) = can leave in any direction\n\n            var previousDirectionAngle;\n            if (!isRouteBeginning) previousDirectionAngle = getDirectionAngle(currentParent, currentPoint, numDirections, grid, opt); // a vertex on the route\n            else if (!isPathBeginning) previousDirectionAngle = previousRouteDirectionAngle; // beginning of route on the path\n            else if (!isStart) previousDirectionAngle = getDirectionAngle(start, currentPoint, numDirections, grid, opt); // beginning of path, start rect point\n            else previousDirectionAngle = null; // beginning of path, source anchor or `from` point\n\n            // check if we reached any endpoint\n            var samePoints = startPoints.length === endPoints.length;\n            if (samePoints) {\n                for (var j = 0; j < startPoints.length; j++) {\n                    if (!startPoints[j].equals(endPoints[j])) {\n                        samePoints = false;\n                        break;\n                    }\n                }\n            }\n            var skipEndCheck = (isRouteBeginning && samePoints);\n            if (!skipEndCheck && (endPointsKeys.indexOf(currentKey) >= 0)) {\n                opt.previousDirectionAngle = previousDirectionAngle;\n                return reconstructRoute(parents, points, currentPoint, start, end, grid, opt);\n            }\n\n            // go over all possible directions and find neighbors\n            for (i = 0; i < numDirections; i++) {\n                direction = directions[i];\n\n                var directionAngle = direction.angle;\n                directionChange = getDirectionChange(previousDirectionAngle, directionAngle);\n\n                // if the direction changed rapidly, don't use this point\n                // any direction is allowed for starting points\n                if (!(isPathBeginning && isStart) && directionChange > opt.maxAllowedDirectionChange) continue;\n\n                var neighborPoint = align(currentPoint.clone().offset(direction.gridOffsetX, direction.gridOffsetY), grid, precision);\n                var neighborKey = getKey(neighborPoint);\n\n                // Closed points from the openSet were already evaluated.\n                if (openSet.isClose(neighborKey) || isPointObstacle(neighborPoint)) continue;\n\n                // We can only enter end points at an acceptable angle.\n                if (endPointsKeys.indexOf(neighborKey) >= 0) { // neighbor is an end point\n\n                    var isNeighborEnd = neighborPoint.equals(end); // (is target anchor or `to` point) = can be entered in any direction\n\n                    if (!isNeighborEnd) {\n                        var endDirectionAngle = getDirectionAngle(neighborPoint, end, numDirections, grid, opt);\n                        var endDirectionChange = getDirectionChange(directionAngle, endDirectionAngle);\n\n                        if (endDirectionChange > opt.maxAllowedDirectionChange) continue;\n                    }\n                }\n\n                // The current direction is ok.\n\n                var neighborCost = direction.cost;\n                var neighborPenalty = isStart ? 0 : opt.penalties[directionChange]; // no penalties for start point\n                var costFromStart = currentCost + neighborCost + neighborPenalty;\n\n                if (!openSet.isOpen(neighborKey) || (costFromStart < costs[neighborKey])) {\n                    // neighbor point has not been processed yet\n                    // or the cost of the path from start is lower than previously calculated\n\n                    points[neighborKey] = neighborPoint;\n                    parents[neighborKey] = currentPoint;\n                    costs[neighborKey] = costFromStart;\n                    openSet.add(neighborKey, costFromStart + estimateCost(neighborPoint, endPoints));\n                }\n            }\n\n            loopsRemaining--;\n        }\n    }\n\n    // no route found (`to` point either wasn't accessible or finding route took\n    // way too much calculation)\n    return opt.fallbackRoute.call(this, start, end, opt);\n}\n\n// resolve some of the options\nfunction resolveOptions(opt) {\n\n    opt.directions = util.result(opt, 'directions');\n    opt.penalties = util.result(opt, 'penalties');\n    opt.paddingBox = util.result(opt, 'paddingBox');\n    opt.padding = util.result(opt, 'padding');\n\n    if (opt.padding) {\n        // if both provided, opt.padding wins over opt.paddingBox\n        var sides = util.normalizeSides(opt.padding);\n        opt.paddingBox = {\n            x: -sides.left,\n            y: -sides.top,\n            width: sides.left + sides.right,\n            height: sides.top + sides.bottom\n        };\n    }\n\n    util.toArray(opt.directions).forEach(function(direction) {\n\n        var point1 = new g.Point(0, 0);\n        var point2 = new g.Point(direction.offsetX, direction.offsetY);\n\n        direction.angle = g.normalizeAngle(point1.theta(point2));\n    });\n}\n\n// initialization of the route finding\nfunction router(vertices, opt, linkView) {\n\n    resolveOptions(opt);\n\n    // enable/disable linkView perpendicular option\n    linkView.options.perpendicular = !!opt.perpendicular;\n\n    var sourceBBox = getSourceBBox(linkView, opt);\n    var targetBBox = getTargetBBox(linkView, opt);\n\n    var sourceAnchor = getSourceAnchor(linkView, opt);\n    //var targetAnchor = getTargetAnchor(linkView, opt);\n\n    // pathfinding\n    let isPointObstacle;\n    if (typeof opt.isPointObstacle === 'function') {\n        isPointObstacle = opt.isPointObstacle;\n    } else {\n        const map = new ObstacleMap(opt);\n        map.build(linkView.paper.model, linkView.model);\n        isPointObstacle = (point) => !map.isPointAccessible(point);\n    }\n\n    var oldVertices = util.toArray(vertices).map(g.Point);\n    var newVertices = [];\n    var tailPoint = sourceAnchor; // the origin of first route's grid, does not need snapping\n\n    // find a route by concatenating all partial routes (routes need to pass through vertices)\n    // source -> vertex[1] -> ... -> vertex[n] -> target\n    var to, from;\n\n    for (var i = 0, len = oldVertices.length; i <= len; i++) {\n\n        var partialRoute = null;\n\n        from = to || sourceBBox;\n        to = oldVertices[i];\n\n        if (!to) {\n            // this is the last iteration\n            // we ran through all vertices in oldVertices\n            // 'to' is not a vertex.\n\n            to = targetBBox;\n\n            // If the target is a point (i.e. it's not an element), we\n            // should use dragging route instead of main routing method if it has been provided.\n            var isEndingAtPoint = !linkView.model.get('source').id || !linkView.model.get('target').id;\n\n            if (isEndingAtPoint && util.isFunction(opt.draggingRoute)) {\n                // Make sure we are passing points only (not rects).\n                var dragFrom = (from === sourceBBox) ? sourceAnchor : from;\n                var dragTo = to.origin();\n\n                partialRoute = opt.draggingRoute.call(linkView, dragFrom, dragTo, opt);\n            }\n        }\n\n        // if partial route has not been calculated yet use the main routing method to find one\n        partialRoute = partialRoute || findRoute.call(linkView, from, to, isPointObstacle, opt);\n\n        if (partialRoute === null) { // the partial route cannot be found\n            return opt.fallbackRouter(vertices, opt, linkView);\n        }\n\n        var leadPoint = partialRoute[0];\n\n        // remove the first point if the previous partial route had the same point as last\n        if (leadPoint && leadPoint.equals(tailPoint)) partialRoute.shift();\n\n        // save tailPoint for next iteration\n        tailPoint = partialRoute[partialRoute.length - 1] || tailPoint;\n\n        Array.prototype.push.apply(newVertices, partialRoute);\n    }\n\n    return newVertices;\n}\n\n// public function\nexport const manhattan = function(vertices, opt, linkView) {\n    return router(vertices, util.assign({}, config, opt), linkView);\n};\n","import { manhattan } from './manhattan.mjs';\nimport * as util from '../util/index.mjs';\nimport * as g from '../g/index.mjs';\n\nvar config = {\n\n    maxAllowedDirectionChange: 45,\n\n    // cost of a diagonal step\n    diagonalCost: function() {\n\n        var step = this.step;\n        return Math.ceil(Math.sqrt(step * step << 1));\n    },\n\n    // an array of directions to find next points on the route\n    // different from start/end directions\n    directions: function() {\n\n        var step = this.step;\n        var cost = this.cost();\n        var diagonalCost = this.diagonalCost();\n\n        return [\n            { offsetX: step, offsetY: 0, cost: cost },\n            { offsetX: step, offsetY: step, cost: diagonalCost },\n            { offsetX: 0, offsetY: step, cost: cost },\n            { offsetX: -step, offsetY: step, cost: diagonalCost },\n            { offsetX: -step, offsetY: 0, cost: cost },\n            { offsetX: -step, offsetY: -step, cost: diagonalCost },\n            { offsetX: 0, offsetY: -step, cost: cost },\n            { offsetX: step, offsetY: -step, cost: diagonalCost }\n        ];\n    },\n\n    // a simple route used in situations when main routing method fails\n    // (exceed max number of loop iterations, inaccessible)\n    fallbackRoute: function(from, to, opt) {\n\n        // Find a route which breaks by 45 degrees ignoring all obstacles.\n\n        var theta = from.theta(to);\n\n        var route = [];\n\n        var a = { x: to.x, y: from.y };\n        var b = { x: from.x, y: to.y };\n\n        if (theta % 180 > 90) {\n            var t = a;\n            a = b;\n            b = t;\n        }\n\n        var p1 = (theta % 90) < 45 ? a : b;\n        var l1 = new g.Line(from, p1);\n\n        var alpha = 90 * Math.ceil(theta / 90);\n\n        var p2 = g.Point.fromPolar(l1.squaredLength(), g.toRad(alpha + 135), p1);\n        var l2 = new g.Line(to, p2);\n\n        var intersectionPoint = l1.intersection(l2);\n        var point = intersectionPoint ? intersectionPoint : to;\n\n        var directionFrom = intersectionPoint ? point : from;\n\n        var quadrant = 360 / opt.directions.length;\n        var angleTheta = directionFrom.theta(to);\n        var normalizedAngle = g.normalizeAngle(angleTheta + (quadrant / 2));\n        var directionAngle = quadrant * Math.floor(normalizedAngle / quadrant);\n\n        opt.previousDirectionAngle = directionAngle;\n\n        if (point) route.push(point.round());\n        route.push(to);\n\n        return route;\n    }\n};\n\n// public function\nexport const metro = function(vertices, opt, linkView) {\n\n    if (!util.isFunction(manhattan)) {\n        throw new Error('Metro requires the manhattan router.');\n    }\n\n    return manhattan(vertices, util.assign({}, config, opt), linkView);\n};\n\n","import * as g from '../g/index.mjs';\n\nconst Directions = {\n    AUTO: 'auto',\n    LEFT: 'left',\n    RIGHT: 'right',\n    TOP: 'top',\n    BOTTOM: 'bottom',\n    ANCHOR_SIDE: 'anchor-side',\n    MAGNET_SIDE: 'magnet-side'\n};\n\nconst DEFINED_DIRECTIONS = [Directions.LEFT, Directions.RIGHT, Directions.TOP, Directions.BOTTOM];\n\nfunction getDirectionForLinkConnection(linkOrigin, connectionPoint, linkView) {\n    const tangent = linkView.getTangentAtLength(linkView.getClosestPointLength(connectionPoint));\n    const roundedAngle = Math.round(tangent.angle() / 90) * 90;\n\n    switch (roundedAngle) {\n        case 0:\n        case 360:\n            return linkOrigin.y < connectionPoint.y ? Directions.TOP : Directions.BOTTOM;\n        case 90:\n            return linkOrigin.x < connectionPoint.x ? Directions.LEFT : Directions.RIGHT;\n        case 180:\n            return linkOrigin.y < connectionPoint.y ? Directions.TOP : Directions.BOTTOM;\n        case 270:\n            return linkOrigin.x < connectionPoint.x ? Directions.LEFT : Directions.RIGHT;\n    }\n}\n\nfunction rightAngleRouter(_vertices, opt, linkView) {\n    const margin = opt.margin || 20;\n    let { sourceDirection = Directions.AUTO, targetDirection = Directions.AUTO } = opt;\n\n    const sourceView = linkView.sourceView;\n    const targetView = linkView.targetView;\n\n    const isSourcePort = !!linkView.model.source().port;\n    const isTargetPort = !!linkView.model.target().port;\n\n    if (sourceDirection === Directions.AUTO) {\n        sourceDirection = isSourcePort ? Directions.MAGNET_SIDE : Directions.ANCHOR_SIDE;\n    }\n\n    if (targetDirection === Directions.AUTO) {\n        targetDirection = isTargetPort ? Directions.MAGNET_SIDE : Directions.ANCHOR_SIDE;\n    }\n\n    const sourceBBox = linkView.sourceBBox;\n    const targetBBox = linkView.targetBBox;\n    const sourcePoint = linkView.sourceAnchor;\n    const targetPoint = linkView.targetAnchor;\n    let {\n        x: sx0,\n        y: sy0,\n        width: sourceWidth = 0,\n        height: sourceHeight = 0\n    } = sourceView && sourceView.model.isElement() ? g.Rect.fromRectUnion(sourceBBox, sourceView.model.getBBox()) : linkView.sourceAnchor;\n\n    let {\n        x: tx0,\n        y: ty0,\n        width: targetWidth = 0,\n        height: targetHeight = 0\n    } = targetView && targetView.model.isElement() ? g.Rect.fromRectUnion(targetBBox, targetView.model.getBBox()) : linkView.targetAnchor;\n\n    const tx1 = tx0 + targetWidth;\n    const ty1 = ty0 + targetHeight;\n    const sx1 = sx0 + sourceWidth;\n    const sy1 = sy0 + sourceHeight;\n\n    // Key coordinates including the margin\n    const smx0 = sx0 - margin;\n    const smx1 = sx1 + margin;\n    const smy0 = sy0 - margin;\n    const smy1 = sy1 + margin;\n    const tmx0 = tx0 - margin;\n    const tmx1 = tx1 + margin;\n    const tmy0 = ty0 - margin;\n    const tmy1 = ty1 + margin;\n\n    const sourceOutsidePoint = sourcePoint.clone();\n\n    let sourceSide;\n\n    if (!sourceView) {\n        const sourceLinkAnchorBBox = new g.Rect(sx0, sy0, 0, 0);\n        sourceSide = DEFINED_DIRECTIONS.includes(sourceDirection) ? sourceDirection : sourceLinkAnchorBBox.sideNearestToPoint(targetPoint);\n    } else if (sourceView.model.isLink()) {\n        sourceSide = getDirectionForLinkConnection(targetPoint, sourcePoint, sourceView);\n    } else if (sourceDirection === Directions.ANCHOR_SIDE) {\n        sourceSide = sourceBBox.sideNearestToPoint(sourcePoint);\n    } else if (sourceDirection === Directions.MAGNET_SIDE) {\n        sourceSide = sourceView.model.getBBox().sideNearestToPoint(sourcePoint);\n    } else {\n        sourceSide = sourceDirection;\n    }\n\n    switch (sourceSide) {\n        case 'left':\n            sourceOutsidePoint.x = smx0;\n            break;\n        case 'right':\n            sourceOutsidePoint.x = smx1;\n            break;\n        case 'top':\n            sourceOutsidePoint.y = smy0;\n            break;\n        case 'bottom':\n            sourceOutsidePoint.y = smy1;\n            break;\n    }\n    const targetOutsidePoint = targetPoint.clone();\n\n\n    let targetSide;\n\n\n    if (!targetView) {\n        const targetLinkAnchorBBox = new g.Rect(tx0, ty0, 0, 0);\n        targetSide = DEFINED_DIRECTIONS.includes(targetDirection) ? targetDirection : targetLinkAnchorBBox.sideNearestToPoint(sourcePoint);\n    } else if (targetView.model.isLink()) {\n        targetSide = getDirectionForLinkConnection(sourcePoint, targetPoint, targetView);\n    } else if (targetDirection === Directions.ANCHOR_SIDE) {\n        targetSide = targetBBox.sideNearestToPoint(targetPoint);\n    } else if (targetDirection === Directions.MAGNET_SIDE) {\n        targetSide = targetView.model.getBBox().sideNearestToPoint(targetPoint);\n    } else {\n        targetSide = targetDirection;\n    }\n\n    switch (targetSide) {\n        case 'left':\n            targetOutsidePoint.x = tmx0;\n            break;\n        case 'right':\n            targetOutsidePoint.x = tmx1;\n            break;\n        case 'top':\n            targetOutsidePoint.y = tmy0;\n            break;\n        case 'bottom':\n            targetOutsidePoint.y = tmy1;\n            break;\n    }\n\n    const { x: sox, y: soy } = sourceOutsidePoint;\n    const { x: tox, y: toy } = targetOutsidePoint;\n    const tcx = (tx0 + tx1) / 2;\n    const tcy = (ty0 + ty1) / 2;\n    const scx = (sx0 + sx1) / 2;\n    const scy = (sy0 + sy1) / 2;\n    const middleOfVerticalSides = (scx < tcx ? (sx1 + tx0) : (tx1 + sx0)) / 2;\n    const middleOfHorizontalSides = (scy < tcy ? (sy1 + ty0) : (ty1 + sy0)) / 2;\n\n    if (sourceSide === 'left' && targetSide === 'right') {\n        if (smx0 <= tx1) {\n            let y = middleOfHorizontalSides;\n            if (sx1 <= tx0) {\n                if (ty1 >= smy0 && toy < soy) {\n                    y = Math.min(tmy0, smy0);\n                } else if (ty0 <= smy1 && toy >= soy) {\n                    y = Math.max(tmy1, smy1);\n                }\n            }\n            return [\n                { x: sox, y: soy },\n                { x: sox, y },\n                { x: tox, y },\n                { x: tox, y: toy }\n            ];\n        }\n\n        const x = (sox + tox) / 2;\n        return [\n            { x, y: soy },\n            { x, y: toy }\n        ];\n    } else if (sourceSide === 'right' && targetSide === 'left') {\n        if (smx1 >= tx0) {\n            let y = middleOfHorizontalSides;\n            if (sox > tx1) {\n                if (ty1 >= smy0 && toy < soy) {\n                    y = Math.min(tmy0, smy0);\n                } else if (ty0 <= smy1 && toy >= soy) {\n                    y = Math.max(tmy1, smy1);\n                }\n            }\n\n            return [\n                { x: sox, y: soy },\n                { x: sox, y },\n                { x: tox, y },\n                { x: tox, y: toy }\n            ];\n        }\n\n        const x = (sox + tox) / 2;\n        return [\n            { x, y: soy },\n            { x, y: toy }\n        ];\n    } else if (sourceSide === 'top' && targetSide === 'bottom') {\n        if (soy < toy) {\n            let x = middleOfVerticalSides;\n            let y = soy;\n\n            if (soy < ty0) {\n                if (tx1 >= smx0 && tox < sox) {\n                    x = Math.min(tmx0, smx0);\n                } else if (tx0 <= smx1 && tox >= sox) {\n                    x = Math.max(tmx1, smx1);\n                }\n            }\n\n            return [\n                { x: sox, y },\n                { x, y },\n                { x, y: toy },\n                { x: tox, y: toy }\n            ];\n        }\n        const y = (soy + toy) / 2;\n        return [\n            { x: sox, y },\n            { x: tox, y }\n        ];\n    } else if (sourceSide === 'bottom' && targetSide === 'top') {\n        if (soy - margin > toy) {\n            let x = middleOfVerticalSides;\n            let y = soy;\n\n            if (soy > ty1) {\n                if (tx1 >= smx0 && tox < sox) {\n                    x = Math.min(tmx0, smx0);\n                } else if (tx0 <= smx1 && tox >= sox) {\n                    x = Math.max(tmx1, smx1);\n                }\n            }\n\n            return [\n                { x: sox, y },\n                { x, y },\n                { x, y: toy },\n                { x: tox, y: toy }\n            ];\n        }\n        const y = (soy + toy) / 2;\n        return [\n            { x: sox, y },\n            { x: tox, y }\n        ];\n    } else if (sourceSide === 'top' && targetSide === 'top') {\n        let x;\n        let y1 = Math.min((sy1 + ty0) / 2, toy);\n        let y2 = Math.min((sy0 + ty1) / 2, soy);\n\n        if (toy < soy) {\n            if (sox >= tmx1 || sox <= tmx0) {\n                return [\n                    { x: sox, y: Math.min(soy,toy) },\n                    { x: tox, y: Math.min(soy,toy) }\n                ];\n            } else if (tox > sox) {\n                x = Math.min(sox, tmx0);\n            } else {\n                x = Math.max(sox, tmx1);\n            }\n        } else {\n            if (tox >= smx1 || tox <= smx0) {\n                return [\n                    { x: sox, y: Math.min(soy,toy) },\n                    { x: tox, y: Math.min(soy,toy) }\n                ];\n            } else if (tox >= sox) {\n                x = Math.max(tox, smx1);\n            } else {\n                x = Math.min(tox, smx0);\n            }\n        }\n\n        return [\n            { x: sox, y: y2 },\n            { x, y: y2 },\n            { x, y: y1 },\n            { x: tox, y: y1 }\n        ];\n    } else if (sourceSide === 'bottom' && targetSide === 'bottom') {\n        if (tx0 >= sox + margin || tx1 <= sox - margin) {\n            return [\n                { x: sox, y: Math.max(soy, toy) },\n                { x: tox, y: Math.max(soy, toy) }\n            ];\n        }\n\n        let x;\n        let y1;\n        let y2;\n\n        if (toy > soy) {\n            y1 = Math.max((sy1 + ty0) / 2, toy);\n            y2 = Math.max((sy1 + ty0) / 2, soy);\n\n            if (tox > sox) {\n                x = Math.min(sox, tmx0);\n            } else {\n                x = Math.max(sox, tmx1);\n            }\n        } else {\n            y1 = Math.max((sy0 + ty1) / 2, toy);\n            y2 = Math.max((sy0 + ty1) / 2, soy);\n\n            if (tox > sox) {\n                x = Math.min(tox, smx0);\n            } else {\n                x = Math.max(tox, smx1);\n            }\n        }\n\n        return [\n            { x: sox, y: y2 },\n            { x, y: y2 },\n            { x, y: y1 },\n            { x: tox, y: y1 }\n        ];\n    } else if (sourceSide === 'left' && targetSide === 'left') {\n        let y;\n        let x1 = Math.min((sx1 + tx0) / 2, tox);\n        let x2 = Math.min((sx0 + tx1) / 2, sox);\n\n        if (tox > sox) {\n            if (toy <= soy) {\n                y = Math.min(smy0, toy);\n            } else {\n                y = Math.max(smy1, toy);\n            }\n        } else {\n            if (toy >= soy) {\n                y = Math.min(tmy0, soy);\n            } else {\n                y = Math.max(tmy1, soy);\n            }\n        }\n\n        return [\n            { x: x2, y: soy },\n            { x: x2, y },\n            { x: x1, y },\n            { x: x1, y: toy }\n        ];\n    } else if (sourceSide === 'right' && targetSide === 'right') {\n        let y;\n        let x1 = Math.max((sx0 + tx1) / 2, tox);\n        let x2 = Math.max((sx1 + tx0) / 2, sox);\n\n        if (tox < sox) {\n            if (toy <= soy) {\n                y = Math.min(smy0, toy);\n            } else {\n                y = Math.max(smy1, toy);\n            }\n        } else {\n            if (toy >= soy) {\n                y = Math.min(tmy0, soy);\n            } else {\n                y = Math.max(tmy1, soy);\n            }\n        }\n\n        return [\n            { x: x2, y: soy },\n            { x: x2, y },\n            { x: x1, y },\n            { x: x1, y: toy }\n        ];\n    } else if (sourceSide === 'top' && targetSide === 'right') {\n        if (soy > toy) {\n            if (sox < tox) {\n                let y = (sy0 + ty1) / 2;\n                if (y > tcy && y < tmy1 && sox < tmx0) {\n                    y = tmy0;\n                }\n                return [\n                    { x: sox, y },\n                    { x: tox, y },\n                    { x: tox, y: toy }\n                ];\n            }\n            return [{ x: sox, y: toy }];\n        }\n\n        const x = (sx0 + tx1) / 2;\n\n        if (sox > tox && sy1 >= toy) {\n            return [\n                { x: sox, y: soy },\n                { x, y: soy },\n                { x, y: toy }];\n        }\n\n        if (x > smx0 && soy < ty1) {\n            const y = Math.min(sy0, ty0) - margin;\n            const x = Math.max(sx1, tx1) + margin;\n            return [\n                { x: sox, y },\n                { x, y },\n                { x, y: toy }\n            ];\n        }\n        return [\n            { x: sox, y: soy },\n            { x, y: soy },\n            { x, y: toy }\n        ];\n    } else if (sourceSide === 'top' && targetSide === 'left') {\n        if (soy > toy) {\n            if (sox > tox) {\n                let y = (sy0 + ty1) / 2;\n                if (y > tcy && y < tmy1 && sox > tmx1) {\n                    y = tmy0;\n                }\n                return [\n                    { x: sox, y },\n                    { x: tox, y },\n                    { x: tox, y: toy }\n                ];\n            }\n            return [{ x: sox, y: toy }];\n        }\n\n        const x = (sx1 + tx0) / 2;\n\n        if (sox < tox && sy1 >= toy) {\n            return [\n                { x: sox, y: soy },\n                { x, y: soy },\n                { x, y: toy }];\n        }\n\n        if (x < smx1 && soy < ty1) {\n            const y = Math.min(sy0, ty0) - margin;\n            const x = Math.min(sx0, tx0) - margin;\n            return [\n                { x: sox, y },\n                { x, y },\n                { x, y: toy }\n            ];\n        }\n        return [\n            { x: sox, y: soy },\n            { x, y: soy },\n            { x, y: toy }\n        ];\n    } else if (sourceSide === 'bottom' && targetSide === 'right') {\n        if (soy < toy) {\n            if (sox < tox) {\n                let y = (sy1 + ty0) / 2;\n                if (y < tcy && y > tmy0 && sox < tmx0) {\n                    y = tmy1;\n                }\n                return [\n                    { x: sox, y },\n                    { x: tox, y },\n                    { x: tox, y: toy }\n                ];\n            }\n            return [{ x: sox, y: toy }];\n        } else {\n            if (sx0 < tox) {\n                const y = Math.max(sy1, ty1) + margin;\n                const x = Math.max(sx1, tx1) + margin;\n                return [\n                    { x: sox, y },\n                    { x, y },\n                    { x, y: toy }\n                ];\n            }\n        }\n\n        const x = middleOfVerticalSides;\n\n        return [\n            { x: sox, y: soy },\n            { x, y: soy },\n            { x, y: toy }\n        ];\n    } else if (sourceSide === 'bottom' && targetSide === 'left') {\n        if (soy < toy) {\n            if (sox > tox) {\n                let y = (sy1 + ty0) / 2;\n                if (y < tcy && y > tmy0 && sox > tmx1) {\n                    y = tmy1;\n                }\n                return [\n                    { x: sox, y },\n                    { x: tox, y },\n                    { x: tox, y: toy }\n                ];\n            }\n            return [{ x: sox, y: toy }];\n        } else {\n            if (sx1 > tox) {\n                const y = Math.max(sy1, ty1) + margin;\n                const x = Math.min(sx0, tx0) - margin;\n                return [\n                    { x: sox, y },\n                    { x, y },\n                    { x, y: toy }\n                ];\n            }\n        }\n\n        const x = middleOfVerticalSides;\n\n        return [\n            { x: sox, y: soy },\n            { x, y: soy },\n            { x, y: toy }\n        ];\n    } else if (sourceSide === 'left' && targetSide === 'bottom') {\n        if (sox > tox && soy >= tmy1) {\n            return [{ x: tox, y: soy }];\n        }\n\n        if (sox >= tx1 && soy < toy) {\n            const x = (sx1 + tx0) / 2;\n            return [\n                { x, y: soy },\n                { x, y: toy },\n                { x: tox, y: toy }\n            ];\n        }\n\n        if (tox < sx1 && ty1 <= sy0) {\n            const y = (sy0 + ty1) / 2;\n\n            return [\n                { x: sox, y: soy },\n                { x: sox, y },\n                { x: tox, y }\n            ];\n        }\n\n        const x = Math.min(tmx0, sox);\n        const y = Math.max(sy1, ty1) + margin;\n\n        return [\n            { x, y: soy },\n            { x, y },\n            { x: tox, y }\n        ];\n    } else if (sourceSide === 'left' && targetSide === 'top') {\n        if (sox > tox && soy < tmy0) {\n            return [{ x: tox, y: soy }];\n        }\n\n        if (sox >= tx1) {\n            if (soy > toy) {\n                const x = (sx0 + tx1) / 2;\n                return [\n                    { x, y: soy },\n                    { x, y: toy },\n                    { x: tox, y: toy }\n                ];\n            }\n        }\n\n        if (tox <= sx1 && toy > soy) {\n            const y = (ty0 + sy1) / 2;\n\n            return [\n                { x: sox, y: soy },\n                { x: sox, y },\n                { x: tox, y },\n            ];\n        }\n\n        const x = toy < soy ? Math.min(sx0, tx0) - margin : smx0;\n        const y = Math.min(sy0, ty0) - margin;\n\n        return [\n            { x, y: soy },\n            { x, y },\n            { x: tox, y }\n        ];\n\n    } else if (sourceSide === 'right' && targetSide === 'top') {\n        if (sox < tox && soy < tmy0) {\n            return [{ x: tox, y: soy }];\n        }\n\n        if (sx1 < tx0 && soy > toy) {\n            let x = (sx1 + tx0) / 2;\n            return [\n                { x, y: soy },\n                { x, y: toy },\n                { x: tox, y: toy }\n            ];\n        }\n\n        if (tox < sox && ty0 > sy1) {\n            const y = (sy1 + ty0) / 2;\n\n            return [\n                { x: sox, y: soy },\n                { x: sox, y },\n                { x: tox, y }\n            ];\n        }\n\n        const x = Math.max(sx1, tx1) + margin;\n        const y = Math.min(sy0, ty0) - margin;\n        return [\n            { x, y: soy },\n            { x, y },\n            { x: tox, y }\n        ];\n    } else if (sourceSide === 'right' && targetSide === 'bottom') {\n        if (sox < tox && soy >= tmy1) {\n            return [{ x: tox, y: soy }];\n        }\n\n        if (sox <= tx0 && soy < toy) {\n            const x = (sx1 + tx0) / 2;\n            return [\n                { x, y: soy },\n                { x, y: toy },\n                { x: tox, y: toy }\n            ];\n        }\n\n        if (tox > sx0 && ty1 < sy0) {\n            const y = (sy0 + ty1) / 2;\n\n            return [\n                { x: sox, y: soy },\n                { x: sox, y },\n                { x: tox, y }\n            ];\n        }\n\n        const x = Math.max(tmx1, sox);\n        const y = Math.max(sy1, ty1) + margin;\n\n        return [\n            { x, y: soy },\n            { x, y },\n            { x: tox, y }\n        ];\n    }\n}\n\nrightAngleRouter.Directions = Directions;\n\nexport const rightAngle = rightAngleRouter;\n","import * as g from '../g/index.mjs';\n\nconst CornerTypes = {\n    POINT: 'point',\n    CUBIC: 'cubic',\n    LINE: 'line',\n    GAP: 'gap'\n};\n\nconst DEFINED_CORNER_TYPES = Object.values(CornerTypes);\n\nconst CORNER_RADIUS = 10;\nconst PRECISION = 1;\n\nexport const straight = function(sourcePoint, targetPoint, routePoints = [], opt = {}) {\n\n    const {\n        cornerType = CornerTypes.POINT,\n        cornerRadius = CORNER_RADIUS,\n        cornerPreserveAspectRatio = false,\n        precision = PRECISION,\n        raw = false\n    } = opt;\n\n    if (DEFINED_CORNER_TYPES.indexOf(cornerType) === -1) {\n        // unknown `cornerType` provided => error\n        throw new Error('Invalid `cornerType` provided to `straight` connector.');\n    }\n\n    let path;\n\n    if ((cornerType === CornerTypes.POINT) || !cornerRadius) {\n        // default option => normal connector\n        // simply connect all points with straight lines\n        const points = [sourcePoint].concat(routePoints).concat([targetPoint]);\n        const polyline = new g.Polyline(points);\n        path = new g.Path(polyline);\n\n    } else {\n        // `cornerType` is not unknown and not 'point' (default) => must be one of other valid types\n        path = new g.Path();\n\n        // add initial gap segment = to source point\n        path.appendSegment(g.Path.createSegment('M', sourcePoint));\n\n        let nextDistance;\n        const routePointsLength = routePoints.length;\n        for (let i = 0; i < routePointsLength; i++) {\n\n            const curr = new g.Point(routePoints[i]);\n            const prev = (routePoints[i - 1] || sourcePoint);\n            const next = (routePoints[i + 1] || targetPoint);\n            const prevDistance = (nextDistance || (curr.distance(prev) / 2)); // try to re-use previously-computed `nextDistance`\n            nextDistance = (curr.distance(next) / 2);\n\n            let startMove, endMove;\n            if (!cornerPreserveAspectRatio) {\n                // `startMove` and `endMove` may be different\n                // (this happens when next or previous path point is closer than `2 * cornerRadius`)\n                startMove = -Math.min(cornerRadius, prevDistance);\n                endMove = -Math.min(cornerRadius, nextDistance);\n            } else {\n                // force `startMove` and `endMove` to be the same\n                startMove = endMove = -Math.min(cornerRadius, prevDistance, nextDistance);\n            }\n\n            // to find `cornerStart` and `cornerEnd`, the logic is as follows (using `cornerStart` as example):\n            // - find a point lying on the line `prev - startMove` such that...\n            // - ...the point lies `abs(startMove)` distance away from `curr`...\n            // - ...and its coordinates are rounded to whole numbers\n            const cornerStart = curr.clone().move(prev, startMove).round(precision);\n            const cornerEnd = curr.clone().move(next, endMove).round(precision);\n\n            // add in-between straight segment = from previous route point to corner start point\n            // (may have zero length)\n            path.appendSegment(g.Path.createSegment('L', cornerStart));\n\n            // add corner segment = from corner start point to corner end point\n            switch (cornerType) {\n                case CornerTypes.CUBIC: {\n                    // corner is rounded\n                    const _13 = (1 / 3);\n                    const _23 = (2 / 3);\n                    const control1 = new g.Point((_13 * cornerStart.x) + (_23 * curr.x), (_23 * curr.y) + (_13 * cornerStart.y));\n                    const control2 = new g.Point((_13 * cornerEnd.x) + (_23 * curr.x), (_23 * curr.y) + (_13 * cornerEnd.y));\n                    path.appendSegment(g.Path.createSegment('C', control1, control2, cornerEnd));\n                    break;\n                }\n                case CornerTypes.LINE: {\n                    // corner has bevel\n                    path.appendSegment(g.Path.createSegment('L', cornerEnd));\n                    break;\n                }\n                case CornerTypes.GAP: {\n                    // corner has empty space\n                    path.appendSegment(g.Path.createSegment('M', cornerEnd));\n                    break;\n                }\n                // default: no segment is created\n            }\n        }\n\n        // add final straight segment = from last corner end point to target point\n        // (= or from start point to end point, if there are no route points)\n        // (may have zero length)\n        path.appendSegment(g.Path.createSegment('L', targetPoint));\n    }\n\n    return ((raw) ? path : path.serialize());\n};\n","import * as util from '../util/index.mjs';\nimport * as g from '../g/index.mjs';\n\n// default size of jump if not specified in options\nvar JUMP_SIZE = 5;\n\n// available jump types\n// first one taken as default\nvar JUMP_TYPES = ['arc', 'gap', 'cubic'];\n\n// default radius\nvar RADIUS = 0;\n\n// takes care of math. error for case when jump is too close to end of line\nvar CLOSE_PROXIMITY_PADDING = 1;\n\n// list of connector types not to jump over.\nvar IGNORED_CONNECTORS = ['smooth'];\n\n// internal constants for round segment\nvar _13 = 1 / 3;\nvar _23 = 2 / 3;\n\nfunction sortPointsAscending(p1, p2) {\n\n    let { x: x1, y: y1 } = p1;\n    let { x: x2, y: y2 } = p2;\n\n    if (x1 > x2) {\n\n        let swap = x1;\n        x1 = x2;\n        x2 = swap;\n\n        swap = y1;\n        y1 = y2;\n        y2 = swap;\n    }\n\n    if (y1 > y2) {\n        let swap = x1;\n        x1 = x2;\n        x2 = swap;\n\n        swap = y1;\n        y1 = y2;\n        y2 = swap;\n    }\n\n    return [new g.Point(x1, y1), new g.Point(x2, y2)];\n}\n\nfunction overlapExists(line1, line2) {\n\n    const [{ x: x1, y: y1 }, { x: x2, y: y2 }] = sortPointsAscending(line1.start, line1.end);\n    const [{ x: x3, y: y3 }, { x: x4, y: y4 }] = sortPointsAscending(line2.start, line2.end);\n\n    const xMatch = x1 <= x4 && x3 <= x2;\n    const yMatch = y1 <= y4 && y3 <= y2;\n\n    return xMatch && yMatch;\n}\n\n/**\n * Transform start/end and route into series of lines\n * @param {g.point} sourcePoint start point\n * @param {g.point} targetPoint end point\n * @param {g.point[]} route optional list of route\n * @return {g.line[]} [description]\n */\nfunction createLines(sourcePoint, targetPoint, route) {\n    // make a flattened array of all points\n    var points = [].concat(sourcePoint, route, targetPoint);\n    return points.reduce(function(resultLines, point, idx) {\n        // if there is a next point, make a line with it\n        var nextPoint = points[idx + 1];\n        if (nextPoint != null) {\n            resultLines[idx] = g.line(point, nextPoint);\n        }\n        return resultLines;\n    }, []);\n}\n\nfunction setupUpdating(jumpOverLinkView) {\n    var paper = jumpOverLinkView.paper;\n    var updateList = paper._jumpOverUpdateList;\n\n    // first time setup for this paper\n    if (updateList == null) {\n        updateList = paper._jumpOverUpdateList = [];\n        var graph = paper.model;\n        graph.on('batch:stop', function() {\n            if (this.hasActiveBatch()) return;\n            updateJumpOver(paper);\n        });\n        graph.on('reset', function() {\n            updateList = paper._jumpOverUpdateList = [];\n        });\n    }\n\n    // add this link to a list so it can be updated when some other link is updated\n    if (updateList.indexOf(jumpOverLinkView) < 0) {\n        updateList.push(jumpOverLinkView);\n\n        // watch for change of connector type or removal of link itself\n        // to remove the link from a list of jump over connectors\n        jumpOverLinkView.listenToOnce(jumpOverLinkView.model, 'change:connector remove', function() {\n            updateList.splice(updateList.indexOf(jumpOverLinkView), 1);\n        });\n    }\n}\n\n/**\n * Handler for a batch:stop event to force\n * update of all registered links with jump over connector\n * @param {object} batchEvent optional object with info about batch\n */\nfunction updateJumpOver(paper) {\n    var updateList = paper._jumpOverUpdateList;\n    for (var i = 0; i < updateList.length; i++) {\n        const linkView = updateList[i];\n        const updateFlag = linkView.getFlag(linkView.constructor.Flags.CONNECTOR);\n        linkView.requestUpdate(updateFlag);\n    }\n}\n\n/**\n * Utility function to collect all intersection points of a single\n * line against group of other lines.\n * @param {g.line} line where to find points\n * @param {g.line[]} crossCheckLines lines to cross\n * @return {g.point[]} list of intersection points\n */\nfunction findLineIntersections(line, crossCheckLines) {\n    return util.toArray(crossCheckLines).reduce(function(res, crossCheckLine) {\n        var intersection = line.intersection(crossCheckLine);\n        if (intersection) {\n            res.push(intersection);\n        }\n        return res;\n    }, []);\n}\n\n/**\n * Sorting function for list of points by their distance.\n * @param {g.point} p1 first point\n * @param {g.point} p2 second point\n * @return {number} squared distance between points\n */\nfunction sortPoints(p1, p2) {\n    return g.line(p1, p2).squaredLength();\n}\n\n/**\n * Split input line into multiple based on intersection points.\n * @param {g.line} line input line to split\n * @param {g.point[]} intersections points where to split the line\n * @param {number} jumpSize the size of jump arc (length empty spot on a line)\n * @return {g.line[]} list of lines being split\n */\nfunction createJumps(line, intersections, jumpSize) {\n    return intersections.reduce(function(resultLines, point, idx) {\n        // skipping points that were merged with the previous line\n        // to make bigger arc over multiple lines that are close to each other\n        if (point.skip === true) {\n            return resultLines;\n        }\n\n        // always grab the last line from buffer and modify it\n        var lastLine = resultLines.pop() || line;\n\n        // calculate start and end of jump by moving by a given size of jump\n        var jumpStart = g.point(point).move(lastLine.start, -(jumpSize));\n        var jumpEnd = g.point(point).move(lastLine.start, +(jumpSize));\n\n        // now try to look at the next intersection point\n        var nextPoint = intersections[idx + 1];\n        if (nextPoint != null) {\n            var distance = jumpEnd.distance(nextPoint);\n            if (distance <= jumpSize) {\n                // next point is close enough, move the jump end by this\n                // difference and mark the next point to be skipped\n                jumpEnd = nextPoint.move(lastLine.start, distance);\n                nextPoint.skip = true;\n            }\n        } else {\n            // this block is inside of `else` as an optimization so the distance is\n            // not calculated when we know there are no other intersection points\n            var endDistance = jumpStart.distance(lastLine.end);\n            // if the end is too close to possible jump, draw remaining line instead of a jump\n            if (endDistance < jumpSize * 2 + CLOSE_PROXIMITY_PADDING) {\n                resultLines.push(lastLine);\n                return resultLines;\n            }\n        }\n\n        var startDistance = jumpEnd.distance(lastLine.start);\n        if (startDistance < jumpSize * 2 + CLOSE_PROXIMITY_PADDING) {\n            // if the start of line is too close to jump, draw that line instead of a jump\n            resultLines.push(lastLine);\n            return resultLines;\n        }\n\n        // finally create a jump line\n        var jumpLine = g.line(jumpStart, jumpEnd);\n        // it's just simple line but with a `isJump` property\n        jumpLine.isJump = true;\n\n        resultLines.push(\n            g.line(lastLine.start, jumpStart),\n            jumpLine,\n            g.line(jumpEnd, lastLine.end)\n        );\n        return resultLines;\n    }, []);\n}\n\n/**\n * Assemble `D` attribute of a SVG path by iterating given lines.\n * @param {g.line[]} lines source lines to use\n * @param {number} jumpSize the size of jump arc (length empty spot on a line)\n * @param {number} radius the radius\n * @return {string}\n */\nfunction buildPath(lines, jumpSize, jumpType, radius) {\n\n    var path = new g.Path();\n    var segment;\n\n    // first move to the start of a first line\n    segment = g.Path.createSegment('M', lines[0].start);\n    path.appendSegment(segment);\n\n    // make a paths from lines\n    util.toArray(lines).forEach(function(line, index) {\n\n        if (line.isJump) {\n            var angle, diff;\n\n            var control1, control2;\n\n            if (jumpType === 'arc') { // approximates semicircle with 2 curves\n                angle = -90;\n                // determine rotation of arc based on difference between points\n                diff = line.start.difference(line.end);\n                // make sure the arc always points up (or right)\n                var xAxisRotate = Number((diff.x < 0) || (diff.x === 0 && diff.y < 0));\n                if (xAxisRotate) angle += 180;\n\n                var midpoint = line.midpoint();\n                var centerLine = new g.Line(midpoint, line.end).rotate(midpoint, angle);\n\n                var halfLine;\n\n                // first half\n                halfLine = new g.Line(line.start, midpoint);\n\n                control1 = halfLine.pointAt(2 / 3).rotate(line.start, angle);\n                control2 = centerLine.pointAt(1 / 3).rotate(centerLine.end, -angle);\n\n                segment = g.Path.createSegment('C', control1, control2, centerLine.end);\n                path.appendSegment(segment);\n\n                // second half\n                halfLine = new g.Line(midpoint, line.end);\n\n                control1 = centerLine.pointAt(1 / 3).rotate(centerLine.end, angle);\n                control2 = halfLine.pointAt(1 / 3).rotate(line.end, -angle);\n\n                segment = g.Path.createSegment('C', control1, control2, line.end);\n                path.appendSegment(segment);\n\n            } else if (jumpType === 'gap') {\n                segment = g.Path.createSegment('M', line.end);\n                path.appendSegment(segment);\n\n            } else if (jumpType === 'cubic') { // approximates semicircle with 1 curve\n                angle = line.start.theta(line.end);\n\n                var xOffset = jumpSize * 0.6;\n                var yOffset = jumpSize * 1.35;\n\n                // determine rotation of arc based on difference between points\n                diff = line.start.difference(line.end);\n                // make sure the arc always points up (or right)\n                xAxisRotate = Number((diff.x < 0) || (diff.x === 0 && diff.y < 0));\n                if (xAxisRotate) yOffset *= -1;\n\n                control1 = g.Point(line.start.x + xOffset, line.start.y + yOffset).rotate(line.start, angle);\n                control2 = g.Point(line.end.x - xOffset, line.end.y + yOffset).rotate(line.end, angle);\n\n                segment = g.Path.createSegment('C', control1, control2, line.end);\n                path.appendSegment(segment);\n            }\n\n        } else {\n            var nextLine = lines[index + 1];\n            if (radius == 0 || !nextLine || nextLine.isJump) {\n                segment = g.Path.createSegment('L', line.end);\n                path.appendSegment(segment);\n            } else {\n                buildRoundedSegment(radius, path, line.end, line.start, nextLine.end);\n            }\n        }\n    });\n\n    return path;\n}\n\nfunction buildRoundedSegment(offset, path, curr, prev, next) {\n    var prevDistance = curr.distance(prev) / 2;\n    var nextDistance = curr.distance(next) / 2;\n\n    var startMove = -Math.min(offset, prevDistance);\n    var endMove = -Math.min(offset, nextDistance);\n\n    var roundedStart = curr.clone().move(prev, startMove).round();\n    var roundedEnd = curr.clone().move(next, endMove).round();\n\n    var control1 = new g.Point((_13 * roundedStart.x) + (_23 * curr.x), (_23 * curr.y) + (_13 * roundedStart.y));\n    var control2 = new g.Point((_13 * roundedEnd.x) + (_23 * curr.x), (_23 * curr.y) + (_13 * roundedEnd.y));\n\n    var segment;\n    segment = g.Path.createSegment('L', roundedStart);\n    path.appendSegment(segment);\n\n    segment = g.Path.createSegment('C', control1, control2, roundedEnd);\n    path.appendSegment(segment);\n}\n\n/**\n * Actual connector function that will be run on every update.\n * @param {g.point} sourcePoint start point of this link\n * @param {g.point} targetPoint end point of this link\n * @param {g.point[]} route of this link\n * @param {object} opt options\n * @property {number} size optional size of a jump arc\n * @return {string} created `D` attribute of SVG path\n */\nexport const jumpover = function(sourcePoint, targetPoint, route, opt) { // eslint-disable-line max-params\n\n    setupUpdating(this);\n\n    var raw = opt.raw;\n    var jumpSize = opt.size || JUMP_SIZE;\n    var jumpType = opt.jump && ('' + opt.jump).toLowerCase();\n    var radius = opt.radius || RADIUS;\n    var ignoreConnectors = opt.ignoreConnectors || IGNORED_CONNECTORS;\n\n    // grab the first jump type as a default if specified one is invalid\n    if (JUMP_TYPES.indexOf(jumpType) === -1) {\n        jumpType = JUMP_TYPES[0];\n    }\n\n    var paper = this.paper;\n    var graph = paper.model;\n    var allLinks = graph.getLinks();\n\n    // there is just one link, draw it directly\n    if (allLinks.length === 1) {\n        return buildPath(\n            createLines(sourcePoint, targetPoint, route),\n            jumpSize, jumpType, radius\n        );\n    }\n\n    var thisModel = this.model;\n    var thisIndex = allLinks.indexOf(thisModel);\n    var defaultConnector = paper.options.defaultConnector || {};\n\n    // not all links are meant to be jumped over.\n    var links = allLinks.filter(function(link, idx) {\n\n        var connector = link.get('connector') || defaultConnector;\n\n        // avoid jumping over links with connector type listed in `ignored connectors`.\n        if (util.toArray(ignoreConnectors).includes(connector.name)) {\n            return false;\n        }\n        // filter out links that are above this one and  have the same connector type\n        // otherwise there would double hoops for each intersection\n        if (idx > thisIndex) {\n            return connector.name !== 'jumpover';\n        }\n        return true;\n    });\n\n    // find views for all links\n    var linkViews = links.map(function(link) {\n        return paper.findViewByModel(link);\n    });\n\n    // create lines for this link\n    var thisLines = createLines(\n        sourcePoint,\n        targetPoint,\n        route\n    );\n\n    // create lines for all other links\n    var linkLines = linkViews.map(function(linkView) {\n        if (linkView == null) {\n            return [];\n        }\n        if (linkView === this) {\n            return thisLines;\n        }\n        return createLines(\n            linkView.sourcePoint,\n            linkView.targetPoint,\n            linkView.route\n        );\n    }, this);\n\n    // transform lines for this link by splitting with jump lines at\n    // points of intersection with other links\n    var jumpingLines = thisLines.reduce(function(resultLines, thisLine) {\n        // iterate all links and grab the intersections with this line\n        // these are then sorted by distance so the line can be split more easily\n        var intersections = links.reduce(function(res, link, i) {\n            // don't intersection with itself\n            if (link !== thisModel) {\n\n                const linkLinesToTest = linkLines[i].slice();\n                const overlapIndex = linkLinesToTest.findIndex((line) => overlapExists(thisLine, line));\n\n                // Overlap occurs and the end point of one segment lies on thisLine\n                if (overlapIndex > -1 && thisLine.containsPoint(linkLinesToTest[overlapIndex].end)) {\n                    // Remove the next segment because there will never be a jump\n                    linkLinesToTest.splice(overlapIndex + 1, 1);\n                } \n                const lineIntersections = findLineIntersections(thisLine, linkLinesToTest);\n                res.push.apply(res, lineIntersections);\n            }\n            return res;\n        }, []).sort(function(a, b) {\n            return sortPoints(thisLine.start, a) - sortPoints(thisLine.start, b);\n        });\n\n        if (intersections.length > 0) {\n            // split the line based on found intersection points\n            resultLines.push.apply(resultLines, createJumps(thisLine, intersections, jumpSize));\n        } else {\n            // without any intersection the line goes uninterrupted\n            resultLines.push(thisLine);\n        }\n        return resultLines;\n    }, []);\n\n    var path = buildPath(jumpingLines, jumpSize, jumpType, radius);\n    return (raw) ? path : path.serialize();\n};\n","import { straight } from './straight.mjs';\n\nexport const normal = function(sourcePoint, targetPoint, route = [], opt = {}) {\n\n    const { raw } = opt;\n    const localOpt = {\n        cornerType: 'point',\n        raw\n    };\n\n    return straight(sourcePoint, targetPoint, route, localOpt);\n};\n","import { straight } from './straight.mjs';\n\nconst CORNER_RADIUS = 10;\nconst PRECISION = 0;\n\nexport const rounded = function(sourcePoint, targetPoint, route = [], opt = {}) {\n\n    const { radius = CORNER_RADIUS, raw } = opt;\n    const localOpt = {\n        cornerType: 'cubic',\n        cornerRadius: radius,\n        precision: PRECISION,\n        raw\n    };\n\n    return straight(sourcePoint, targetPoint, route, localOpt);\n};\n","import * as g from '../g/index.mjs';\n\nexport const smooth = function(sourcePoint, targetPoint, route, opt) {\n\n    var raw = opt && opt.raw;\n    var path;\n\n    if (route && route.length !== 0) {\n\n        var points = [sourcePoint].concat(route).concat([targetPoint]);\n        var curves = g.Curve.throughPoints(points);\n\n        path = new g.Path(curves);\n\n    } else {\n        // if we have no route, use a default cubic bezier curve\n        // cubic bezier requires two control points\n        // the control points have `x` midway between source and target\n        // this produces an S-like curve\n\n        path = new g.Path();\n\n        var segment;\n\n        segment = g.Path.createSegment('M', sourcePoint);\n        path.appendSegment(segment);\n\n        if ((Math.abs(sourcePoint.x - targetPoint.x)) >= (Math.abs(sourcePoint.y - targetPoint.y))) {\n            var controlPointX = (sourcePoint.x + targetPoint.x) / 2;\n\n            segment = g.Path.createSegment('C', controlPointX, sourcePoint.y, controlPointX, targetPoint.y, targetPoint.x, targetPoint.y);\n            path.appendSegment(segment);\n\n        } else {\n            var controlPointY = (sourcePoint.y + targetPoint.y) / 2;\n\n            segment = g.Path.createSegment('C', sourcePoint.x, controlPointY, targetPoint.x, controlPointY, targetPoint.x, targetPoint.y);\n            path.appendSegment(segment);\n\n        }\n    }\n\n    return (raw) ? path : path.serialize();\n};\n","import { Path, Point, Curve } from '../g/index.mjs';\n\nconst Directions = {\n    AUTO: 'auto',\n    HORIZONTAL: 'horizontal',\n    VERTICAL: 'vertical',\n    CLOSEST_POINT: 'closest-point',\n    OUTWARDS: 'outwards'\n};\n\nconst TangentDirections = {\n    UP: 'up',\n    DOWN: 'down',\n    LEFT: 'left',\n    RIGHT: 'right',\n    AUTO: 'auto',\n    CLOSEST_POINT: 'closest-point',\n    OUTWARDS: 'outwards'\n};\n\nexport const curve = function(sourcePoint, targetPoint, route = [], opt = {}, linkView) {\n    const raw = Boolean(opt.raw);\n    // distanceCoefficient - a coefficient of the tangent vector length relative to the distance between points.\n    // angleTangentCoefficient - a coefficient of the end tangents length in the case of angles larger than 45 degrees.\n    // tension - a Catmull-Rom curve tension parameter.\n    // sourceTangent - a tangent vector along the curve at the sourcePoint.\n    // sourceDirection - a unit direction vector along the curve at the sourcePoint.\n    // targetTangent - a tangent vector along the curve at the targetPoint.\n    // targetDirection - a unit direction vector along the curve at the targetPoint.\n    // precision - a rounding precision for path values.\n    const { direction = Directions.AUTO, precision = 3 } = opt;\n    const options = {\n        coeff: opt.distanceCoefficient || 0.6,\n        angleTangentCoefficient: opt.angleTangentCoefficient || 80,\n        tau: opt.tension || 0.5,\n        sourceTangent: opt.sourceTangent ? new Point(opt.sourceTangent) : null,\n        targetTangent: opt.targetTangent ? new Point(opt.targetTangent) : null,\n        rotate: Boolean(opt.rotate)\n    };\n    if (typeof opt.sourceDirection === 'string')\n        options.sourceDirection = opt.sourceDirection;\n    else if (typeof opt.sourceDirection === 'number')\n        options.sourceDirection = new Point(1, 0).rotate(null, opt.sourceDirection);\n    else\n        options.sourceDirection = opt.sourceDirection ? new Point(opt.sourceDirection).normalize() : null;\n\n    if (typeof opt.targetDirection === 'string')\n        options.targetDirection = opt.targetDirection;\n    else if (typeof opt.targetDirection === 'number')\n        options.targetDirection = new Point(1, 0).rotate(null, opt.targetDirection);\n    else\n        options.targetDirection = opt.targetDirection ? new Point(opt.targetDirection).normalize() : null;\n\n    const completeRoute = [sourcePoint, ...route, targetPoint].map(p => new Point(p));\n\n    // The calculation of a sourceTangent\n    let sourceTangent;\n    if (options.sourceTangent) {\n        sourceTangent = options.sourceTangent;\n    } else {\n        const sourceDirection = getSourceTangentDirection(linkView, completeRoute, direction, options);\n        const tangentLength = completeRoute[0].distance(completeRoute[1]) * options.coeff;\n        const pointsVector = completeRoute[1].difference(completeRoute[0]).normalize();\n        const angle = angleBetweenVectors(sourceDirection, pointsVector);\n        if (angle > Math.PI / 4) {\n            const updatedLength = tangentLength + (angle - Math.PI / 4) * options.angleTangentCoefficient;\n            sourceTangent = sourceDirection.clone().scale(updatedLength, updatedLength);\n        } else {\n            sourceTangent = sourceDirection.clone().scale(tangentLength, tangentLength);\n        }\n    }\n\n    // The calculation of a targetTangent\n    let targetTangent;\n    if (options.targetTangent) {\n        targetTangent = options.targetTangent;\n    } else {\n        const targetDirection = getTargetTangentDirection(linkView, completeRoute, direction, options);\n        const last = completeRoute.length - 1;\n        const tangentLength = completeRoute[last - 1].distance(completeRoute[last]) * options.coeff;\n        const pointsVector = completeRoute[last - 1].difference(completeRoute[last]).normalize();\n        const angle = angleBetweenVectors(targetDirection, pointsVector);\n        if (angle > Math.PI / 4) {\n            const updatedLength = tangentLength + (angle - Math.PI / 4) * options.angleTangentCoefficient;\n            targetTangent = targetDirection.clone().scale(updatedLength, updatedLength);\n        } else {\n            targetTangent = targetDirection.clone().scale(tangentLength, tangentLength);\n        }\n    }\n\n    const catmullRomCurves = createCatmullRomCurves(completeRoute, sourceTangent, targetTangent, options);\n    const bezierCurves = catmullRomCurves.map(curve => catmullRomToBezier(curve, options));\n    const path = new Path(bezierCurves).round(precision);\n\n    return (raw) ? path : path.serialize();\n};\ncurve.Directions = Directions;\ncurve.TangentDirections = TangentDirections;\n\nfunction getHorizontalSourceDirection(linkView, route, options) {\n    const { sourceBBox } = linkView;\n\n    let sourceSide;\n    let rotation;\n    if (!linkView.sourceView) {\n        if (sourceBBox.x > route[1].x)\n            sourceSide = 'right';\n        else\n            sourceSide = 'left';\n    } else {\n        rotation = linkView.sourceView.model.angle();\n        if (options.rotate && rotation) {\n            const unrotatedBBox = linkView.sourceView.getNodeUnrotatedBBox(linkView.sourceView.el);\n            const sourcePoint = route[0].clone();\n            sourcePoint.rotate(sourceBBox.center(), rotation);\n            sourceSide = unrotatedBBox.sideNearestToPoint(sourcePoint);\n        } else {\n            sourceSide = sourceBBox.sideNearestToPoint(route[0]);\n        }\n    }\n\n    let direction;\n    switch (sourceSide) {\n        case 'left':\n            direction = new Point(-1, 0);\n            break;\n        case 'right':\n        default:\n            direction = new Point(1, 0);\n            break;\n    }\n\n    if (options.rotate && rotation) {\n        direction.rotate(null, -rotation);\n    }\n\n    return direction;\n}\n\nfunction getHorizontalTargetDirection(linkView, route, options) {\n    const { targetBBox } = linkView;\n\n    let targetSide;\n    let rotation;\n    if (!linkView.targetView) {\n        if (targetBBox.x > route[route.length - 2].x)\n            targetSide = 'left';\n        else\n            targetSide = 'right';\n    } else {\n        rotation = linkView.targetView.model.angle();\n        if (options.rotate && rotation) {\n            const unrotatedBBox = linkView.targetView.getNodeUnrotatedBBox(linkView.targetView.el);\n            const targetPoint = route[route.length - 1].clone();\n            targetPoint.rotate(targetBBox.center(), rotation);\n            targetSide = unrotatedBBox.sideNearestToPoint(targetPoint);\n        } else {\n            targetSide = targetBBox.sideNearestToPoint(route[route.length - 1]);\n        }\n    }\n\n    let direction;\n    switch (targetSide) {\n        case 'left':\n            direction = new Point(-1, 0);\n            break;\n        case 'right':\n        default:\n            direction = new Point(1, 0);\n            break;\n    }\n\n    if (options.rotate && rotation) {\n        direction.rotate(null, -rotation);\n    }\n\n    return direction;\n}\n\nfunction getVerticalSourceDirection(linkView, route, options) {\n    const { sourceBBox } = linkView;\n\n    let sourceSide;\n    let rotation;\n    if (!linkView.sourceView) {\n        if (sourceBBox.y > route[1].y)\n            sourceSide = 'bottom';\n        else\n            sourceSide = 'top';\n    } else {\n        rotation = linkView.sourceView.model.angle();\n        if (options.rotate && rotation) {\n            const unrotatedBBox = linkView.sourceView.getNodeUnrotatedBBox(linkView.sourceView.el);\n            const sourcePoint = route[0].clone();\n            sourcePoint.rotate(sourceBBox.center(), rotation);\n            sourceSide = unrotatedBBox.sideNearestToPoint(sourcePoint);\n        } else {\n            sourceSide = sourceBBox.sideNearestToPoint(route[0]);\n        }\n    }\n\n    let direction;\n    switch (sourceSide) {\n        case 'top':\n            direction = new Point(0, -1);\n            break;\n        case 'bottom':\n        default:\n            direction = new Point(0, 1);\n            break;\n    }\n\n    if (options.rotate && rotation) {\n        direction.rotate(null, -rotation);\n    }\n\n    return direction;\n}\n\nfunction getVerticalTargetDirection(linkView, route, options) {\n    const { targetBBox } = linkView;\n\n    let targetSide;\n    let rotation;\n    if (!linkView.targetView) {\n        if (targetBBox.y > route[route.length - 2].y)\n            targetSide = 'top';\n        else\n            targetSide = 'bottom';\n    } else {\n        rotation = linkView.targetView.model.angle();\n        if (options.rotate && rotation) {\n            const unrotatedBBox = linkView.targetView.getNodeUnrotatedBBox(linkView.targetView.el);\n            const targetPoint = route[route.length - 1].clone();\n            targetPoint.rotate(targetBBox.center(), rotation);\n            targetSide = unrotatedBBox.sideNearestToPoint(targetPoint);\n        } else {\n            targetSide = targetBBox.sideNearestToPoint(route[route.length - 1]);\n        }\n    }\n\n\n    let direction;\n    switch (targetSide) {\n        case 'top':\n            direction = new Point(0, -1);\n            break;\n        case 'bottom':\n        default:\n            direction = new Point(0, 1);\n            break;\n    }\n\n    if (options.rotate && rotation) {\n        direction.rotate(null, -rotation);\n    }\n\n    return direction;\n}\n\nfunction getAutoSourceDirection(linkView, route, options) {\n    const { sourceBBox } = linkView;\n\n    let sourceSide;\n    let rotation;\n    if (!linkView.sourceView) {\n        sourceSide = sourceBBox.sideNearestToPoint(route[1]);\n    } else {\n        rotation = linkView.sourceView.model.angle();\n        if (options.rotate && rotation) {\n            const unrotatedBBox = linkView.sourceView.getNodeUnrotatedBBox(linkView.sourceView.el);\n            const sourcePoint = route[0].clone();\n            sourcePoint.rotate(sourceBBox.center(), rotation);\n            sourceSide = unrotatedBBox.sideNearestToPoint(sourcePoint);\n        } else {\n            sourceSide = sourceBBox.sideNearestToPoint(route[0]);\n        }\n    }\n\n    let direction;\n    switch (sourceSide) {\n        case 'top':\n            direction = new Point(0, -1);\n            break;\n        case 'bottom':\n            direction = new Point(0, 1);\n            break;\n        case 'right':\n            direction = new Point(1, 0);\n            break;\n        case 'left':\n            direction = new Point(-1, 0);\n            break;\n    }\n\n    if (options.rotate && rotation) {\n        direction.rotate(null, -rotation);\n    }\n\n    return direction;\n}\n\nfunction getAutoTargetDirection(linkView, route, options) {\n    const { targetBBox } = linkView;\n\n    let targetSide;\n    let rotation;\n    if (!linkView.targetView) {\n        targetSide = targetBBox.sideNearestToPoint(route[route.length - 2]);\n    } else {\n        rotation = linkView.targetView.model.angle();\n        if (options.rotate && rotation) {\n            const unrotatedBBox = linkView.targetView.getNodeUnrotatedBBox(linkView.targetView.el);\n            const targetPoint = route[route.length - 1].clone();\n            targetPoint.rotate(targetBBox.center(), rotation);\n            targetSide = unrotatedBBox.sideNearestToPoint(targetPoint);\n        } else {\n            targetSide = targetBBox.sideNearestToPoint(route[route.length - 1]);\n        }\n    }\n\n    let direction;\n    switch (targetSide) {\n        case 'top':\n            direction = new Point(0, -1);\n            break;\n        case 'bottom':\n            direction = new Point(0, 1);\n            break;\n        case 'right':\n            direction = new Point(1, 0);\n            break;\n        case 'left':\n            direction = new Point(-1, 0);\n            break;\n    }\n\n    if (options.rotate && rotation) {\n        direction.rotate(null, -rotation);\n    }\n\n    return direction;\n}\n\nfunction getClosestPointSourceDirection(linkView, route, options) {\n    return route[1].difference(route[0]).normalize();\n}\n\nfunction getClosestPointTargetDirection(linkView, route, options) {\n    const last = route.length - 1;\n    return route[last - 1].difference(route[last]).normalize();\n}\n\nfunction getOutwardsSourceDirection(linkView, route, options) {\n    const { sourceBBox } = linkView;\n    const sourceCenter = sourceBBox.center();\n    return route[0].difference(sourceCenter).normalize();\n}\n\nfunction getOutwardsTargetDirection(linkView, route, options) {\n    const { targetBBox } = linkView;\n    const targetCenter = targetBBox.center();\n    return route[route.length - 1].difference(targetCenter).normalize();\n}\n\nfunction getSourceTangentDirection(linkView, route, direction, options) {\n    if (options.sourceDirection) {\n        switch (options.sourceDirection) {\n            case TangentDirections.UP:\n                return new Point(0, -1);\n            case TangentDirections.DOWN:\n                return new Point(0, 1);\n            case TangentDirections.LEFT:\n                return new Point(-1, 0);\n            case TangentDirections.RIGHT:\n                return new Point(1, 0);\n            case TangentDirections.AUTO:\n                return getAutoSourceDirection(linkView, route, options);\n            case TangentDirections.CLOSEST_POINT:\n                return getClosestPointSourceDirection(linkView, route, options);\n            case TangentDirections.OUTWARDS:\n                return getOutwardsSourceDirection(linkView, route, options);\n            default:\n                return options.sourceDirection;\n        }\n    }\n\n    switch (direction) {\n        case Directions.HORIZONTAL:\n            return getHorizontalSourceDirection(linkView, route, options);\n        case Directions.VERTICAL:\n            return getVerticalSourceDirection(linkView, route, options);\n        case Directions.CLOSEST_POINT:\n            return getClosestPointSourceDirection(linkView, route, options);\n        case Directions.OUTWARDS:\n            return getOutwardsSourceDirection(linkView, route, options);\n        case Directions.AUTO:\n        default:\n            return getAutoSourceDirection(linkView, route, options);\n    }\n}\n\nfunction getTargetTangentDirection(linkView, route, direction, options) {\n    if (options.targetDirection) {\n        switch (options.targetDirection) {\n            case TangentDirections.UP:\n                return new Point(0, -1);\n            case TangentDirections.DOWN:\n                return new Point(0, 1);\n            case TangentDirections.LEFT:\n                return new Point(-1, 0);\n            case TangentDirections.RIGHT:\n                return new Point(0, 1);\n            case TangentDirections.AUTO:\n                return getAutoTargetDirection(linkView, route, options);\n            case TangentDirections.CLOSEST_POINT:\n                return getClosestPointTargetDirection(linkView, route, options);\n            case TangentDirections.OUTWARDS:\n                return getOutwardsTargetDirection(linkView, route, options);\n            default:\n                return options.targetDirection;\n        }\n    }\n\n    switch (direction) {\n        case Directions.HORIZONTAL:\n            return getHorizontalTargetDirection(linkView, route, options);\n        case Directions.VERTICAL:\n            return getVerticalTargetDirection(linkView, route, options);\n        case Directions.CLOSEST_POINT:\n            return getClosestPointTargetDirection(linkView, route, options);\n        case Directions.OUTWARDS:\n            return getOutwardsTargetDirection(linkView, route, options);\n        case Directions.AUTO:\n        default:\n            return getAutoTargetDirection(linkView, route, options);\n    }\n}\n\nfunction rotateVector(vector, angle) {\n    const cos = Math.cos(angle);\n    const sin = Math.sin(angle);\n    const x = cos * vector.x - sin * vector.y;\n    const y = sin * vector.x + cos * vector.y;\n    vector.x = x;\n    vector.y = y;\n}\n\nfunction angleBetweenVectors(v1, v2) {\n    let cos = v1.dot(v2) / (v1.magnitude() * v2.magnitude());\n    if (cos < -1) cos = -1;\n    if (cos > 1) cos = 1;\n    return Math.acos(cos);\n}\n\nfunction determinant(v1, v2) {\n    return v1.x * v2.y - v1.y * v2.x;\n}\n\nfunction createCatmullRomCurves(points, sourceTangent, targetTangent, options) {\n    const { tau, coeff } = options;\n    const distances = [];\n    const tangents = [];\n    const catmullRomCurves = [];\n    const n = points.length - 1;\n\n    for (let i = 0; i < n; i++) {\n        distances[i] = points[i].distance(points[i + 1]);\n    }\n\n    tangents[0] = sourceTangent;\n    tangents[n] = targetTangent;\n\n    // The calculation of tangents of vertices\n    for (let i = 1; i < n; i++) {\n        let tpPrev;\n        let tpNext;\n        if (i === 1) {\n            tpPrev = points[i - 1].clone().offset(tangents[i - 1].x, tangents[i - 1].y);\n        } else {\n            tpPrev = points[i - 1].clone();\n        }\n        if (i === n - 1) {\n            tpNext = points[i + 1].clone().offset(tangents[i + 1].x, tangents[i + 1].y);\n        } else {\n            tpNext = points[i + 1].clone();\n        }\n        const v1 = tpPrev.difference(points[i]).normalize();\n        const v2 = tpNext.difference(points[i]).normalize();\n        const vAngle = angleBetweenVectors(v1, v2);\n\n        let rot = (Math.PI - vAngle) / 2;\n        let t;\n        const vectorDeterminant = determinant(v1, v2);\n        let pointsDeterminant;\n        pointsDeterminant = determinant(points[i].difference(points[i + 1]), points[i].difference(points[i - 1]));\n        if (vectorDeterminant < 0) {\n            rot = -rot;\n        }\n        if ((vAngle < Math.PI / 2) && ((rot < 0 && pointsDeterminant < 0) || (rot > 0 && pointsDeterminant > 0))) {\n            rot = rot - Math.PI;\n        }\n        t = v2.clone();\n        rotateVector(t, rot);\n\n        const t1 = t.clone();\n        const t2 = t.clone();\n        const scaleFactor1 = distances[i - 1] * coeff;\n        const scaleFactor2 = distances[i] * coeff;\n        t1.scale(scaleFactor1, scaleFactor1);\n        t2.scale(scaleFactor2, scaleFactor2);\n\n        tangents[i] = [t1, t2];\n    }\n\n    // The building of a Catmull-Rom curve based of tangents of points\n    for (let i = 0; i < n; i++) {\n        let p0;\n        let p3;\n        if (i === 0) {\n            p0 = points[i + 1].difference(tangents[i].x / tau, tangents[i].y / tau);\n        } else {\n            p0 = points[i + 1].difference(tangents[i][1].x / tau, tangents[i][1].y / tau);\n        }\n        if (i === n - 1) {\n            p3 = points[i].clone().offset(tangents[i + 1].x / tau, tangents[i + 1].y / tau);\n        } else {\n            p3 = points[i].difference(tangents[i + 1][0].x / tau, tangents[i + 1][0].y / tau);\n        }\n\n        catmullRomCurves[i] = [p0, points[i], points[i + 1], p3];\n    }\n    return catmullRomCurves;\n}\n\n// The function to convert Catmull-Rom curve to Bezier curve using the tension (tau)\nfunction catmullRomToBezier(points, options) {\n    const { tau } = options;\n\n    const bcp1 = new Point();\n    bcp1.x = points[1].x + (points[2].x - points[0].x) / (6 * tau);\n    bcp1.y = points[1].y + (points[2].y - points[0].y) / (6 * tau);\n\n    const bcp2 = new Point();\n    bcp2.x = points[2].x + (points[3].x - points[1].x) / (6 * tau);\n    bcp2.y = points[2].y + (points[3].y - points[1].y) / (6 * tau);\n    return new Curve(\n        points[1],\n        bcp1,\n        bcp2,\n        points[2]\n    );\n}\n","import { CellView } from './CellView.mjs';\nimport { Link } from './Link.mjs';\nimport V from '../V/index.mjs';\nimport { addClassNamePrefix, removeClassNamePrefix, merge, template, assign, toArray, isObject, isFunction, clone, isPercentage, result, isEqual } from '../util/index.mjs';\nimport { Point, Line, Path, normalizeAngle, Rect, Polyline } from '../g/index.mjs';\nimport * as routers from '../routers/index.mjs';\nimport * as connectors from '../connectors/index.mjs';\nimport $ from 'jquery';\n\nconst Flags = {\n    TOOLS: CellView.Flags.TOOLS,\n    RENDER: 'RENDER',\n    UPDATE: 'UPDATE',\n    LEGACY_TOOLS: 'LEGACY_TOOLS',\n    LABELS: 'LABELS',\n    VERTICES: 'VERTICES',\n    SOURCE: 'SOURCE',\n    TARGET: 'TARGET',\n    CONNECTOR: 'CONNECTOR'\n};\n\n// Link base view and controller.\n// ----------------------------------------\n\nexport const LinkView = CellView.extend({\n\n    className: function() {\n\n        var classNames = CellView.prototype.className.apply(this).split(' ');\n\n        classNames.push('link');\n\n        return classNames.join(' ');\n    },\n\n    options: {\n\n        shortLinkLength: 105,\n        doubleLinkTools: false,\n        longLinkLength: 155,\n        linkToolsOffset: 40,\n        doubleLinkToolsOffset: 65,\n        sampleInterval: 50\n    },\n\n    _labelCache: null,\n    _labelSelectors: null,\n    _markerCache: null,\n    _V: null,\n    _dragData: null, // deprecated\n\n    metrics: null,\n    decimalsRounding: 2,\n\n    initialize: function() {\n\n        CellView.prototype.initialize.apply(this, arguments);\n\n        // `_.labelCache` is a mapping of indexes of labels in the `this.get('labels')` array to\n        // `<g class=\"label\">` nodes wrapped by Vectorizer. This allows for quick access to the\n        // nodes in `updateLabelPosition()` in order to update the label positions.\n        this._labelCache = {};\n\n        // a cache of label selectors\n        this._labelSelectors = {};\n\n        // keeps markers bboxes and positions again for quicker access\n        this._markerCache = {};\n\n        // cache of default markup nodes\n        this._V = {};\n\n        // connection path metrics\n        this.cleanNodesCache();\n    },\n\n    presentationAttributes: {\n        markup: [Flags.RENDER],\n        attrs: [Flags.UPDATE],\n        router: [Flags.UPDATE],\n        connector: [Flags.CONNECTOR],\n        smooth: [Flags.UPDATE],\n        manhattan: [Flags.UPDATE],\n        toolMarkup: [Flags.LEGACY_TOOLS],\n        labels: [Flags.LABELS],\n        labelMarkup: [Flags.LABELS],\n        vertices: [Flags.VERTICES, Flags.UPDATE],\n        vertexMarkup: [Flags.VERTICES],\n        source: [Flags.SOURCE, Flags.UPDATE],\n        target: [Flags.TARGET, Flags.UPDATE]\n    },\n\n    initFlag: [Flags.RENDER, Flags.SOURCE, Flags.TARGET, Flags.TOOLS],\n\n    UPDATE_PRIORITY: 1,\n\n    confirmUpdate: function(flags, opt) {\n\n        opt || (opt = {});\n\n        if (this.hasFlag(flags, Flags.SOURCE)) {\n            if (!this.updateEndProperties('source')) return flags;\n            flags = this.removeFlag(flags, Flags.SOURCE);\n        }\n\n        if (this.hasFlag(flags, Flags.TARGET)) {\n            if (!this.updateEndProperties('target')) return flags;\n            flags = this.removeFlag(flags, Flags.TARGET);\n        }\n\n        const { paper, sourceView, targetView } = this;\n        if (paper && ((sourceView && !paper.isViewMounted(sourceView)) || (targetView && !paper.isViewMounted(targetView)))) {\n            // Wait for the sourceView and targetView to be rendered\n            return flags;\n        }\n\n        if (this.hasFlag(flags, Flags.RENDER)) {\n            this.render();\n            this.updateHighlighters(true);\n            this.updateTools(opt);\n            flags = this.removeFlag(flags, [Flags.RENDER, Flags.UPDATE, Flags.VERTICES, Flags.LABELS, Flags.TOOLS, Flags.LEGACY_TOOLS, Flags.CONNECTOR]);\n            return flags;\n        }\n\n        let updateHighlighters = false;\n\n        if (this.hasFlag(flags, Flags.VERTICES)) {\n            this.renderVertexMarkers();\n            flags = this.removeFlag(flags, Flags.VERTICES);\n        }\n\n        const { model } = this;\n        const { attributes } = model;\n        let updateLabels = this.hasFlag(flags, Flags.LABELS);\n        let updateLegacyTools = this.hasFlag(flags, Flags.LEGACY_TOOLS);\n\n        if (updateLabels) {\n            this.onLabelsChange(model, attributes.labels, opt);\n            flags = this.removeFlag(flags, Flags.LABELS);\n            updateHighlighters = true;\n        }\n\n        if (updateLegacyTools) {\n            this.renderTools();\n            flags = this.removeFlag(flags, Flags.LEGACY_TOOLS);\n        }\n\n        const updateAll = this.hasFlag(flags, Flags.UPDATE);\n        const updateConnector = this.hasFlag(flags, Flags.CONNECTOR);\n        if (updateAll || updateConnector) {\n            if (!updateAll) {\n                // Keep the current route and update the geometry\n                this.updatePath();\n                this.updateDOM();\n            } else if (opt.translateBy && model.isRelationshipEmbeddedIn(opt.translateBy)) {\n                // The link is being translated by an ancestor that will\n                // shift source point, target point and all vertices\n                // by an equal distance.\n                this.translate(opt.tx, opt.ty);\n            } else {\n                this.update();\n            }\n            this.updateTools(opt);\n            flags = this.removeFlag(flags, [Flags.UPDATE, Flags.TOOLS, Flags.CONNECTOR]);\n            updateLabels = false;\n            updateLegacyTools = false;\n            updateHighlighters = true;\n        }\n\n        if (updateLabels) {\n            this.updateLabelPositions();\n        }\n\n        if (updateLegacyTools) {\n            this.updateToolsPosition();\n        }\n\n        if (updateHighlighters) {\n            this.updateHighlighters();\n        }\n\n        if (this.hasFlag(flags, Flags.TOOLS)) {\n            this.updateTools(opt);\n            flags = this.removeFlag(flags, Flags.TOOLS);\n        }\n\n        return flags;\n    },\n\n    requestConnectionUpdate: function(opt) {\n        this.requestUpdate(this.getFlag(Flags.UPDATE), opt);\n    },\n\n    isLabelsRenderRequired: function(opt = {}) {\n\n        const previousLabels = this.model.previous('labels');\n        if (!previousLabels) return true;\n\n        // Here is an optimization for cases when we know, that change does\n        // not require re-rendering of all labels.\n        if (('propertyPathArray' in opt) && ('propertyValue' in opt)) {\n            // The label is setting by `prop()` method\n            var pathArray = opt.propertyPathArray || [];\n            var pathLength = pathArray.length;\n            if (pathLength > 1) {\n                // We are changing a single label here e.g. 'labels/0/position'\n                var labelExists = !!previousLabels[pathArray[1]];\n                if (labelExists) {\n                    if (pathLength === 2) {\n                        // We are changing the entire label. Need to check if the\n                        // markup is also being changed.\n                        return ('markup' in Object(opt.propertyValue));\n                    } else if (pathArray[2] !== 'markup') {\n                        // We are changing a label property but not the markup\n                        return false;\n                    }\n                }\n            }\n        }\n\n        return true;\n    },\n\n    onLabelsChange: function(_link, _labels, opt) {\n\n        // Note: this optimization works in async=false mode only\n        if (this.isLabelsRenderRequired(opt)) {\n            this.renderLabels();\n        } else {\n            this.updateLabels();\n        }\n    },\n\n    // Rendering.\n    // ----------\n\n    render: function() {\n\n        this.vel.empty();\n        this.unmountLabels();\n        this._V = {};\n        this.renderMarkup();\n        // rendering labels has to be run after the link is appended to DOM tree. (otherwise <Text> bbox\n        // returns zero values)\n        this.renderLabels();\n        this.update();\n\n        return this;\n    },\n\n    renderMarkup: function() {\n\n        var link = this.model;\n        var markup = link.get('markup') || link.markup;\n        if (!markup) throw new Error('dia.LinkView: markup required');\n        if (Array.isArray(markup)) return this.renderJSONMarkup(markup);\n        if (typeof markup === 'string') return this.renderStringMarkup(markup);\n        throw new Error('dia.LinkView: invalid markup');\n    },\n\n    renderJSONMarkup: function(markup) {\n\n        var doc = this.parseDOMJSON(markup, this.el);\n        // Selectors\n        this.selectors = doc.selectors;\n        // Fragment\n        this.vel.append(doc.fragment);\n    },\n\n    renderStringMarkup: function(markup) {\n\n        // A special markup can be given in the `properties.markup` property. This might be handy\n        // if e.g. arrowhead markers should be `<image>` elements or any other element than `<path>`s.\n        // `.connection`, `.connection-wrap`, `.marker-source` and `.marker-target` selectors\n        // of elements with special meaning though. Therefore, those classes should be preserved in any\n        // special markup passed in `properties.markup`.\n        var children = V(markup);\n        // custom markup may contain only one children\n        if (!Array.isArray(children)) children = [children];\n        // Cache all children elements for quicker access.\n        var cache = this._V; // vectorized markup;\n        for (var i = 0, n = children.length; i < n; i++) {\n            var child = children[i];\n            var className = child.attr('class');\n            if (className) {\n                // Strip the joint class name prefix, if there is one.\n                className = removeClassNamePrefix(className);\n                cache[$.camelCase(className)] = child;\n            }\n        }\n        // partial rendering\n        this.renderTools();\n        this.renderVertexMarkers();\n        this.renderArrowheadMarkers();\n        this.vel.append(children);\n    },\n\n    _getLabelMarkup: function(labelMarkup) {\n\n        if (!labelMarkup) return undefined;\n\n        if (Array.isArray(labelMarkup)) return this.parseDOMJSON(labelMarkup, null);\n        if (typeof labelMarkup === 'string') return this._getLabelStringMarkup(labelMarkup);\n        throw new Error('dia.linkView: invalid label markup');\n    },\n\n    _getLabelStringMarkup: function(labelMarkup) {\n\n        var children = V(labelMarkup);\n        var fragment = document.createDocumentFragment();\n\n        if (!Array.isArray(children)) {\n            fragment.appendChild(children.node);\n\n        } else {\n            for (var i = 0, n = children.length; i < n; i++) {\n                var currentChild = children[i].node;\n                fragment.appendChild(currentChild);\n            }\n        }\n\n        return { fragment: fragment, selectors: {}}; // no selectors\n    },\n\n    // Label markup fragment may come wrapped in <g class=\"label\" />, or not.\n    // If it doesn't, add the <g /> container here.\n    _normalizeLabelMarkup: function(markup) {\n\n        if (!markup) return undefined;\n\n        var fragment = markup.fragment;\n        if (!(markup.fragment instanceof DocumentFragment) || !markup.fragment.hasChildNodes()) throw new Error('dia.LinkView: invalid label markup.');\n\n        var vNode;\n        var childNodes = fragment.childNodes;\n\n        if ((childNodes.length > 1) || childNodes[0].nodeName.toUpperCase() !== 'G') {\n            // default markup fragment is not wrapped in <g />\n            // add a <g /> container\n            vNode = V('g').append(fragment);\n        } else {\n            vNode = V(childNodes[0]);\n        }\n\n        vNode.addClass('label');\n\n        return { node: vNode.node, selectors: markup.selectors };\n    },\n\n    renderLabels: function() {\n\n        var cache = this._V;\n        var vLabels = cache.labels;\n        var labelCache = this._labelCache = {};\n        var labelSelectors = this._labelSelectors = {};\n        var model = this.model;\n        var labels = model.attributes.labels || [];\n        var labelsCount = labels.length;\n\n        if (labelsCount === 0) {\n            if (vLabels) vLabels.remove();\n            return this;\n        }\n\n        if (vLabels) {\n            vLabels.empty();\n        }  else {\n            // there is no label container in the markup but some labels are defined\n            // add a <g class=\"labels\" /> container\n            vLabels = cache.labels = V('g').addClass('labels');\n            if (this.options.labelsLayer) {\n                vLabels.addClass(addClassNamePrefix(result(this, 'className')));\n                vLabels.attr('model-id', model.id);\n            }\n        }\n\n        for (var i = 0; i < labelsCount; i++) {\n\n            var label = labels[i];\n            var labelMarkup = this._normalizeLabelMarkup(this._getLabelMarkup(label.markup));\n            var labelNode;\n            var selectors;\n            if (labelMarkup) {\n\n                labelNode = labelMarkup.node;\n                selectors = labelMarkup.selectors;\n\n            } else {\n\n                var builtinDefaultLabel =  model._builtins.defaultLabel;\n                var builtinDefaultLabelMarkup = this._normalizeLabelMarkup(this._getLabelMarkup(builtinDefaultLabel.markup));\n                var defaultLabel = model._getDefaultLabel();\n                var defaultLabelMarkup = this._normalizeLabelMarkup(this._getLabelMarkup(defaultLabel.markup));\n                var defaultMarkup = defaultLabelMarkup || builtinDefaultLabelMarkup;\n\n                labelNode = defaultMarkup.node;\n                selectors = defaultMarkup.selectors;\n            }\n\n            labelNode.setAttribute('label-idx', i); // assign label-idx\n            vLabels.append(labelNode);\n            labelCache[i] = labelNode; // cache node for `updateLabels()` so it can just update label node positions\n\n            var rootSelector = this.selector;\n            if (selectors[rootSelector]) throw new Error('dia.LinkView: ambiguous label root selector.');\n            selectors[rootSelector] = labelNode;\n\n            labelSelectors[i] = selectors; // cache label selectors for `updateLabels()`\n        }\n        if (!vLabels.parent()) {\n            this.mountLabels();\n        }\n\n        this.updateLabels();\n\n        return this;\n    },\n\n    mountLabels: function() {\n        const { el, paper, model, _V, options } = this;\n        const { labels: vLabels } = _V;\n        if (!vLabels || !model.hasLabels()) return;\n        const { node } = vLabels;\n        if (options.labelsLayer) {\n            paper.getLayerView(options.labelsLayer).insertSortedNode(node, model.get('z'));\n        } else {\n            if (node.parentNode !== el) {\n                el.appendChild(node);\n            }\n        }\n    },\n\n    unmountLabels: function() {\n        const { options, _V } = this;\n        if (!_V) return;\n        const { labels: vLabels } = _V;\n        if (vLabels && options.labelsLayer) {\n            vLabels.remove();\n        }\n    },\n\n    findLabelNode: function(labelIndex, selector) {\n        const labelRoot = this._labelCache[labelIndex];\n        if (!labelRoot) return null;\n        const labelSelectors = this._labelSelectors[labelIndex];\n        const [node = null] = this.findBySelector(selector, labelRoot, labelSelectors);\n        return node;\n    },\n\n\n    // merge default label attrs into label attrs (or use built-in default label attrs if neither is provided)\n    // keep `undefined` or `null` because `{}` means something else\n    _mergeLabelAttrs: function(hasCustomMarkup, labelAttrs, defaultLabelAttrs, builtinDefaultLabelAttrs) {\n\n        if (labelAttrs === null) return null;\n        if (labelAttrs === undefined) {\n\n            if (defaultLabelAttrs === null) return null;\n            if (defaultLabelAttrs === undefined) {\n\n                if (hasCustomMarkup) return undefined;\n                return builtinDefaultLabelAttrs;\n            }\n\n            if (hasCustomMarkup) return defaultLabelAttrs;\n            return merge({}, builtinDefaultLabelAttrs, defaultLabelAttrs);\n        }\n\n        if (hasCustomMarkup) return merge({}, defaultLabelAttrs, labelAttrs);\n        return merge({}, builtinDefaultLabelAttrs, defaultLabelAttrs, labelAttrs);\n    },\n\n    // merge default label size into label size (no built-in default)\n    // keep `undefined` or `null` because `{}` means something else\n    _mergeLabelSize: function(labelSize, defaultLabelSize) {\n\n        if (labelSize === null) return null;\n        if (labelSize === undefined) {\n\n            if (defaultLabelSize === null) return null;\n            if (defaultLabelSize === undefined) return undefined;\n\n            return defaultLabelSize;\n        }\n\n        return merge({}, defaultLabelSize, labelSize);\n    },\n\n    updateLabels: function() {\n\n        if (!this._V.labels) return this;\n\n        var model = this.model;\n        var labels = model.get('labels') || [];\n        var canLabelMove = this.can('labelMove');\n\n        var builtinDefaultLabel = model._builtins.defaultLabel;\n        var builtinDefaultLabelAttrs = builtinDefaultLabel.attrs;\n\n        var defaultLabel = model._getDefaultLabel();\n        var defaultLabelMarkup = defaultLabel.markup;\n        var defaultLabelAttrs = defaultLabel.attrs;\n        var defaultLabelSize = defaultLabel.size;\n\n        for (var i = 0, n = labels.length; i < n; i++) {\n\n            var labelNode = this._labelCache[i];\n            labelNode.setAttribute('cursor', (canLabelMove ? 'move' : 'default'));\n\n            var selectors = this._labelSelectors[i];\n\n            var label = labels[i];\n            var labelMarkup = label.markup;\n            var labelAttrs = label.attrs;\n            var labelSize = label.size;\n\n            var attrs = this._mergeLabelAttrs(\n                (labelMarkup || defaultLabelMarkup),\n                labelAttrs,\n                defaultLabelAttrs,\n                builtinDefaultLabelAttrs\n            );\n\n            var size = this._mergeLabelSize(\n                labelSize,\n                defaultLabelSize\n            );\n\n            this.updateDOMSubtreeAttributes(labelNode, attrs, {\n                rootBBox: new Rect(size),\n                selectors: selectors\n            });\n        }\n\n        return this;\n    },\n\n    renderTools: function() {\n\n        if (!this._V.linkTools) return this;\n\n        // Tools are a group of clickable elements that manipulate the whole link.\n        // A good example of this is the remove tool that removes the whole link.\n        // Tools appear after hovering the link close to the `source` element/point of the link\n        // but are offset a bit so that they don't cover the `marker-arrowhead`.\n\n        var $tools = $(this._V.linkTools.node).empty();\n        var toolTemplate = template(this.model.get('toolMarkup') || this.model.toolMarkup);\n        var tool = V(toolTemplate());\n\n        $tools.append(tool.node);\n\n        // Cache the tool node so that the `updateToolsPosition()` can update the tool position quickly.\n        this._toolCache = tool;\n\n        // If `doubleLinkTools` is enabled, we render copy of the tools on the other side of the\n        // link as well but only if the link is longer than `longLinkLength`.\n        if (this.options.doubleLinkTools) {\n\n            var tool2;\n            if (this.model.get('doubleToolMarkup') || this.model.doubleToolMarkup) {\n                toolTemplate = template(this.model.get('doubleToolMarkup') || this.model.doubleToolMarkup);\n                tool2 = V(toolTemplate());\n            } else {\n                tool2 = tool.clone();\n            }\n\n            $tools.append(tool2.node);\n            this._tool2Cache = tool2;\n        }\n\n        return this;\n    },\n\n    renderVertexMarkers: function() {\n\n        if (!this._V.markerVertices) return this;\n\n        var $markerVertices = $(this._V.markerVertices.node).empty();\n\n        // A special markup can be given in the `properties.vertexMarkup` property. This might be handy\n        // if default styling (elements) are not desired. This makes it possible to use any\n        // SVG elements for .marker-vertex and .marker-vertex-remove tools.\n        var markupTemplate = template(this.model.get('vertexMarkup') || this.model.vertexMarkup);\n\n        this.model.vertices().forEach(function(vertex, idx) {\n            $markerVertices.append(V(markupTemplate(assign({ idx: idx }, vertex))).node);\n        });\n\n        return this;\n    },\n\n    renderArrowheadMarkers: function() {\n\n        // Custom markups might not have arrowhead markers. Therefore, jump of this function immediately if that's the case.\n        if (!this._V.markerArrowheads) return this;\n\n        var $markerArrowheads = $(this._V.markerArrowheads.node);\n\n        $markerArrowheads.empty();\n\n        // A special markup can be given in the `properties.vertexMarkup` property. This might be handy\n        // if default styling (elements) are not desired. This makes it possible to use any\n        // SVG elements for .marker-vertex and .marker-vertex-remove tools.\n        var markupTemplate = template(this.model.get('arrowheadMarkup') || this.model.arrowheadMarkup);\n\n        this._V.sourceArrowhead = V(markupTemplate({ end: 'source' }));\n        this._V.targetArrowhead = V(markupTemplate({ end: 'target' }));\n\n        $markerArrowheads.append(this._V.sourceArrowhead.node, this._V.targetArrowhead.node);\n\n        return this;\n    },\n\n    // remove vertices that lie on (or nearly on) straight lines within the link\n    // return the number of removed points\n    removeRedundantLinearVertices: function(opt) {\n\n        const SIMPLIFY_THRESHOLD = 0.001;\n\n        const link = this.model;\n        const vertices = link.vertices();\n        const routePoints = [this.sourceAnchor, ...vertices, this.targetAnchor];\n        const numRoutePoints = routePoints.length;\n\n        // put routePoints into a polyline and try to simplify\n        const polyline = new Polyline(routePoints);\n        polyline.simplify({ threshold: SIMPLIFY_THRESHOLD });\n        const polylinePoints = polyline.points.map((point) => (point.toJSON())); // JSON of points after simplification\n        const numPolylinePoints = polylinePoints.length; // number of points after simplification\n\n        // shortcut if simplification did not remove any redundant vertices:\n        if (numRoutePoints === numPolylinePoints) return 0;\n\n        // else: set simplified polyline points as link vertices\n        // remove first and last polyline points again (= source/target anchors)\n        link.vertices(polylinePoints.slice(1, numPolylinePoints - 1), opt);\n        return (numRoutePoints - numPolylinePoints);\n    },\n\n    updateDefaultConnectionPath: function() {\n\n        var cache = this._V;\n\n        if (cache.connection) {\n            cache.connection.attr('d', this.getSerializedConnection());\n        }\n\n        if (cache.connectionWrap) {\n            cache.connectionWrap.attr('d', this.getSerializedConnection());\n        }\n\n        if (cache.markerSource && cache.markerTarget) {\n            this._translateAndAutoOrientArrows(cache.markerSource, cache.markerTarget);\n        }\n    },\n\n    getEndView: function(type) {\n        switch (type) {\n            case 'source':\n                return this.sourceView || null;\n            case 'target':\n                return this.targetView || null;\n            default:\n                throw new Error('dia.LinkView: type parameter required.');\n        }\n    },\n\n    getEndAnchor: function(type) {\n        switch (type) {\n            case 'source':\n                return new Point(this.sourceAnchor);\n            case 'target':\n                return new Point(this.targetAnchor);\n            default:\n                throw new Error('dia.LinkView: type parameter required.');\n        }\n    },\n\n    getEndConnectionPoint: function(type) {\n        switch (type) {\n            case 'source':\n                return new Point(this.sourcePoint);\n            case 'target':\n                return new Point(this.targetPoint);\n            default:\n                throw new Error('dia.LinkView: type parameter required.');\n        }\n    },\n\n    getEndMagnet: function(type) {\n        switch (type) {\n            case 'source':\n                var sourceView = this.sourceView;\n                if (!sourceView) break;\n                return this.sourceMagnet || sourceView.el;\n            case 'target':\n                var targetView = this.targetView;\n                if (!targetView) break;\n                return this.targetMagnet || targetView.el;\n            default:\n                throw new Error('dia.LinkView: type parameter required.');\n        }\n        return null;\n    },\n\n\n    // Updating.\n    // ---------\n\n    update: function() {\n        this.updateRoute();\n        this.updatePath();\n        this.updateDOM();\n        return this;\n    },\n\n    translate: function(tx = 0, ty = 0) {\n        const { route, path } = this;\n        if (!route || !path) return;\n        // translate the route\n        const polyline = new Polyline(route);\n        polyline.translate(tx, ty);\n        this.route = polyline.points;\n        // translate source and target connection and marker points.\n        this._translateConnectionPoints(tx, ty);\n        // translate the geometry path\n        path.translate(tx, ty);\n        this.updateDOM();\n    },\n\n    updateDOM() {\n        const { el, model, selectors } = this;\n        this.cleanNodesCache();\n        // update SVG attributes defined by 'attrs/'.\n        this.updateDOMSubtreeAttributes(el, model.attr(), { selectors });\n        // legacy link path update\n        this.updateDefaultConnectionPath();\n        // update the label position etc.\n        this.updateLabelPositions();\n        this.updateToolsPosition();\n        this.updateArrowheadMarkers();\n        // *Deprecated*\n        // Local perpendicular flag (as opposed to one defined on paper).\n        // Could be enabled inside a connector/router. It's valid only\n        // during the update execution.\n        this.options.perpendicular = null;\n    },\n\n    updateRoute: function() {\n        const { model } = this;\n        const vertices = model.vertices();\n        // 1. Find Anchors\n        const anchors = this.findAnchors(vertices);\n        const sourceAnchor = this.sourceAnchor = anchors.source;\n        const targetAnchor = this.targetAnchor = anchors.target;\n        // 2. Find Route\n        const route = this.findRoute(vertices);\n        this.route = route;\n        // 3. Find Connection Points\n        var connectionPoints = this.findConnectionPoints(route, sourceAnchor, targetAnchor);\n        this.sourcePoint = connectionPoints.source;\n        this.targetPoint = connectionPoints.target;\n    },\n\n    updatePath: function() {\n        const { route, sourcePoint, targetPoint } = this;\n        // 3b. Find Marker Connection Point - Backwards Compatibility\n        const markerPoints = this.findMarkerPoints(route, sourcePoint, targetPoint);\n        // 4. Find Connection\n        const path = this.findPath(route, markerPoints.source || sourcePoint, markerPoints.target || targetPoint);\n        this.path = path;\n    },\n\n    findMarkerPoints: function(route, sourcePoint, targetPoint) {\n\n        var firstWaypoint = route[0];\n        var lastWaypoint = route[route.length - 1];\n\n        // Move the source point by the width of the marker taking into account\n        // its scale around x-axis. Note that scale is the only transform that\n        // makes sense to be set in `.marker-source` attributes object\n        // as all other transforms (translate/rotate) will be replaced\n        // by the `translateAndAutoOrient()` function.\n        var cache = this._markerCache;\n        // cache source and target points\n        var sourceMarkerPoint, targetMarkerPoint;\n\n        if (this._V.markerSource) {\n\n            cache.sourceBBox = cache.sourceBBox || this._V.markerSource.getBBox();\n            sourceMarkerPoint = Point(sourcePoint).move(\n                firstWaypoint || targetPoint,\n                cache.sourceBBox.width * this._V.markerSource.scale().sx * -1\n            ).round();\n        }\n\n        if (this._V.markerTarget) {\n\n            cache.targetBBox = cache.targetBBox || this._V.markerTarget.getBBox();\n            targetMarkerPoint = Point(targetPoint).move(\n                lastWaypoint || sourcePoint,\n                cache.targetBBox.width * this._V.markerTarget.scale().sx * -1\n            ).round();\n        }\n\n        // if there was no markup for the marker, use the connection point.\n        cache.sourcePoint = sourceMarkerPoint || sourcePoint.clone();\n        cache.targetPoint = targetMarkerPoint || targetPoint.clone();\n\n        return {\n            source: sourceMarkerPoint,\n            target: targetMarkerPoint\n        };\n    },\n\n    findAnchorsOrdered: function(firstEndType, firstRef, secondEndType, secondRef) {\n\n        var firstAnchor, secondAnchor;\n        var firstAnchorRef, secondAnchorRef;\n        var model = this.model;\n        var firstDef = model.get(firstEndType);\n        var secondDef = model.get(secondEndType);\n        var firstView = this.getEndView(firstEndType);\n        var secondView = this.getEndView(secondEndType);\n        var firstMagnet = this.getEndMagnet(firstEndType);\n        var secondMagnet = this.getEndMagnet(secondEndType);\n\n        // Anchor first\n        if (firstView) {\n            if (firstRef) {\n                firstAnchorRef = new Point(firstRef);\n            } else if (secondView) {\n                firstAnchorRef = secondMagnet;\n            } else {\n                firstAnchorRef = new Point(secondDef);\n            }\n            firstAnchor = this.getAnchor(firstDef.anchor, firstView, firstMagnet, firstAnchorRef, firstEndType);\n        } else {\n            firstAnchor = new Point(firstDef);\n        }\n\n        // Anchor second\n        if (secondView) {\n            secondAnchorRef = new Point(secondRef || firstAnchor);\n            secondAnchor = this.getAnchor(secondDef.anchor, secondView, secondMagnet, secondAnchorRef, secondEndType);\n        } else {\n            secondAnchor = new Point(secondDef);\n        }\n\n        var res = {};\n        res[firstEndType] = firstAnchor;\n        res[secondEndType] = secondAnchor;\n        return res;\n    },\n\n    findAnchors: function(vertices) {\n\n        var model = this.model;\n        var firstVertex = vertices[0];\n        var lastVertex = vertices[vertices.length - 1];\n\n        if (model.target().priority && !model.source().priority) {\n            // Reversed order\n            return this.findAnchorsOrdered('target', lastVertex, 'source', firstVertex);\n        }\n\n        // Usual order\n        return this.findAnchorsOrdered('source', firstVertex, 'target', lastVertex);\n    },\n\n    findConnectionPoints: function(route, sourceAnchor, targetAnchor) {\n\n        var firstWaypoint = route[0];\n        var lastWaypoint = route[route.length - 1];\n        var model = this.model;\n        var sourceDef = model.get('source');\n        var targetDef = model.get('target');\n        var sourceView = this.sourceView;\n        var targetView = this.targetView;\n        var paperOptions = this.paper.options;\n        var sourceMagnet, targetMagnet;\n\n        // Connection Point Source\n        var sourcePoint;\n        if (sourceView && !sourceView.isNodeConnection(this.sourceMagnet)) {\n            sourceMagnet = (this.sourceMagnet || sourceView.el);\n            var sourceConnectionPointDef = sourceDef.connectionPoint || paperOptions.defaultConnectionPoint;\n            var sourcePointRef = firstWaypoint || targetAnchor;\n            var sourceLine = new Line(sourcePointRef, sourceAnchor);\n            sourcePoint = this.getConnectionPoint(\n                sourceConnectionPointDef,\n                sourceView,\n                sourceMagnet,\n                sourceLine,\n                'source'\n            );\n        } else {\n            sourcePoint = sourceAnchor;\n        }\n        // Connection Point Target\n        var targetPoint;\n        if (targetView && !targetView.isNodeConnection(this.targetMagnet)) {\n            targetMagnet = (this.targetMagnet || targetView.el);\n            var targetConnectionPointDef = targetDef.connectionPoint || paperOptions.defaultConnectionPoint;\n            var targetPointRef = lastWaypoint || sourceAnchor;\n            var targetLine = new Line(targetPointRef, targetAnchor);\n            targetPoint = this.getConnectionPoint(\n                targetConnectionPointDef,\n                targetView,\n                targetMagnet,\n                targetLine,\n                'target'\n            );\n        } else {\n            targetPoint = targetAnchor;\n        }\n\n        return {\n            source: sourcePoint,\n            target: targetPoint\n        };\n    },\n\n    getAnchor: function(anchorDef, cellView, magnet, ref, endType) {\n\n        var isConnection = cellView.isNodeConnection(magnet);\n        var paperOptions = this.paper.options;\n        if (!anchorDef) {\n            if (isConnection) {\n                anchorDef = paperOptions.defaultLinkAnchor;\n            } else {\n                if (paperOptions.perpendicularLinks || this.options.perpendicular) {\n                    // Backwards compatibility\n                    // If `perpendicularLinks` flag is set on the paper and there are vertices\n                    // on the link, then try to find a connection point that makes the link perpendicular\n                    // even though the link won't point to the center of the targeted object.\n                    anchorDef = { name: 'perpendicular' };\n                } else {\n                    anchorDef = paperOptions.defaultAnchor;\n                }\n            }\n        }\n\n        if (!anchorDef) throw new Error('Anchor required.');\n        var anchorFn;\n        if (typeof anchorDef === 'function') {\n            anchorFn = anchorDef;\n        } else {\n            var anchorName = anchorDef.name;\n            var anchorNamespace = isConnection ? 'linkAnchorNamespace' : 'anchorNamespace';\n            anchorFn = paperOptions[anchorNamespace][anchorName];\n            if (typeof anchorFn !== 'function') throw new Error('Unknown anchor: ' + anchorName);\n        }\n        var anchor = anchorFn.call(\n            this,\n            cellView,\n            magnet,\n            ref,\n            anchorDef.args || {},\n            endType,\n            this\n        );\n        if (!anchor) return new Point();\n        return anchor.round(this.decimalsRounding);\n    },\n\n\n    getConnectionPoint: function(connectionPointDef, view, magnet, line, endType) {\n\n        var connectionPoint;\n        var anchor = line.end;\n        var paperOptions = this.paper.options;\n\n        // Backwards compatibility\n        if (typeof paperOptions.linkConnectionPoint === 'function') {\n            var linkConnectionMagnet = (magnet === view.el) ? undefined : magnet;\n            connectionPoint = paperOptions.linkConnectionPoint(this, view, linkConnectionMagnet, line.start, endType);\n            if (connectionPoint) return connectionPoint;\n        }\n\n        if (!connectionPointDef) return anchor;\n        var connectionPointFn;\n        if (typeof connectionPointDef === 'function') {\n            connectionPointFn = connectionPointDef;\n        } else {\n            var connectionPointName = connectionPointDef.name;\n            connectionPointFn = paperOptions.connectionPointNamespace[connectionPointName];\n            if (typeof connectionPointFn !== 'function') throw new Error('Unknown connection point: ' + connectionPointName);\n        }\n        connectionPoint = connectionPointFn.call(this, line, view, magnet, connectionPointDef.args || {}, endType, this);\n        if (!connectionPoint) return anchor;\n        return connectionPoint.round(this.decimalsRounding);\n    },\n\n    _translateConnectionPoints: function(tx, ty) {\n\n        var cache = this._markerCache;\n\n        cache.sourcePoint.offset(tx, ty);\n        cache.targetPoint.offset(tx, ty);\n        this.sourcePoint.offset(tx, ty);\n        this.targetPoint.offset(tx, ty);\n        this.sourceAnchor.offset(tx, ty);\n        this.targetAnchor.offset(tx, ty);\n    },\n\n    // combine default label position with built-in default label position\n    _getDefaultLabelPositionProperty: function() {\n\n        var model = this.model;\n\n        var builtinDefaultLabel = model._builtins.defaultLabel;\n        var builtinDefaultLabelPosition = builtinDefaultLabel.position;\n\n        var defaultLabel = model._getDefaultLabel();\n        var defaultLabelPosition = this._normalizeLabelPosition(defaultLabel.position);\n\n        return merge({}, builtinDefaultLabelPosition, defaultLabelPosition);\n    },\n\n    // if label position is a number, normalize it to a position object\n    // this makes sure that label positions can be merged properly\n    _normalizeLabelPosition: function(labelPosition) {\n\n        if (typeof labelPosition === 'number') return { distance: labelPosition, offset: null, angle: 0, args: null };\n        return labelPosition;\n    },\n\n    // expects normalized position properties\n    // e.g. `this._normalizeLabelPosition(labelPosition)` and `this._getDefaultLabelPositionProperty()`\n    _mergeLabelPositionProperty: function(normalizedLabelPosition, normalizedDefaultLabelPosition) {\n\n        if (normalizedLabelPosition === null) return null;\n        if (normalizedLabelPosition === undefined) {\n\n            if (normalizedDefaultLabelPosition === null) return null;\n            return normalizedDefaultLabelPosition;\n        }\n\n        return merge({}, normalizedDefaultLabelPosition, normalizedLabelPosition);\n    },\n\n    updateLabelPositions: function() {\n\n        if (!this._V.labels) return this;\n\n        var path = this.path;\n        if (!path) return this;\n\n        // This method assumes all the label nodes are stored in the `this._labelCache` hash table\n        // by their indices in the `this.get('labels')` array. This is done in the `renderLabels()` method.\n\n        var model = this.model;\n        var labels = model.get('labels') || [];\n        if (!labels.length) return this;\n\n        var defaultLabelPosition = this._getDefaultLabelPositionProperty();\n\n        for (var idx = 0, n = labels.length; idx < n; idx++) {\n            var labelNode = this._labelCache[idx];\n            if (!labelNode) continue;\n            var label = labels[idx];\n            var labelPosition = this._normalizeLabelPosition(label.position);\n            var position = this._mergeLabelPositionProperty(labelPosition, defaultLabelPosition);\n            var transformationMatrix = this._getLabelTransformationMatrix(position);\n            labelNode.setAttribute('transform', V.matrixToTransformString(transformationMatrix));\n            this._cleanLabelMatrices(idx);\n        }\n\n        return this;\n    },\n\n    _cleanLabelMatrices: function(index) {\n        // Clean magnetMatrix for all nodes of the label.\n        // Cached BoundingRect does not need to updated when the position changes\n        // TODO: this doesn't work for labels with XML String markups.\n        const { metrics, _labelSelectors } = this;\n        const selectors = _labelSelectors[index];\n        if (!selectors) return;\n        for (let selector in selectors) {\n            const { id } = selectors[selector];\n            if (id && (id in metrics)) delete metrics[id].magnetMatrix;\n        }\n    },\n\n    updateToolsPosition: function() {\n\n        if (!this._V.linkTools) return this;\n\n        // Move the tools a bit to the target position but don't cover the `sourceArrowhead` marker.\n        // Note that the offset is hardcoded here. The offset should be always\n        // more than the `this.$('.marker-arrowhead[end=\"source\"]')[0].bbox().width` but looking\n        // this up all the time would be slow.\n\n        var scale = '';\n        var offset = this.options.linkToolsOffset;\n        var connectionLength = this.getConnectionLength();\n\n        // Firefox returns connectionLength=NaN in odd cases (for bezier curves).\n        // In that case we won't update tools position at all.\n        if (!Number.isNaN(connectionLength)) {\n\n            // If the link is too short, make the tools half the size and the offset twice as low.\n            if (connectionLength < this.options.shortLinkLength) {\n                scale = 'scale(.5)';\n                offset /= 2;\n            }\n\n            var toolPosition = this.getPointAtLength(offset);\n\n            this._toolCache.attr('transform', 'translate(' + toolPosition.x + ', ' + toolPosition.y + ') ' + scale);\n\n            if (this.options.doubleLinkTools && connectionLength >= this.options.longLinkLength) {\n\n                var doubleLinkToolsOffset = this.options.doubleLinkToolsOffset || offset;\n\n                toolPosition = this.getPointAtLength(connectionLength - doubleLinkToolsOffset);\n                this._tool2Cache.attr('transform', 'translate(' + toolPosition.x + ', ' + toolPosition.y + ') ' + scale);\n                this._tool2Cache.attr('visibility', 'visible');\n\n            } else if (this.options.doubleLinkTools) {\n\n                this._tool2Cache.attr('visibility', 'hidden');\n            }\n        }\n\n        return this;\n    },\n\n    updateArrowheadMarkers: function() {\n\n        if (!this._V.markerArrowheads) return this;\n\n        // getting bbox of an element with `display=\"none\"` in IE9 ends up with access violation\n        if ($.css(this._V.markerArrowheads.node, 'display') === 'none') return this;\n\n        var sx = this.getConnectionLength() < this.options.shortLinkLength ? .5 : 1;\n        this._V.sourceArrowhead.scale(sx);\n        this._V.targetArrowhead.scale(sx);\n\n        this._translateAndAutoOrientArrows(this._V.sourceArrowhead, this._V.targetArrowhead);\n\n        return this;\n    },\n\n    updateEndProperties: function(endType) {\n\n        const { model, paper } = this;\n        const endViewProperty = `${endType}View`;\n        const endDef = model.get(endType);\n        const endId = endDef && endDef.id;\n\n        if (!endId) {\n            // the link end is a point ~ rect 0x0\n            this[endViewProperty] = null;\n            this.updateEndMagnet(endType);\n            return true;\n        }\n\n        const endModel = paper.getModelById(endId);\n        if (!endModel) throw new Error('LinkView: invalid ' + endType + ' cell.');\n\n        const endView = endModel.findView(paper);\n        if (!endView) {\n            // A view for a model should always exist\n            return false;\n        }\n\n        this[endViewProperty] = endView;\n        this.updateEndMagnet(endType);\n        return true;\n    },\n\n    updateEndMagnet: function(endType) {\n\n        const endMagnetProperty = `${endType}Magnet`;\n        const endView = this.getEndView(endType);\n        if (endView) {\n            let connectedMagnet = endView.getMagnetFromLinkEnd(this.model.get(endType));\n            if (connectedMagnet === endView.el) connectedMagnet = null;\n            this[endMagnetProperty] = connectedMagnet;\n        } else {\n            this[endMagnetProperty] = null;\n        }\n    },\n\n    _translateAndAutoOrientArrows: function(sourceArrow, targetArrow) {\n\n        // Make the markers \"point\" to their sticky points being auto-oriented towards\n        // `targetPosition`/`sourcePosition`. And do so only if there is a markup for them.\n        var route = toArray(this.route);\n        if (sourceArrow) {\n            sourceArrow.translateAndAutoOrient(\n                this.sourcePoint,\n                route[0] || this.targetPoint,\n                this.paper.cells\n            );\n        }\n\n        if (targetArrow) {\n            targetArrow.translateAndAutoOrient(\n                this.targetPoint,\n                route[route.length - 1] || this.sourcePoint,\n                this.paper.cells\n            );\n        }\n    },\n\n    _getLabelPositionProperty: function(idx) {\n\n        return (this.model.label(idx).position || {});\n    },\n\n    _getLabelPositionAngle: function(idx) {\n\n        var labelPosition = this._getLabelPositionProperty(idx);\n        return (labelPosition.angle || 0);\n    },\n\n    _getLabelPositionArgs: function(idx) {\n\n        var labelPosition = this._getLabelPositionProperty(idx);\n        return labelPosition.args;\n    },\n\n    _getDefaultLabelPositionArgs: function() {\n\n        var defaultLabel = this.model._getDefaultLabel();\n        var defaultLabelPosition = defaultLabel.position || {};\n        return defaultLabelPosition.args;\n    },\n\n    // merge default label position args into label position args\n    // keep `undefined` or `null` because `{}` means something else\n    _mergeLabelPositionArgs: function(labelPositionArgs, defaultLabelPositionArgs) {\n\n        if (labelPositionArgs === null) return null;\n        if (labelPositionArgs === undefined) {\n\n            if (defaultLabelPositionArgs === null) return null;\n            return defaultLabelPositionArgs;\n        }\n\n        return merge({}, defaultLabelPositionArgs, labelPositionArgs);\n    },\n\n    // Add default label at given position at end of `labels` array.\n    // Four signatures:\n    // - obj, obj = point, opt\n    // - obj, num, obj = point, angle, opt\n    // - num, num, obj = x, y, opt\n    // - num, num, num, obj = x, y, angle, opt\n    // Assigns relative coordinates by default:\n    // `opt.absoluteDistance` forces absolute coordinates.\n    // `opt.reverseDistance` forces reverse absolute coordinates (if absoluteDistance = true).\n    // `opt.absoluteOffset` forces absolute coordinates for offset.\n    // Additional args:\n    // `opt.keepGradient` auto-adjusts the angle of the label to match path gradient at position.\n    // `opt.ensureLegibility` rotates labels so they are never upside-down.\n    addLabel: function(p1, p2, p3, p4) {\n\n        // normalize data from the four possible signatures\n        var localX;\n        var localY;\n        var localAngle = 0;\n        var localOpt;\n        if (typeof p1 !== 'number') {\n            // {x, y} object provided as first parameter\n            localX = p1.x;\n            localY = p1.y;\n            if (typeof p2 === 'number') {\n                // angle and opt provided as second and third parameters\n                localAngle = p2;\n                localOpt = p3;\n            } else {\n                // opt provided as second parameter\n                localOpt = p2;\n            }\n        } else {\n            // x and y provided as first and second parameters\n            localX = p1;\n            localY = p2;\n            if (typeof p3 === 'number') {\n                // angle and opt provided as third and fourth parameters\n                localAngle = p3;\n                localOpt = p4;\n            } else {\n                // opt provided as third parameter\n                localOpt = p3;\n            }\n        }\n\n        // merge label position arguments\n        var defaultLabelPositionArgs = this._getDefaultLabelPositionArgs();\n        var labelPositionArgs = localOpt;\n        var positionArgs = this._mergeLabelPositionArgs(labelPositionArgs, defaultLabelPositionArgs);\n\n        // append label to labels array\n        var label = { position: this.getLabelPosition(localX, localY, localAngle, positionArgs) };\n        var idx = -1;\n        this.model.insertLabel(idx, label, localOpt);\n        return idx;\n    },\n\n    // Add a new vertex at calculated index to the `vertices` array.\n    addVertex: function(x, y, opt) {\n\n        // accept input in form `{ x, y }, opt` or `x, y, opt`\n        var isPointProvided = (typeof x !== 'number');\n        var localX = isPointProvided ? x.x : x;\n        var localY = isPointProvided ? x.y : y;\n        var localOpt = isPointProvided ? y : opt;\n\n        var vertex = { x: localX, y: localY };\n        var idx = this.getVertexIndex(localX, localY);\n        this.model.insertVertex(idx, vertex, localOpt);\n        return idx;\n    },\n\n    // Send a token (an SVG element, usually a circle) along the connection path.\n    // Example: `link.findView(paper).sendToken(V('circle', { r: 7, fill: 'green' }).node)`\n    // `opt.duration` is optional and is a time in milliseconds that the token travels from the source to the target of the link. Default is `1000`.\n    // `opt.directon` is optional and it determines whether the token goes from source to target or other way round (`reverse`)\n    // `opt.connection` is an optional selector to the connection path.\n    // `callback` is optional and is a function to be called once the token reaches the target.\n    sendToken: function(token, opt, callback) {\n\n        function onAnimationEnd(vToken, callback) {\n            return function() {\n                vToken.remove();\n                if (typeof callback === 'function') {\n                    callback();\n                }\n            };\n        }\n\n        var duration, isReversed, selector;\n        if (isObject(opt)) {\n            duration = opt.duration;\n            isReversed = (opt.direction === 'reverse');\n            selector = opt.connection;\n        } else {\n            // Backwards compatibility\n            duration = opt;\n            isReversed = false;\n            selector = null;\n        }\n\n        duration = duration || 1000;\n\n        var animationAttributes = {\n            dur: duration + 'ms',\n            repeatCount: 1,\n            calcMode: 'linear',\n            fill: 'freeze'\n        };\n\n        if (isReversed) {\n            animationAttributes.keyPoints = '1;0';\n            animationAttributes.keyTimes = '0;1';\n        }\n\n        var vToken = V(token);\n        var connection;\n        if (typeof selector === 'string') {\n            // Use custom connection path.\n            connection = this.findBySelector(selector, this.el, this.selectors)[0];\n        } else {\n            // Select connection path automatically.\n            var cache = this._V;\n            connection = (cache.connection) ? cache.connection.node : this.el.querySelector('path');\n        }\n\n        if (!(connection instanceof SVGPathElement)) {\n            throw new Error('dia.LinkView: token animation requires a valid connection path.');\n        }\n\n        vToken\n            .appendTo(this.paper.cells)\n            .animateAlongPath(animationAttributes, connection);\n\n        setTimeout(onAnimationEnd(vToken, callback), duration);\n    },\n\n    findRoute: function(vertices) {\n\n        vertices || (vertices = []);\n\n        var namespace = this.paper.options.routerNamespace || routers;\n        var router = this.model.router();\n        var defaultRouter = this.paper.options.defaultRouter;\n\n        if (!router) {\n            if (defaultRouter) router = defaultRouter;\n            else return vertices.map(Point); // no router specified\n        }\n\n        var routerFn = isFunction(router) ? router : namespace[router.name];\n        if (!isFunction(routerFn)) {\n            throw new Error('dia.LinkView: unknown router: \"' + router.name + '\".');\n        }\n\n        var args = router.args || {};\n\n        var route = routerFn.call(\n            this, // context\n            vertices, // vertices\n            args, // options\n            this // linkView\n        );\n\n        if (!route) return vertices.map(Point);\n        return route;\n    },\n\n    // Return the `d` attribute value of the `<path>` element representing the link\n    // between `source` and `target`.\n    findPath: function(route, sourcePoint, targetPoint) {\n\n        var namespace = this.paper.options.connectorNamespace || connectors;\n        var connector = this.model.connector();\n        var defaultConnector = this.paper.options.defaultConnector;\n\n        if (!connector) {\n            connector = defaultConnector || {};\n        }\n\n        var connectorFn = isFunction(connector) ? connector : namespace[connector.name];\n        if (!isFunction(connectorFn)) {\n            throw new Error('dia.LinkView: unknown connector: \"' + connector.name + '\".');\n        }\n\n        var args = clone(connector.args || {});\n        args.raw = true; // Request raw g.Path as the result.\n\n        var path = connectorFn.call(\n            this, // context\n            sourcePoint, // start point\n            targetPoint, // end point\n            route, // vertices\n            args, // options\n            this // linkView\n        );\n\n        if (typeof path === 'string') {\n            // Backwards compatibility for connectors not supporting `raw` option.\n            path = new Path(V.normalizePathData(path));\n        }\n\n        return path;\n    },\n\n    // Public API.\n    // -----------\n\n    getConnection: function() {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.clone();\n    },\n\n    getSerializedConnection: function() {\n\n        var path = this.path;\n        if (!path) return null;\n\n        var metrics = this.metrics;\n        if (metrics.hasOwnProperty('data')) return metrics.data;\n        var data = path.serialize();\n        metrics.data = data;\n        return data;\n    },\n\n    getConnectionSubdivisions: function() {\n\n        var path = this.path;\n        if (!path) return null;\n\n        var metrics = this.metrics;\n        if (metrics.hasOwnProperty('segmentSubdivisions')) return metrics.segmentSubdivisions;\n        var subdivisions = path.getSegmentSubdivisions();\n        metrics.segmentSubdivisions = subdivisions;\n        return subdivisions;\n    },\n\n    getConnectionLength: function() {\n\n        var path = this.path;\n        if (!path) return 0;\n\n        var metrics = this.metrics;\n        if (metrics.hasOwnProperty('length')) return metrics.length;\n        var length = path.length({ segmentSubdivisions: this.getConnectionSubdivisions() });\n        metrics.length = length;\n        return length;\n    },\n\n    getPointAtLength: function(length) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.pointAtLength(length, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getPointAtRatio: function(ratio) {\n\n        var path = this.path;\n        if (!path) return null;\n        if (isPercentage(ratio)) ratio = parseFloat(ratio) / 100;\n        return path.pointAt(ratio, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getTangentAtLength: function(length) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.tangentAtLength(length, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getTangentAtRatio: function(ratio) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.tangentAt(ratio, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getClosestPoint: function(point) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.closestPoint(point, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getClosestPointLength: function(point) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.closestPointLength(point, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getClosestPointRatio: function(point) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.closestPointNormalizedLength(point, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    // Get label position object based on two provided coordinates, x and y.\n    // (Used behind the scenes when user moves labels around.)\n    // Two signatures:\n    // - num, num, obj = x, y, options\n    // - num, num, num, obj = x, y, angle, options\n    // Accepts distance/offset options = `absoluteDistance: boolean`, `reverseDistance: boolean`, `absoluteOffset: boolean`\n    // - `absoluteOffset` is necessary in order to move beyond connection endpoints\n    // Additional options = `keepGradient: boolean`, `ensureLegibility: boolean`\n    getLabelPosition: function(x, y, p3, p4) {\n\n        var position = {};\n\n        // normalize data from the two possible signatures\n        var localAngle = 0;\n        var localOpt;\n        if (typeof p3 === 'number') {\n            // angle and opt provided as third and fourth argument\n            localAngle = p3;\n            localOpt = p4;\n        } else {\n            // opt provided as third argument\n            localOpt = p3;\n        }\n\n        // save localOpt as `args` of the position object that is passed along\n        if (localOpt) position.args = localOpt;\n\n        // identify distance/offset settings\n        var isDistanceRelative = !(localOpt && localOpt.absoluteDistance); // relative by default\n        var isDistanceAbsoluteReverse = (localOpt && localOpt.absoluteDistance && localOpt.reverseDistance); // non-reverse by default\n        var isOffsetAbsolute = localOpt && localOpt.absoluteOffset; // offset is non-absolute by default\n\n        // find closest point t\n        var path = this.path;\n        var pathOpt = { segmentSubdivisions: this.getConnectionSubdivisions() };\n        var labelPoint = new Point(x, y);\n        var t = path.closestPointT(labelPoint, pathOpt);\n\n        // DISTANCE:\n        var labelDistance = path.lengthAtT(t, pathOpt);\n        if (isDistanceRelative) labelDistance = (labelDistance / this.getConnectionLength()) || 0; // fix to prevent NaN for 0 length\n        if (isDistanceAbsoluteReverse) labelDistance = (-1 * (this.getConnectionLength() - labelDistance)) || 1; // fix for end point (-0 => 1)\n        position.distance = labelDistance;\n\n        // OFFSET:\n        // use absolute offset if:\n        // - opt.absoluteOffset is true,\n        // - opt.absoluteOffset is not true but there is no tangent\n        var tangent;\n        if (!isOffsetAbsolute) tangent = path.tangentAtT(t);\n        var labelOffset;\n        if (tangent) {\n            labelOffset = tangent.pointOffset(labelPoint);\n        } else {\n            var closestPoint = path.pointAtT(t);\n            var labelOffsetDiff = labelPoint.difference(closestPoint);\n            labelOffset = { x: labelOffsetDiff.x, y: labelOffsetDiff.y };\n        }\n        position.offset = labelOffset;\n\n        // ANGLE:\n        position.angle = localAngle;\n\n        return position;\n    },\n\n    _getLabelTransformationMatrix: function(labelPosition) {\n\n        var labelDistance;\n        var labelAngle = 0;\n        var args = {};\n        if (typeof labelPosition === 'number') {\n            labelDistance = labelPosition;\n        } else if (typeof labelPosition.distance === 'number') {\n            args = labelPosition.args || {};\n            labelDistance = labelPosition.distance;\n            labelAngle = labelPosition.angle || 0;\n        } else {\n            throw new Error('dia.LinkView: invalid label position distance.');\n        }\n\n        var isDistanceRelative = ((labelDistance > 0) && (labelDistance <= 1));\n\n        var labelOffset = 0;\n        var labelOffsetCoordinates = { x: 0, y: 0 };\n        if (labelPosition.offset) {\n            var positionOffset = labelPosition.offset;\n            if (typeof positionOffset === 'number') labelOffset = positionOffset;\n            if (positionOffset.x) labelOffsetCoordinates.x = positionOffset.x;\n            if (positionOffset.y) labelOffsetCoordinates.y = positionOffset.y;\n        }\n\n        var isOffsetAbsolute = ((labelOffsetCoordinates.x !== 0) || (labelOffsetCoordinates.y !== 0) || labelOffset === 0);\n\n        var isKeepGradient = args.keepGradient;\n        var isEnsureLegibility = args.ensureLegibility;\n\n        var path = this.path;\n        var pathOpt = { segmentSubdivisions: this.getConnectionSubdivisions() };\n\n        var distance = isDistanceRelative ? (labelDistance * this.getConnectionLength()) : labelDistance;\n        var tangent = path.tangentAtLength(distance, pathOpt);\n\n        var translation;\n        var angle = labelAngle;\n        if (tangent) {\n            if (isOffsetAbsolute) {\n                translation = tangent.start.clone();\n                translation.offset(labelOffsetCoordinates);\n            } else {\n                var normal = tangent.clone();\n                normal.rotate(tangent.start, -90);\n                normal.setLength(labelOffset);\n                translation = normal.end;\n            }\n\n            if (isKeepGradient) {\n                angle = (tangent.angle() + labelAngle);\n                if (isEnsureLegibility) {\n                    angle = normalizeAngle(((angle + 90) % 180) - 90);\n                }\n            }\n\n        } else {\n            // fallback - the connection has zero length\n            translation = path.start.clone();\n            if (isOffsetAbsolute) translation.offset(labelOffsetCoordinates);\n        }\n\n        return V.createSVGMatrix()\n            .translate(translation.x, translation.y)\n            .rotate(angle);\n    },\n\n    getLabelCoordinates: function(labelPosition) {\n\n        var transformationMatrix = this._getLabelTransformationMatrix(labelPosition);\n        return new Point(transformationMatrix.e, transformationMatrix.f);\n    },\n\n    getVertexIndex: function(x, y) {\n\n        var model = this.model;\n        var vertices = model.vertices();\n\n        var vertexLength = this.getClosestPointLength(new Point(x, y));\n\n        var idx = 0;\n        for (var n = vertices.length; idx < n; idx++) {\n            var currentVertex = vertices[idx];\n            var currentVertexLength = this.getClosestPointLength(currentVertex);\n            if (vertexLength < currentVertexLength) break;\n        }\n\n        return idx;\n    },\n\n    // Interaction. The controller part.\n    // ---------------------------------\n\n    notifyPointerdown(evt, x, y) {\n        CellView.prototype.pointerdown.call(this, evt, x, y);\n        this.notify('link:pointerdown', evt, x, y);\n    },\n\n    notifyPointermove(evt, x, y) {\n        CellView.prototype.pointermove.call(this, evt, x, y);\n        this.notify('link:pointermove', evt, x, y);\n    },\n\n    notifyPointerup(evt, x, y) {\n        this.notify('link:pointerup', evt, x, y);\n        CellView.prototype.pointerup.call(this, evt, x, y);\n    },\n\n    pointerdblclick: function(evt, x, y) {\n\n        CellView.prototype.pointerdblclick.apply(this, arguments);\n        this.notify('link:pointerdblclick', evt, x, y);\n    },\n\n    pointerclick: function(evt, x, y) {\n\n        CellView.prototype.pointerclick.apply(this, arguments);\n        this.notify('link:pointerclick', evt, x, y);\n    },\n\n    contextmenu: function(evt, x, y) {\n\n        CellView.prototype.contextmenu.apply(this, arguments);\n        this.notify('link:contextmenu', evt, x, y);\n    },\n\n    pointerdown: function(evt, x, y) {\n\n        this.notifyPointerdown(evt, x, y);\n\n        // Backwards compatibility for the default markup\n        var className = evt.target.getAttribute('class');\n        switch (className) {\n\n            case 'marker-vertex':\n                this.dragVertexStart(evt, x, y);\n                return;\n\n            case 'marker-vertex-remove':\n            case 'marker-vertex-remove-area':\n                this.dragVertexRemoveStart(evt, x, y);\n                return;\n\n            case 'marker-arrowhead':\n                this.dragArrowheadStart(evt, x, y);\n                return;\n\n            case 'connection':\n            case 'connection-wrap':\n                this.dragConnectionStart(evt, x, y);\n                return;\n\n            case 'marker-source':\n            case 'marker-target':\n                return;\n        }\n\n        this.dragStart(evt, x, y);\n    },\n\n    pointermove: function(evt, x, y) {\n\n        // Backwards compatibility\n        var dragData = this._dragData;\n        if (dragData) this.eventData(evt, dragData);\n\n        var data = this.eventData(evt);\n        switch (data.action) {\n\n            case 'vertex-move':\n                this.dragVertex(evt, x, y);\n                break;\n\n            case 'label-move':\n                this.dragLabel(evt, x, y);\n                break;\n\n            case 'arrowhead-move':\n                this.dragArrowhead(evt, x, y);\n                break;\n\n            case 'move':\n                this.drag(evt, x, y);\n                break;\n        }\n\n        // Backwards compatibility\n        if (dragData) assign(dragData, this.eventData(evt));\n\n        this.notifyPointermove(evt, x, y);\n    },\n\n    pointerup: function(evt, x, y) {\n\n        // Backwards compatibility\n        var dragData = this._dragData;\n        if (dragData) {\n            this.eventData(evt, dragData);\n            this._dragData = null;\n        }\n\n        var data = this.eventData(evt);\n        switch (data.action) {\n\n            case 'vertex-move':\n                this.dragVertexEnd(evt, x, y);\n                break;\n\n            case 'label-move':\n                this.dragLabelEnd(evt, x, y);\n                break;\n\n            case 'arrowhead-move':\n                this.dragArrowheadEnd(evt, x, y);\n                break;\n\n            case 'move':\n                this.dragEnd(evt, x, y);\n        }\n\n        this.notifyPointerup(evt, x, y);\n        this.checkMouseleave(evt);\n    },\n\n    mouseover: function(evt) {\n\n        CellView.prototype.mouseover.apply(this, arguments);\n        this.notify('link:mouseover', evt);\n    },\n\n    mouseout: function(evt) {\n\n        CellView.prototype.mouseout.apply(this, arguments);\n        this.notify('link:mouseout', evt);\n    },\n\n    mouseenter: function(evt) {\n\n        CellView.prototype.mouseenter.apply(this, arguments);\n        this.notify('link:mouseenter', evt);\n    },\n\n    mouseleave: function(evt) {\n\n        CellView.prototype.mouseleave.apply(this, arguments);\n        this.notify('link:mouseleave', evt);\n    },\n\n    mousewheel: function(evt, x, y, delta) {\n\n        CellView.prototype.mousewheel.apply(this, arguments);\n        this.notify('link:mousewheel', evt, x, y, delta);\n    },\n\n    onevent: function(evt, eventName, x, y) {\n\n        // Backwards compatibility\n        var linkTool = V(evt.target).findParentByClass('link-tool', this.el);\n        if (linkTool) {\n            // No further action to be executed\n            evt.stopPropagation();\n\n            // Allow `interactive.useLinkTools=false`\n            if (this.can('useLinkTools')) {\n                if (eventName === 'remove') {\n                    // Built-in remove event\n                    this.model.remove({ ui: true });\n                    // Do not trigger link pointerdown\n                    return;\n\n                } else {\n                    // link:options and other custom events inside the link tools\n                    this.notify(eventName, evt, x, y);\n                }\n            }\n\n            this.notifyPointerdown(evt, x, y);\n            this.paper.delegateDragEvents(this, evt.data);\n\n        } else {\n            CellView.prototype.onevent.apply(this, arguments);\n        }\n    },\n\n    onlabel: function(evt, x, y) {\n\n        this.notifyPointerdown(evt, x, y);\n\n        this.dragLabelStart(evt, x, y);\n\n        var stopPropagation = this.eventData(evt).stopPropagation;\n        if (stopPropagation) evt.stopPropagation();\n    },\n\n    // Drag Start Handlers\n\n    dragConnectionStart: function(evt, x, y) {\n\n        if (!this.can('vertexAdd')) return;\n\n        // Store the index at which the new vertex has just been placed.\n        // We'll be update the very same vertex position in `pointermove()`.\n        var vertexIdx = this.addVertex({ x: x, y: y }, { ui: true });\n        this.eventData(evt, {\n            action: 'vertex-move',\n            vertexIdx: vertexIdx\n        });\n    },\n\n    dragLabelStart: function(evt, x, y) {\n\n        if (this.can('labelMove')) {\n\n            if (this.isDefaultInteractionPrevented(evt)) return;\n\n            var labelNode = evt.currentTarget;\n            var labelIdx = parseInt(labelNode.getAttribute('label-idx'), 10);\n\n            var defaultLabelPosition = this._getDefaultLabelPositionProperty();\n            var initialLabelPosition = this._normalizeLabelPosition(this._getLabelPositionProperty(labelIdx));\n            var position = this._mergeLabelPositionProperty(initialLabelPosition, defaultLabelPosition);\n\n            var coords = this.getLabelCoordinates(position);\n            var dx = coords.x - x; // how much needs to be added to cursor x to get to label x\n            var dy = coords.y - y; // how much needs to be added to cursor y to get to label y\n\n            var positionAngle = this._getLabelPositionAngle(labelIdx);\n            var labelPositionArgs = this._getLabelPositionArgs(labelIdx);\n            var defaultLabelPositionArgs = this._getDefaultLabelPositionArgs();\n            var positionArgs = this._mergeLabelPositionArgs(labelPositionArgs, defaultLabelPositionArgs);\n\n            this.eventData(evt, {\n                action: 'label-move',\n                labelIdx: labelIdx,\n                dx: dx,\n                dy: dy,\n                positionAngle: positionAngle,\n                positionArgs: positionArgs,\n                stopPropagation: true\n            });\n\n        } else {\n\n            // Backwards compatibility:\n            // If labels can't be dragged no default action is triggered.\n            this.eventData(evt, { stopPropagation: true });\n        }\n\n        this.paper.delegateDragEvents(this, evt.data);\n    },\n\n    dragVertexStart: function(evt, x, y) {\n\n        if (!this.can('vertexMove')) return;\n\n        var vertexNode = evt.target;\n        var vertexIdx = parseInt(vertexNode.getAttribute('idx'), 10);\n        this.eventData(evt, {\n            action: 'vertex-move',\n            vertexIdx: vertexIdx\n        });\n    },\n\n    dragVertexRemoveStart: function(evt, x, y) {\n\n        if (!this.can('vertexRemove')) return;\n\n        var removeNode = evt.target;\n        var vertexIdx = parseInt(removeNode.getAttribute('idx'), 10);\n        this.model.removeVertex(vertexIdx);\n    },\n\n    dragArrowheadStart: function(evt, x, y) {\n\n        if (!this.can('arrowheadMove')) return;\n\n        var arrowheadNode = evt.target;\n        var arrowheadType = arrowheadNode.getAttribute('end');\n        var data = this.startArrowheadMove(arrowheadType, { ignoreBackwardsCompatibility: true });\n\n        this.eventData(evt, data);\n    },\n\n    dragStart: function(evt, x, y) {\n\n        if (this.isDefaultInteractionPrevented(evt)) return;\n\n        if (!this.can('linkMove')) return;\n\n        this.eventData(evt, {\n            action: 'move',\n            dx: x,\n            dy: y\n        });\n    },\n\n    // Drag Handlers\n    dragLabel: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        var label = { position: this.getLabelPosition((x + data.dx), (y + data.dy), data.positionAngle, data.positionArgs) };\n        if (this.paper.options.snapLabels) delete label.position.offset;\n        // The `touchmove' events are not fired\n        // when the original event target is removed from the DOM.\n        // The labels are currently re-rendered completely when only\n        // the position changes. This is why we need to make sure that\n        // the label is updated synchronously.\n        // TODO: replace `touchmove` with `pointermove` (breaking change).\n        const setOptions = { ui: true };\n        if (this.paper.isAsync() && evt.type === 'touchmove') {\n            setOptions.async = false;\n        }\n        this.model.label(data.labelIdx, label, setOptions);\n    },\n\n    dragVertex: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        this.model.vertex(data.vertexIdx, { x: x, y: y }, { ui: true });\n    },\n\n    dragArrowhead: function(evt, x, y) {\n        if (this.paper.options.snapLinks) {\n            const isSnapped = this._snapArrowhead(evt, x, y);\n            if (!isSnapped && this.paper.options.snapLinksSelf) {\n                this._snapArrowheadSelf(evt, x, y);\n            }\n        } else {\n            if (this.paper.options.snapLinksSelf) {\n                this._snapArrowheadSelf(evt, x, y);\n            } else {\n                this._connectArrowhead(this.getEventTarget(evt), x, y, this.eventData(evt));\n            }\n        }\n    },\n\n    drag: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        this.model.translate(x - data.dx, y - data.dy, { ui: true });\n        this.eventData(evt, {\n            dx: x,\n            dy: y\n        });\n    },\n\n    // Drag End Handlers\n\n    dragLabelEnd: function() {\n        // noop\n    },\n\n    dragVertexEnd: function() {\n        // noop\n    },\n\n    dragArrowheadEnd: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        var paper = this.paper;\n\n        if (paper.options.snapLinks) {\n            this._snapArrowheadEnd(data);\n        } else {\n            this._connectArrowheadEnd(data, x, y);\n        }\n\n        if (!paper.linkAllowed(this)) {\n            // If the changed link is not allowed, revert to its previous state.\n            this._disallow(data);\n        } else {\n            this._finishEmbedding(data);\n            this._notifyConnectEvent(data, evt);\n        }\n\n        this._afterArrowheadMove(data);\n    },\n\n    dragEnd: function() {\n        // noop\n    },\n\n    _disallow: function(data) {\n\n        switch (data.whenNotAllowed) {\n\n            case 'remove':\n                this.model.remove({ ui: true });\n                break;\n\n            case 'revert':\n            default:\n                this.model.set(data.arrowhead, data.initialEnd, { ui: true });\n                break;\n        }\n    },\n\n    _finishEmbedding: function(data) {\n\n        // Reparent the link if embedding is enabled\n        if (this.paper.options.embeddingMode && this.model.reparent()) {\n            // Make sure we don't reverse to the original 'z' index (see afterArrowheadMove()).\n            data.z = null;\n        }\n    },\n\n    _notifyConnectEvent: function(data, evt) {\n\n        var arrowhead = data.arrowhead;\n        var initialEnd = data.initialEnd;\n        var currentEnd = this.model.prop(arrowhead);\n        var endChanged = currentEnd && !Link.endsEqual(initialEnd, currentEnd);\n        if (endChanged) {\n            var paper = this.paper;\n            if (initialEnd.id) {\n                this.notify('link:disconnect', evt, paper.findViewByModel(initialEnd.id), data.initialMagnet, arrowhead);\n            }\n            if (currentEnd.id) {\n                this.notify('link:connect', evt, paper.findViewByModel(currentEnd.id), data.magnetUnderPointer, arrowhead);\n            }\n        }\n    },\n\n    _snapToPoints: function(snapPoint, points, radius) {\n        let closestPointX = null;\n        let closestDistanceX = Infinity;\n\n        let closestPointY = null;\n        let closestDistanceY = Infinity;\n\n        let x = snapPoint.x;\n        let y = snapPoint.y;\n\n        for (let i = 0; i < points.length; i++) {\n            const distX = Math.abs(points[i].x - snapPoint.x);\n            if (distX < closestDistanceX) {\n                closestDistanceX = distX;\n                closestPointX = points[i];\n            }\n\n            const distY = Math.abs(points[i].y - snapPoint.y);\n            if (distY < closestDistanceY) {\n                closestDistanceY = distY;\n                closestPointY = points[i];\n            }\n        }\n\n        if (closestDistanceX < radius) {\n            x = closestPointX.x;\n        }\n        if (closestDistanceY < radius) {\n            y = closestPointY.y;\n        }\n\n        return { x, y };\n    },\n\n    _snapArrowheadSelf: function(evt, x, y) {\n\n        const { paper, model } = this;\n        const { snapLinksSelf } = paper.options;\n        const data = this.eventData(evt);\n        const radius = snapLinksSelf.radius || 20;\n\n        const anchor = this.getEndAnchor(data.arrowhead === 'source' ? 'target' : 'source');\n        const vertices = model.vertices();\n        const points = [anchor, ...vertices];\n\n        const snapPoint = this._snapToPoints({ x: x, y: y }, points, radius);\n\n        const point = paper.localToClientPoint(snapPoint);\n        this._connectArrowhead(document.elementFromPoint(point.x, point.y), snapPoint.x, snapPoint.y, this.eventData(evt));\n    },\n\n    _snapArrowhead: function(evt, x, y) {\n\n        const { paper } = this;\n        const { snapLinks, connectionStrategy } = paper.options;\n        const data = this.eventData(evt);\n        let isSnapped = false;\n        // checking view in close area of the pointer\n\n        var r = snapLinks.radius || 50;\n        var viewsInArea = paper.findViewsInArea({ x: x - r, y: y - r, width: 2 * r, height: 2 * r });\n\n        var prevClosestView = data.closestView || null;\n        var prevClosestMagnet = data.closestMagnet || null;\n        var prevMagnetProxy = data.magnetProxy || null;\n\n        data.closestView = data.closestMagnet = data.magnetProxy = null;\n\n        var minDistance = Number.MAX_VALUE;\n        var pointer = new Point(x, y);\n\n        viewsInArea.forEach(function(view) {\n            const candidates = [];\n            // skip connecting to the element in case '.': { magnet: false } attribute present\n            if (view.el.getAttribute('magnet') !== 'false') {\n                candidates.push({\n                    bbox: view.model.getBBox(),\n                    magnet: view.el\n                });\n            }\n\n            view.$('[magnet]').toArray().forEach(magnet => {\n                candidates.push({\n                    bbox: view.getNodeBBox(magnet),\n                    magnet\n                });\n            });\n\n            candidates.forEach(candidate => {\n                const { magnet, bbox } = candidate;\n                // find distance from the center of the model to pointer coordinates\n                const distance = bbox.center().squaredDistance(pointer);\n                // the connection is looked up in a circle area by `distance < r`\n                if (distance < minDistance) {\n                    const isAlreadyValidated = prevClosestMagnet === magnet;\n                    if (isAlreadyValidated || paper.options.validateConnection.apply(\n                        paper, data.validateConnectionArgs(view, (view.el === magnet) ? null : magnet)\n                    )) {\n                        minDistance = distance;\n                        data.closestView = view;\n                        data.closestMagnet = magnet;\n                    }\n                }\n            });\n\n        }, this);\n\n        var end;\n        var magnetProxy = null;\n        var closestView = data.closestView;\n        var closestMagnet = data.closestMagnet;\n        if (closestMagnet) {\n            magnetProxy = data.magnetProxy = closestView.findProxyNode(closestMagnet, 'highlighter');\n        }\n        var endType = data.arrowhead;\n        var newClosestMagnet = (prevClosestMagnet !== closestMagnet);\n        if (prevClosestView && newClosestMagnet) {\n            prevClosestView.unhighlight(prevMagnetProxy, {\n                connecting: true,\n                snapping: true\n            });\n        }\n\n        if (closestView) {\n            const { prevEnd, prevX, prevY } = data;\n            data.prevX = x;\n            data.prevY = y;\n            isSnapped = true;\n\n            if (!newClosestMagnet)  {\n                if (typeof connectionStrategy !== 'function' || (prevX === x && prevY === y)) {\n                    // the magnet has not changed and the link's end does not depend on the x and y\n                    return isSnapped;\n                }\n            }\n\n            end = closestView.getLinkEnd(closestMagnet, x, y, this.model, endType);\n            if (!newClosestMagnet && isEqual(prevEnd, end)) {\n                // the source/target json has not changed\n                return isSnapped;\n            }\n\n            data.prevEnd = end;\n\n            if (newClosestMagnet) {\n                closestView.highlight(magnetProxy, {\n                    connecting: true,\n                    snapping: true\n                });\n            }\n\n        } else {\n\n            end = { x: x, y: y };\n        }\n\n        this.model.set(endType, end || { x: x, y: y }, { ui: true });\n\n        if (prevClosestView) {\n            this.notify('link:snap:disconnect', evt, prevClosestView, prevClosestMagnet, endType);\n        }\n        if (closestView) {\n            this.notify('link:snap:connect', evt, closestView, closestMagnet, endType);\n        }\n\n        return isSnapped;\n    },\n\n    _snapArrowheadEnd: function(data) {\n\n        // Finish off link snapping.\n        // Everything except view unhighlighting was already done on pointermove.\n        var closestView = data.closestView;\n        var closestMagnet = data.closestMagnet;\n        if (closestView && closestMagnet) {\n\n            closestView.unhighlight(data.magnetProxy, { connecting: true, snapping: true });\n            data.magnetUnderPointer = closestView.findMagnet(closestMagnet);\n        }\n\n        data.closestView = data.closestMagnet = null;\n    },\n\n    _connectArrowhead: function(target, x, y, data) {\n\n        // checking views right under the pointer\n        const { paper, model } = this;\n\n        if (data.eventTarget !== target) {\n            // Unhighlight the previous view under pointer if there was one.\n            if (data.magnetProxy) {\n                data.viewUnderPointer.unhighlight(data.magnetProxy, {\n                    connecting: true\n                });\n            }\n\n            const viewUnderPointer = data.viewUnderPointer = paper.findView(target);\n            if (viewUnderPointer) {\n                // If we found a view that is under the pointer, we need to find the closest\n                // magnet based on the real target element of the event.\n                const magnetUnderPointer = data.magnetUnderPointer = viewUnderPointer.findMagnet(target);\n                const magnetProxy = data.magnetProxy = viewUnderPointer.findProxyNode(magnetUnderPointer, 'highlighter');\n\n                if (magnetUnderPointer && this.paper.options.validateConnection.apply(\n                    paper,\n                    data.validateConnectionArgs(viewUnderPointer, magnetUnderPointer)\n                )) {\n                    // If there was no magnet found, do not highlight anything and assume there\n                    // is no view under pointer we're interested in reconnecting to.\n                    // This can only happen if the overall element has the attribute `'.': { magnet: false }`.\n                    if (magnetProxy) {\n                        viewUnderPointer.highlight(magnetProxy, {\n                            connecting: true\n                        });\n                    }\n                } else {\n                    // This type of connection is not valid. Disregard this magnet.\n                    data.magnetUnderPointer = null;\n                    data.magnetProxy = null;\n                }\n            } else {\n                // Make sure we'll unset previous magnet.\n                data.magnetUnderPointer = null;\n                data.magnetProxy = null;\n            }\n        }\n\n        data.eventTarget = target;\n\n        model.set(data.arrowhead, { x: x, y: y }, { ui: true });\n    },\n\n    _connectArrowheadEnd: function(data = {}, x, y) {\n\n        const { model } = this;\n        const { viewUnderPointer, magnetUnderPointer, magnetProxy, arrowhead } = data;\n\n        if (!magnetUnderPointer || !magnetProxy || !viewUnderPointer) return;\n\n        viewUnderPointer.unhighlight(magnetProxy, { connecting: true });\n\n        // The link end is taken from the magnet under the pointer, not the proxy.\n        const end = viewUnderPointer.getLinkEnd(magnetUnderPointer, x, y, model, arrowhead);\n        model.set(arrowhead, end, { ui: true });\n    },\n\n    _beforeArrowheadMove: function(data) {\n\n        data.z = this.model.get('z');\n        this.model.toFront();\n\n        // Let the pointer propagate through the link view elements so that\n        // the `evt.target` is another element under the pointer, not the link itself.\n        var style = this.el.style;\n        data.pointerEvents = style.pointerEvents;\n        style.pointerEvents = 'none';\n\n        if (this.paper.options.markAvailable) {\n            this._markAvailableMagnets(data);\n        }\n    },\n\n    _afterArrowheadMove: function(data) {\n\n        if (data.z !== null) {\n            this.model.set('z', data.z, { ui: true });\n            data.z = null;\n        }\n\n        // Put `pointer-events` back to its original value. See `_beforeArrowheadMove()` for explanation.\n        this.el.style.pointerEvents = data.pointerEvents;\n\n        if (this.paper.options.markAvailable) {\n            this._unmarkAvailableMagnets(data);\n        }\n    },\n\n    _createValidateConnectionArgs: function(arrowhead) {\n        // It makes sure the arguments for validateConnection have the following form:\n        // (source view, source magnet, target view, target magnet and link view)\n        var args = [];\n\n        args[4] = arrowhead;\n        args[5] = this;\n\n        var oppositeArrowhead;\n        var i = 0;\n        var j = 0;\n\n        if (arrowhead === 'source') {\n            i = 2;\n            oppositeArrowhead = 'target';\n        } else {\n            j = 2;\n            oppositeArrowhead = 'source';\n        }\n\n        var end = this.model.get(oppositeArrowhead);\n\n        if (end.id) {\n            var view = args[i] = this.paper.findViewByModel(end.id);\n            var magnet = view.getMagnetFromLinkEnd(end);\n            if (magnet === view.el) magnet = undefined;\n            args[i + 1] = magnet;\n        }\n\n        function validateConnectionArgs(cellView, magnet) {\n            args[j] = cellView;\n            args[j + 1] = cellView.el === magnet ? undefined : magnet;\n            return args;\n        }\n\n        return validateConnectionArgs;\n    },\n\n    _markAvailableMagnets: function(data) {\n\n        function isMagnetAvailable(view, magnet) {\n            var paper = view.paper;\n            var validate = paper.options.validateConnection;\n            return validate.apply(paper, this.validateConnectionArgs(view, magnet));\n        }\n\n        var paper = this.paper;\n        var elements = paper.model.getCells();\n        data.marked = {};\n\n        for (var i = 0, n = elements.length; i < n; i++) {\n            var view = elements[i].findView(paper);\n\n            if (!view) {\n                continue;\n            }\n\n            var magnets = Array.prototype.slice.call(view.el.querySelectorAll('[magnet]'));\n            if (view.el.getAttribute('magnet') !== 'false') {\n                // Element wrapping group is also a magnet\n                magnets.push(view.el);\n            }\n\n            var availableMagnets = magnets.filter(isMagnetAvailable.bind(data, view));\n\n            if (availableMagnets.length > 0) {\n                // highlight all available magnets\n                for (var j = 0, m = availableMagnets.length; j < m; j++) {\n                    view.highlight(availableMagnets[j], { magnetAvailability: true });\n                }\n                // highlight the entire view\n                view.highlight(null, { elementAvailability: true });\n\n                data.marked[view.model.id] = availableMagnets;\n            }\n        }\n    },\n\n    _unmarkAvailableMagnets: function(data) {\n\n        var markedKeys = Object.keys(data.marked);\n        var id;\n        var markedMagnets;\n\n        for (var i = 0, n = markedKeys.length; i < n; i++) {\n            id = markedKeys[i];\n            markedMagnets = data.marked[id];\n\n            var view = this.paper.findViewByModel(id);\n            if (view) {\n                for (var j = 0, m = markedMagnets.length; j < m; j++) {\n                    view.unhighlight(markedMagnets[j], { magnetAvailability: true });\n                }\n                view.unhighlight(null, { elementAvailability: true });\n            }\n        }\n\n        data.marked = null;\n    },\n\n    startArrowheadMove: function(end, opt) {\n\n        opt || (opt = {});\n\n        // Allow to delegate events from an another view to this linkView in order to trigger arrowhead\n        // move without need to click on the actual arrowhead dom element.\n        var data = {\n            action: 'arrowhead-move',\n            arrowhead: end,\n            whenNotAllowed: opt.whenNotAllowed || 'revert',\n            initialMagnet: this[end + 'Magnet'] || (this[end + 'View'] ? this[end + 'View'].el : null),\n            initialEnd: clone(this.model.get(end)),\n            validateConnectionArgs: this._createValidateConnectionArgs(end)\n        };\n\n        this._beforeArrowheadMove(data);\n\n        if (opt.ignoreBackwardsCompatibility !== true) {\n            this._dragData = data;\n        }\n\n        return data;\n    },\n\n    // Lifecycle methods\n\n    onMount: function() {\n        CellView.prototype.onMount.apply(this, arguments);\n        this.mountLabels();\n    },\n\n    onDetach: function() {\n        CellView.prototype.onDetach.apply(this, arguments);\n        this.unmountLabels();\n    },\n\n    onRemove: function() {\n        CellView.prototype.onRemove.apply(this, arguments);\n        this.unmountLabels();\n    }\n\n}, {\n\n    Flags: Flags,\n});\n\nObject.defineProperty(LinkView.prototype, 'sourceBBox', {\n\n    enumerable: true,\n\n    get: function() {\n        var sourceView = this.sourceView;\n        if (!sourceView) {\n            var sourceDef = this.model.source();\n            return new Rect(sourceDef.x, sourceDef.y);\n        }\n        var sourceMagnet = this.sourceMagnet;\n        if (sourceView.isNodeConnection(sourceMagnet)) {\n            return new Rect(this.sourceAnchor);\n        }\n        return sourceView.getNodeBBox(sourceMagnet || sourceView.el);\n    }\n\n});\n\nObject.defineProperty(LinkView.prototype, 'targetBBox', {\n\n    enumerable: true,\n\n    get: function() {\n        var targetView = this.targetView;\n        if (!targetView) {\n            var targetDef = this.model.target();\n            return new Rect(targetDef.x, targetDef.y);\n        }\n        var targetMagnet = this.targetMagnet;\n        if (targetView.isNodeConnection(targetMagnet)) {\n            return new Rect(this.targetAnchor);\n        }\n        return targetView.getNodeBBox(targetMagnet || targetView.el);\n    }\n});\n\n","import { assign } from '../util/index.mjs';\nimport V from '../V/index.mjs';\nimport { HighlighterView } from '../dia/HighlighterView.mjs';\n\nexport const stroke = HighlighterView.extend({\n\n    tagName: 'path',\n    className: 'highlight-stroke',\n    attributes: {\n        'pointer-events': 'none',\n        'vector-effect': 'non-scaling-stroke',\n        'fill': 'none'\n    },\n\n    options: {\n        padding: 3,\n        rx: 0,\n        ry: 0,\n        useFirstSubpath: false,\n        attrs: {\n            'stroke-width': 3,\n            'stroke': '#FEB663'\n        }\n    },\n\n    getPathData(cellView, node) {\n        const { options } = this;\n        const { useFirstSubpath } = options;\n        let d;\n        try {\n            const vNode = V(node);\n            d = vNode.convertToPathData().trim();\n            if (vNode.tagName() === 'PATH' && useFirstSubpath) {\n                const secondSubpathIndex = d.search(/.M/i) + 1;\n                if (secondSubpathIndex > 0) {\n                    d = d.substr(0, secondSubpathIndex);\n                }\n            }\n        } catch (error) {\n            // Failed to get path data from magnet element.\n            // Draw a rectangle around the node instead.\n            const nodeBBox = cellView.getNodeBoundingRect(node);\n            d = V.rectToPath(assign({}, options, nodeBBox.toJSON()));\n        }\n        return d;\n    },\n\n    highlightConnection(cellView) {\n        this.vel.attr('d', cellView.getSerializedConnection());\n    },\n\n    highlightNode(cellView, node) {\n        const { vel, options } = this;\n        const { padding, layer } = options;\n        let highlightMatrix = this.getNodeMatrix(cellView, node);\n        // Add padding to the highlight element.\n        if (padding) {\n            if (!layer && node === cellView.el) {\n                // If the highlighter is appended to the cellView\n                // and we measure the size of the cellView wrapping group\n                // it's necessary to remove the highlighter first\n                vel.remove();\n            }\n            let nodeBBox = cellView.getNodeBoundingRect(node);\n            const cx = nodeBBox.x + (nodeBBox.width / 2);\n            const cy = nodeBBox.y + (nodeBBox.height / 2);\n            nodeBBox = V.transformRect(nodeBBox, highlightMatrix);\n            const width = Math.max(nodeBBox.width, 1);\n            const height = Math.max(nodeBBox.height, 1);\n            const sx = (width + padding) / width;\n            const sy = (height + padding) / height;\n            const paddingMatrix = V.createSVGMatrix({\n                a: sx,\n                b: 0,\n                c: 0,\n                d: sy,\n                e: cx - sx * cx,\n                f: cy - sy * cy\n            });\n            highlightMatrix = highlightMatrix.multiply(paddingMatrix);\n        }\n        vel.attr({\n            'd': this.getPathData(cellView, node),\n            'transform': V.matrixToTransformString(highlightMatrix)\n        });\n    },\n\n    highlight(cellView, node) {\n        const { vel, options } = this;\n        vel.attr(options.attrs);\n        if (cellView.isNodeConnection(node)) {\n            this.highlightConnection(cellView);\n        } else {\n            this.highlightNode(cellView, node);\n        }\n    }\n\n});\n","import V from '../V/index.mjs';\nimport { HighlighterView } from '../dia/HighlighterView.mjs';\n\nconst MASK_CLIP = 20;\n\nfunction forEachDescendant(vel, fn) {\n    const descendants = vel.children();\n    while (descendants.length > 0) {\n        const descendant = descendants.shift();\n        if (fn(descendant)) {\n            descendants.push(...descendant.children());\n        }\n    }\n}\n\nexport const mask = HighlighterView.extend({\n\n    tagName: 'rect',\n    className: 'highlight-mask',\n    attributes: {\n        'pointer-events': 'none'\n    },\n\n    options: {\n        padding: 3,\n        maskClip: MASK_CLIP,\n        deep: false,\n        attrs: {\n            'stroke': '#FEB663',\n            'stroke-width': 3,\n            'stroke-linecap': 'butt',\n            'stroke-linejoin': 'miter',\n        }\n    },\n\n    VISIBLE: 'white',\n    INVISIBLE: 'black',\n\n    MASK_ROOT_ATTRIBUTE_BLACKLIST: [\n        'marker-start',\n        'marker-end',\n        'marker-mid',\n        'transform',\n        'stroke-dasharray',\n        'class',\n    ],\n\n    MASK_CHILD_ATTRIBUTE_BLACKLIST: [\n        'stroke',\n        'fill',\n        'stroke-width',\n        'stroke-opacity',\n        'stroke-dasharray',\n        'fill-opacity',\n        'marker-start',\n        'marker-end',\n        'marker-mid',\n        'class',\n    ],\n\n    // TODO: change the list to a function callback\n    MASK_REPLACE_TAGS: [\n        'FOREIGNOBJECT',\n        'IMAGE',\n        'USE',\n        'TEXT',\n        'TSPAN',\n        'TEXTPATH'\n    ],\n\n    // TODO: change the list to a function callback\n    MASK_REMOVE_TAGS: [\n        'TEXT',\n        'TSPAN',\n        'TEXTPATH'\n    ],\n\n    transformMaskChild(cellView, childEl) {\n        const {\n            MASK_CHILD_ATTRIBUTE_BLACKLIST,\n            MASK_REPLACE_TAGS,\n            MASK_REMOVE_TAGS\n        } = this;\n        const childTagName = childEl.tagName();\n        // Do not include the element in the mask's image\n        if (!V.isSVGGraphicsElement(childEl) || MASK_REMOVE_TAGS.includes(childTagName)) {\n            childEl.remove();\n            return false;\n        }\n        // Replace the element with a rectangle\n        if (MASK_REPLACE_TAGS.includes(childTagName)) {\n            // Note: clone() method does not change the children ids\n            const originalChild = cellView.vel.findOne(`#${childEl.id}`);\n            if (originalChild) {\n                const { node: originalNode } = originalChild;\n                let childBBox = cellView.getNodeBoundingRect(originalNode);\n                if (cellView.model.isElement()) {\n                    childBBox = V.transformRect(childBBox, cellView.getNodeMatrix(originalNode));\n                }\n                const replacement = V('rect', childBBox.toJSON());\n                const { x: ox, y: oy } = childBBox.center();\n                const { angle, cx = ox, cy = oy } = originalChild.rotate();\n                if (angle) replacement.rotate(angle, cx, cy);\n                // Note: it's not important to keep the same sibling index since all subnodes are filled\n                childEl.parent().append(replacement);\n            }\n            childEl.remove();\n            return false;\n        }\n        // Keep the element, but clean it from certain attributes\n        MASK_CHILD_ATTRIBUTE_BLACKLIST.forEach(attrName => {\n            if (attrName === 'fill' && childEl.attr('fill') === 'none') return;\n            childEl.removeAttr(attrName);\n        });\n        return true;\n    },\n\n    transformMaskRoot(_cellView, rootEl) {\n        const { MASK_ROOT_ATTRIBUTE_BLACKLIST } = this;\n        MASK_ROOT_ATTRIBUTE_BLACKLIST.forEach(attrName => {\n            rootEl.removeAttr(attrName);\n        });\n    },\n\n    getMaskShape(cellView, vel) {\n        const { options, MASK_REPLACE_TAGS } = this;\n        const { deep } = options;\n        const tagName = vel.tagName();\n        let maskRoot;\n        if (tagName === 'G') {\n            if (!deep) return null;\n            maskRoot = vel.clone();\n            forEachDescendant(maskRoot, maskChild => this.transformMaskChild(cellView, maskChild));\n        } else {\n            if (MASK_REPLACE_TAGS.includes(tagName)) return null;\n            maskRoot = vel.clone();\n        }\n        this.transformMaskRoot(cellView, maskRoot);\n        return maskRoot;\n    },\n\n    getMaskId() {\n        return `highlight-mask-${this.cid}`;\n    },\n\n    getMask(cellView, vNode) {\n\n        const { VISIBLE, INVISIBLE, options } = this;\n        const { padding, attrs } = options;\n\n        const strokeWidth = ('stroke-width' in attrs) ? attrs['stroke-width'] : 1;\n        const hasNodeFill = vNode.attr('fill') !== 'none';\n        let magnetStrokeWidth = parseFloat(vNode.attr('stroke-width'));\n        if (isNaN(magnetStrokeWidth)) magnetStrokeWidth = 1;\n        // stroke of the invisible shape\n        const minStrokeWidth = magnetStrokeWidth + padding * 2;\n        // stroke of the visible shape\n        const maxStrokeWidth = minStrokeWidth + strokeWidth * 2;\n        let maskEl = this.getMaskShape(cellView, vNode);\n        if (!maskEl) {\n            const nodeBBox = cellView.getNodeBoundingRect(vNode.node);\n            // Make sure the rect is visible\n            nodeBBox.inflate(nodeBBox.width ? 0 : 0.5, nodeBBox.height ? 0 : 0.5);\n            maskEl =  V('rect', nodeBBox.toJSON());\n        }\n        maskEl.attr(attrs);\n        return V('mask', {\n            'id': this.getMaskId()\n        }).append([\n            maskEl.clone().attr({\n                'fill': hasNodeFill ? VISIBLE : 'none',\n                'stroke': VISIBLE,\n                'stroke-width': maxStrokeWidth\n            }),\n            maskEl.clone().attr({\n                'fill': hasNodeFill ? INVISIBLE : 'none',\n                'stroke': INVISIBLE,\n                'stroke-width': minStrokeWidth\n            })\n        ]);\n    },\n\n    removeMask(paper) {\n        const maskNode = paper.svg.getElementById(this.getMaskId());\n        if (maskNode) {\n            paper.defs.removeChild(maskNode);\n        }\n    },\n\n    addMask(paper, maskEl) {\n        paper.defs.appendChild(maskEl.node);\n    },\n\n    highlight(cellView, node) {\n        const { options, vel } = this;\n        const { padding, attrs, maskClip = MASK_CLIP, layer } = options;\n        const color = ('stroke' in attrs) ? attrs['stroke'] : '#000000';\n        if (!layer && node === cellView.el) {\n            // If the highlighter is appended to the cellView\n            // and we measure the size of the cellView wrapping group\n            // it's necessary to remove the highlighter first\n            vel.remove();\n        }\n        const highlighterBBox = cellView.getNodeBoundingRect(node).inflate(padding + maskClip);\n        const highlightMatrix = this.getNodeMatrix(cellView, node);\n        const maskEl = this.getMask(cellView, V(node));\n        this.addMask(cellView.paper, maskEl);\n        vel.attr(highlighterBBox.toJSON());\n        vel.attr({\n            'transform': V.matrixToTransformString(highlightMatrix),\n            'mask': `url(#${maskEl.id})`,\n            'fill': color\n        });\n    },\n\n    unhighlight(cellView) {\n        this.removeMask(cellView.paper);\n    }\n\n});\n","import * as util from '../util/index.mjs';\nimport V from '../V/index.mjs';\nimport { HighlighterView } from '../dia/HighlighterView.mjs';\n\nexport const opacity = HighlighterView.extend({\n\n    UPDATABLE: false,\n    MOUNTABLE: false,\n\n    opacityClassName: util.addClassNamePrefix('highlight-opacity'),\n\n    highlight: function(_cellView, node) {\n        V(node).addClass(this.opacityClassName);\n    },\n\n    unhighlight: function(_cellView, node) {\n        V(node).removeClass(this.opacityClassName);\n    }\n\n});\n","import * as util from '../util/index.mjs';\nimport V from '../V/index.mjs';\nimport { HighlighterView } from '../dia/HighlighterView.mjs';\n\nconst className = util.addClassNamePrefix('highlighted');\n\nexport const addClass = HighlighterView.extend({\n\n    UPDATABLE: false,\n    MOUNTABLE: false,\n\n    options: {\n        className\n    },\n\n    highlight: function(_cellView, node) {\n        V(node).addClass(this.options.className);\n    },\n\n    unhighlight: function(_cellView, node) {\n        V(node).removeClass(this.options.className);\n    }\n\n}, {\n    // Backwards Compatibility\n    className\n});\n","import { Rect } from '../g/index.mjs';\nimport { HighlighterView } from '../dia/HighlighterView.mjs';\nimport {\n    normalizeSides,\n    isEqual,\n} from '../util/index.mjs';\nimport {\n    Positions,\n    getRectPoint,\n} from '../util/getRectPoint.mjs';\n\nconst Directions = {\n    ROW: 'row',\n    COLUMN: 'column'\n};\n\nexport const list = HighlighterView.extend({\n\n    tagName: 'g',\n    MOUNTABLE: true,\n    UPDATE_ATTRIBUTES: function() {\n        return [this.options.attribute];\n    },\n\n    _prevItems: null,\n\n    highlight(elementView, node) {\n        const element = elementView.model;\n        const { attribute, size = 20, gap = 5, direction = Directions.ROW } = this.options;\n        if (!attribute) throw new Error('List: attribute is required');\n        const normalizedSize = (typeof size === 'number') ? { width: size, height: size } : size;\n        const isRowDirection = (direction === Directions.ROW);\n        const itemWidth = isRowDirection ? normalizedSize.width : normalizedSize.height;\n        let items = element.get(attribute);\n        if (!Array.isArray(items)) items = [];\n        const prevItems = this._prevItems || [];\n        const comparison = items.map((item, index) => isEqual(prevItems[index], items[index]));\n        if (prevItems.length !== items.length || comparison.some(unchanged => !unchanged)) {\n            const prevEls = this.vel.children();\n            const itemsEls = items.map((item, index) => {\n                const prevEl = (index in prevEls) ? prevEls[index].node : null;\n                if (comparison[index]) return prevEl;\n                const itemEl = this.createListItem(item, normalizedSize, prevEl);\n                if (!itemEl) return null;\n                if (!(itemEl instanceof SVGElement)) throw new Error('List: item must be an SVGElement');\n                itemEl.dataset.index = index;\n                itemEl.dataset.attribute = attribute;\n                const offset = index * (itemWidth + gap);\n                itemEl.setAttribute('transform', (isRowDirection)\n                    ? `translate(${offset}, 0)`\n                    : `translate(0, ${offset})`\n                );\n                return itemEl;\n            });\n            this.vel.empty().append(itemsEls);\n            this._prevItems = items;\n        }\n        const itemsCount = items.length;\n        const length = (itemsCount === 0)\n            ? 0\n            : (itemsCount * itemWidth + (itemsCount - 1) * gap);\n        const listSize = (isRowDirection)\n            ? { width: length, height: normalizedSize.height }\n            : { width: normalizedSize.width, height: length };\n\n        this.position(element, listSize);\n    },\n\n    position(element, listSize) {\n        const { vel, options } = this;\n        const { margin = 5, position = 'top-left' } = options;\n        const { width, height } = element.size();\n        const { left, right, top, bottom } = normalizeSides(margin);\n        const bbox = new Rect(left, top, width - (left + right), height - (top + bottom));\n        let { x, y } = getRectPoint(bbox, position);\n        // x\n        switch (position) {\n            case Positions.CENTER:\n            case Positions.TOP:\n            case Positions.BOTTOM: {\n                x -= listSize.width / 2;\n                break;\n            }\n            case Positions.RIGHT:\n            case Positions.BOTTOM_RIGHT:\n            case Positions.TOP_RIGHT: {\n                x -= listSize.width;\n                break;\n            }\n        }\n        // y\n        switch (position) {\n            case Positions.CENTER:\n            case Positions.RIGHT:\n            case Positions.LEFT: {\n                y -= listSize.height / 2;\n                break;\n            }\n            case Positions.BOTTOM:\n            case Positions.BOTTOM_RIGHT:\n            case Positions.BOTTOM_LEFT: {\n                y -= listSize.height;\n                break;\n            }\n        }\n        vel.attr('transform', `translate(${x}, ${y})`);\n    }\n}, {\n    Directions,\n    Positions\n});\n","import { Line, Point } from '../g/index.mjs';\nimport { isPercentage } from '../util/index.mjs';\n\nfunction connectionRatio(view, _magnet, _refPoint, opt) {\n\n    var ratio = ('ratio' in opt) ? opt.ratio : 0.5;\n    return view.getPointAtRatio(ratio);\n}\n\nfunction connectionLength(view, _magnet, _refPoint, opt) {\n\n    var length = ('length' in opt) ? opt.length : 20;\n    return view.getPointAtLength(length);\n}\n\nfunction _connectionPerpendicular(view, _magnet, refPoint, opt) {\n\n    var OFFSET = 1e6;\n    var path = view.getConnection();\n    var segmentSubdivisions = view.getConnectionSubdivisions();\n    var verticalLine = new Line(refPoint.clone().offset(0, OFFSET), refPoint.clone().offset(0, -OFFSET));\n    var horizontalLine = new Line(refPoint.clone().offset(OFFSET, 0), refPoint.clone().offset(-OFFSET, 0));\n    var verticalIntersections = verticalLine.intersect(path, { segmentSubdivisions: segmentSubdivisions });\n    var horizontalIntersections = horizontalLine.intersect(path, { segmentSubdivisions: segmentSubdivisions });\n    var intersections = [];\n    if (verticalIntersections) Array.prototype.push.apply(intersections, verticalIntersections);\n    if (horizontalIntersections) Array.prototype.push.apply(intersections, horizontalIntersections);\n    if (intersections.length > 0) return refPoint.chooseClosest(intersections);\n    if ('fallbackAt' in opt) {\n        return getPointAtLink(view, opt.fallbackAt);\n    }\n    return connectionClosest(view, _magnet, refPoint, opt);\n}\n\nfunction _connectionClosest(view, _magnet, refPoint, _opt) {\n\n    var closestPoint = view.getClosestPoint(refPoint);\n    if (!closestPoint) return new Point();\n    return closestPoint;\n}\n\nexport function resolveRef(fn) {\n    return function(view, magnet, ref, opt) {\n        if (ref instanceof Element) {\n            var refView = this.paper.findView(ref);\n            var refPoint;\n            if (refView) {\n                if (refView.isNodeConnection(ref)) {\n                    var distance = ('fixedAt' in opt) ? opt.fixedAt : '50%';\n                    refPoint = getPointAtLink(refView, distance);\n                } else {\n                    refPoint = refView.getNodeBBox(ref).center();\n                }\n            } else {\n                // Something went wrong\n                refPoint = new Point();\n            }\n            return fn.call(this, view, magnet, refPoint, opt);\n        }\n        return fn.apply(this, arguments);\n    };\n}\n\nfunction getPointAtLink(view, value) {\n    var parsedValue = parseFloat(value);\n    if (isPercentage(value)) {\n        return view.getPointAtRatio(parsedValue / 100);\n    } else {\n        return view.getPointAtLength(parsedValue);\n    }\n}\n\n// joint.linkAnchors\nexport { connectionRatio, connectionLength };\nexport const connectionPerpendicular = resolveRef(_connectionPerpendicular);\nexport const connectionClosest = resolveRef(_connectionClosest);\n","import * as g from '../g/index.mjs';\nimport V from '../V/index.mjs';\nimport * as util from '../util/index.mjs';\n\nfunction offsetPoint(p1, p2, offset) {\n    if (util.isPlainObject(offset)) {\n        const { x, y } = offset;\n        if (isFinite(y)) {\n            const line =  new g.Line(p2, p1);\n            const { start, end } = line.parallel(y);\n            p2 = start;\n            p1 = end;\n        }\n        offset = x;\n    }\n    if (!isFinite(offset)) return p1;\n    var length = p1.distance(p2);\n    if (offset === 0 && length > 0) return p1;\n    return p1.move(p2, -Math.min(offset, length - 1));\n}\n\nfunction stroke(magnet) {\n\n    var stroke = magnet.getAttribute('stroke-width');\n    if (stroke === null) return 0;\n    return parseFloat(stroke) || 0;\n}\n\nfunction alignLine(line, type, offset = 0) {\n    let coordinate, a, b, direction;\n    const { start, end } = line;\n    switch (type) {\n        case 'left':\n            coordinate = 'x';\n            a = end;\n            b = start;\n            direction = -1;\n            break;\n        case 'right':\n            coordinate = 'x';\n            a = start;\n            b = end;\n            direction = 1;\n            break;\n        case 'top':\n            coordinate = 'y';\n            a = end;\n            b = start;\n            direction = -1;\n            break;\n        case 'bottom':\n            coordinate = 'y';\n            a = start;\n            b = end;\n            direction = 1;\n            break;\n        default:\n            return;\n    }\n    if (start[coordinate] < end[coordinate]) {\n        a[coordinate] = b[coordinate];\n    } else {\n        b[coordinate] = a[coordinate];\n    }\n    if (isFinite(offset)) {\n        a[coordinate] += direction * offset;\n        b[coordinate] += direction * offset;\n    }\n}\n\n// Connection Points\n\nfunction anchorConnectionPoint(line, _view, _magnet, opt) {\n    let { offset, alignOffset, align } = opt;\n    if (align) alignLine(line, align, alignOffset);\n    return offsetPoint(line.end, line.start, offset);\n}\n\nfunction bboxIntersection(line, view, magnet, opt) {\n\n    var bbox = view.getNodeBBox(magnet);\n    if (opt.stroke) bbox.inflate(stroke(magnet) / 2);\n    var intersections = line.intersect(bbox);\n    var cp = (intersections)\n        ? line.start.chooseClosest(intersections)\n        : line.end;\n    return offsetPoint(cp, line.start, opt.offset);\n}\n\nfunction rectangleIntersection(line, view, magnet, opt) {\n\n    var angle = view.model.angle();\n    if (angle === 0) {\n        return bboxIntersection(line, view, magnet, opt);\n    }\n\n    var bboxWORotation = view.getNodeUnrotatedBBox(magnet);\n    if (opt.stroke) bboxWORotation.inflate(stroke(magnet) / 2);\n    var center = bboxWORotation.center();\n    var lineWORotation = line.clone().rotate(center, angle);\n    var intersections = lineWORotation.setLength(1e6).intersect(bboxWORotation);\n    var cp = (intersections)\n        ? lineWORotation.start.chooseClosest(intersections).rotate(center, -angle)\n        : line.end;\n    return offsetPoint(cp, line.start, opt.offset);\n}\n\nfunction findShapeNode(magnet) {\n    if (!magnet) return null;\n    var node = magnet;\n    do {\n        var tagName = node.tagName;\n        if (typeof tagName !== 'string') return null;\n        tagName = tagName.toUpperCase();\n        if (tagName === 'G') {\n            node = node.firstElementChild;\n        } else if (tagName === 'TITLE') {\n            node = node.nextElementSibling;\n        } else break;\n    } while (node);\n    return node;\n}\n\nvar BNDR_SUBDIVISIONS = 'segmentSubdivisons';\nvar BNDR_SHAPE_BBOX = 'shapeBBox';\n\nfunction boundaryIntersection(line, view, magnet, opt) {\n\n    var node, intersection;\n    var selector = opt.selector;\n    var anchor = line.end;\n\n    if (typeof selector === 'string') {\n        node = view.findBySelector(selector)[0];\n    } else if (selector === false) {\n        node = magnet;\n    } else if (Array.isArray(selector)) {\n        node = util.getByPath(magnet, selector);\n    } else {\n        node = findShapeNode(magnet);\n    }\n\n    if (!V.isSVGGraphicsElement(node)) {\n        if (node === magnet || !V.isSVGGraphicsElement(magnet)) return anchor;\n        node = magnet;\n    }\n\n    var localShape = view.getNodeShape(node);\n    var magnetMatrix = view.getNodeMatrix(node);\n    var translateMatrix = view.getRootTranslateMatrix();\n    var rotateMatrix = view.getRootRotateMatrix();\n    var targetMatrix = translateMatrix.multiply(rotateMatrix).multiply(magnetMatrix);\n    var localMatrix = targetMatrix.inverse();\n    var localLine = V.transformLine(line, localMatrix);\n    var localRef = localLine.start.clone();\n    var data = view.getNodeData(node);\n\n    if (opt.insideout === false) {\n        if (!data[BNDR_SHAPE_BBOX]) data[BNDR_SHAPE_BBOX] = localShape.bbox();\n        var localBBox = data[BNDR_SHAPE_BBOX];\n        if (localBBox.containsPoint(localRef)) return anchor;\n    }\n\n    // Caching segment subdivisions for paths\n    var pathOpt;\n    if (localShape instanceof g.Path) {\n        var precision = opt.precision || 2;\n        if (!data[BNDR_SUBDIVISIONS]) data[BNDR_SUBDIVISIONS] = localShape.getSegmentSubdivisions({ precision: precision });\n        pathOpt = {\n            precision: precision,\n            segmentSubdivisions: data[BNDR_SUBDIVISIONS]\n        };\n    }\n\n    if (opt.extrapolate === true) localLine.setLength(1e6);\n\n    intersection = localLine.intersect(localShape, pathOpt);\n    if (intersection) {\n        // More than one intersection\n        if (V.isArray(intersection)) intersection = localRef.chooseClosest(intersection);\n    } else if (opt.sticky === true) {\n        // No intersection, find the closest point instead\n        if (localShape instanceof g.Rect) {\n            intersection = localShape.pointNearestToPoint(localRef);\n        } else if (localShape instanceof g.Ellipse) {\n            intersection = localShape.intersectionWithLineFromCenterToPoint(localRef);\n        } else {\n            intersection = localShape.closestPoint(localRef, pathOpt);\n        }\n    }\n\n    var cp = (intersection) ? V.transformPoint(intersection, targetMatrix) : anchor;\n    var cpOffset = opt.offset || 0;\n    if (opt.stroke) cpOffset += stroke(node) / 2;\n\n    return offsetPoint(cp, line.start, cpOffset);\n}\n\nexport const anchor = anchorConnectionPoint;\nexport const bbox = bboxIntersection;\nexport const rectangle = rectangleIntersection;\nexport const boundary = boundaryIntersection;\n","import * as util from '../util/index.mjs';\nimport { toRad } from '../g/index.mjs';\nimport { resolveRef } from '../linkAnchors/index.mjs';\n\nfunction bboxWrapper(method) {\n\n    return function(view, magnet, ref, opt) {\n\n        var rotate = !!opt.rotate;\n        var bbox = (rotate) ? view.getNodeUnrotatedBBox(magnet) : view.getNodeBBox(magnet);\n        var anchor = bbox[method]();\n\n        var dx = opt.dx;\n        if (dx) {\n            var dxPercentage = util.isPercentage(dx);\n            dx = parseFloat(dx);\n            if (isFinite(dx)) {\n                if (dxPercentage) {\n                    dx /= 100;\n                    dx *= bbox.width;\n                }\n                anchor.x += dx;\n            }\n        }\n\n        var dy = opt.dy;\n        if (dy) {\n            var dyPercentage = util.isPercentage(dy);\n            dy = parseFloat(dy);\n            if (isFinite(dy)) {\n                if (dyPercentage) {\n                    dy /= 100;\n                    dy *= bbox.height;\n                }\n                anchor.y += dy;\n            }\n        }\n\n        return (rotate) ? anchor.rotate(view.model.getBBox().center(), -view.model.angle()) : anchor;\n    };\n}\n\nfunction _perpendicular(view, magnet, refPoint, opt) {\n\n    var angle = view.model.angle();\n    var bbox = view.getNodeBBox(magnet);\n    var anchor = bbox.center();\n    var topLeft = bbox.origin();\n    var bottomRight = bbox.corner();\n\n    var padding = opt.padding;\n    if (!isFinite(padding)) padding = 0;\n\n    if ((topLeft.y + padding) <= refPoint.y && refPoint.y <= (bottomRight.y - padding)) {\n        var dy = (refPoint.y - anchor.y);\n        anchor.x += (angle === 0 || angle === 180) ? 0 : dy * 1 / Math.tan(toRad(angle));\n        anchor.y += dy;\n    } else if ((topLeft.x + padding) <= refPoint.x && refPoint.x <= (bottomRight.x - padding)) {\n        var dx = (refPoint.x - anchor.x);\n        anchor.y += (angle === 90 || angle === 270) ? 0 : dx * Math.tan(toRad(angle));\n        anchor.x += dx;\n    }\n\n    return anchor;\n}\n\nfunction _midSide(view, magnet, refPoint, opt) {\n\n    var rotate = !!opt.rotate;\n    var bbox, angle, center;\n    if (rotate) {\n        bbox = view.getNodeUnrotatedBBox(magnet);\n        center = view.model.getBBox().center();\n        angle = view.model.angle();\n    } else {\n        bbox = view.getNodeBBox(magnet);\n    }\n\n    var padding = opt.padding;\n    if (isFinite(padding)) bbox.inflate(padding);\n\n    if (rotate) refPoint.rotate(center, angle);\n\n    var side = bbox.sideNearestToPoint(refPoint);\n    var anchor;\n    switch (side) {\n        case 'left':\n            anchor = bbox.leftMiddle();\n            break;\n        case 'right':\n            anchor = bbox.rightMiddle();\n            break;\n        case 'top':\n            anchor = bbox.topMiddle();\n            break;\n        case 'bottom':\n            anchor = bbox.bottomMiddle();\n            break;\n    }\n\n    return (rotate) ? anchor.rotate(center, -angle) : anchor;\n}\n\n// Can find anchor from model, when there is no selector or the link end\n// is connected to a port\nfunction _modelCenter(view, _magnet, _refPoint, opt, endType) {\n    return view.model.getPointFromConnectedLink(this.model, endType).offset(opt.dx, opt.dy);\n}\n\n//joint.anchors\nexport const center = bboxWrapper('center');\nexport const top = bboxWrapper('topMiddle');\nexport const bottom = bboxWrapper('bottomMiddle');\nexport const left = bboxWrapper('leftMiddle');\nexport const right = bboxWrapper('rightMiddle');\nexport const topLeft = bboxWrapper('origin');\nexport const topRight = bboxWrapper('topRight');\nexport const bottomLeft = bboxWrapper('bottomLeft');\nexport const bottomRight = bboxWrapper('corner');\nexport const perpendicular = resolveRef(_perpendicular);\nexport const midSide = resolveRef(_midSide);\nexport const modelCenter = _modelCenter;\n\n","import V from '../V/index.mjs';\nimport {\n    isNumber,\n    assign,\n    nextFrame,\n    isObject,\n    cancelFrame,\n    defaults,\n    defaultsDeep,\n    addClassNamePrefix,\n    normalizeSides,\n    isFunction,\n    isPlainObject,\n    getByPath,\n    sortElements,\n    isString,\n    guid,\n    normalizeEvent,\n    normalizeWheel,\n    cap,\n    debounce,\n    omit,\n    result,\n    merge,\n    camelCase,\n    cloneDeep,\n    invoke,\n    hashCode,\n    filter as _filter,\n    parseDOMJSON,\n    toArray,\n    has\n} from '../util/index.mjs';\nimport { Rect, Point, toRad } from '../g/index.mjs';\nimport { View, views } from '../mvc/index.mjs';\nimport { CellView } from './CellView.mjs';\nimport { ElementView } from './ElementView.mjs';\nimport { LinkView } from './LinkView.mjs';\nimport { Link } from './Link.mjs';\nimport { Cell } from './Cell.mjs';\nimport { Graph } from './Graph.mjs';\nimport { LayersNames, PaperLayer } from './PaperLayer.mjs';\nimport * as highlighters from '../highlighters/index.mjs';\nimport * as linkAnchors from '../linkAnchors/index.mjs';\nimport * as connectionPoints from '../connectionPoints/index.mjs';\nimport * as anchors from '../anchors/index.mjs';\n\nimport $ from 'jquery';\nimport Backbone from 'backbone';\n\nconst sortingTypes = {\n    NONE: 'sorting-none',\n    APPROX: 'sorting-approximate',\n    EXACT: 'sorting-exact'\n};\n\nconst WHEEL_CAP = 50;\nconst WHEEL_WAIT_MS = 20;\nconst MOUNT_BATCH_SIZE = 1000;\nconst UPDATE_BATCH_SIZE = Infinity;\nconst MIN_PRIORITY = 9007199254740991; // Number.MAX_SAFE_INTEGER\n\nconst HighlightingTypes = CellView.Highlighting;\n\nconst defaultHighlighting = {\n    [HighlightingTypes.DEFAULT]: {\n        name: 'stroke',\n        options: {\n            padding: 3\n        }\n    },\n    [HighlightingTypes.MAGNET_AVAILABILITY]: {\n        name: 'addClass',\n        options: {\n            className: 'available-magnet'\n        }\n    },\n    [HighlightingTypes.ELEMENT_AVAILABILITY]: {\n        name: 'addClass',\n        options: {\n            className: 'available-cell'\n        }\n    }\n};\n\nconst defaultLayers = [{\n    name: LayersNames.BACK,\n}, {\n    name: LayersNames.CELLS,\n}, {\n    name: LayersNames.LABELS,\n}, {\n    name: LayersNames.FRONT\n}, {\n    name: LayersNames.TOOLS\n}];\n\nexport const Paper = View.extend({\n\n    className: 'paper',\n\n    options: {\n\n        width: 800,\n        height: 600,\n        origin: { x: 0, y: 0 }, // x,y coordinates in top-left corner\n        gridSize: 1,\n        // Whether or not to draw the grid lines on the paper's DOM element.\n        // e.g drawGrid: true, drawGrid: { color: 'red', thickness: 2 }\n        drawGrid: false,\n        // If not set, the size of the visual grid is the same as the `gridSize`.\n        drawGridSize: null,\n\n        // Whether or not to draw the background on the paper's DOM element.\n        // e.g. background: { color: 'lightblue', image: '/paper-background.png', repeat: 'flip-xy' }\n        background: false,\n\n        perpendicularLinks: false,\n        elementView: ElementView,\n        linkView: LinkView,\n        snapLabels: false, // false, true\n        snapLinks: false, // false, true, { radius: value }\n        snapLinksSelf: false, // false, true, { radius: value }\n\n        // Should the link labels be rendered into its own layer?\n        // `false` - the labels are part of the links\n        // `true` - the labels are appended to LayersName.LABELS\n        // [LayersName] - the labels are appended to the layer specified\n        labelsLayer: false,\n\n        // When set to FALSE, an element may not have more than 1 link with the same source and target element.\n        multiLinks: true,\n\n        // For adding custom guard logic.\n        guard: function(evt, view) {\n\n            // FALSE means the event isn't guarded.\n            return false;\n        },\n\n        highlighting: defaultHighlighting,\n\n        // Prevent the default context menu from being displayed.\n        preventContextMenu: true,\n\n        // Prevent the default action for blank:pointer<action>.\n        preventDefaultBlankAction: true,\n\n        // Prevent the default action for cell:pointer<action>.\n        preventDefaultViewAction: true,\n\n        // Restrict the translation of elements by given bounding box.\n        // Option accepts a boolean:\n        //  true - the translation is restricted to the paper area\n        //  false - no restrictions\n        // A method:\n        // restrictTranslate: function(elementView) {\n        //     var parentId = elementView.model.get('parent');\n        //     return parentId && this.model.getCell(parentId).getBBox();\n        // },\n        // Or a bounding box:\n        // restrictTranslate: { x: 10, y: 10, width: 790, height: 590 }\n        restrictTranslate: false,\n\n        // Marks all available magnets with 'available-magnet' class name and all available cells with\n        // 'available-cell' class name. Marks them when dragging a link is started and unmark\n        // when the dragging is stopped.\n        markAvailable: false,\n\n        // Defines what link model is added to the graph after an user clicks on an active magnet.\n        // Value could be the Backbone.model or a function returning the Backbone.model\n        // defaultLink: function(elementView, magnet) { return condition ? new customLink1() : new customLink2() }\n        defaultLink: new Link,\n\n        // A connector that is used by links with no connector defined on the model.\n        // e.g. { name: 'rounded', args: { radius: 5 }} or a function\n        defaultConnector: { name: 'normal' },\n\n        // A router that is used by links with no router defined on the model.\n        // e.g. { name: 'oneSide', args: { padding: 10 }} or a function\n        defaultRouter: { name: 'normal' },\n\n        defaultAnchor: { name: 'center' },\n\n        defaultLinkAnchor: { name: 'connectionRatio' },\n\n        defaultConnectionPoint: { name: 'bbox' },\n\n        /* CONNECTING */\n\n        connectionStrategy: null,\n\n        // Check whether to add a new link to the graph when user clicks on an a magnet.\n        validateMagnet: function(_cellView, magnet, _evt) {\n            return magnet.getAttribute('magnet') !== 'passive';\n        },\n\n        // Check whether to allow or disallow the link connection while an arrowhead end (source/target)\n        // being changed.\n        validateConnection: function(cellViewS, _magnetS, cellViewT, _magnetT, end, _linkView) {\n            return (end === 'target' ? cellViewT : cellViewS) instanceof ElementView;\n        },\n\n        /* EMBEDDING */\n\n        // Enables embedding. Re-parent the dragged element with elements under it and makes sure that\n        // all links and elements are visible taken the level of embedding into account.\n        embeddingMode: false,\n\n        // Check whether to allow or disallow the element embedding while an element being translated.\n        validateEmbedding: function(childView, parentView) {\n            // by default all elements can be in relation child-parent\n            return true;\n        },\n\n        // Check whether to allow or disallow an embedded element to be unembedded / to become a root.\n        validateUnembedding: function(childView) {\n            // by default all elements can become roots\n            return true;\n        },\n\n        // Determines the way how a cell finds a suitable parent when it's dragged over the paper.\n        // The cell with the highest z-index (visually on the top) will be chosen.\n        findParentBy: 'bbox', // 'bbox'|'center'|'origin'|'corner'|'topRight'|'bottomLeft'\n\n        // If enabled only the element on the very front is taken into account for the embedding.\n        // If disabled the elements under the dragged view are tested one by one\n        // (from front to back) until a valid parent found.\n        frontParentOnly: true,\n\n        // Interactive flags. See online docs for the complete list of interactive flags.\n        interactive: {\n            labelMove: false\n        },\n\n        // When set to true the links can be pinned to the paper.\n        // i.e. link source/target can be a point e.g. link.get('source') ==> { x: 100, y: 100 };\n        linkPinning: true,\n\n        // Custom validation after an interaction with a link ends.\n        // Recognizes a function. If `false` is returned, the link is disallowed (removed or reverted)\n        // (linkView, paper) => boolean\n        allowLink: null,\n\n        // Allowed number of mousemove events after which the pointerclick event will be still triggered.\n        clickThreshold: 0,\n\n        // Number of required mousemove events before the first pointermove event will be triggered.\n        moveThreshold: 0,\n\n        // Number of required mousemove events before a link is created out of the magnet.\n        // Or string `onleave` so the link is created when the pointer leaves the magnet\n        magnetThreshold: 0,\n\n        // Rendering Options\n\n        sorting: sortingTypes.EXACT,\n\n        frozen: false,\n\n        autoFreeze: false,\n\n        // no docs yet\n        onViewUpdate: function(view, flag, priority, opt, paper) {\n            // Do not update connected links when:\n            // 1. the view was just inserted (added to the graph and rendered)\n            // 2. the view was just mounted (added back to the paper by viewport function)\n            // 3. the change was marked as `isolate`.\n            // 4. the view model was just removed from the graph\n            if ((flag & (view.FLAG_INSERT | view.FLAG_REMOVE)) || opt.mounting || opt.isolate) return;\n            paper.requestConnectedLinksUpdate(view, priority, opt);\n        },\n\n        // no docs yet\n        onViewPostponed: function(view, flag, paper) {\n            return paper.forcePostponedViewUpdate(view, flag);\n        },\n\n        beforeRender: null, // function(opt, paper) { },\n\n        afterRender: null, // function(stats, opt, paper) {\n\n        viewport: null,\n\n        // Default namespaces\n\n        cellViewNamespace: null,\n\n        routerNamespace: null,\n\n        connectorNamespace: null,\n\n        highlighterNamespace: highlighters,\n\n        anchorNamespace: anchors,\n\n        linkAnchorNamespace: linkAnchors,\n\n        connectionPointNamespace: connectionPoints,\n\n        overflow: false\n    },\n\n    events: {\n        'dblclick': 'pointerdblclick',\n        'dbltap': 'pointerdblclick',\n        'contextmenu': 'contextmenu',\n        'mousedown': 'pointerdown',\n        'touchstart': 'pointerdown',\n        'mouseover': 'mouseover',\n        'mouseout': 'mouseout',\n        'mouseenter': 'mouseenter',\n        'mouseleave': 'mouseleave',\n        'wheel': 'mousewheel',\n        'mouseenter .joint-cell': 'mouseenter',\n        'mouseleave .joint-cell': 'mouseleave',\n        'mouseenter .joint-tools': 'mouseenter',\n        'mouseleave .joint-tools': 'mouseleave',\n        'dblclick .joint-cell [magnet]': 'magnetpointerdblclick',\n        'contextmenu .joint-cell [magnet]': 'magnetcontextmenu',\n        'mousedown .joint-link .label': 'onlabel', // interaction with link label\n        'touchstart .joint-link .label': 'onlabel',\n        'dragstart .joint-cell image': 'onImageDragStart' // firefox fix\n    },\n\n    documentEvents: {\n        'mousemove': 'pointermove',\n        'touchmove': 'pointermove',\n        'mouseup': 'pointerup',\n        'touchend': 'pointerup',\n        'touchcancel': 'pointerup'\n    },\n\n    svg: null,\n    viewport: null,\n    defs: null,\n    tools: null,\n    $background: null,\n    layers: null,\n    $grid: null,\n    $document: null,\n\n    // For storing the current transformation matrix (CTM) of the paper's viewport.\n    _viewportMatrix: null,\n    // For verifying whether the CTM is up-to-date. The viewport transform attribute\n    // could have been manipulated directly.\n    _viewportTransformString: null,\n    // Updates data (priorities, unmounted views etc.)\n    _updates: null,\n    // Paper Layers\n    _layers: null,\n\n    SORT_DELAYING_BATCHES: ['add', 'to-front', 'to-back'],\n    UPDATE_DELAYING_BATCHES: ['translate'],\n    // If you interact with these elements,\n    // the default interaction such as `element move` is prevented.\n    FORM_CONTROL_TAG_NAMES: ['TEXTAREA', 'INPUT', 'BUTTON', 'SELECT', 'OPTION'] ,\n    // If you interact with these elements, the events are not propagated to the paper\n    // i.e. paper events such as `element:pointerdown` are not triggered.\n    GUARDED_TAG_NAMES: [\n        // Guard <select> for consistency. When you click on it:\n        // Chrome: triggers `pointerdown`, `pointerup`, `pointerclick` to open\n        // Firefox: triggers `pointerdown` on open, `pointerup` (and `pointerclick` only if you haven't moved).\n        //          on close. However, if you open and then close by clicking elsewhere on the page,\n        //           no other event is triggered.\n        // Safari: when you open it, it triggers `pointerdown`. That's it.\n        'SELECT',\n    ],\n    MIN_SCALE: 1e-6,\n\n    init: function() {\n\n        const { options, el } = this;\n        if (!options.cellViewNamespace) {\n            /* eslint-disable no-undef */\n            options.cellViewNamespace = typeof joint !== 'undefined' && has(joint, 'shapes') ? joint.shapes : null;\n            /* eslint-enable no-undef */\n        }\n\n        const model = this.model = options.model || new Graph;\n\n        // Layers (SVGGroups)\n        this._layers = {};\n\n        this.setGrid(options.drawGrid);\n        this.cloneOptions();\n        this.render();\n        this._setDimensions();\n        this.startListening();\n\n        // Hash of all cell views.\n        this._views = {};\n\n        // Mouse wheel events buffer\n        this._mw_evt_buffer = {\n            event: null,\n            deltas: [],\n        };\n\n        // Reference to the paper owner document\n        this.$document = $(el.ownerDocument);\n        // Render existing cells in the graph\n        this.resetViews(model.attributes.cells.models);\n        // Start the Rendering Loop\n        if (!this.isFrozen() && this.isAsync()) this.updateViewsAsync();\n    },\n\n    _resetUpdates: function() {\n        return this._updates = {\n            id: null,\n            priorities: [{}, {}, {}],\n            unmountedCids: [],\n            mountedCids: [],\n            unmounted: {},\n            mounted: {},\n            count: 0,\n            keyFrozen: false,\n            freezeKey: null,\n            sort: false,\n            disabled: false,\n            idle: false\n        };\n    },\n\n    startListening: function() {\n        var model = this.model;\n        this.listenTo(model, 'add', this.onCellAdded)\n            .listenTo(model, 'remove', this.onCellRemoved)\n            .listenTo(model, 'change', this.onCellChange)\n            .listenTo(model, 'reset', this.onGraphReset)\n            .listenTo(model, 'sort', this.onGraphSort)\n            .listenTo(model, 'batch:stop', this.onGraphBatchStop);\n        this.on('cell:highlight', this.onCellHighlight)\n            .on('cell:unhighlight', this.onCellUnhighlight)\n            .on('scale translate', this.update);\n    },\n\n    onCellAdded: function(cell, _, opt) {\n        var position = opt.position;\n        if (this.isAsync() || !isNumber(position)) {\n            this.renderView(cell, opt);\n        } else {\n            if (opt.maxPosition === position) this.freeze({ key: 'addCells' });\n            this.renderView(cell, opt);\n            if (position === 0) this.unfreeze({ key: 'addCells' });\n        }\n    },\n\n    onCellRemoved: function(cell, _, opt) {\n        const view = this.findViewByModel(cell);\n        if (view) this.requestViewUpdate(view, view.FLAG_REMOVE, view.UPDATE_PRIORITY, opt);\n    },\n\n    onCellChange: function(cell, opt) {\n        if (cell === this.model.attributes.cells) return;\n        if (cell.hasChanged('z') && this.options.sorting === sortingTypes.APPROX) {\n            const view = this.findViewByModel(cell);\n            if (view) this.requestViewUpdate(view, view.FLAG_INSERT, view.UPDATE_PRIORITY, opt);\n        }\n    },\n\n    onGraphReset: function(collection, opt) {\n        this.resetLayers();\n        this.resetViews(collection.models, opt);\n    },\n\n    onGraphSort: function() {\n        if (this.model.hasActiveBatch(this.SORT_DELAYING_BATCHES)) return;\n        this.sortViews();\n    },\n\n    onGraphBatchStop: function(data) {\n        if (this.isFrozen()) return;\n        var name = data && data.batchName;\n        var graph = this.model;\n        if (!this.isAsync()) {\n            var updateDelayingBatches = this.UPDATE_DELAYING_BATCHES;\n            if (updateDelayingBatches.includes(name) && !graph.hasActiveBatch(updateDelayingBatches)) {\n                this.updateViews(data);\n            }\n        }\n        var sortDelayingBatches = this.SORT_DELAYING_BATCHES;\n        if (sortDelayingBatches.includes(name) && !graph.hasActiveBatch(sortDelayingBatches)) {\n            this.sortViews();\n        }\n    },\n\n    cloneOptions: function() {\n\n        const { options } = this;\n        const {\n            defaultConnector,\n            defaultRouter,\n            defaultConnectionPoint,\n            defaultAnchor,\n            defaultLinkAnchor,\n            origin,\n            highlighting,\n            cellViewNamespace,\n            interactive\n        } = options;\n\n        // Default cellView namespace for ES5\n        /* eslint-disable no-undef */\n        if (!cellViewNamespace && typeof joint !== 'undefined' && has(joint, 'shapes')) {\n            options.cellViewNamespace = joint.shapes;\n        }\n        /* eslint-enable no-undef */\n\n        // Here if a function was provided, we can not clone it, as this would result in loosing the function.\n        // If the default is used, the cloning is necessary in order to prevent modifying the options on prototype.\n        if (!isFunction(defaultConnector)) {\n            options.defaultConnector = cloneDeep(defaultConnector);\n        }\n        if (!isFunction(defaultRouter)) {\n            options.defaultRouter = cloneDeep(defaultRouter);\n        }\n        if (!isFunction(defaultConnectionPoint)) {\n            options.defaultConnectionPoint = cloneDeep(defaultConnectionPoint);\n        }\n        if (!isFunction(defaultAnchor)) {\n            options.defaultAnchor = cloneDeep(defaultAnchor);\n        }\n        if (!isFunction(defaultLinkAnchor)) {\n            options.defaultLinkAnchor = cloneDeep(defaultLinkAnchor);\n        }\n        if (isPlainObject(interactive)) {\n            options.interactive = assign({}, interactive);\n        }\n        if (isPlainObject(highlighting)) {\n            // Return the default highlighting options into the user specified options.\n            options.highlighting = defaultsDeep({}, highlighting, defaultHighlighting);\n        }\n        options.origin = assign({}, origin);\n    },\n\n    children: function() {\n        var ns = V.namespace;\n        return [{\n            namespaceURI: ns.xhtml,\n            tagName: 'div',\n            className: addClassNamePrefix('paper-background'),\n            selector: 'background'\n        }, {\n            namespaceURI: ns.xhtml,\n            tagName: 'div',\n            className: addClassNamePrefix('paper-grid'),\n            selector: 'grid'\n        }, {\n            namespaceURI: ns.svg,\n            tagName: 'svg',\n            attributes: {\n                'width': '100%',\n                'height': '100%',\n                'xmlns:xlink': ns.xlink\n            },\n            selector: 'svg',\n            children: [{\n                // Append `<defs>` element to the SVG document. This is useful for filters and gradients.\n                // It's desired to have the defs defined before the viewport (e.g. to make a PDF document pick up defs properly).\n                tagName: 'defs',\n                selector: 'defs'\n            }, {\n                tagName: 'g',\n                className: addClassNamePrefix('layers'),\n                selector: 'layers'\n            }]\n        }];\n    },\n\n    hasLayerView(layerName) {\n        return  (layerName in this._layers);\n    },\n\n    getLayerView(layerName) {\n        const { _layers } = this;\n        if (layerName in _layers) return _layers[layerName];\n        throw new Error(`dia.Paper: Unknown layer \"${layerName}\"`);\n    },\n\n    getLayerNode(layerName) {\n        return this.getLayerView(layerName).el;\n    },\n\n    render: function() {\n\n        this.renderChildren();\n        const { childNodes, options } = this;\n        const { svg, defs, layers, background, grid } = childNodes;\n\n        svg.style.overflow = options.overflow ? 'visible' : 'hidden';\n\n        this.svg = svg;\n        this.defs = defs;\n        this.layers = layers;\n        this.$background = $(background);\n        this.$grid = $(grid);\n\n        this.renderLayers();\n\n        V.ensureId(svg);\n\n        if (options.background) {\n            this.drawBackground(options.background);\n        }\n\n        if (options.drawGrid) {\n            this.drawGrid();\n        }\n\n        return this;\n    },\n\n    renderLayers: function(layers = defaultLayers) {\n        this.removeLayers();\n        // TODO: Layers to be read from the graph `layers` attribute\n        layers.forEach(({ name, sorted }) => {\n            const layerView = new PaperLayer({ name });\n            this.layers.appendChild(layerView.el);\n            this._layers[name] = layerView;\n        });\n        // Throws an exception if doesn't exist\n        const cellsLayerView = this.getLayerView(LayersNames.CELLS);\n        const toolsLayerView = this.getLayerView(LayersNames.TOOLS);\n        const labelsLayerView = this.getLayerView(LayersNames.LABELS);\n        // backwards compatibility\n        this.tools = toolsLayerView.el;\n        this.cells = this.viewport = cellsLayerView.el;\n        // user-select: none;\n        cellsLayerView.vel.addClass(addClassNamePrefix('viewport'));\n        labelsLayerView.vel.addClass(addClassNamePrefix('viewport'));\n    },\n\n    removeLayers: function() {\n        const { _layers } = this;\n        Object.keys(_layers).forEach(name => {\n            _layers[name].remove();\n            delete _layers[name];\n        });\n    },\n\n    resetLayers: function() {\n        const { _layers } = this;\n        Object.keys(_layers).forEach(name => {\n            _layers[name].removePivots();\n        });\n    },\n\n    update: function() {\n\n        if (this.options.drawGrid) {\n            this.drawGrid();\n        }\n\n        if (this._background) {\n            this.updateBackgroundImage(this._background);\n        }\n\n        return this;\n    },\n\n    matrix: function(ctm) {\n\n        var viewport = this.layers;\n\n        // Getter:\n        if (ctm === undefined) {\n\n            var transformString = viewport.getAttribute('transform');\n\n            if ((this._viewportTransformString || null) === transformString) {\n                // It's ok to return the cached matrix. The transform attribute has not changed since\n                // the matrix was stored.\n                ctm = this._viewportMatrix;\n            } else {\n                // The viewport transform attribute has changed. Measure the matrix and cache again.\n                ctm = viewport.getCTM();\n                this._viewportMatrix = ctm;\n                this._viewportTransformString = transformString;\n            }\n\n            // Clone the cached current transformation matrix.\n            // If no matrix previously stored the identity matrix is returned.\n            return V.createSVGMatrix(ctm);\n        }\n\n        // Setter:\n        ctm = V.createSVGMatrix(ctm);\n        var ctmString = V.matrixToTransformString(ctm);\n        viewport.setAttribute('transform', ctmString);\n\n        this._viewportMatrix = ctm;\n        this._viewportTransformString = viewport.getAttribute('transform');\n\n        return this;\n    },\n\n    clientMatrix: function() {\n\n        return V.createSVGMatrix(this.cells.getScreenCTM());\n    },\n\n    requestConnectedLinksUpdate: function(view, priority, opt) {\n        if (view instanceof CellView) {\n            var model = view.model;\n            var links = this.model.getConnectedLinks(model);\n            for (var j = 0, n = links.length; j < n; j++) {\n                var link = links[j];\n                var linkView = this.findViewByModel(link);\n                if (!linkView) continue;\n                var flagLabels = ['UPDATE'];\n                if (link.getTargetCell() === model) flagLabels.push('TARGET');\n                if (link.getSourceCell() === model) flagLabels.push('SOURCE');\n                var nextPriority = Math.max(priority + 1, linkView.UPDATE_PRIORITY);\n                this.scheduleViewUpdate(linkView, linkView.getFlag(flagLabels), nextPriority, opt);\n            }\n        }\n    },\n\n    forcePostponedViewUpdate: function(view, flag) {\n        if (!view || !(view instanceof CellView)) return false;\n        var model = view.model;\n        if (model.isElement()) return false;\n        if ((flag & view.getFlag(['SOURCE', 'TARGET'])) === 0) {\n            var dumpOptions = { silent: true };\n            // LinkView is waiting for the target or the source cellView to be rendered\n            // This can happen when the cells are not in the viewport.\n            var sourceFlag = 0;\n            var sourceView = this.findViewByModel(model.getSourceCell());\n            if (sourceView && !this.isViewMounted(sourceView)) {\n                sourceFlag = this.dumpView(sourceView, dumpOptions);\n                view.updateEndMagnet('source');\n            }\n            var targetFlag = 0;\n            var targetView = this.findViewByModel(model.getTargetCell());\n            if (targetView && !this.isViewMounted(targetView)) {\n                targetFlag = this.dumpView(targetView, dumpOptions);\n                view.updateEndMagnet('target');\n            }\n            if (sourceFlag === 0 && targetFlag === 0) {\n                // If leftover flag is 0, all view updates were done.\n                return !this.dumpView(view, dumpOptions);\n            }\n        }\n        return false;\n    },\n\n    requestViewUpdate: function(view, flag, priority, opt) {\n        opt || (opt = {});\n        this.scheduleViewUpdate(view, flag, priority, opt);\n        var isAsync = this.isAsync();\n        if (this.isFrozen() || (isAsync && opt.async !== false)) return;\n        if (this.model.hasActiveBatch(this.UPDATE_DELAYING_BATCHES)) return;\n        var stats = this.updateViews(opt);\n        if (isAsync) this.notifyAfterRender(stats, opt);\n    },\n\n    scheduleViewUpdate: function(view, type, priority, opt) {\n        const { _updates: updates, options } = this;\n        if (updates.idle) {\n            if (options.autoFreeze) {\n                updates.idle = false;\n                this.unfreeze();\n            }\n        }\n        const { FLAG_REMOVE, FLAG_INSERT, UPDATE_PRIORITY, cid } = view;\n        let priorityUpdates = updates.priorities[priority];\n        if (!priorityUpdates) priorityUpdates = updates.priorities[priority] = {};\n        // Move higher priority updates to this priority\n        if (priority > UPDATE_PRIORITY) {\n            // Not the default priority for this view. It's most likely a link view\n            // connected to another link view, which triggered the update.\n            // TODO: If there is an update scheduled with a lower priority already, we should\n            // change the requested priority to the lowest one. Does not seem to be critical\n            // right now, as it \"only\" results in multiple updates on the same view.\n            for (let i = priority - 1; i >= UPDATE_PRIORITY; i--) {\n                const prevPriorityUpdates = updates.priorities[i];\n                if (!prevPriorityUpdates || !(cid in prevPriorityUpdates)) continue;\n                priorityUpdates[cid] |= prevPriorityUpdates[cid];\n                delete prevPriorityUpdates[cid];\n            }\n        }\n        let currentType = priorityUpdates[cid] || 0;\n        // Prevent cycling\n        if ((currentType & type) === type) return;\n        if (!currentType) updates.count++;\n        if (type & FLAG_REMOVE && currentType & FLAG_INSERT) {\n            // When a view is removed we need to remove the insert flag as this is a reinsert\n            priorityUpdates[cid] ^= FLAG_INSERT;\n        } else if (type & FLAG_INSERT && currentType & FLAG_REMOVE) {\n            // When a view is added we need to remove the remove flag as this is view was previously removed\n            priorityUpdates[cid] ^= FLAG_REMOVE;\n        }\n        priorityUpdates[cid] |= type;\n        const viewUpdateFn = options.onViewUpdate;\n        if (typeof viewUpdateFn === 'function') viewUpdateFn.call(this, view, type, priority, opt || {}, this);\n    },\n\n    dumpViewUpdate: function(view) {\n        if (!view) return 0;\n        var updates = this._updates;\n        var cid = view.cid;\n        var priorityUpdates = updates.priorities[view.UPDATE_PRIORITY];\n        var flag = this.registerMountedView(view) | priorityUpdates[cid];\n        delete priorityUpdates[cid];\n        return flag;\n    },\n\n    dumpView: function(view, opt = {}) {\n        const flag = this.dumpViewUpdate(view);\n        if (!flag) return 0;\n        const shouldNotify = !opt.silent;\n        if (shouldNotify) this.notifyBeforeRender(opt);\n        const leftover = this.updateView(view, flag, opt);\n        if (shouldNotify) {\n            const stats = { updated: 1, priority: view.UPDATE_PRIORITY };\n            this.notifyAfterRender(stats, opt);\n        }\n        return leftover;\n    },\n\n    updateView: function(view, flag, opt) {\n        if (!view) return 0;\n        const { FLAG_REMOVE, FLAG_INSERT, FLAG_INIT, model } = view;\n        if (view instanceof CellView) {\n            if (flag & FLAG_REMOVE) {\n                this.removeView(model);\n                return 0;\n            }\n            if (flag & FLAG_INSERT) {\n                const isInitialInsert = !!(flag & FLAG_INIT);\n                if (isInitialInsert) {\n                    flag ^= FLAG_INIT;\n                }\n                this.insertView(view, isInitialInsert);\n                flag ^= FLAG_INSERT;\n            }\n        }\n        if (!flag) return 0;\n        return view.confirmUpdate(flag, opt || {});\n    },\n\n    requireView: function(model, opt) {\n        var view = this.findViewByModel(model);\n        if (!view) return null;\n        this.dumpView(view, opt);\n        return view;\n    },\n\n    registerUnmountedView: function(view) {\n        var cid = view.cid;\n        var updates = this._updates;\n        if (cid in updates.unmounted) return 0;\n        var flag = updates.unmounted[cid] |= view.FLAG_INSERT;\n        updates.unmountedCids.push(cid);\n        delete updates.mounted[cid];\n        return flag;\n    },\n\n    registerMountedView: function(view) {\n        var cid = view.cid;\n        var updates = this._updates;\n        if (cid in updates.mounted) return 0;\n        updates.mounted[cid] = true;\n        updates.mountedCids.push(cid);\n        var flag = updates.unmounted[cid] || 0;\n        delete updates.unmounted[cid];\n        return flag;\n    },\n\n    isViewMounted: function(view) {\n        if (!view) return false;\n        var cid = view.cid;\n        var updates = this._updates;\n        return (cid in updates.mounted);\n    },\n\n    dumpViews: function(opt) {\n        var passingOpt = defaults({}, opt, { viewport: null });\n        this.checkViewport(passingOpt);\n        this.updateViews(passingOpt);\n    },\n\n    // Synchronous views update\n    updateViews: function(opt) {\n        this.notifyBeforeRender(opt);\n        let batchStats;\n        let updateCount = 0;\n        let batchCount = 0;\n        let priority = MIN_PRIORITY;\n        do {\n            batchCount++;\n            batchStats = this.updateViewsBatch(opt);\n            updateCount += batchStats.updated;\n            priority = Math.min(batchStats.priority, priority);\n        } while (!batchStats.empty);\n        const stats = { updated: updateCount, batches: batchCount, priority };\n        this.notifyAfterRender(stats, opt);\n        return stats;\n    },\n\n    hasScheduledUpdates: function() {\n        const priorities = this._updates.priorities;\n        const priorityIndexes = Object.keys(priorities); // convert priorities to a dense array\n        let i = priorityIndexes.length;\n        while (i > 0 && i--) {\n            // a faster way how to check if an object is empty\n            for (let _key in priorities[priorityIndexes[i]]) return true;\n        }\n        return false;\n    },\n\n    updateViewsAsync: function(opt, data) {\n        opt || (opt = {});\n        data || (data = { processed: 0, priority: MIN_PRIORITY });\n        const { _updates: updates, options } = this;\n        const id = updates.id;\n        if (id) {\n            cancelFrame(id);\n            if (data.processed === 0 && this.hasScheduledUpdates()) {\n                this.notifyBeforeRender(opt);\n            }\n            const stats = this.updateViewsBatch(opt);\n            const passingOpt = defaults({}, opt, {\n                mountBatchSize: MOUNT_BATCH_SIZE - stats.mounted,\n                unmountBatchSize: MOUNT_BATCH_SIZE - stats.unmounted\n            });\n            const checkStats = this.checkViewport(passingOpt);\n            const unmountCount = checkStats.unmounted;\n            const mountCount = checkStats.mounted;\n            let processed = data.processed;\n            const total = updates.count;\n            if (stats.updated > 0) {\n                // Some updates have been just processed\n                processed += stats.updated + stats.unmounted;\n                stats.processed = processed;\n                data.priority = Math.min(stats.priority, data.priority);\n                if (stats.empty && mountCount === 0) {\n                    stats.unmounted += unmountCount;\n                    stats.mounted += mountCount;\n                    stats.priority = data.priority;\n                    this.notifyAfterRender(stats, opt);\n                    data.processed = 0;\n                    data.priority = MIN_PRIORITY;\n                    updates.count = 0;\n                } else {\n                    data.processed = processed;\n                }\n            } else {\n                if (!updates.idle) {\n                    if (options.autoFreeze) {\n                        this.freeze();\n                        updates.idle = true;\n                        this.trigger('render:idle', opt);\n                    }\n                }\n            }\n            // Progress callback\n            const progressFn = opt.progress;\n            if (total && typeof progressFn === 'function') {\n                progressFn.call(this, stats.empty, processed, total, stats, this);\n            }\n            // The current frame could have been canceled in a callback\n            if (updates.id !== id) return;\n        }\n        if (updates.disabled) {\n            throw new Error('dia.Paper: can not unfreeze the paper after it was removed');\n        }\n        updates.id = nextFrame(this.updateViewsAsync, this, opt, data);\n    },\n\n    notifyBeforeRender: function(opt = {}) {\n        let beforeFn = opt.beforeRender;\n        if (typeof beforeFn !== 'function') {\n            beforeFn = this.options.beforeRender;\n            if (typeof beforeFn !== 'function') return;\n        }\n        beforeFn.call(this, opt, this);\n    },\n\n    notifyAfterRender: function(stats, opt = {}) {\n        let afterFn = opt.afterRender;\n        if (typeof afterFn !== 'function') {\n            afterFn = this.options.afterRender;\n        }\n        if (typeof afterFn === 'function') {\n            afterFn.call(this, stats, opt, this);\n        }\n        this.trigger('render:done', stats, opt);\n    },\n\n    updateViewsBatch: function(opt) {\n        opt || (opt = {});\n        var batchSize = opt.batchSize || UPDATE_BATCH_SIZE;\n        var updates = this._updates;\n        var updateCount = 0;\n        var postponeCount = 0;\n        var unmountCount = 0;\n        var mountCount = 0;\n        var maxPriority = MIN_PRIORITY;\n        var empty = true;\n        var options = this.options;\n        var priorities = updates.priorities;\n        var viewportFn = 'viewport' in opt ? opt.viewport : options.viewport;\n        if (typeof viewportFn !== 'function') viewportFn = null;\n        var postponeViewFn = options.onViewPostponed;\n        if (typeof postponeViewFn !== 'function') postponeViewFn = null;\n        var priorityIndexes = Object.keys(priorities); // convert priorities to a dense array\n        main: for (var i = 0, n = priorityIndexes.length; i < n; i++) {\n            var priority = +priorityIndexes[i];\n            var priorityUpdates = priorities[priority];\n            for (var cid in priorityUpdates) {\n                if (updateCount >= batchSize) {\n                    empty = false;\n                    break main;\n                }\n                var view = views[cid];\n                if (!view) {\n                    // This should not occur\n                    delete priorityUpdates[cid];\n                    continue;\n                }\n                var currentFlag = priorityUpdates[cid];\n                if ((currentFlag & view.FLAG_REMOVE) === 0) {\n                    // We should never check a view for viewport if we are about to remove the view\n                    var isDetached = cid in updates.unmounted;\n                    if (view.DETACHABLE && viewportFn && !viewportFn.call(this, view, !isDetached, this)) {\n                        // Unmount View\n                        if (!isDetached) {\n                            this.registerUnmountedView(view);\n                            this.detachView(view);\n                        }\n                        updates.unmounted[cid] |= currentFlag;\n                        delete priorityUpdates[cid];\n                        unmountCount++;\n                        continue;\n                    }\n                    // Mount View\n                    if (isDetached) {\n                        currentFlag |= view.FLAG_INSERT;\n                        mountCount++;\n                    }\n                    currentFlag |= this.registerMountedView(view);\n                }\n                var leftoverFlag = this.updateView(view, currentFlag, opt);\n                if (leftoverFlag > 0) {\n                    // View update has not finished completely\n                    priorityUpdates[cid] = leftoverFlag;\n                    if (!postponeViewFn || !postponeViewFn.call(this, view, leftoverFlag, this) || priorityUpdates[cid]) {\n                        postponeCount++;\n                        empty = false;\n                        continue;\n                    }\n                }\n                if (maxPriority > priority) maxPriority = priority;\n                updateCount++;\n                delete priorityUpdates[cid];\n            }\n        }\n        return {\n            priority: maxPriority,\n            updated: updateCount,\n            postponed: postponeCount,\n            unmounted: unmountCount,\n            mounted: mountCount,\n            empty: empty\n        };\n    },\n\n    getUnmountedViews: function() {\n        const updates = this._updates;\n        const unmountedCids = Object.keys(updates.unmounted);\n        const n = unmountedCids.length;\n        const unmountedViews = new Array(n);\n        for (var i = 0; i < n; i++) {\n            unmountedViews[i] = views[unmountedCids[i]];\n        }\n        return unmountedViews;\n    },\n\n    getMountedViews: function() {\n        const updates = this._updates;\n        const mountedCids = Object.keys(updates.mounted);\n        const n = mountedCids.length;\n        const mountedViews = new Array(n);\n        for (var i = 0; i < n; i++) {\n            mountedViews[i] = views[mountedCids[i]];\n        }\n        return mountedViews;\n    },\n\n    checkUnmountedViews: function(viewportFn, opt) {\n        opt || (opt  = {});\n        var mountCount = 0;\n        if (typeof viewportFn !== 'function') viewportFn = null;\n        var batchSize = 'mountBatchSize' in opt ? opt.mountBatchSize : Infinity;\n        var updates = this._updates;\n        var unmountedCids = updates.unmountedCids;\n        var unmounted = updates.unmounted;\n        for (var i = 0, n = Math.min(unmountedCids.length, batchSize); i < n; i++) {\n            var cid = unmountedCids[i];\n            if (!(cid in unmounted)) continue;\n            var view = views[cid];\n            if (!view) continue;\n            if (view.DETACHABLE && viewportFn && !viewportFn.call(this, view, false, this)) {\n                // Push at the end of all unmounted ids, so this can be check later again\n                unmountedCids.push(cid);\n                continue;\n            }\n            mountCount++;\n            var flag = this.registerMountedView(view);\n            if (flag) this.scheduleViewUpdate(view, flag, view.UPDATE_PRIORITY, { mounting: true });\n        }\n        // Get rid of views, that have been mounted\n        unmountedCids.splice(0, i);\n        return mountCount;\n    },\n\n    checkMountedViews: function(viewportFn, opt) {\n        opt || (opt = {});\n        var unmountCount = 0;\n        if (typeof viewportFn !== 'function') return unmountCount;\n        var batchSize = 'unmountBatchSize' in opt ? opt.unmountBatchSize : Infinity;\n        var updates = this._updates;\n        var mountedCids = updates.mountedCids;\n        var mounted = updates.mounted;\n        for (var i = 0, n = Math.min(mountedCids.length, batchSize); i < n; i++) {\n            var cid = mountedCids[i];\n            if (!(cid in mounted)) continue;\n            var view = views[cid];\n            if (!view) continue;\n            if (!view.DETACHABLE || viewportFn.call(this, view, true, this)) {\n                // Push at the end of all mounted ids, so this can be check later again\n                mountedCids.push(cid);\n                continue;\n            }\n            unmountCount++;\n            var flag = this.registerUnmountedView(view);\n            if (flag) this.detachView(view);\n        }\n        // Get rid of views, that have been unmounted\n        mountedCids.splice(0, i);\n        return unmountCount;\n    },\n\n    checkViewVisibility: function(cellView, opt = {}) {\n        let viewportFn = 'viewport' in opt ? opt.viewport : this.options.viewport;\n        if (typeof viewportFn !== 'function') viewportFn = null;\n        const updates = this._updates;\n        const { mounted, unmounted } = updates;\n        const visible = !cellView.DETACHABLE || !viewportFn || viewportFn.call(this, cellView, false, this);\n\n        let isUnmounted = false;\n        let isMounted = false;\n\n        if (cellView.cid in mounted && !visible) {\n            const flag = this.registerUnmountedView(cellView);\n            if (flag) this.detachView(cellView);\n            const i = updates.mountedCids.indexOf(cellView.cid);\n            updates.mountedCids.splice(i, 1);\n            isUnmounted = true;\n        }\n\n        if (!isUnmounted && cellView.cid in unmounted && visible) {\n            const i = updates.unmountedCids.indexOf(cellView.cid);\n            updates.unmountedCids.splice(i, 1);\n            var flag = this.registerMountedView(cellView);\n            if (flag) this.scheduleViewUpdate(cellView, flag, cellView.UPDATE_PRIORITY, { mounting: true });\n            isMounted = true;\n        }\n\n        return {\n            mounted: isMounted ? 1 : 0,\n            unmounted: isUnmounted ? 1 : 0\n        };\n    },\n\n    checkViewport: function(opt) {\n        var passingOpt = defaults({}, opt, {\n            mountBatchSize: Infinity,\n            unmountBatchSize: Infinity\n        });\n        var viewportFn = 'viewport' in passingOpt ? passingOpt.viewport : this.options.viewport;\n        var unmountedCount = this.checkMountedViews(viewportFn, passingOpt);\n        if (unmountedCount > 0) {\n            // Do not check views, that have been just unmounted and pushed at the end of the cids array\n            var unmountedCids = this._updates.unmountedCids;\n            passingOpt.mountBatchSize = Math.min(unmountedCids.length - unmountedCount, passingOpt.mountBatchSize);\n        }\n        var mountedCount = this.checkUnmountedViews(viewportFn, passingOpt);\n        return {\n            mounted: mountedCount,\n            unmounted: unmountedCount\n        };\n    },\n\n    freeze: function(opt) {\n        opt || (opt = {});\n        var updates = this._updates;\n        var key = opt.key;\n        var isFrozen = this.options.frozen;\n        var freezeKey = updates.freezeKey;\n        if (key && key !== freezeKey)  {\n            // key passed, but the paper is already freezed with another key\n            if (isFrozen && freezeKey) return;\n            updates.freezeKey = key;\n            updates.keyFrozen = isFrozen;\n        }\n        this.options.frozen = true;\n        var id = updates.id;\n        updates.id = null;\n        if (this.isAsync() && id) cancelFrame(id);\n    },\n\n    unfreeze: function(opt) {\n        opt || (opt = {});\n        var updates = this._updates;\n        var key = opt.key;\n        var freezeKey = updates.freezeKey;\n        // key passed, but the paper is already freezed with another key\n        if (key && freezeKey && key !== freezeKey) return;\n        updates.freezeKey = null;\n        // key passed, but the paper is already freezed\n        if (key && key === freezeKey && updates.keyFrozen) return;\n        if (this.isAsync()) {\n            this.freeze();\n            this.updateViewsAsync(opt);\n        } else {\n            this.updateViews(opt);\n        }\n        this.options.frozen = updates.keyFrozen = false;\n        if (updates.sort) {\n            this.sortViews();\n            updates.sort = false;\n        }\n    },\n\n    isAsync: function() {\n        return !!this.options.async;\n    },\n\n    isFrozen: function() {\n        return !!this.options.frozen;\n    },\n\n    isExactSorting: function() {\n        return this.options.sorting === sortingTypes.EXACT;\n    },\n\n    onRemove: function() {\n\n        this.freeze();\n        this._updates.disabled = true;\n        //clean up all DOM elements/views to prevent memory leaks\n        this.removeLayers();\n        this.removeViews();\n    },\n\n    getComputedSize: function() {\n\n        var options = this.options;\n        var w = options.width;\n        var h = options.height;\n        if (!isNumber(w)) w = this.el.clientWidth;\n        if (!isNumber(h)) h = this.el.clientHeight;\n        return { width: w, height: h };\n    },\n\n    setDimensions: function(width, height) {\n        const { options } = this;\n        const { width: currentWidth, height: currentHeight } = options;\n        let w = (width === undefined) ? currentWidth : width;\n        let h = (height === undefined) ? currentHeight : height;\n        if (currentWidth === w && currentHeight === h) return;\n        options.width = w;\n        options.height = h;\n        this._setDimensions();\n        const computedSize = this.getComputedSize();\n        this.trigger('resize', computedSize.width, computedSize.height);\n    },\n\n    _setDimensions: function() {\n        const { options } = this;\n        let w = options.width;\n        let h = options.height;\n        if (isNumber(w)) w = Math.round(w);\n        if (isNumber(h)) h = Math.round(h);\n        this.$el.css({\n            width: (w === null) ? '' : w,\n            height: (h === null) ? '' : h\n        });\n    },\n\n    setOrigin: function(ox, oy) {\n        return this.translate(ox || 0, oy || 0);\n    },\n\n    // Expand/shrink the paper to fit the content.\n    // Alternatively signature function(opt)\n    fitToContent: function(gridWidth, gridHeight, padding, opt) {\n\n        if (isObject(gridWidth)) {\n            // first parameter is an option object\n            opt = gridWidth;\n        } else {\n            // Support for a deprecated signature\n            opt = assign({ gridWidth, gridHeight, padding }, opt);\n        }\n\n        const { x, y, width, height } = this.getFitToContentArea(opt);\n        const { sx, sy } = this.scale();\n\n        this.setOrigin(-x * sx, -y * sy);\n        this.setDimensions(width * sx, height * sy);\n\n        return new Rect(x, y, width, height);\n    },\n\n    getFitToContentArea: function(opt = {}) {\n\n        // Calculate the paper size to accommodate all the graph's elements.\n\n        const gridWidth = opt.gridWidth || 1;\n        const gridHeight = opt.gridHeight || 1;\n        const padding = normalizeSides(opt.padding || 0);\n\n        const minWidth = Math.max(opt.minWidth || 0, gridWidth);\n        const minHeight = Math.max(opt.minHeight || 0, gridHeight);\n        const maxWidth = opt.maxWidth || Number.MAX_VALUE;\n        const maxHeight = opt.maxHeight || Number.MAX_VALUE;\n        const newOrigin = opt.allowNewOrigin;\n\n        const area = ('contentArea' in opt) ? new Rect(opt.contentArea) : this.getContentArea(opt);\n        const { sx, sy } = this.scale();\n        area.x *= sx;\n        area.y *= sy;\n        area.width *= sx;\n        area.height *= sy;\n\n        let calcWidth = Math.ceil((area.width + area.x) / gridWidth);\n        let calcHeight = Math.ceil((area.height + area.y) / gridHeight);\n        if (!opt.allowNegativeBottomRight) {\n            calcWidth = Math.max(calcWidth, 1);\n            calcHeight = Math.max(calcHeight, 1);\n        }\n        calcWidth *= gridWidth;\n        calcHeight *= gridHeight;\n\n        let tx = 0;\n        if ((newOrigin === 'negative' && area.x < 0) || (newOrigin === 'positive' && area.x >= 0) || newOrigin === 'any') {\n            tx = Math.ceil(-area.x / gridWidth) * gridWidth;\n            tx += padding.left;\n            calcWidth += tx;\n        }\n\n        let ty = 0;\n        if ((newOrigin === 'negative' && area.y < 0) || (newOrigin === 'positive' && area.y >= 0) || newOrigin === 'any') {\n            ty = Math.ceil(-area.y / gridHeight) * gridHeight;\n            ty += padding.top;\n            calcHeight += ty;\n        }\n\n        calcWidth += padding.right;\n        calcHeight += padding.bottom;\n\n        // Make sure the resulting width and height are greater than minimum.\n        calcWidth = Math.max(calcWidth, minWidth);\n        calcHeight = Math.max(calcHeight, minHeight);\n\n        // Make sure the resulting width and height are lesser than maximum.\n        calcWidth = Math.min(calcWidth, maxWidth);\n        calcHeight = Math.min(calcHeight, maxHeight);\n\n        return new Rect(-tx / sx, -ty / sy, calcWidth / sx, calcHeight / sy);\n    },\n\n    transformToFitContent: function(opt) {\n        opt || (opt = {});\n\n        let contentBBox, contentLocalOrigin;\n        if ('contentArea' in opt) {\n            const contentArea = opt.contentArea;\n            contentBBox = this.localToPaperRect(contentArea);\n            contentLocalOrigin = new Point(contentArea);\n        } else {\n            contentBBox = this.getContentBBox(opt);\n            contentLocalOrigin = this.paperToLocalPoint(contentBBox);\n        }\n\n        if (!contentBBox.width || !contentBBox.height) return;\n\n        defaults(opt, {\n            padding: 0,\n            preserveAspectRatio: true,\n            scaleGrid: null,\n            minScale: 0,\n            maxScale: Number.MAX_VALUE,\n            verticalAlign: 'top',\n            horizontalAlign: 'left',\n            //minScaleX\n            //minScaleY\n            //maxScaleX\n            //maxScaleY\n            //fittingBBox\n        });\n\n        const padding = normalizeSides(opt.padding);\n\n        const minScaleX = opt.minScaleX || opt.minScale;\n        const maxScaleX = opt.maxScaleX || opt.maxScale;\n        const minScaleY = opt.minScaleY || opt.minScale;\n        const maxScaleY = opt.maxScaleY || opt.maxScale;\n\n        let fittingBBox;\n        if (opt.fittingBBox) {\n            fittingBBox = opt.fittingBBox;\n        } else {\n            const currentTranslate = this.translate();\n            const computedSize = this.getComputedSize();\n            fittingBBox = {\n                x: currentTranslate.tx,\n                y: currentTranslate.ty,\n                width: computedSize.width,\n                height: computedSize.height\n            };\n        }\n\n        fittingBBox = new Rect(fittingBBox).moveAndExpand({\n            x: padding.left,\n            y: padding.top,\n            width: -padding.left - padding.right,\n            height: -padding.top - padding.bottom\n        });\n\n        const currentScale = this.scale();\n\n        let newSx = fittingBBox.width / contentBBox.width * currentScale.sx;\n        let newSy = fittingBBox.height / contentBBox.height * currentScale.sy;\n\n        if (opt.preserveAspectRatio) {\n            newSx = newSy = Math.min(newSx, newSy);\n        }\n\n        // snap scale to a grid\n        if (opt.scaleGrid) {\n\n            const gridSize = opt.scaleGrid;\n\n            newSx = gridSize * Math.floor(newSx / gridSize);\n            newSy = gridSize * Math.floor(newSy / gridSize);\n        }\n\n        // scale min/max boundaries\n        newSx = Math.min(maxScaleX, Math.max(minScaleX, newSx));\n        newSy = Math.min(maxScaleY, Math.max(minScaleY, newSy));\n\n        const scaleDiff = {\n            x: newSx / currentScale.sx,\n            y: newSy / currentScale.sy\n        };\n\n        const origin = this.options.origin;\n        let newOx = fittingBBox.x - contentLocalOrigin.x * newSx - origin.x;\n        let newOy = fittingBBox.y - contentLocalOrigin.y * newSy - origin.y;\n\n        switch (opt.verticalAlign) {\n            case 'middle':\n                newOy = newOy + (fittingBBox.height - contentBBox.height * scaleDiff.y) / 2;\n                break;\n            case 'bottom':\n                newOy = newOy + (fittingBBox.height - contentBBox.height * scaleDiff.y);\n                break;\n            case 'top':\n            default:\n                break;\n        }\n\n        switch (opt.horizontalAlign) {\n            case 'middle':\n                newOx = newOx + (fittingBBox.width - contentBBox.width * scaleDiff.x) / 2;\n                break;\n            case 'right':\n                newOx = newOx + (fittingBBox.width - contentBBox.width * scaleDiff.x);\n                break;\n            case 'left':\n            default:\n                break;\n        }\n\n        this.scale(newSx, newSy);\n        this.translate(newOx, newOy);\n    },\n\n    scaleContentToFit: function(opt) {\n        this.transformToFitContent(opt);\n    },\n\n    // Return the dimensions of the content area in local units (without transformations).\n    getContentArea: function(opt) {\n\n        if (opt && opt.useModelGeometry) {\n            return this.model.getBBox() || new Rect();\n        }\n\n        return V(this.cells).getBBox();\n    },\n\n    // Return the dimensions of the content bbox in the paper units (as it appears on screen).\n    getContentBBox: function(opt) {\n\n        return this.localToPaperRect(this.getContentArea(opt));\n    },\n\n    // Returns a geometry rectangle representing the entire\n    // paper area (coordinates from the left paper border to the right one\n    // and the top border to the bottom one).\n    getArea: function() {\n\n        return this.paperToLocalRect(this.getComputedSize());\n    },\n\n    getRestrictedArea: function(...args) {\n\n        const { restrictTranslate } = this.options;\n\n        let restrictedArea;\n        if (isFunction(restrictTranslate)) {\n            // A method returning a bounding box\n            restrictedArea = restrictTranslate.apply(this, args);\n        } else if (restrictTranslate === true) {\n            // The paper area\n            restrictedArea = this.getArea();\n        } else if (!restrictTranslate) {\n            // falsy value\n            restrictedArea = null;\n        } else {\n            // any other value\n            restrictedArea = new Rect(restrictTranslate);\n        }\n\n        return restrictedArea;\n    },\n\n    createViewForModel: function(cell) {\n\n        const { options } = this;\n        // A class taken from the paper options.\n        var optionalViewClass;\n\n        // A default basic class (either dia.ElementView or dia.LinkView)\n        var defaultViewClass;\n\n        // A special class defined for this model in the corresponding namespace.\n        // e.g. joint.shapes.basic.Rect searches for joint.shapes.basic.RectView\n        var namespace = options.cellViewNamespace;\n        var type = cell.get('type') + 'View';\n        var namespaceViewClass = getByPath(namespace, type, '.');\n\n        if (cell.isLink()) {\n            optionalViewClass = options.linkView;\n            defaultViewClass = LinkView;\n        } else {\n            optionalViewClass = options.elementView;\n            defaultViewClass = ElementView;\n        }\n\n        // a) the paper options view is a class (deprecated)\n        //  1. search the namespace for a view\n        //  2. if no view was found, use view from the paper options\n        // b) the paper options view is a function\n        //  1. call the function from the paper options\n        //  2. if no view was return, search the namespace for a view\n        //  3. if no view was found, use the default\n        var ViewClass = (optionalViewClass.prototype instanceof Backbone.View)\n            ? namespaceViewClass || optionalViewClass\n            : optionalViewClass.call(this, cell) || namespaceViewClass || defaultViewClass;\n\n        return new ViewClass({\n            model: cell,\n            interactive: options.interactive,\n            labelsLayer: options.labelsLayer === true ? LayersNames.LABELS : options.labelsLayer\n        });\n    },\n\n    removeView: function(cell) {\n\n        const { id } = cell;\n        const { _views, _updates } = this;\n        const view = _views[id];\n        if (view) {\n            var { cid } = view;\n            const { mounted, unmounted } = _updates;\n            view.remove();\n            delete _views[id];\n            delete mounted[cid];\n            delete unmounted[cid];\n        }\n        return view;\n    },\n\n    renderView: function(cell, opt) {\n\n        const { id } = cell;\n        const views = this._views;\n        let view, flag;\n        let create = true;\n        if (id in views) {\n            view = views[id];\n            if (view.model === cell) {\n                flag = view.FLAG_INSERT;\n                create = false;\n            } else {\n                // The view for this `id` already exist.\n                // The cell is a new instance of the model with identical id\n                // We simply remove the existing view and create a new one\n                this.removeView(cell);\n            }\n        }\n        if (create) {\n            view = views[id] = this.createViewForModel(cell);\n            view.paper = this;\n            flag = this.registerUnmountedView(view) | this.FLAG_INIT | view.getFlag(result(view, 'initFlag'));\n        }\n        this.requestViewUpdate(view, flag, view.UPDATE_PRIORITY, opt);\n        return view;\n    },\n\n    onImageDragStart: function() {\n        // This is the only way to prevent image dragging in Firefox that works.\n        // Setting -moz-user-select: none, draggable=\"false\" attribute or user-drag: none didn't help.\n\n        return false;\n    },\n\n    resetViews: function(cells, opt) {\n        opt || (opt = {});\n        cells || (cells = []);\n        this._resetUpdates();\n        // clearing views removes any event listeners\n        this.removeViews();\n        // Allows to unfreeze normally while in the idle state using autoFreeze option\n        const key = this.options.autoFreeze ? null : 'reset';\n        this.freeze({ key });\n        for (var i = 0, n = cells.length; i < n; i++) {\n            this.renderView(cells[i], opt);\n        }\n        this.unfreeze({ key });\n        this.sortViews();\n    },\n\n    removeViews: function() {\n\n        invoke(this._views, 'remove');\n\n        this._views = {};\n    },\n\n    sortViews: function() {\n\n        if (!this.isExactSorting()) {\n            // noop\n            return;\n        }\n        if (this.isFrozen()) {\n            // sort views once unfrozen\n            this._updates.sort = true;\n            return;\n        }\n        this.sortViewsExact();\n    },\n\n    sortViewsExact: function() {\n\n        // Run insertion sort algorithm in order to efficiently sort DOM elements according to their\n        // associated model `z` attribute.\n\n        var $cells = $(this.cells).children('[model-id]');\n        var cells = this.model.get('cells');\n\n        sortElements($cells, function(a, b) {\n            var cellA = cells.get(a.getAttribute('model-id'));\n            var cellB = cells.get(b.getAttribute('model-id'));\n            var zA = cellA.attributes.z || 0;\n            var zB = cellB.attributes.z || 0;\n            return (zA === zB) ? 0 : (zA < zB) ? -1 : 1;\n        });\n    },\n\n    insertView: function(view, isInitialInsert) {\n        const layerView = this.getLayerView(LayersNames.CELLS);\n        const { el, model } = view;\n        switch (this.options.sorting) {\n            case sortingTypes.APPROX:\n                layerView.insertSortedNode(el, model.get('z'));\n                break;\n            case sortingTypes.EXACT:\n            default:\n                layerView.insertNode(el);\n                break;\n        }\n        view.onMount(isInitialInsert);\n    },\n\n    detachView(view) {\n        view.unmount();\n        view.onDetach();\n    },\n\n    scale: function(sx, sy, ox, oy) {\n\n        // getter\n        if (sx === undefined) {\n            return V.matrixToScale(this.matrix());\n        }\n\n        // setter\n        if (sy === undefined) {\n            sy = sx;\n        }\n        if (ox === undefined) {\n            ox = 0;\n            oy = 0;\n        }\n\n        var translate = this.translate();\n\n        if (ox || oy || translate.tx || translate.ty) {\n            var newTx = translate.tx - ox * (sx - 1);\n            var newTy = translate.ty - oy * (sy - 1);\n            this.translate(newTx, newTy);\n        }\n\n        sx = Math.max(sx || 0, this.MIN_SCALE);\n        sy = Math.max(sy || 0, this.MIN_SCALE);\n\n        var ctm = this.matrix();\n        ctm.a = sx;\n        ctm.d = sy;\n\n        this.matrix(ctm);\n\n        this.trigger('scale', sx, sy, ox, oy);\n\n        return this;\n    },\n\n    // Experimental - do not use in production.\n    rotate: function(angle, cx, cy) {\n\n        // getter\n        if (angle === undefined) {\n            return V.matrixToRotate(this.matrix());\n        }\n\n        // setter\n\n        // If the origin is not set explicitely, rotate around the center. Note that\n        // we must use the plain bounding box (`this.el.getBBox()` instead of the one that gives us\n        // the real bounding box (`bbox()`) including transformations).\n        if (cx === undefined) {\n            var bbox = this.cells.getBBox();\n            cx = bbox.width / 2;\n            cy = bbox.height / 2;\n        }\n\n        var ctm = this.matrix().translate(cx, cy).rotate(angle).translate(-cx, -cy);\n        this.matrix(ctm);\n\n        return this;\n    },\n\n    translate: function(tx, ty) {\n\n        // getter\n        if (tx === undefined) {\n            return V.matrixToTranslate(this.matrix());\n        }\n\n        const { options } = this;\n        const { origin, drawGrid } = options;\n\n        // setter\n        tx || (tx = 0);\n        ty || (ty = 0);\n\n        const ctm = this.matrix();\n        if (ctm.e === tx && ctm.f === ty) return this;\n        ctm.e = tx;\n        ctm.f = ty;\n\n        this.matrix(ctm);\n\n        const { tx: ox, ty: oy } = this.translate();\n        origin.x = ox;\n        origin.y = oy;\n\n        this.trigger('translate', ox, oy);\n\n        if (drawGrid) {\n            this.drawGrid();\n        }\n\n        return this;\n    },\n\n    // Find the first view climbing up the DOM tree starting at element `el`. Note that `el` can also\n    // be a selector or a jQuery object.\n    findView: function($el) {\n\n        var el = isString($el)\n            ? this.cells.querySelector($el)\n            : $el instanceof $ ? $el[0] : $el;\n\n        var id = this.findAttribute('model-id', el);\n        if (id) return this._views[id];\n\n        return undefined;\n    },\n\n    // Find a view for a model `cell`. `cell` can also be a string or number representing a model `id`.\n    findViewByModel: function(cell) {\n\n        var id = (isString(cell) || isNumber(cell)) ? cell : (cell && cell.id);\n\n        return this._views[id];\n    },\n\n    // Find all views at given point\n    findViewsFromPoint: function(p) {\n\n        p = new Point(p);\n\n        var views = this.model.getElements().map(this.findViewByModel, this);\n\n        return views.filter(function(view) {\n            return view && view.vel.getBBox({ target: this.cells }).containsPoint(p);\n        }, this);\n    },\n\n    // Find all views in given area\n    findViewsInArea: function(rect, opt) {\n\n        opt = defaults(opt || {}, { strict: false });\n        rect = new Rect(rect);\n\n        var views = this.model.getElements().map(this.findViewByModel, this);\n        var method = opt.strict ? 'containsRect' : 'intersect';\n\n        return views.filter(function(view) {\n            return view && rect[method](view.vel.getBBox({ target: this.cells }));\n        }, this);\n    },\n\n    removeTools: function() {\n        this.dispatchToolsEvent('remove');\n        return this;\n    },\n\n    hideTools: function() {\n        this.dispatchToolsEvent('hide');\n        return this;\n    },\n\n    showTools: function() {\n        this.dispatchToolsEvent('show');\n        return this;\n    },\n\n    dispatchToolsEvent: function(event, ...args) {\n        if (typeof event !== 'string') return;\n        this.trigger('tools:event', event, ...args);\n    },\n\n\n    getModelById: function(id) {\n\n        return this.model.getCell(id);\n    },\n\n    snapToGrid: function(x, y) {\n\n        // Convert global coordinates to the local ones of the `viewport`. Otherwise,\n        // improper transformation would be applied when the viewport gets transformed (scaled/rotated).\n        return this.clientToLocalPoint(x, y).snapToGrid(this.options.gridSize);\n    },\n\n    localToPaperPoint: function(x, y) {\n        // allow `x` to be a point and `y` undefined\n        var localPoint = new Point(x, y);\n        var paperPoint = V.transformPoint(localPoint, this.matrix());\n        return paperPoint;\n    },\n\n    localToPaperRect: function(x, y, width, height) {\n        // allow `x` to be a rectangle and rest arguments undefined\n        var localRect = new Rect(x, y, width, height);\n        var paperRect = V.transformRect(localRect, this.matrix());\n        return paperRect;\n    },\n\n    paperToLocalPoint: function(x, y) {\n        // allow `x` to be a point and `y` undefined\n        var paperPoint = new Point(x, y);\n        var localPoint = V.transformPoint(paperPoint, this.matrix().inverse());\n        return localPoint;\n    },\n\n    paperToLocalRect: function(x, y, width, height) {\n        // allow `x` to be a rectangle and rest arguments undefined\n        var paperRect = new Rect(x, y, width, height);\n        var localRect = V.transformRect(paperRect, this.matrix().inverse());\n        return localRect;\n    },\n\n    localToClientPoint: function(x, y) {\n        // allow `x` to be a point and `y` undefined\n        var localPoint = new Point(x, y);\n        var clientPoint = V.transformPoint(localPoint, this.clientMatrix());\n        return clientPoint;\n    },\n\n    localToClientRect: function(x, y, width, height) {\n        // allow `x` to be a point and `y` undefined\n        var localRect = new Rect(x, y, width, height);\n        var clientRect = V.transformRect(localRect, this.clientMatrix());\n        return clientRect;\n    },\n\n    // Transform client coordinates to the paper local coordinates.\n    // Useful when you have a mouse event object and you'd like to get coordinates\n    // inside the paper that correspond to `evt.clientX` and `evt.clientY` point.\n    // Example: var localPoint = paper.clientToLocalPoint({ x: evt.clientX, y: evt.clientY });\n    clientToLocalPoint: function(x, y) {\n        // allow `x` to be a point and `y` undefined\n        var clientPoint = new Point(x, y);\n        var localPoint = V.transformPoint(clientPoint, this.clientMatrix().inverse());\n        return localPoint;\n    },\n\n    clientToLocalRect: function(x, y, width, height) {\n        // allow `x` to be a point and `y` undefined\n        var clientRect = new Rect(x, y, width, height);\n        var localRect = V.transformRect(clientRect, this.clientMatrix().inverse());\n        return localRect;\n    },\n\n    localToPagePoint: function(x, y) {\n\n        return this.localToPaperPoint(x, y).offset(this.pageOffset());\n    },\n\n    localToPageRect: function(x, y, width, height) {\n\n        return this.localToPaperRect(x, y, width, height).offset(this.pageOffset());\n    },\n\n    pageToLocalPoint: function(x, y) {\n\n        var pagePoint = new Point(x, y);\n        var paperPoint = pagePoint.difference(this.pageOffset());\n        return this.paperToLocalPoint(paperPoint);\n    },\n\n    pageToLocalRect: function(x, y, width, height) {\n\n        var pageOffset = this.pageOffset();\n        var paperRect = new Rect(x, y, width, height);\n        paperRect.x -= pageOffset.x;\n        paperRect.y -= pageOffset.y;\n        return this.paperToLocalRect(paperRect);\n    },\n\n    clientOffset: function() {\n\n        var clientRect = this.svg.getBoundingClientRect();\n        return new Point(clientRect.left, clientRect.top);\n    },\n\n    pageOffset: function() {\n\n        return this.clientOffset().offset(window.scrollX, window.scrollY);\n    },\n\n    linkAllowed: function(linkView) {\n\n        if (!(linkView instanceof LinkView)) {\n            throw new Error('Must provide a linkView.');\n        }\n\n        var link = linkView.model;\n        var paperOptions = this.options;\n        var graph = this.model;\n        var ns = graph.constructor.validations;\n\n        if (!paperOptions.multiLinks) {\n            if (!ns.multiLinks.call(this, graph, link)) return false;\n        }\n\n        if (!paperOptions.linkPinning) {\n            // Link pinning is not allowed and the link is not connected to the target.\n            if (!ns.linkPinning.call(this, graph, link)) return false;\n        }\n\n        if (typeof paperOptions.allowLink === 'function') {\n            if (!paperOptions.allowLink.call(this, linkView, this)) return false;\n        }\n\n        return true;\n    },\n\n    getDefaultLink: function(cellView, magnet) {\n\n        return isFunction(this.options.defaultLink)\n        // default link is a function producing link model\n            ? this.options.defaultLink.call(this, cellView, magnet)\n        // default link is the Backbone model\n            : this.options.defaultLink.clone();\n    },\n\n    // Cell highlighting.\n    // ------------------\n\n    resolveHighlighter: function(opt = {}) {\n\n        let { highlighter: highlighterDef, type } = opt;\n        const { highlighting,highlighterNamespace  } = this.options;\n\n        /*\n            Expecting opt.highlighter to have the following structure:\n            {\n                name: 'highlighter-name',\n                options: {\n                    some: 'value'\n                }\n            }\n        */\n        if (highlighterDef === undefined) {\n\n            // Is highlighting disabled?\n            if (!highlighting) return false;\n            // check for built-in types\n            if (type) {\n                highlighterDef = highlighting[type];\n                // Is a specific type highlight disabled?\n                if (highlighterDef === false) return false;\n            }\n            if (!highlighterDef) {\n                // Type not defined use default highlight\n                highlighterDef = highlighting['default'];\n            }\n        }\n\n        // Do nothing if opt.highlighter is falsy.\n        // This allows the case to not highlight cell(s) in certain cases.\n        // For example, if you want to NOT highlight when embedding elements\n        // or use a custom highlighter.\n        if (!highlighterDef) return false;\n\n        // Allow specifying a highlighter by name.\n        if (isString(highlighterDef)) {\n            highlighterDef = {\n                name: highlighterDef\n            };\n        }\n\n        const name = highlighterDef.name;\n        const highlighter = highlighterNamespace[name];\n\n        // Highlighter validation\n        if (!highlighter) {\n            throw new Error('Unknown highlighter (\"' + name + '\")');\n        }\n        if (typeof highlighter.highlight !== 'function') {\n            throw new Error('Highlighter (\"' + name + '\") is missing required highlight() method');\n        }\n        if (typeof highlighter.unhighlight !== 'function') {\n            throw new Error('Highlighter (\"' + name + '\") is missing required unhighlight() method');\n        }\n\n        return {\n            highlighter,\n            options: highlighterDef.options || {},\n            name\n        };\n    },\n\n    onCellHighlight: function(cellView, magnetEl, opt) {\n        const highlighterDescriptor = this.resolveHighlighter(opt);\n        if (!highlighterDescriptor) return;\n        const { highlighter, options } = highlighterDescriptor;\n        highlighter.highlight(cellView, magnetEl, options);\n    },\n\n    onCellUnhighlight: function(cellView, magnetEl, opt) {\n        const highlighterDescriptor = this.resolveHighlighter(opt);\n        if (!highlighterDescriptor) return;\n        const { highlighter, options } = highlighterDescriptor;\n        highlighter.unhighlight(cellView, magnetEl, options);\n    },\n\n    // Interaction.\n    // ------------\n\n    pointerdblclick: function(evt) {\n\n        evt.preventDefault();\n\n        // magnetpointerdblclick can stop propagation\n\n        evt = normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        var localPoint = this.snapToGrid(evt.clientX, evt.clientY);\n\n        if (view) {\n            view.pointerdblclick(evt, localPoint.x, localPoint.y);\n\n        } else {\n            this.trigger('blank:pointerdblclick', evt, localPoint.x, localPoint.y);\n        }\n    },\n\n    pointerclick: function(evt) {\n\n        // magnetpointerclick can stop propagation\n\n        var data = this.eventData(evt);\n        // Trigger event only if mouse has not moved.\n        if (data.mousemoved <= this.options.clickThreshold) {\n\n            evt = normalizeEvent(evt);\n\n            var view = this.findView(evt.target);\n            if (this.guard(evt, view)) return;\n\n            var localPoint = this.snapToGrid(evt.clientX, evt.clientY);\n\n            if (view) {\n                view.pointerclick(evt, localPoint.x, localPoint.y);\n\n            } else {\n                this.trigger('blank:pointerclick', evt, localPoint.x, localPoint.y);\n            }\n        }\n    },\n\n    contextmenu: function(evt) {\n\n        if (this.options.preventContextMenu) evt.preventDefault();\n\n        if (this.contextMenuFired) {\n            this.contextMenuFired = false;\n            return;\n        }\n\n        evt = normalizeEvent(evt);\n\n        this.contextMenuTrigger(evt);\n    },\n\n    contextMenuTrigger: function(evt) {\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        var localPoint = this.snapToGrid(evt.clientX, evt.clientY);\n\n        if (view) {\n            view.contextmenu(evt, localPoint.x, localPoint.y);\n\n        } else {\n            this.trigger('blank:contextmenu', evt, localPoint.x, localPoint.y);\n        }\n    },\n\n    pointerdown: function(evt) {\n\n        evt = normalizeEvent(evt);\n\n        const { target, button } = evt;\n        const view = this.findView(target);\n        const isContextMenu = (button === 2);\n\n        if (view) {\n\n            if (!isContextMenu && this.guard(evt, view)) return;\n\n            const isTargetFormNode = this.FORM_CONTROL_TAG_NAMES.includes(target.tagName);\n\n            if (this.options.preventDefaultViewAction && !isTargetFormNode) {\n                // If the target is a form element, we do not want to prevent the default action.\n                // For example, we want to be able to select text in a text input or\n                // to be able to click on a checkbox.\n                evt.preventDefault();\n            }\n\n            if (isTargetFormNode) {\n                // If the target is a form element, we do not want to start dragging the element.\n                // For example, we want to be able to select text by dragging the mouse.\n                view.preventDefaultInteraction(evt);\n            }\n\n            const rootViewEl = view.el;\n\n            // Custom event\n            const eventNode = target.closest('[event]');\n            if (eventNode && rootViewEl !== eventNode && view.el.contains(eventNode)) {\n                const eventEvt = normalizeEvent($.Event(evt.originalEvent, {\n                    data: evt.data,\n                    // Originally the event listener was attached to the event element.\n                    currentTarget: eventNode\n                }));\n                this.onevent(eventEvt);\n                if (eventEvt.isDefaultPrevented()) {\n                    evt.preventDefault();\n                }\n                // `onevent` can stop propagation\n                if (eventEvt.isPropagationStopped()) return;\n                evt.data = eventEvt.data;\n            }\n\n            // Element magnet\n            const magnetNode = target.closest('[magnet]');\n            if (magnetNode && view.el !== magnetNode && view.el.contains(magnetNode)) {\n                const magnetEvt = normalizeEvent($.Event(evt.originalEvent, {\n                    data: evt.data,\n                    // Originally the event listener was attached to the magnet element.\n                    currentTarget: magnetNode\n                }));\n                this.onmagnet(magnetEvt);\n                if (magnetEvt.isDefaultPrevented()) {\n                    evt.preventDefault();\n                }\n                // `onmagnet` stops propagation when `addLinkFromMagnet` is allowed\n                if (magnetEvt.isPropagationStopped()) {\n                    // `magnet:pointermove` and `magnet:pointerup` events must be fired\n                    if (isContextMenu) return;\n                    this.delegateDragEvents(view, magnetEvt.data);\n                    return;\n                }\n                evt.data = magnetEvt.data;\n            }\n        }\n\n        if (isContextMenu) {\n            this.contextMenuFired = true;\n            const contextmenuEvt = $.Event(evt.originalEvent, { type: 'contextmenu', data: evt.data });\n            this.contextMenuTrigger(contextmenuEvt);\n        } else {\n            const localPoint = this.snapToGrid(evt.clientX, evt.clientY);\n            if (view) {\n                view.pointerdown(evt, localPoint.x, localPoint.y);\n            } else {\n                if (this.options.preventDefaultBlankAction) {\n                    evt.preventDefault();\n                }\n                this.trigger('blank:pointerdown', evt, localPoint.x, localPoint.y);\n            }\n\n            this.delegateDragEvents(view, evt.data);\n        }\n\n    },\n\n    pointermove: function(evt) {\n\n        // mouse moved counter\n        var data = this.eventData(evt);\n        if (!data.mousemoved) {\n            data.mousemoved = 0;\n            // Make sure that events like `mouseenter` and `mouseleave` are\n            // not triggered while the user is dragging a cellView.\n            this.undelegateEvents();\n            // Note: the events are undelegated after the first `pointermove` event.\n            // Not on `pointerdown` to make sure that `dbltap` is recognized.\n        }\n\n        var mousemoved = ++data.mousemoved;\n\n        if (mousemoved <= this.options.moveThreshold) return;\n\n        evt = normalizeEvent(evt);\n\n        var localPoint = this.snapToGrid(evt.clientX, evt.clientY);\n\n        var view = data.sourceView;\n        if (view) {\n            view.pointermove(evt, localPoint.x, localPoint.y);\n        } else {\n            this.trigger('blank:pointermove', evt, localPoint.x, localPoint.y);\n        }\n\n        this.eventData(evt, data);\n    },\n\n    pointerup: function(evt) {\n\n        this.undelegateDocumentEvents();\n\n        var normalizedEvt = normalizeEvent(evt);\n\n        var localPoint = this.snapToGrid(normalizedEvt.clientX, normalizedEvt.clientY);\n\n        var view = this.eventData(evt).sourceView;\n        if (view) {\n            view.pointerup(normalizedEvt, localPoint.x, localPoint.y);\n        } else {\n            this.trigger('blank:pointerup', normalizedEvt, localPoint.x, localPoint.y);\n        }\n\n        if (!normalizedEvt.isPropagationStopped()) {\n            this.pointerclick($.Event(evt.originalEvent, { type: 'click', data: evt.data }));\n        }\n\n        this.delegateEvents();\n    },\n\n    mouseover: function(evt) {\n\n        evt = normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        if (view) {\n            view.mouseover(evt);\n\n        } else {\n            if (this.el === evt.target) return; // prevent border of paper from triggering this\n            this.trigger('blank:mouseover', evt);\n        }\n    },\n\n    mouseout: function(evt) {\n\n        evt = normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        if (view) {\n            view.mouseout(evt);\n\n        } else {\n            if (this.el === evt.target) return; // prevent border of paper from triggering this\n            this.trigger('blank:mouseout', evt);\n        }\n    },\n\n    mouseenter: function(evt) {\n\n        evt = normalizeEvent(evt);\n\n        const {\n            target, // The EventTarget the pointing device entered to\n            relatedTarget, // The EventTarget the pointing device exited from\n            currentTarget // The EventTarget on which the event listener was registered\n        } = evt;\n        const view = this.findView(target);\n        if (this.guard(evt, view)) return;\n        const relatedView = this.findView(relatedTarget);\n        if (view) {\n            if (relatedView === view) {\n                // Mouse left a cell tool\n                return;\n            }\n            view.mouseenter(evt);\n            if (this.el.contains(relatedTarget)) {\n                // The pointer remains inside the paper.\n                return;\n            }\n        }\n        if (relatedView) {\n            return;\n        }\n        // prevent double `mouseenter` event if the `relatedTarget` is outside the paper\n        // (mouseenter method would be fired twice)\n        if (currentTarget === this.el) {\n            // `paper` (more descriptive), not `blank`\n            this.trigger('paper:mouseenter', evt);\n        }\n    },\n\n    mouseleave: function(evt) {\n\n        evt = normalizeEvent(evt);\n\n        const {\n            target, // The EventTarget the pointing device exited from\n            relatedTarget, // The EventTarget the pointing device entered to\n            currentTarget // The EventTarget on which the event listener was registered\n        } = evt;\n        const view = this.findView(target);\n        if (this.guard(evt, view)) return;\n        const relatedView = this.findView(relatedTarget);\n        if (view) {\n            if (relatedView === view) {\n                // Mouse entered a cell tool\n                return;\n            }\n            view.mouseleave(evt);\n            if (this.el.contains(relatedTarget)) {\n                // The pointer has exited a cellView. The pointer is still inside of the paper.\n                return;\n            }\n        }\n        if (relatedView) {\n            // The pointer has entered a new cellView\n            return;\n        }\n        // prevent double `mouseleave` event if the `relatedTarget` is outside the paper\n        // (mouseleave method would be fired twice)\n        if (currentTarget === this.el) {\n            // There is no cellView under the pointer, nor the blank area of the paper\n            this.trigger('paper:mouseleave', evt);\n        }\n    },\n\n    _processMouseWheelEvtBuf: debounce(function() {\n        const { event, deltas } = this._mw_evt_buffer;\n        const deltaY = deltas.reduce((acc, deltaY) => acc + cap(deltaY, WHEEL_CAP), 0);\n\n        const scale = Math.pow(0.995, deltaY); // 1.005 for inverted pinch/zoom\n        const { x, y } = this.clientToLocalPoint(event.clientX, event.clientY);\n        this.trigger('paper:pinch', event, x, y, scale);\n\n        this._mw_evt_buffer = {\n            event: null,\n            deltas: [],\n        };\n    }, WHEEL_WAIT_MS, { maxWait: WHEEL_WAIT_MS }),\n\n    mousewheel: function(evt) {\n\n        evt = normalizeEvent(evt);\n\n        const view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        const originalEvent = evt.originalEvent;\n        const localPoint = this.snapToGrid(originalEvent.clientX, originalEvent.clientY);\n        const { deltaX, deltaY } = normalizeWheel(originalEvent);\n\n        const pinchHandlers = this._events['paper:pinch'];\n\n        // Touchpad devices will send a fake CTRL press when a pinch is performed\n        //\n        // We also check if there are any subscribers to paper:pinch event. If there are none,\n        // just skip the entire block of code (we don't want to blindly call\n        // .preventDefault() if we really don't have to).\n        if (evt.ctrlKey && pinchHandlers && pinchHandlers.length > 0) {\n            // This is a pinch gesture, it's safe to assume that we must call .preventDefault()\n            originalEvent.preventDefault();\n            this._mw_evt_buffer.event = originalEvent;\n            this._mw_evt_buffer.deltas.push(deltaY);\n            this._processMouseWheelEvtBuf();\n        } else {\n            const delta = Math.max(-1, Math.min(1, originalEvent.wheelDelta));\n            if (view) {\n                view.mousewheel(evt, localPoint.x, localPoint.y, delta);\n\n            } else {\n                this.trigger('blank:mousewheel', evt, localPoint.x, localPoint.y, delta);\n            }\n\n            this.trigger('paper:pan', evt, deltaX, deltaY);\n        }\n    },\n\n    onevent: function(evt) {\n\n        var eventNode = evt.currentTarget;\n        var eventName = eventNode.getAttribute('event');\n        if (eventName) {\n            var view = this.findView(eventNode);\n            if (view) {\n\n                evt = normalizeEvent(evt);\n                if (this.guard(evt, view)) return;\n\n                var localPoint = this.snapToGrid(evt.clientX, evt.clientY);\n                view.onevent(evt, eventName, localPoint.x, localPoint.y);\n            }\n        }\n    },\n\n    magnetEvent: function(evt, handler) {\n\n        var magnetNode = evt.currentTarget;\n        var magnetValue = magnetNode.getAttribute('magnet');\n        if (magnetValue) {\n            var view = this.findView(magnetNode);\n            if (view) {\n                evt = normalizeEvent(evt);\n                if (this.guard(evt, view)) return;\n                var localPoint = this.snapToGrid(evt.clientX, evt.clientY);\n                handler.call(this, view, evt, magnetNode, localPoint.x, localPoint.y);\n            }\n        }\n    },\n\n    onmagnet: function(evt) {\n\n        if (evt.button === 2) {\n            this.contextMenuFired = true;\n            this.magnetContextMenuFired = true;\n            const contextmenuEvt = $.Event(evt.originalEvent, {\n                type: 'contextmenu',\n                data: evt.data,\n                currentTarget: evt.currentTarget,\n            });\n            this.magnetContextMenuTrigger(contextmenuEvt);\n            if (contextmenuEvt.isPropagationStopped()) {\n                evt.stopPropagation();\n            }\n        } else {\n            this.magnetEvent(evt, function(view, evt, _, x, y) {\n                view.onmagnet(evt, x, y);\n            });\n        }\n    },\n\n    magnetpointerdblclick: function(evt) {\n\n        this.magnetEvent(evt, function(view, evt, magnet, x, y) {\n            view.magnetpointerdblclick(evt, magnet, x, y);\n        });\n    },\n\n    magnetcontextmenu: function(evt) {\n        if (this.options.preventContextMenu) evt.preventDefault();\n\n        if (this.magnetContextMenuFired) {\n            this.magnetContextMenuFired = false;\n            return;\n        }\n\n        this.magnetContextMenuTrigger(evt);\n    },\n\n    magnetContextMenuTrigger: function(evt) {\n        this.magnetEvent(evt, function(view, evt, magnet, x, y) {\n            view.magnetcontextmenu(evt, magnet, x, y);\n        });\n    },\n\n    onlabel: function(evt) {\n\n        var labelNode = evt.currentTarget;\n        var view = this.findView(labelNode);\n        if (view) {\n\n            evt = normalizeEvent(evt);\n            if (this.guard(evt, view)) return;\n\n            var localPoint = this.snapToGrid(evt.clientX, evt.clientY);\n            view.onlabel(evt, localPoint.x, localPoint.y);\n        }\n    },\n\n    getPointerArgs(evt) {\n        const normalizedEvt = normalizeEvent(evt);\n        const { x, y } = this.snapToGrid(normalizedEvt.clientX, normalizedEvt.clientY);\n        return [normalizedEvt, x, y];\n    },\n\n    delegateDragEvents: function(view, data) {\n\n        data || (data = {});\n        this.eventData({ data: data }, { sourceView: view || null, mousemoved: 0 });\n        this.delegateDocumentEvents(null, data);\n    },\n\n    // Guard the specified event. If the event should be ignored, guard returns `true`.\n    // Otherwise, it returns `false`.\n    guard: function(evt, view) {\n\n        if (evt.type === 'mousedown' && evt.button === 2) {\n            // handled as `contextmenu` type\n            return true;\n        }\n\n        if (this.options.guard && this.options.guard(evt, view)) {\n            return true;\n        }\n\n        if (evt.data && evt.data.guarded !== undefined) {\n            return evt.data.guarded;\n        }\n\n        const { target } = evt;\n\n        if (this.GUARDED_TAG_NAMES.includes(target.tagName)) {\n            return true;\n        }\n\n        if (view && view.model && (view.model instanceof Cell)) {\n            return false;\n        }\n\n        if (this.svg === target || this.el === target || $.contains(this.svg, target)) {\n            return false;\n        }\n\n        return true;    // Event guarded. Paper should not react on it in any way.\n    },\n\n    setGridSize: function(gridSize) {\n\n        const { options } = this;\n        options.gridSize = gridSize;\n\n        if (options.drawGrid && !options.drawGridSize) {\n            // Do not redraw the grid if the `drawGridSize` is set.\n            this.drawGrid();\n        }\n\n        return this;\n    },\n\n    clearGrid: function() {\n\n        if (this.$grid) {\n            this.$grid.css('backgroundImage', 'none');\n        }\n        return this;\n    },\n\n    _getGridRefs: function() {\n\n        if (!this._gridCache) {\n\n            this._gridCache = {\n                root: V('svg', { width: '100%', height: '100%' }, V('defs')),\n                patterns: {},\n                add: function(id, vel) {\n                    V(this.root.node.childNodes[0]).append(vel);\n                    this.patterns[id] = vel;\n                    this.root.append(V('rect', { width: '100%', height: '100%', fill: 'url(#' + id + ')' }));\n                },\n                get: function(id) {\n                    return this.patterns[id];\n                },\n                exist: function(id) {\n                    return this.patterns[id] !== undefined;\n                }\n            };\n        }\n\n        return this._gridCache;\n    },\n\n    setGrid: function(drawGrid) {\n\n        this.clearGrid();\n\n        this._gridCache = null;\n        this._gridSettings = [];\n\n        var optionsList = Array.isArray(drawGrid) ? drawGrid : [drawGrid || {}];\n        optionsList.forEach(function(item) {\n            this._gridSettings.push.apply(this._gridSettings, this._resolveDrawGridOption(item));\n        }, this);\n        return this;\n    },\n\n    _resolveDrawGridOption: function(opt) {\n\n        var namespace = this.constructor.gridPatterns;\n        if (isString(opt) && Array.isArray(namespace[opt])) {\n            return namespace[opt].map(function(item) {\n                return assign({}, item);\n            });\n        }\n\n        var options = opt || { args: [{}] };\n        var isArray = Array.isArray(options);\n        var name = options.name;\n\n        if (!isArray && !name && !options.markup) {\n            name = 'dot';\n        }\n\n        if (name && Array.isArray(namespace[name])) {\n            var pattern = namespace[name].map(function(item) {\n                return assign({}, item);\n            });\n\n            var args = Array.isArray(options.args) ? options.args : [options.args || {}];\n\n            defaults(args[0], omit(opt, 'args'));\n            for (var i = 0; i < args.length; i++) {\n                if (pattern[i]) {\n                    assign(pattern[i], args[i]);\n                }\n            }\n            return pattern;\n        }\n\n        return isArray ? options : [options];\n    },\n\n    drawGrid: function(opt) {\n\n        const gridSize = this.options.drawGridSize || this.options.gridSize;\n        if (gridSize <= 1) {\n            return this.clearGrid();\n        }\n\n        var localOptions = Array.isArray(opt) ? opt : [opt];\n\n        var ctm = this.matrix();\n        var refs = this._getGridRefs();\n\n        this._gridSettings.forEach(function(gridLayerSetting, index) {\n\n            var id = 'pattern_' + index;\n            var options = merge(gridLayerSetting, localOptions[index], {\n                sx: ctm.a || 1,\n                sy: ctm.d || 1,\n                ox: ctm.e || 0,\n                oy: ctm.f || 0\n            });\n\n            options.width = gridSize * (ctm.a || 1) * (options.scaleFactor || 1);\n            options.height = gridSize * (ctm.d || 1) * (options.scaleFactor || 1);\n\n            if (!refs.exist(id)) {\n                refs.add(id, V('pattern', { id: id, patternUnits: 'userSpaceOnUse' }, V(options.markup)));\n            }\n\n            var patternDefVel = refs.get(id);\n\n            if (isFunction(options.update)) {\n                options.update(patternDefVel.node.childNodes[0], options);\n            }\n\n            var x = options.ox % options.width;\n            if (x < 0) x += options.width;\n\n            var y = options.oy % options.height;\n            if (y < 0) y += options.height;\n\n            patternDefVel.attr({\n                x: x,\n                y: y,\n                width: options.width,\n                height: options.height\n            });\n        });\n\n        var patternUri = new XMLSerializer().serializeToString(refs.root.node);\n        patternUri = 'url(data:image/svg+xml;base64,' + btoa(patternUri) + ')';\n\n        this.$grid.css('backgroundImage', patternUri);\n\n        return this;\n    },\n\n    updateBackgroundImage: function(opt) {\n\n        opt = opt || {};\n\n        var backgroundPosition = opt.position || 'center';\n        var backgroundSize = opt.size || 'auto auto';\n\n        var currentScale = this.scale();\n        var currentTranslate = this.translate();\n\n        // backgroundPosition\n        if (isObject(backgroundPosition)) {\n            var x = currentTranslate.tx + (currentScale.sx * (backgroundPosition.x || 0));\n            var y = currentTranslate.ty + (currentScale.sy * (backgroundPosition.y || 0));\n            backgroundPosition = x + 'px ' + y + 'px';\n        }\n\n        // backgroundSize\n        if (isObject(backgroundSize)) {\n            backgroundSize = new Rect(backgroundSize).scale(currentScale.sx, currentScale.sy);\n            backgroundSize = backgroundSize.width + 'px ' + backgroundSize.height + 'px';\n        }\n\n        this.$background.css({\n            backgroundSize: backgroundSize,\n            backgroundPosition: backgroundPosition\n        });\n    },\n\n    drawBackgroundImage: function(img, opt) {\n\n        // Clear the background image if no image provided\n        if (!(img instanceof HTMLImageElement)) {\n            this.$background.css('backgroundImage', '');\n            return;\n        }\n\n        if (!this._background || this._background.id !== opt.id) {\n            // Draw only the last image requested (see drawBackground())\n            return;\n        }\n\n        opt = opt || {};\n\n        var backgroundImage;\n        var backgroundSize = opt.size;\n        var backgroundRepeat = opt.repeat || 'no-repeat';\n        var backgroundOpacity = opt.opacity || 1;\n        var backgroundQuality = Math.abs(opt.quality) || 1;\n        var backgroundPattern = this.constructor.backgroundPatterns[camelCase(backgroundRepeat)];\n\n        if (isFunction(backgroundPattern)) {\n            // 'flip-x', 'flip-y', 'flip-xy', 'watermark' and custom\n            img.width *= backgroundQuality;\n            img.height *= backgroundQuality;\n            var canvas = backgroundPattern(img, opt);\n            if (!(canvas instanceof HTMLCanvasElement)) {\n                throw new Error('dia.Paper: background pattern must return an HTML Canvas instance');\n            }\n\n            backgroundImage = canvas.toDataURL('image/png');\n            backgroundRepeat = 'repeat';\n            if (isObject(backgroundSize)) {\n                // recalculate the tile size if an object passed in\n                backgroundSize.width *= canvas.width / img.width;\n                backgroundSize.height *= canvas.height / img.height;\n            } else if (backgroundSize === undefined) {\n                // calculate the tile size if no provided\n                opt.size = {\n                    width: canvas.width / backgroundQuality,\n                    height: canvas.height / backgroundQuality\n                };\n            }\n        } else {\n            // backgroundRepeat:\n            // no-repeat', 'round', 'space', 'repeat', 'repeat-x', 'repeat-y'\n            backgroundImage = img.src;\n            if (backgroundSize === undefined) {\n                // pass the image size for  the backgroundSize if no size provided\n                opt.size = {\n                    width: img.width,\n                    height: img.height\n                };\n            }\n        }\n\n        this.$background.css({\n            opacity: backgroundOpacity,\n            backgroundRepeat: backgroundRepeat,\n            backgroundImage: 'url(' + backgroundImage + ')'\n        });\n\n        this.updateBackgroundImage(opt);\n    },\n\n    updateBackgroundColor: function(color) {\n\n        this.$el.css('backgroundColor', color || '');\n    },\n\n    drawBackground: function(opt) {\n\n        opt = opt || {};\n\n        this.updateBackgroundColor(opt.color);\n\n        if (opt.image) {\n            opt = this._background = cloneDeep(opt);\n            guid(opt);\n            var img = document.createElement('img');\n            img.onload = this.drawBackgroundImage.bind(this, img, opt);\n            img.src = opt.image;\n        } else {\n            this.drawBackgroundImage(null);\n            this._background = null;\n        }\n\n        return this;\n    },\n\n    setInteractivity: function(value) {\n\n        this.options.interactive = value;\n\n        invoke(this._views, 'setInteractivity', value);\n    },\n\n    // Paper definitions.\n    // ------------------\n\n    isDefined: function(defId) {\n\n        return !!this.svg.getElementById(defId);\n    },\n\n    defineFilter: function(filter) {\n\n        if (!isObject(filter)) {\n            throw new TypeError('dia.Paper: defineFilter() requires 1. argument to be an object.');\n        }\n\n        var filterId = filter.id;\n        var name = filter.name;\n        // Generate a hash code from the stringified filter definition. This gives us\n        // a unique filter ID for different definitions.\n        if (!filterId) {\n            filterId = name + this.svg.id + hashCode(JSON.stringify(filter));\n        }\n        // If the filter already exists in the document,\n        // we're done and we can just use it (reference it using `url()`).\n        // If not, create one.\n        if (!this.isDefined(filterId)) {\n\n            var namespace = _filter;\n            var filterSVGString = namespace[name] && namespace[name](filter.args || {});\n            if (!filterSVGString) {\n                throw new Error('Non-existing filter ' + name);\n            }\n\n            // Set the filter area to be 3x the bounding box of the cell\n            // and center the filter around the cell.\n            var filterAttrs = assign({\n                filterUnits: 'objectBoundingBox',\n                x: -1,\n                y: -1,\n                width: 3,\n                height: 3\n            }, filter.attrs, {\n                id: filterId\n            });\n\n            V(filterSVGString, filterAttrs).appendTo(this.defs);\n        }\n\n        return filterId;\n    },\n\n    defineGradient: function(gradient) {\n        if (!isObject(gradient)) {\n            throw new TypeError('dia.Paper: defineGradient() requires 1. argument to be an object.');\n        }\n        const { svg, defs } = this;\n        const {\n            type,\n            // Generate a hash code from the stringified filter definition. This gives us\n            // a unique filter ID for different definitions.\n            id = type + svg.id + hashCode(JSON.stringify(gradient)),\n            stops,\n            attrs = {}\n        } = gradient;\n        // If the gradient already exists in the document,\n        // we're done and we can just use it (reference it using `url()`).\n        if (this.isDefined(id)) return id;\n        // If not, create one.\n        const stopVEls = toArray(stops).map(({ offset, color, opacity }) => {\n            return V('stop').attr({\n                'offset': offset,\n                'stop-color': color,\n                'stop-opacity': Number.isFinite(opacity) ? opacity : 1\n            });\n        });\n        const gradientVEl = V(type, attrs, stopVEls);\n        gradientVEl.id = id;\n        gradientVEl.appendTo(defs);\n        return id;\n    },\n\n    definePattern: function(pattern) {\n        if (!isObject(pattern)) {\n            throw new TypeError('dia.Paper: definePattern() requires 1. argument to be an object.');\n        }\n        const { svg, defs } = this;\n        const {\n            // Generate a hash code from the stringified filter definition. This gives us\n            // a unique filter ID for different definitions.\n            id = svg.id + hashCode(JSON.stringify(pattern)),\n            markup,\n            attrs = {}\n        } = pattern;\n        if (!markup) {\n            throw new TypeError('dia.Paper: definePattern() requires markup.');\n        }\n        // If the gradient already exists in the document,\n        // we're done and we can just use it (reference it using `url()`).\n        if (this.isDefined(id)) return id;\n        // If not, create one.\n        const patternVEl = V('pattern', {\n            patternUnits: 'userSpaceOnUse'\n        });\n        patternVEl.id = id;\n        patternVEl.attr(attrs);\n        if (typeof markup === 'string') {\n            patternVEl.append(V(markup));\n        } else {\n            const { fragment } = parseDOMJSON(markup);\n            patternVEl.append(fragment);\n        }\n        patternVEl.appendTo(defs);\n        return id;\n    },\n\n    defineMarker: function(marker) {\n        if (!isObject(marker)) {\n            throw new TypeError('dia.Paper: defineMarker() requires the first argument to be an object.');\n        }\n        const { svg, defs } = this;\n        const {\n            // Generate a hash code from the stringified filter definition. This gives us\n            // a unique filter ID for different definitions.\n            id = svg.id + hashCode(JSON.stringify(marker)),\n            // user-provided markup\n            // (e.g. defined when creating link via `attrs/line/sourceMarker/markup`)\n            markup,\n            // user-provided attributes\n            // (e.g. defined when creating link via `attrs/line/sourceMarker/attrs`)\n            // note: `transform` attrs are ignored by browsers\n            attrs = {},\n            // deprecated - use `attrs/markerUnits` instead (which has higher priority)\n            markerUnits = 'userSpaceOnUse'\n        } = marker;\n        // If the marker already exists in the document,\n        // we're done and we can just use it (reference it using `url()`).\n        if (this.isDefined(id)) return id;\n        // If not, create one.\n        const markerVEl = V('marker', {\n            orient: 'auto',\n            overflow: 'visible',\n            markerUnits: markerUnits\n        });\n        markerVEl.id = id;\n        markerVEl.attr(attrs);\n        let markerContentVEl;\n        if (markup) {\n            let markupVEl;\n            if (typeof markup === 'string') {\n                // Marker object has a `markup` property of type string.\n                // - Construct V from the provided string.\n                markupVEl = V(markup);\n                // `markupVEl` is now either a single VEl, or an array of VEls.\n                // - Coerce it to an array.\n                markupVEl = (Array.isArray(markupVEl) ? markupVEl : [markupVEl]);\n            } else {\n                // Marker object has a `markup` property of type object.\n                // - Construct V from the object by parsing it as DOM JSON.\n                const { fragment } = parseDOMJSON(markup);\n                markupVEl = V(fragment).children();\n            }\n            // `markupVEl` is an array with one or more VEls inside.\n            // - If there are multiple VEls, wrap them in a newly-constructed <g> element\n            if (markupVEl.length > 1) {\n                markerContentVEl = V('g').append(markupVEl);\n            } else {\n                markerContentVEl = markupVEl[0];\n            }\n        } else {\n            // Marker object is a flat structure.\n            // - Construct a new V of type `marker.type`.\n            const { type = 'path' } = marker;\n            markerContentVEl = V(type);\n        }\n        // `markerContentVEl` is a single VEl.\n        // Assign additional attributes to it (= context attributes + marker attributes):\n        // - Attribute values are taken from non-special properties of `marker`.\n        const markerAttrs = omit(marker, 'type', 'id', 'markup', 'attrs', 'markerUnits');\n        const markerAttrsKeys = Object.keys(markerAttrs);\n        markerAttrsKeys.forEach((key) => {\n            const value = markerAttrs[key];\n            const markupValue = markerContentVEl.attr(key); // value coming from markupVEl (if any) = higher priority\n            if (markupValue == null) {\n                // Default logic:\n                markerContentVEl.attr(key, value);\n            } else {\n                // Properties with special logic should be added as cases to this switch block:\n                switch(key) {\n                    case 'transform':\n                        // - Prepend `transform` to existing value.\n                        markerContentVEl.attr(key, (value + ' ' + markupValue));\n                        break;\n                }\n            }\n        });\n        markerContentVEl.appendTo(markerVEl);\n        markerVEl.appendTo(defs);\n        return id;\n    }\n\n}, {\n\n    sorting: sortingTypes,\n\n    Layers: LayersNames,\n\n    backgroundPatterns: {\n\n        flipXy: function(img) {\n            // d b\n            // q p\n\n            var canvas = document.createElement('canvas');\n            var imgWidth = img.width;\n            var imgHeight = img.height;\n\n            canvas.width = 2 * imgWidth;\n            canvas.height = 2 * imgHeight;\n\n            var ctx = canvas.getContext('2d');\n            // top-left image\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n            // xy-flipped bottom-right image\n            ctx.setTransform(-1, 0, 0, -1, canvas.width, canvas.height);\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n            // x-flipped top-right image\n            ctx.setTransform(-1, 0, 0, 1, canvas.width, 0);\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n            // y-flipped bottom-left image\n            ctx.setTransform(1, 0, 0, -1, 0, canvas.height);\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n\n            return canvas;\n        },\n\n        flipX: function(img) {\n            // d b\n            // d b\n\n            var canvas = document.createElement('canvas');\n            var imgWidth = img.width;\n            var imgHeight = img.height;\n\n            canvas.width = imgWidth * 2;\n            canvas.height = imgHeight;\n\n            var ctx = canvas.getContext('2d');\n            // left image\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n            // flipped right image\n            ctx.translate(2 * imgWidth, 0);\n            ctx.scale(-1, 1);\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n\n            return canvas;\n        },\n\n        flipY: function(img) {\n            // d d\n            // q q\n\n            var canvas = document.createElement('canvas');\n            var imgWidth = img.width;\n            var imgHeight = img.height;\n\n            canvas.width = imgWidth;\n            canvas.height = imgHeight * 2;\n\n            var ctx = canvas.getContext('2d');\n            // top image\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n            // flipped bottom image\n            ctx.translate(0, 2 * imgHeight);\n            ctx.scale(1, -1);\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n\n            return canvas;\n        },\n\n        watermark: function(img, opt) {\n            //   d\n            // d\n\n            opt = opt || {};\n\n            var imgWidth = img.width;\n            var imgHeight = img.height;\n\n            var canvas = document.createElement('canvas');\n            canvas.width = imgWidth * 3;\n            canvas.height = imgHeight * 3;\n\n            var ctx = canvas.getContext('2d');\n            var angle = isNumber(opt.watermarkAngle) ? -opt.watermarkAngle : -20;\n            var radians = toRad(angle);\n            var stepX = canvas.width / 4;\n            var stepY = canvas.height / 4;\n\n            for (var i = 0; i < 4; i++) {\n                for (var j = 0; j < 4; j++) {\n                    if ((i + j) % 2 > 0) {\n                        // reset the current transformations\n                        ctx.setTransform(1, 0, 0, 1, (2 * i - 1) * stepX, (2 * j - 1) * stepY);\n                        ctx.rotate(radians);\n                        ctx.drawImage(img, -imgWidth / 2, -imgHeight / 2, imgWidth, imgHeight);\n                    }\n                }\n            }\n\n            return canvas;\n        }\n    },\n\n    gridPatterns: {\n        dot: [{\n            color: '#AAAAAA',\n            thickness: 1,\n            markup: 'rect',\n            update: function(el, opt) {\n                V(el).attr({\n                    width: opt.thickness * opt.sx,\n                    height: opt.thickness * opt.sy,\n                    fill: opt.color\n                });\n            }\n        }],\n        fixedDot: [{\n            color: '#AAAAAA',\n            thickness: 1,\n            markup: 'rect',\n            update: function(el, opt) {\n                var size = opt.sx <= 1 ? opt.thickness * opt.sx : opt.thickness;\n                V(el).attr({ width: size, height: size, fill: opt.color });\n            }\n        }],\n        mesh: [{\n            color: '#AAAAAA',\n            thickness: 1,\n            markup: 'path',\n            update: function(el, opt) {\n\n                var d;\n                var width = opt.width;\n                var height = opt.height;\n                var thickness = opt.thickness;\n\n                if (width - thickness >= 0 && height - thickness >= 0) {\n                    d = ['M', width, 0, 'H0 M0 0 V0', height].join(' ');\n                } else {\n                    d = 'M 0 0 0 0';\n                }\n\n                V(el).attr({ 'd': d, stroke: opt.color, 'stroke-width': opt.thickness });\n            }\n        }],\n        doubleMesh: [{\n            color: '#AAAAAA',\n            thickness: 1,\n            markup: 'path',\n            update: function(el, opt) {\n\n                var d;\n                var width = opt.width;\n                var height = opt.height;\n                var thickness = opt.thickness;\n\n                if (width - thickness >= 0 && height - thickness >= 0) {\n                    d = ['M', width, 0, 'H0 M0 0 V0', height].join(' ');\n                } else {\n                    d = 'M 0 0 0 0';\n                }\n\n                V(el).attr({ 'd': d, stroke: opt.color, 'stroke-width': opt.thickness });\n            }\n        }, {\n            color: '#000000',\n            thickness: 3,\n            scaleFactor: 4,\n            markup: 'path',\n            update: function(el, opt) {\n\n                var d;\n                var width = opt.width;\n                var height = opt.height;\n                var thickness = opt.thickness;\n\n                if (width - thickness >= 0 && height - thickness >= 0) {\n                    d = ['M', width, 0, 'H0 M0 0 V0', height].join(' ');\n                } else {\n                    d = 'M 0 0 0 0';\n                }\n\n                V(el).attr({ 'd': d, stroke: opt.color, 'stroke-width': opt.thickness });\n            }\n        }]\n    }\n});\n\n","import * as mvc from '../mvc/index.mjs';\nimport * as util from '../util/index.mjs';\nimport { CellView } from './CellView.mjs';\nimport { LayersNames } from './PaperLayer.mjs';\nimport { ToolView } from './ToolView.mjs';\n\nexport const ToolsView = mvc.View.extend({\n    tagName: 'g',\n    className: 'tools',\n    svgElement: true,\n    tools: null,\n    isRendered: false,\n    options: {\n        tools: null,\n        relatedView: null,\n        name: null,\n        // layer?: LayersNames.TOOLS\n        // z?: number\n    },\n\n    configure: function(options) {\n        options = util.assign(this.options, options);\n        var tools = options.tools;\n        if (!Array.isArray(tools)) return this;\n        var relatedView = options.relatedView;\n        if (!(relatedView instanceof CellView)) return this;\n        var views = this.tools = [];\n        for (var i = 0, n = tools.length; i < n; i++) {\n            var tool = tools[i];\n            if (!(tool instanceof ToolView)) continue;\n            tool.configure(relatedView, this);\n            this.vel.append(tool.el);\n            views.push(tool);\n        }\n        this.isRendered = false;\n        relatedView.requestUpdate(relatedView.getFlag('TOOLS'));\n        return this;\n    },\n\n    getName: function() {\n        return this.options.name;\n    },\n\n    update: function(opt) {\n\n        opt || (opt = {});\n        var tools = this.tools;\n        if (!tools) return this;\n        var isRendered = this.isRendered;\n        for (var i = 0, n = tools.length; i < n; i++) {\n            var tool = tools[i];\n            if (!isRendered) {\n                // First update executes render()\n                tool.render();\n            } else if (opt.tool !== tool.cid && tool.isVisible()) {\n                tool.update();\n            }\n        }\n        if (!this.isMounted()) {\n            this.mount();\n        }\n        if (!isRendered) {\n            // Make sure tools are visible (if they were hidden and the tool removed)\n            this.blurTool();\n            this.isRendered = true;\n        }\n        return this;\n    },\n\n    focusTool: function(focusedTool) {\n\n        var tools = this.tools;\n        if (!tools) return this;\n        for (var i = 0, n = tools.length; i < n; i++) {\n            var tool = tools[i];\n            if (focusedTool === tool) {\n                tool.show();\n            } else {\n                tool.hide();\n            }\n        }\n        return this;\n    },\n\n    blurTool: function(blurredTool) {\n        var tools = this.tools;\n        if (!tools) return this;\n        for (var i = 0, n = tools.length; i < n; i++) {\n            var tool = tools[i];\n            if (tool !== blurredTool && !tool.isVisible()) {\n                tool.show();\n                tool.update();\n            }\n        }\n        return this;\n    },\n\n    hide: function() {\n        return this.focusTool(null);\n    },\n\n    show: function() {\n        return this.blurTool(null);\n    },\n\n    onRemove: function() {\n        var tools = this.tools;\n        if (!tools) return this;\n        for (var i = 0, n = tools.length; i < n; i++) {\n            tools[i].remove();\n        }\n        this.tools = null;\n    },\n\n    mount: function() {\n        const { options, el } = this;\n        const { relatedView, layer = LayersNames.TOOLS, z } = options;\n        if (relatedView) {\n            if (layer) {\n                relatedView.paper.getLayerView(layer).insertSortedNode(el, z);\n            } else {\n                relatedView.el.appendChild(el);\n            }\n        }\n        return this;\n    }\n\n});\n","export const env = {\n\n    _results: {},\n\n    _tests: {\n\n        svgforeignobject: function() {\n            return !!document.createElementNS &&\n                /SVGForeignObject/.test(({}).toString.call(document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject')));\n        }\n    },\n\n    addTest: function(name, fn) {\n\n        return this._tests[name] = fn;\n    },\n\n    test: function(name) {\n\n        var fn = this._tests[name];\n\n        if (!fn) {\n            throw new Error('Test not defined (\"' + name + '\"). Use `joint.env.addTest(name, fn) to add a new test.`');\n        }\n\n        var result = this._results[name];\n\n        if (typeof result !== 'undefined') {\n            return result;\n        }\n\n        try {\n            result = fn();\n        } catch (error) {\n            result = false;\n        }\n\n        // Cache the test result.\n        this._results[name] = result;\n\n        return result;\n    }\n};\n","import { Element } from '../dia/Element.mjs';\nimport { ElementView } from '../dia/ElementView.mjs';\nimport { omit, assign, sanitizeHTML, merge, has, breakText, setByPath } from '../util/index.mjs';\nimport { env } from '../env/index.mjs';\n\nexport const Generic = Element.define('basic.Generic', {\n    attrs: {\n        '.': { fill: '#ffffff', stroke: 'none' }\n    }\n});\n\nexport const Rect = Generic.define('basic.Rect', {\n    attrs: {\n        'rect': {\n            fill: '#ffffff',\n            stroke: '#000000',\n            width: 100,\n            height: 60\n        },\n        'text': {\n            fill: '#000000',\n            text: '',\n            'font-size': 14,\n            'ref-x': .5,\n            'ref-y': .5,\n            'text-anchor': 'middle',\n            'y-alignment': 'middle',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><rect/></g><text/></g>'\n});\n\nexport const TextView = ElementView.extend({\n\n    presentationAttributes: ElementView.addPresentationAttributes({\n        // The element view is not automatically re-scaled to fit the model size\n        // when the attribute 'attrs' is changed.\n        attrs: ['SCALE']\n    }),\n\n    confirmUpdate: function() {\n        var flags = ElementView.prototype.confirmUpdate.apply(this, arguments);\n        if (this.hasFlag(flags, 'SCALE')) {\n            this.resize();\n            flags = this.removeFlag(flags, 'SCALE');\n        }\n        return flags;\n    }\n});\n\nexport const Text = Generic.define('basic.Text', {\n    attrs: {\n        'text': {\n            'font-size': 18,\n            fill: '#000000'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><text/></g></g>',\n});\n\nexport const Circle = Generic.define('basic.Circle', {\n    size: { width: 60, height: 60 },\n    attrs: {\n        'circle': {\n            fill: '#ffffff',\n            stroke: '#000000',\n            r: 30,\n            cx: 30,\n            cy: 30\n        },\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-y': .5,\n            'y-alignment': 'middle',\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><circle/></g><text/></g>',\n});\n\nexport const Ellipse = Generic.define('basic.Ellipse', {\n    size: { width: 60, height: 40 },\n    attrs: {\n        'ellipse': {\n            fill: '#ffffff',\n            stroke: '#000000',\n            rx: 30,\n            ry: 20,\n            cx: 30,\n            cy: 20\n        },\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-y': .5,\n            'y-alignment': 'middle',\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><ellipse/></g><text/></g>',\n});\n\nexport const Polygon = Generic.define('basic.Polygon', {\n    size: { width: 60, height: 40 },\n    attrs: {\n        'polygon': {\n            fill: '#ffffff',\n            stroke: '#000000'\n        },\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-dy': 20,\n            'y-alignment': 'middle',\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><polygon/></g><text/></g>',\n});\n\nexport const Polyline = Generic.define('basic.Polyline', {\n    size: { width: 60, height: 40 },\n    attrs: {\n        'polyline': {\n            fill: '#ffffff',\n            stroke: '#000000'\n        },\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-dy': 20,\n            'y-alignment': 'middle',\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><polyline/></g><text/></g>',\n});\n\nexport const Image = Generic.define('basic.Image', {\n    attrs: {\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-dy': 20,\n            'y-alignment': 'middle',\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><image/></g><text/></g>',\n});\n\nexport const Path = Generic.define('basic.Path', {\n    size: { width: 60, height: 60 },\n    attrs: {\n        'path': {\n            fill: '#ffffff',\n            stroke: '#000000'\n        },\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref': 'path',\n            'ref-x': .5,\n            'ref-dy': 10,\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><path/></g><text/></g>',\n});\n\nexport const Rhombus = Path.define('basic.Rhombus', {\n    attrs: {\n        'path': {\n            d: 'M 30 0 L 60 30 30 60 0 30 z'\n        },\n        'text': {\n            'ref-y': .5,\n            'ref-dy': null,\n            'y-alignment': 'middle'\n        }\n    }\n});\n\nconst svgForeignObjectSupported = env.test('svgforeignobject');\n\nexport const TextBlock = Generic.define('basic.TextBlock', {\n    // see joint.css for more element styles\n    attrs: {\n        rect: {\n            fill: '#ffffff',\n            stroke: '#000000',\n            width: 80,\n            height: 100\n        },\n        text: {\n            fill: '#000000',\n            'font-size': 14,\n            'font-family': 'Arial, helvetica, sans-serif'\n        },\n        '.content': {\n            text: '',\n            'ref-x': .5,\n            'ref-y': .5,\n            'y-alignment': 'middle',\n            'x-alignment': 'middle'\n        }\n    },\n\n    content: ''\n}, {\n    markup: [\n        '<g class=\"rotatable\">',\n        '<g class=\"scalable\"><rect/></g>',\n        svgForeignObjectSupported\n            ? '<foreignObject class=\"fobj\"><body xmlns=\"http://www.w3.org/1999/xhtml\"><div class=\"content\"/></body></foreignObject>'\n            : '<text class=\"content\"/>',\n        '</g>'\n    ].join(''),\n\n    initialize: function() {\n\n        this.listenTo(this, 'change:size', this.updateSize);\n        this.listenTo(this, 'change:content', this.updateContent);\n        this.updateSize(this, this.get('size'));\n        this.updateContent(this, this.get('content'));\n        Generic.prototype.initialize.apply(this, arguments);\n    },\n\n    updateSize: function(cell, size) {\n\n        // Selector `foreignObject' doesn't work across all browsers, we're using class selector instead.\n        // We have to clone size as we don't want attributes.div.style to be same object as attributes.size.\n        this.attr({\n            '.fobj': assign({}, size),\n            div: {\n                style: assign({}, size)\n            }\n        });\n    },\n\n    updateContent: function(cell, content) {\n\n        if (svgForeignObjectSupported) {\n\n            // Content element is a <div> element.\n            this.attr({\n                '.content': {\n                    html: sanitizeHTML(content)\n                }\n            });\n\n        } else {\n\n            // Content element is a <text> element.\n            // SVG elements don't have innerHTML attribute.\n            this.attr({\n                '.content': {\n                    text: content\n                }\n            });\n        }\n    },\n\n    // Here for backwards compatibility:\n    setForeignObjectSize: function() {\n\n        this.updateSize.apply(this, arguments);\n    },\n\n    // Here for backwards compatibility:\n    setDivContent: function() {\n\n        this.updateContent.apply(this, arguments);\n    }\n});\n\n// TextBlockView implements the fallback for IE when no foreignObject exists and\n// the text needs to be manually broken.\nexport const TextBlockView = ElementView.extend({\n\n    presentationAttributes: svgForeignObjectSupported\n        ? ElementView.prototype.presentationAttributes\n        : ElementView.addPresentationAttributes({\n            content: ['CONTENT'],\n            size: ['CONTENT']\n        }),\n\n    initFlag: ['RENDER', 'CONTENT'],\n\n    confirmUpdate: function() {\n        var flags = ElementView.prototype.confirmUpdate.apply(this, arguments);\n        if (this.hasFlag(flags, 'CONTENT')) {\n            this.updateContent(this.model);\n            flags = this.removeFlag(flags, 'CONTENT');\n        }\n        return flags;\n    },\n\n    update: function(_, renderingOnlyAttrs) {\n\n        var model = this.model;\n\n        if (!svgForeignObjectSupported) {\n\n            // Update everything but the content first.\n            var noTextAttrs = omit(renderingOnlyAttrs || model.get('attrs'), '.content');\n            ElementView.prototype.update.call(this, model, noTextAttrs);\n\n            if (!renderingOnlyAttrs || has(renderingOnlyAttrs, '.content')) {\n                // Update the content itself.\n                this.updateContent(model, renderingOnlyAttrs);\n            }\n\n        } else {\n\n            ElementView.prototype.update.call(this, model, renderingOnlyAttrs);\n        }\n    },\n\n    updateContent: function(cell, renderingOnlyAttrs) {\n\n        // Create copy of the text attributes\n        var textAttrs = merge({}, (renderingOnlyAttrs || cell.get('attrs'))['.content']);\n\n        textAttrs = omit(textAttrs, 'text');\n\n        // Break the content to fit the element size taking into account the attributes\n        // set on the model.\n        var text = breakText(cell.get('content'), cell.get('size'), textAttrs, {\n            // measuring sandbox svg document\n            svgDocument: this.paper.svg\n        });\n\n        // Create a new attrs with same structure as the model attrs { text: { *textAttributes* }}\n        var attrs = setByPath({}, '.content', textAttrs, '/');\n\n        // Replace text attribute with the one we just processed.\n        attrs['.content'].text = text;\n\n        // Update the view using renderingOnlyAttributes parameter.\n        ElementView.prototype.update.call(this, cell, attrs);\n    }\n});\n","import V from '../V/index.mjs';\nimport { Element } from '../dia/Element.mjs';\nimport { Link as LinkBase } from '../dia/Link.mjs';\nimport { isPercentage, assign } from '../util/index.mjs';\nimport { attributes } from '../dia/attributes/index.mjs';\nimport { env } from '../env/index.mjs';\n\n\n// ELEMENTS\n\nexport const Rectangle = Element.define('standard.Rectangle', {\n    attrs: {\n        body: {\n            refWidth: '100%',\n            refHeight: '100%',\n            strokeWidth: 2,\n            stroke: '#000000',\n            fill: '#FFFFFF'\n        },\n        label: {\n            textVerticalAnchor: 'middle',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '50%',\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'rect',\n        selector: 'body',\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }]\n});\n\nexport const Circle = Element.define('standard.Circle', {\n    attrs: {\n        body: {\n            refCx: '50%',\n            refCy: '50%',\n            refR: '50%',\n            strokeWidth: 2,\n            stroke: '#333333',\n            fill: '#FFFFFF'\n        },\n        label: {\n            textVerticalAnchor: 'middle',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '50%',\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'circle',\n        selector: 'body'\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }]\n});\n\nexport const Ellipse = Element.define('standard.Ellipse', {\n    attrs: {\n        body: {\n            refCx: '50%',\n            refCy: '50%',\n            refRx: '50%',\n            refRy: '50%',\n            strokeWidth: 2,\n            stroke: '#333333',\n            fill: '#FFFFFF'\n        },\n        label: {\n            textVerticalAnchor: 'middle',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '50%',\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'ellipse',\n        selector: 'body'\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }]\n});\n\nexport const Path = Element.define('standard.Path', {\n    attrs: {\n        body: {\n            refD: 'M 0 0 L 10 0 10 10 0 10 Z',\n            strokeWidth: 2,\n            stroke: '#333333',\n            fill: '#FFFFFF'\n        },\n        label: {\n            textVerticalAnchor: 'middle',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '50%',\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'path',\n        selector: 'body'\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }]\n});\n\nexport const Polygon = Element.define('standard.Polygon', {\n    attrs: {\n        body: {\n            refPoints: '0 0 10 0 10 10 0 10',\n            strokeWidth: 2,\n            stroke: '#333333',\n            fill: '#FFFFFF'\n        },\n        label: {\n            textVerticalAnchor: 'middle',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '50%',\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'polygon',\n        selector: 'body'\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }]\n});\n\nexport const Polyline = Element.define('standard.Polyline', {\n    attrs: {\n        body: {\n            refPoints: '0 0 10 0 10 10 0 10 0 0',\n            strokeWidth: 2,\n            stroke: '#333333',\n            fill: '#FFFFFF'\n        },\n        label: {\n            textVerticalAnchor: 'middle',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '50%',\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'polyline',\n        selector: 'body'\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }]\n});\n\nexport const Image = Element.define('standard.Image', {\n    attrs: {\n        image: {\n            refWidth: '100%',\n            refHeight: '100%',\n            // xlinkHref: '[URL]'\n        },\n        label: {\n            textVerticalAnchor: 'top',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '100%',\n            refY2: 10,\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'image',\n        selector: 'image'\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }]\n});\n\nexport const BorderedImage = Element.define('standard.BorderedImage', {\n    attrs: {\n        border: {\n            refWidth: '100%',\n            refHeight: '100%',\n            stroke: '#333333',\n            strokeWidth: 2\n        },\n        background: {\n            refWidth: -1,\n            refHeight: -1,\n            x: 0.5,\n            y: 0.5,\n            fill: '#FFFFFF'\n        },\n        image: {\n            // xlinkHref: '[URL]'\n            refWidth: -1,\n            refHeight: -1,\n            x: 0.5,\n            y: 0.5\n        },\n        label: {\n            textVerticalAnchor: 'top',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '100%',\n            refY2: 10,\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'rect',\n        selector: 'background',\n        attributes: {\n            'stroke': 'none'\n        }\n    }, {\n        tagName: 'image',\n        selector: 'image'\n    }, {\n        tagName: 'rect',\n        selector: 'border',\n        attributes: {\n            'fill': 'none'\n        }\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }]\n});\n\nexport const EmbeddedImage = Element.define('standard.EmbeddedImage', {\n    attrs: {\n        body: {\n            refWidth: '100%',\n            refHeight: '100%',\n            stroke: '#333333',\n            fill: '#FFFFFF',\n            strokeWidth: 2\n        },\n        image: {\n            // xlinkHref: '[URL]'\n            refWidth: '30%',\n            refHeight: -20,\n            x: 10,\n            y: 10,\n            preserveAspectRatio: 'xMidYMin'\n        },\n        label: {\n            textVerticalAnchor: 'top',\n            textAnchor: 'left',\n            refX: '30%',\n            refX2: 20, // 10 + 10\n            refY: 10,\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'rect',\n        selector: 'body'\n    }, {\n        tagName: 'image',\n        selector: 'image'\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }]\n});\n\nexport const InscribedImage = Element.define('standard.InscribedImage', {\n    attrs: {\n        border: {\n            refRx: '50%',\n            refRy: '50%',\n            refCx: '50%',\n            refCy: '50%',\n            stroke: '#333333',\n            strokeWidth: 2\n        },\n        background: {\n            refRx: '50%',\n            refRy: '50%',\n            refCx: '50%',\n            refCy: '50%',\n            fill: '#FFFFFF'\n        },\n        image: {\n            // The image corners touch the border when its size is Math.sqrt(2) / 2 = 0.707.. ~= 70%\n            refWidth: '68%',\n            refHeight: '68%',\n            // The image offset is calculated as (100% - 68%) / 2\n            refX: '16%',\n            refY: '16%',\n            preserveAspectRatio: 'xMidYMid'\n            // xlinkHref: '[URL]'\n        },\n        label: {\n            textVerticalAnchor: 'top',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '100%',\n            refY2: 10,\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'ellipse',\n        selector: 'background'\n    }, {\n        tagName: 'image',\n        selector: 'image'\n    }, {\n        tagName: 'ellipse',\n        selector: 'border',\n        attributes: {\n            'fill': 'none'\n        }\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }]\n});\n\nexport const HeaderedRectangle = Element.define('standard.HeaderedRectangle', {\n    attrs: {\n        body: {\n            refWidth: '100%',\n            refHeight: '100%',\n            strokeWidth: 2,\n            stroke: '#000000',\n            fill: '#FFFFFF'\n        },\n        header: {\n            refWidth: '100%',\n            height: 30,\n            strokeWidth: 2,\n            stroke: '#000000',\n            fill: '#FFFFFF'\n        },\n        headerText: {\n            textVerticalAnchor: 'middle',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: 15,\n            fontSize: 16,\n            fill: '#333333'\n        },\n        bodyText: {\n            textVerticalAnchor: 'middle',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '50%',\n            refY2: 15,\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'rect',\n        selector: 'body'\n    }, {\n        tagName: 'rect',\n        selector: 'header'\n    }, {\n        tagName: 'text',\n        selector: 'headerText'\n    }, {\n        tagName: 'text',\n        selector: 'bodyText'\n    }]\n});\n\nvar CYLINDER_TILT = 10;\n\nexport const Cylinder = Element.define('standard.Cylinder', {\n    attrs: {\n        body: {\n            lateralArea: CYLINDER_TILT,\n            fill: '#FFFFFF',\n            stroke: '#333333',\n            strokeWidth: 2\n        },\n        top: {\n            refCx: '50%',\n            cy: CYLINDER_TILT,\n            refRx: '50%',\n            ry: CYLINDER_TILT,\n            fill: '#FFFFFF',\n            stroke: '#333333',\n            strokeWidth: 2\n        },\n        label: {\n            textVerticalAnchor: 'middle',\n            textAnchor: 'middle',\n            refX: '50%',\n            refY: '100%',\n            refY2: 15,\n            fontSize: 14,\n            fill: '#333333'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'path',\n        selector: 'body'\n    }, {\n        tagName: 'ellipse',\n        selector: 'top'\n    }, {\n        tagName: 'text',\n        selector: 'label'\n    }],\n\n    topRy: function(t, opt) {\n        // getter\n        if (t === undefined) return this.attr('body/lateralArea');\n\n        // setter\n        var isPercentageSetter = isPercentage(t);\n\n        var bodyAttrs = { lateralArea: t };\n        var topAttrs = isPercentageSetter\n            ? { refCy: t, refRy: t, cy: null, ry: null }\n            : { refCy: null, refRy: null, cy: t, ry: t };\n\n        return this.attr({ body: bodyAttrs, top: topAttrs }, opt);\n    }\n\n}, {\n    attributes: {\n        lateralArea: {\n            set: function(t, refBBox) {\n                var isPercentageSetter = isPercentage(t);\n                if (isPercentageSetter) t = parseFloat(t) / 100;\n\n                var x = refBBox.x;\n                var y = refBBox.y;\n                var w = refBBox.width;\n                var h = refBBox.height;\n\n                // curve control point variables\n                var rx = w / 2;\n                var ry = isPercentageSetter ? (h * t) : t;\n\n                var kappa = V.KAPPA;\n                var cx = kappa * rx;\n                var cy = kappa * (isPercentageSetter ? (h * t) : t);\n\n                // shape variables\n                var xLeft = x;\n                var xCenter = x + (w / 2);\n                var xRight = x + w;\n\n                var ySideTop = y + ry;\n                var yCurveTop = ySideTop - ry;\n                var ySideBottom = y + h - ry;\n                var yCurveBottom = y + h;\n\n                // return calculated shape\n                var data = [\n                    'M', xLeft, ySideTop,\n                    'L', xLeft, ySideBottom,\n                    'C', x, (ySideBottom + cy), (xCenter - cx), yCurveBottom, xCenter, yCurveBottom,\n                    'C', (xCenter + cx), yCurveBottom, xRight, (ySideBottom + cy), xRight, ySideBottom,\n                    'L', xRight, ySideTop,\n                    'C', xRight, (ySideTop - cy), (xCenter + cx), yCurveTop, xCenter, yCurveTop,\n                    'C', (xCenter - cx), yCurveTop, xLeft, (ySideTop - cy), xLeft, ySideTop,\n                    'Z'\n                ];\n                return { d: data.join(' ') };\n            }\n        }\n    }\n});\n\nvar foLabelMarkup = {\n    tagName: 'foreignObject',\n    selector: 'foreignObject',\n    attributes: {\n        'overflow': 'hidden'\n    },\n    children: [{\n        tagName: 'div',\n        namespaceURI: 'http://www.w3.org/1999/xhtml',\n        selector: 'label',\n        style: {\n            width: '100%',\n            height: '100%',\n            position: 'static',\n            backgroundColor: 'transparent',\n            textAlign: 'center',\n            margin: 0,\n            padding: '0px 5px',\n            boxSizing: 'border-box',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center'\n        }\n    }]\n};\n\nvar svgLabelMarkup = {\n    tagName: 'text',\n    selector: 'label',\n    attributes: {\n        'text-anchor': 'middle'\n    }\n};\n\nvar labelMarkup = (env.test('svgforeignobject')) ? foLabelMarkup : svgLabelMarkup;\n\nexport const TextBlock = Element.define('standard.TextBlock', {\n    attrs: {\n        body: {\n            refWidth: '100%',\n            refHeight: '100%',\n            stroke: '#333333',\n            fill: '#ffffff',\n            strokeWidth: 2\n        },\n        foreignObject: {\n            refWidth: '100%',\n            refHeight: '100%'\n        },\n        label: {\n            style: {\n                fontSize: 14\n            }\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'rect',\n        selector: 'body'\n    }, labelMarkup]\n}, {\n    attributes: {\n        text: {\n            set: function(text, refBBox, node, attrs) {\n                if (node instanceof HTMLElement) {\n                    node.textContent = text;\n                } else {\n                    // No foreign object\n                    var style = attrs.style || {};\n                    var wrapValue = { text: text, width: -5, height: '100%' };\n                    var wrapAttrs = assign({ textVerticalAnchor: 'middle' }, style);\n                    attributes.textWrap.set.call(this, wrapValue, refBBox, node, wrapAttrs);\n                    return { fill: style.color || null };\n                }\n            },\n            position: function(text, refBBox, node) {\n                // No foreign object\n                if (node instanceof SVGElement) return refBBox.center();\n            }\n        }\n    }\n});\n\n// LINKS\n\nexport const Link = LinkBase.define('standard.Link', {\n    attrs: {\n        line: {\n            connection: true,\n            stroke: '#333333',\n            strokeWidth: 2,\n            strokeLinejoin: 'round',\n            targetMarker: {\n                'type': 'path',\n                'd': 'M 10 -5 0 0 10 5 z'\n            }\n        },\n        wrapper: {\n            connection: true,\n            strokeWidth: 10,\n            strokeLinejoin: 'round'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'path',\n        selector: 'wrapper',\n        attributes: {\n            'fill': 'none',\n            'cursor': 'pointer',\n            'stroke': 'transparent',\n            'stroke-linecap': 'round'\n        }\n    }, {\n        tagName: 'path',\n        selector: 'line',\n        attributes: {\n            'fill': 'none',\n            'pointer-events': 'none'\n        }\n    }]\n});\n\nexport const DoubleLink = LinkBase.define('standard.DoubleLink', {\n    attrs: {\n        line: {\n            connection: true,\n            stroke: '#DDDDDD',\n            strokeWidth: 4,\n            strokeLinejoin: 'round',\n            targetMarker: {\n                type: 'path',\n                stroke: '#000000',\n                d: 'M 10 -3 10 -10 -2 0 10 10 10 3'\n            }\n        },\n        outline: {\n            connection: true,\n            stroke: '#000000',\n            strokeWidth: 6,\n            strokeLinejoin: 'round'\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'path',\n        selector: 'outline',\n        attributes: {\n            'fill': 'none'\n        }\n    }, {\n        tagName: 'path',\n        selector: 'line',\n        attributes: {\n            'fill': 'none'\n        }\n    }]\n});\n\nexport const ShadowLink = LinkBase.define('standard.ShadowLink', {\n    attrs: {\n        line: {\n            connection: true,\n            stroke: '#FF0000',\n            strokeWidth: 20,\n            strokeLinejoin: 'round',\n            targetMarker: {\n                'type': 'path',\n                'stroke': 'none',\n                'd': 'M 0 -10 -10 0 0 10 z'\n            },\n            sourceMarker: {\n                'type': 'path',\n                'stroke': 'none',\n                'd': 'M -10 -10 0 0 -10 10 0 10 0 -10 z'\n            }\n        },\n        shadow: {\n            connection: true,\n            refX: 3,\n            refY: 6,\n            stroke: '#000000',\n            strokeOpacity: 0.2,\n            strokeWidth: 20,\n            strokeLinejoin: 'round',\n            targetMarker: {\n                'type': 'path',\n                'd': 'M 0 -10 -10 0 0 10 z',\n                'stroke': 'none'\n            },\n            sourceMarker: {\n                'type': 'path',\n                'stroke': 'none',\n                'd': 'M -10 -10 0 0 -10 10 0 10 0 -10 z'\n            }\n        }\n    }\n}, {\n    markup: [{\n        tagName: 'path',\n        selector: 'shadow',\n        attributes: {\n            'fill': 'none'\n        }\n    }, {\n        tagName: 'path',\n        selector: 'line',\n        attributes: {\n            'fill': 'none'\n        }\n    }]\n});\n","import { Generic } from './basic.mjs';\nimport { Link as LinkBase } from '../dia/Link.mjs';\nimport { uniq, difference, assign, toArray, without, isObject } from '../util/index.mjs';\n\n/**\n * @deprecated use the port api instead\n */\nexport const Model = Generic.define('devs.Model', {\n    inPorts: [],\n    outPorts: [],\n    size: {\n        width: 80,\n        height: 80\n    },\n    attrs: {\n        '.': {\n            magnet: false\n        },\n        '.label': {\n            text: 'Model',\n            'ref-x': .5,\n            'ref-y': 10,\n            'font-size': 18,\n            'text-anchor': 'middle',\n            fill: '#000'\n        },\n        '.body': {\n            'ref-width': '100%',\n            'ref-height': '100%',\n            stroke: '#000'\n        }\n    },\n    ports: {\n        groups: {\n            'in': {\n                position: {\n                    name: 'left'\n                },\n                attrs: {\n                    '.port-label': {\n                        fill: '#000'\n                    },\n                    '.port-body': {\n                        fill: '#fff',\n                        stroke: '#000',\n                        r: 10,\n                        magnet: true\n                    }\n                },\n                label: {\n                    position: {\n                        name: 'left',\n                        args: {\n                            y: 10\n                        }\n                    }\n                }\n            },\n            'out': {\n                position: {\n                    name: 'right'\n                },\n                attrs: {\n                    '.port-label': {\n                        fill: '#000'\n                    },\n                    '.port-body': {\n                        fill: '#fff',\n                        stroke: '#000',\n                        r: 10,\n                        magnet: true\n                    }\n                },\n                label: {\n                    position: {\n                        name: 'right',\n                        args: {\n                            y: 10\n                        }\n                    }\n                }\n            }\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><rect class=\"body\"/><text class=\"label\"/></g>',\n    portMarkup: '<circle class=\"port-body\"/>',\n    portLabelMarkup: '<text class=\"port-label\"/>',\n\n    initialize: function() {\n\n        Generic.prototype.initialize.apply(this, arguments);\n\n        this.on('change:inPorts change:outPorts', this.updatePortItems, this);\n        this.updatePortItems();\n    },\n\n    updatePortItems: function(model, changed, opt) {\n\n        // Make sure all ports are unique.\n        var inPorts = uniq(this.get('inPorts'));\n        var outPorts = difference(uniq(this.get('outPorts')), inPorts);\n\n        var inPortItems = this.createPortItems('in', inPorts);\n        var outPortItems = this.createPortItems('out', outPorts);\n\n        this.prop('ports/items', inPortItems.concat(outPortItems), assign({ rewrite: true }, opt));\n    },\n\n    createPortItem: function(group, port) {\n\n        return {\n            id: port,\n            group: group,\n            attrs: {\n                '.port-label': {\n                    text: port\n                }\n            }\n        };\n    },\n\n    createPortItems: function(group, ports) {\n\n        return toArray(ports).map(this.createPortItem.bind(this, group));\n    },\n\n    _addGroupPort: function(port, group, opt) {\n\n        var ports = this.get(group);\n        return this.set(group, Array.isArray(ports) ? ports.concat(port) : [port], opt);\n    },\n\n    addOutPort: function(port, opt) {\n\n        return this._addGroupPort(port, 'outPorts', opt);\n    },\n\n    addInPort: function(port, opt) {\n\n        return this._addGroupPort(port, 'inPorts', opt);\n    },\n\n    _removeGroupPort: function(port, group, opt) {\n\n        return this.set(group, without(this.get(group), port), opt);\n    },\n\n    removeOutPort: function(port, opt) {\n\n        return this._removeGroupPort(port, 'outPorts', opt);\n    },\n\n    removeInPort: function(port, opt) {\n\n        return this._removeGroupPort(port, 'inPorts', opt);\n    },\n\n    _changeGroup: function(group, properties, opt) {\n\n        return this.prop('ports/groups/' + group, isObject(properties) ? properties : {}, opt);\n    },\n\n    changeInGroup: function(properties, opt) {\n\n        return this._changeGroup('in', properties, opt);\n    },\n\n    changeOutGroup: function(properties, opt) {\n\n        return this._changeGroup('out', properties, opt);\n    }\n});\n\nexport const Atomic = Model.define('devs.Atomic', {\n    size: {\n        width: 80,\n        height: 80\n    },\n    attrs: {\n        '.label': {\n            text: 'Atomic'\n        }\n    }\n});\n\nexport const Coupled = Model.define('devs.Coupled', {\n    size: {\n        width: 200,\n        height: 300\n    },\n    attrs: {\n        '.label': {\n            text: 'Coupled'\n        }\n    }\n});\n\nexport const Link = LinkBase.define('devs.Link', {\n    attrs: {\n        '.connection': {\n            'stroke-width': 2\n        }\n    }\n});\n\n","import { Generic } from './basic.mjs';\nimport { Link } from '../dia/Link.mjs';\n\nexport const Gate = Generic.define('logic.Gate', {\n    size: { width: 80, height: 40 },\n    attrs: {\n        '.': { magnet: false },\n        '.body': { width: 100, height: 50 },\n        circle: { r: 7, stroke: 'black', fill: 'transparent', 'stroke-width': 2 }\n    }\n}, {\n    operation: function() {\n        return true;\n    }\n});\n\nexport const IO = Gate.define('logic.IO', {\n    size: { width: 60, height: 30 },\n    attrs: {\n        '.body': { fill: 'white', stroke: 'black', 'stroke-width': 2 },\n        '.wire': { ref: '.body', 'ref-y': .5, stroke: 'black' },\n        text: {\n            fill: 'black',\n            ref: '.body', 'ref-x': .5, 'ref-y': .5, 'y-alignment': 'middle',\n            'text-anchor': 'middle',\n            'font-weight': 'bold',\n            'font-variant': 'small-caps',\n            'text-transform': 'capitalize',\n            'font-size': '14px'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><rect class=\"body\"/></g><path class=\"wire\"/><circle/><text/></g>',\n});\n\nexport const Input = IO.define('logic.Input', {\n    attrs: {\n        '.wire': { 'ref-dx': 0, d: 'M 0 0 L 23 0' },\n        circle: { ref: '.body', 'ref-dx': 30, 'ref-y': 0.5, magnet: true, 'class': 'output', port: 'out' },\n        text: { text: 'input' }\n    }\n});\n\nexport const Output = IO.define('logic.Output', {\n    attrs: {\n        '.wire': { 'ref-x': 0, d: 'M 0 0 L -23 0' },\n        circle: { ref: '.body', 'ref-x': -30, 'ref-y': 0.5, magnet: 'passive', 'class': 'input', port: 'in' },\n        text: { text: 'output' }\n    }\n});\n\nexport const Gate11 = Gate.define('logic.Gate11', {\n    attrs: {\n        '.input': { ref: '.body', 'ref-x': -2, 'ref-y': 0.5, magnet: 'passive', port: 'in' },\n        '.output': { ref: '.body', 'ref-dx': 2, 'ref-y': 0.5, magnet: true, port: 'out' }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><image class=\"body\"/></g><circle class=\"input\"/><circle class=\"output\"/></g>',\n});\n\nexport const Gate21 = Gate.define('logic.Gate21', {\n    attrs: {\n        '.input1': { ref: '.body', 'ref-x': -2, 'ref-y': 0.3, magnet: 'passive', port: 'in1' },\n        '.input2': { ref: '.body', 'ref-x': -2, 'ref-y': 0.7, magnet: 'passive', port: 'in2' },\n        '.output': { ref: '.body', 'ref-dx': 2, 'ref-y': 0.5, magnet: true, port: 'out' }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><image class=\"body\"/></g><circle class=\"input input1\"/><circle  class=\"input input2\"/><circle class=\"output\"/></g>',\n});\n\nexport const Repeater = Gate11.define('logic.Repeater', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzIuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICA8L2c+Cjwvc3ZnPgo=' }}\n}, {\n    operation: function(input) {\n        return input;\n    }\n});\n\nexport const Not = Gate11.define('logic.Not', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzkuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDI2NzEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzYiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA4MCwyNSBBIDQsNCAwIDEgMSA3MiwyNSBBIDQsNCAwIDEgMSA4MCwyNSB6IgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEsMCkiIC8+CiAgPC9nPgo8L3N2Zz4K' }}\n}, {\n    operation: function(input) {\n        return !input;\n    }\n});\n\nexport const Or = Gate21.define('logic.Or', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik9SIEFOU0kuc3ZnIgogICBpbmtzY2FwZTpvdXRwdXRfZXh0ZW5zaW9uPSJvcmcuaW5rc2NhcGUub3V0cHV0LnN2Zy5pbmtzY2FwZSI+CiAgPGRlZnMKICAgICBpZD0iZGVmczQiPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTAgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjcxNCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iMSA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMC41IDogMC4zMzMzMzMzMyA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODA2IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODE5IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjM3Mi4wNDcyNCA6IDM1MC43ODczOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI3NDQuMDk0NDggOiA1MjYuMTgxMDkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzc3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49Ijc1IDogNDAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTUwIDogNjAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDYwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTMyNzUiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNTAgOiAzMy4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTAwIDogNTAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTU1MzMiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzIgOiAyMS4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNjQgOiAzMiA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMzIgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjU1NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDE2LjY2NjY2NyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDI1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAyNSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iNCIKICAgICBpbmtzY2FwZTpjeD0iMTEzLjAwMDM5IgogICAgIGlua3NjYXBlOmN5PSIxMi44OTM3MzEiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9InB4IgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImcyNTYwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTpncmlkLWJib3g9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1wb2ludHM9InRydWUiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAwMDAiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMzk5IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijg3NCIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMzciCiAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii00IgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Im0gNzAsMjUgYyAyMCwwIDI1LDAgMjUsMCIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMSwxNSA1LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzIsMzUgNSwzNSIKICAgICAgIGlkPSJwYXRoMzk0NCIgLz4KICAgIDxnCiAgICAgICBpZD0iZzI1NjAiCiAgICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2LjUsLTM5LjUpIj4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=' }}\n}, {\n    operation: function(input1, input2) {\n        return input1 || input2;\n    }\n});\n\nexport const And = Gate21.define('logic.And', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IkFORCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI4IgogICAgIGlua3NjYXBlOmN4PSI1Ni42OTgzNDgiCiAgICAgaW5rc2NhcGU6Y3k9IjI1LjMyNjg5OSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTptZWRpdW07Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWluZGVudDowO3RleHQtYWxpZ246c3RhcnQ7dGV4dC1kZWNvcmF0aW9uOm5vbmU7bGluZS1oZWlnaHQ6bm9ybWFsO2xldHRlci1zcGFjaW5nOm5vcm1hbDt3b3JkLXNwYWNpbmc6bm9ybWFsO3RleHQtdHJhbnNmb3JtOm5vbmU7ZGlyZWN0aW9uOmx0cjtibG9jay1wcm9ncmVzc2lvbjp0Yjt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6c3RhcnQ7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDozO21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGU7Zm9udC1mYW1pbHk6Qml0c3RyZWFtIFZlcmEgU2FuczstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkJpdHN0cmVhbSBWZXJhIFNhbnMiCiAgICAgICBkPSJNIDMwLDUgTCAzMCw2LjQyODU3MTQgTCAzMCw0My41NzE0MjkgTCAzMCw0NSBMIDMxLjQyODU3MSw0NSBMIDUwLjQ3NjE5LDQ1IEMgNjEuNzQ0MDk4LDQ1IDcwLjQ3NjE5LDM1Ljk5OTk1NSA3MC40NzYxOSwyNSBDIDcwLjQ3NjE5LDE0LjAwMDA0NSA2MS43NDQwOTksNS4wMDAwMDAyIDUwLjQ3NjE5LDUgQyA1MC40NzYxOSw1IDUwLjQ3NjE5LDUgMzEuNDI4NTcxLDUgTCAzMCw1IHogTSAzMi44NTcxNDMsNy44NTcxNDI5IEMgNDAuODM0MjY0LDcuODU3MTQyOSA0NS45MTgzNjgsNy44NTcxNDI5IDQ4LjA5NTIzOCw3Ljg1NzE0MjkgQyA0OS4yODU3MTQsNy44NTcxNDI5IDQ5Ljg4MDk1Miw3Ljg1NzE0MjkgNTAuMTc4NTcxLDcuODU3MTQyOSBDIDUwLjMyNzM4MSw3Ljg1NzE0MjkgNTAuNDA5MjI3LDcuODU3MTQyOSA1MC40NDY0MjksNy44NTcxNDI5IEMgNTAuNDY1MDI5LDcuODU3MTQyOSA1MC40NzE1NDMsNy44NTcxNDI5IDUwLjQ3NjE5LDcuODU3MTQyOSBDIDYwLjIzNjg1Myw3Ljg1NzE0MyA2Ny4xNDI4NTcsMTUuNDk3MDk4IDY3LjE0Mjg1NywyNSBDIDY3LjE0Mjg1NywzNC41MDI5MDIgNTkuNzYwNjYyLDQyLjE0Mjg1NyA1MCw0Mi4xNDI4NTcgTCAzMi44NTcxNDMsNDIuMTQyODU3IEwgMzIuODU3MTQzLDcuODU3MTQyOSB6IgogICAgICAgaWQ9InBhdGgyODg0IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjY2NzY2NjY3Nzc3NzY2NjIiAvPgogIDwvZz4KPC9zdmc+Cg==' }}\n\n}, {\n    operation: function(input1, input2) {\n        return input1 && input2;\n    }\n});\n\nexport const Nor = Gate21.define('logic.Nor', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjEiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjY3NzY0NCIKICAgICBpbmtzY2FwZTpjeT0iMjIuMTAyMzQ0IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjM3IgogICAgIGlua3NjYXBlOndpbmRvdy15PSItNCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc5LDI1IEMgOTksMjUgOTUsMjUgOTUsMjUiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgICBpZD0icGF0aDI2MDQiCiAgICAgICAgIHNvZGlwb2RpOmN4PSI3NSIKICAgICAgICAgc29kaXBvZGk6Y3k9IjI1IgogICAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgICAgc29kaXBvZGk6cnk9IjQiCiAgICAgICAgIGQ9Ik0gNzksMjUgQSA0LDQgMCAxIDEgNzEsMjUgQSA0LDQgMCAxIDEgNzksMjUgeiIKICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI2LjUsMzkuNSkiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K' }}\n}, {\n    operation: function(input1, input2) {\n        return !(input1 || input2);\n    }\n});\n\nexport const Nand = Gate21.define('logic.Nand', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5BTkQgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMTYiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjI4MzMwNyIKICAgICBpbmtzY2FwZTpjeT0iMTYuNDQyODQzIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzksMjUgQyA5MS44LDI1IDk1LDI1IDk1LDI1IgogICAgICAgaWQ9InBhdGgzMDU5IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMxLDE1IDUsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMiwzNSA1LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmb250LXNpemU6bWVkaXVtO2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1pbmRlbnQ6MDt0ZXh0LWFsaWduOnN0YXJ0O3RleHQtZGVjb3JhdGlvbjpub25lO2xpbmUtaGVpZ2h0Om5vcm1hbDtsZXR0ZXItc3BhY2luZzpub3JtYWw7d29yZC1zcGFjaW5nOm5vcm1hbDt0ZXh0LXRyYW5zZm9ybTpub25lO2RpcmVjdGlvbjpsdHI7YmxvY2stcHJvZ3Jlc3Npb246dGI7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOnN0YXJ0O2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MzttYXJrZXI6bm9uZTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlO2ZvbnQtZmFtaWx5OkJpdHN0cmVhbSBWZXJhIFNhbnM7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpCaXRzdHJlYW0gVmVyYSBTYW5zIgogICAgICAgZD0iTSAzMCw1IEwgMzAsNi40Mjg1NzE0IEwgMzAsNDMuNTcxNDI5IEwgMzAsNDUgTCAzMS40Mjg1NzEsNDUgTCA1MC40NzYxOSw0NSBDIDYxLjc0NDA5OCw0NSA3MC40NzYxOSwzNS45OTk5NTUgNzAuNDc2MTksMjUgQyA3MC40NzYxOSwxNC4wMDAwNDUgNjEuNzQ0MDk5LDUuMDAwMDAwMiA1MC40NzYxOSw1IEMgNTAuNDc2MTksNSA1MC40NzYxOSw1IDMxLjQyODU3MSw1IEwgMzAsNSB6IE0gMzIuODU3MTQzLDcuODU3MTQyOSBDIDQwLjgzNDI2NCw3Ljg1NzE0MjkgNDUuOTE4MzY4LDcuODU3MTQyOSA0OC4wOTUyMzgsNy44NTcxNDI5IEMgNDkuMjg1NzE0LDcuODU3MTQyOSA0OS44ODA5NTIsNy44NTcxNDI5IDUwLjE3ODU3MSw3Ljg1NzE0MjkgQyA1MC4zMjczODEsNy44NTcxNDI5IDUwLjQwOTIyNyw3Ljg1NzE0MjkgNTAuNDQ2NDI5LDcuODU3MTQyOSBDIDUwLjQ2NTAyOSw3Ljg1NzE0MjkgNTAuNDcxNTQzLDcuODU3MTQyOSA1MC40NzYxOSw3Ljg1NzE0MjkgQyA2MC4yMzY4NTMsNy44NTcxNDMgNjcuMTQyODU3LDE1LjQ5NzA5OCA2Ny4xNDI4NTcsMjUgQyA2Ny4xNDI4NTcsMzQuNTAyOTAyIDU5Ljc2MDY2Miw0Mi4xNDI4NTcgNTAsNDIuMTQyODU3IEwgMzIuODU3MTQzLDQyLjE0Mjg1NyBMIDMyLjg1NzE0Myw3Ljg1NzE0MjkgeiIKICAgICAgIGlkPSJwYXRoMjg4NCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2Njc2NjY2Nzc3Nzc2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDQwMDgiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg==' }}\n}, {\n    operation: function(input1, input2) {\n        return !(input1 && input2);\n    }\n});\n\nexport const Xor = Gate21.define('logic.Xor', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhPUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjUuNjU2ODU0MiIKICAgICBpbmtzY2FwZTpjeD0iMjUuOTM4MTE2IgogICAgIGlua3NjYXBlOmN5PSIxNy4yMzAwNSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzAuMzg1NzE3LDE1IEwgNC45OTk5OTk4LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5NzY7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEuMzYyMDkxLDM1IEwgNC45OTk5OTk4LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPGcKICAgICAgIGlkPSJnMjU2MCIKICAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjYuNSwtMzkuNSkiPgogICAgICA8cGF0aAogICAgICAgICBpZD0icGF0aDM1MTYiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi4yNSw4MS41MDAwMDUgQyAtMy44NDczNzQsODQuMTQ0NDA1IC00LjUsODQuNTAwMDA1IC00LjUsODQuNTAwMDA1IEwgLTguMTU2MjUsODQuNTAwMDA1IEwgLTYuMTU2MjUsODIuMDYyNTA1IEMgLTYuMTU2MjUsODIuMDYyNTA1IC0wLjUsNzUuMDYyNDUxIC0wLjUsNjQuNSBDIC0wLjUsNTMuOTM3NTQ5IC02LjE1NjI1LDQ2LjkzNzUgLTYuMTU2MjUsNDYuOTM3NSBMIC04LjE1NjI1LDQ0LjUgTCAtNC41LDQ0LjUgQyAtMy43MTg3NSw0NS40Mzc1IC0zLjA3ODEyNSw0Ni4xNTYyNSAtMi4yODEyNSw0Ny41IEMgLTAuNDA4NTMxLDUwLjU5OTgxNSAyLjUsNTYuNTI2NjQ2IDIuNSw2NC41IEMgMi41LDcyLjQ1MDY1IC0wLjM5NjY5Nyw3OC4zNzk0MjUgLTIuMjUsODEuNTAwMDA1IHoiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY3NjY2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K' }}\n}, {\n    operation: function(input1, input2) {\n        return (!input1 || input2) && (input1 || !input2);\n    }\n});\n\nexport const Xnor = Gate21.define('logic.Xnor', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhOT1IgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNTU3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTYuNjY2NjY3IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDI1IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI0IgogICAgIGlua3NjYXBlOmN4PSI5NS43MjM2NiIKICAgICBpbmtzY2FwZTpjeT0iLTI2Ljc3NTAyMyIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjAwMDAwMDI0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc4LjMzMzMzMiwyNSBDIDkxLjY2NjY2NiwyNSA5NSwyNSA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMC4zODU3MTcsMTUgTCA0Ljk5OTk5OTgsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk3NjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMS4zNjIwOTEsMzUgTCA0Ljk5OTk5OTgsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIGlkPSJwYXRoMzUxNiIKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjI1LDgxLjUwMDAwNSBDIC0zLjg0NzM3NCw4NC4xNDQ0MDUgLTQuNSw4NC41MDAwMDUgLTQuNSw4NC41MDAwMDUgTCAtOC4xNTYyNSw4NC41MDAwMDUgTCAtNi4xNTYyNSw4Mi4wNjI1MDUgQyAtNi4xNTYyNSw4Mi4wNjI1MDUgLTAuNSw3NS4wNjI0NTEgLTAuNSw2NC41IEMgLTAuNSw1My45Mzc1NDkgLTYuMTU2MjUsNDYuOTM3NSAtNi4xNTYyNSw0Ni45Mzc1IEwgLTguMTU2MjUsNDQuNSBMIC00LjUsNDQuNSBDIC0zLjcxODc1LDQ1LjQzNzUgLTMuMDc4MTI1LDQ2LjE1NjI1IC0yLjI4MTI1LDQ3LjUgQyAtMC40MDg1MzEsNTAuNTk5ODE1IDIuNSw1Ni41MjY2NDYgMi41LDY0LjUgQyAyLjUsNzIuNDUwNjUgLTAuMzk2Njk3LDc4LjM3OTQyNSAtMi4yNSw4MS41MDAwMDUgeiIKICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2Njc2NjY2NzYyIgLz4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDM1NTEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg==' }}\n}, {\n    operation: function(input1, input2) {\n        return (!input1 || !input2) && (input1 || input2);\n    }\n});\n\nexport const Wire = Link.define('logic.Wire', {\n    attrs: {\n        '.connection': { 'stroke-width': 2 },\n        '.marker-vertex': { r: 7 }\n    },\n\n    router: { name: 'orthogonal' },\n    connector: { name: 'rounded', args: { radius: 10 }}\n}, {\n    arrowheadMarkup: [\n        '<g class=\"marker-arrowhead-group marker-arrowhead-group-<%= end %>\">',\n        '<circle class=\"marker-arrowhead\" end=\"<%= end %>\" r=\"7\"/>',\n        '</g>'\n    ].join(''),\n\n    vertexMarkup: [\n        '<g class=\"marker-vertex-group\" transform=\"translate(<%= x %>, <%= y %>)\">',\n        '<circle class=\"marker-vertex\" idx=\"<%= idx %>\" r=\"10\" />',\n        '<g class=\"marker-vertex-remove-group\">',\n        '<path class=\"marker-vertex-remove-area\" idx=\"<%= idx %>\" d=\"M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z\" transform=\"translate(5, -33)\"/>',\n        '<path class=\"marker-vertex-remove\" idx=\"<%= idx %>\" transform=\"scale(.8) translate(9.5, -37)\" d=\"M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z\">',\n        '<title>Remove vertex.</title>',\n        '</path>',\n        '</g>',\n        '</g>'\n    ].join('')\n});\n","import { Generic } from './basic.mjs';\n\nexport const KingWhite = Generic.define('chess.KingWhite', {\n    size: { width: 42, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\"><path      d=\"M 22.5,11.63 L 22.5,6\"      style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\" />    <path      d=\"M 20,8 L 25,8\"      style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\" />    <path      d=\"M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25\"      style=\"fill:#ffffff; stroke:#000000; stroke-linecap:butt; stroke-linejoin:miter;\" />    <path      d=\"M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z \"      style=\"fill:#ffffff; stroke:#000000;\" />    <path      d=\"M 11.5,30 C 17,27 27,27 32.5,30\"      style=\"fill:none; stroke:#000000;\" />    <path      d=\"M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5\"      style=\"fill:none; stroke:#000000;\" />    <path      d=\"M 11.5,37 C 17,34 27,34 32.5,37\"      style=\"fill:none; stroke:#000000;\" />  </g></g></g>'\n});\n\nexport const KingBlack = Generic.define('chess.KingBlack', {\n    size: { width: 42, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path       d=\"M 22.5,11.63 L 22.5,6\"       style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\"       id=\"path6570\" />    <path       d=\"M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25\"       style=\"fill:#000000;fill-opacity:1; stroke-linecap:butt; stroke-linejoin:miter;\" />    <path       d=\"M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z \"       style=\"fill:#000000; stroke:#000000;\" />    <path       d=\"M 20,8 L 25,8\"       style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\" />    <path       d=\"M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.51,26.6 L 22.5,24.5 C 20,18 9.906,14 6.997,19.85 C 4.5,25.5 11.85,28.85 11.85,28.85\"       style=\"fill:none; stroke:#ffffff;\" />    <path       d=\"M 11.5,30 C 17,27 27,27 32.5,30 M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5 M 11.5,37 C 17,34 27,34 32.5,37\"       style=\"fill:none; stroke:#ffffff;\" />  </g></g></g>'\n});\n\nexport const QueenWhite = Generic.define('chess.QueenWhite', {\n    size: { width: 42, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path      d=\"M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z\"      transform=\"translate(-1,-1)\" />    <path      d=\"M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z\"      transform=\"translate(15.5,-5.5)\" />    <path      d=\"M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z\"      transform=\"translate(32,-1)\" />    <path      d=\"M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z\"      transform=\"translate(7,-4.5)\" />    <path      d=\"M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z\"      transform=\"translate(24,-4)\" />    <path      d=\"M 9,26 C 17.5,24.5 30,24.5 36,26 L 38,14 L 31,25 L 31,11 L 25.5,24.5 L 22.5,9.5 L 19.5,24.5 L 14,10.5 L 14,25 L 7,14 L 9,26 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 11.5,30 C 15,29 30,29 33.5,30\"      style=\"fill:none;\" />    <path      d=\"M 12,33.5 C 18,32.5 27,32.5 33,33.5\"      style=\"fill:none;\" />  </g></g></g>'\n});\n\nexport const QueenBlack = Generic.define('chess.QueenBlack', {\n    size: { width: 42, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <g style=\"fill:#000000; stroke:none;\">      <circle cx=\"6\"    cy=\"12\" r=\"2.75\" />      <circle cx=\"14\"   cy=\"9\"  r=\"2.75\" />      <circle cx=\"22.5\" cy=\"8\"  r=\"2.75\" />      <circle cx=\"31\"   cy=\"9\"  r=\"2.75\" />      <circle cx=\"39\"   cy=\"12\" r=\"2.75\" />    </g>    <path       d=\"M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z\"       style=\"stroke-linecap:butt; stroke:#000000;\" />    <path       d=\"M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z\"       style=\"stroke-linecap:butt;\" />    <path       d=\"M 11,38.5 A 35,35 1 0 0 34,38.5\"       style=\"fill:none; stroke:#000000; stroke-linecap:butt;\" />    <path       d=\"M 11,29 A 35,35 1 0 1 34,29\"       style=\"fill:none; stroke:#ffffff;\" />    <path       d=\"M 12.5,31.5 L 32.5,31.5\"       style=\"fill:none; stroke:#ffffff;\" />    <path       d=\"M 11.5,34.5 A 35,35 1 0 0 33.5,34.5\"       style=\"fill:none; stroke:#ffffff;\" />    <path       d=\"M 10.5,37.5 A 35,35 1 0 0 34.5,37.5\"       style=\"fill:none; stroke:#ffffff;\" />  </g></g></g>'\n});\n\nexport const RookWhite = Generic.define('chess.RookWhite', {\n    size: { width: 32, height: 34 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path      d=\"M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14\"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 34,14 L 31,17 L 14,17 L 11,14\" />    <path      d=\"M 31,17 L 31,29.5 L 14,29.5 L 14,17\"      style=\"stroke-linecap:butt; stroke-linejoin:miter;\" />    <path      d=\"M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5\" />    <path      d=\"M 11,14 L 34,14\"      style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\" />  </g></g></g>'\n});\n\nexport const RookBlack = Generic.define('chess.RookBlack', {\n    size: { width: 32, height: 34 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path      d=\"M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z \"      style=\"stroke-linecap:butt;stroke-linejoin:miter;\" />    <path      d=\"M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 12,35.5 L 33,35.5 L 33,35.5\"      style=\"fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;\" />    <path      d=\"M 13,31.5 L 32,31.5\"      style=\"fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;\" />    <path      d=\"M 14,29.5 L 31,29.5\"      style=\"fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;\" />    <path      d=\"M 14,16.5 L 31,16.5\"      style=\"fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;\" />    <path      d=\"M 11,14 L 34,14\"      style=\"fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;\" />  </g></g></g>'\n});\n\nexport const BishopWhite = Generic.define('chess.BishopWhite', {\n    size: { width: 38, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <g style=\"fill:#ffffff; stroke:#000000; stroke-linecap:butt;\">       <path        d=\"M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z\" />      <path        d=\"M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z\" />      <path        d=\"M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z\" />    </g>    <path      d=\"M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18\"      style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\" />  </g></g></g>'\n});\n\nexport const BishopBlack = Generic.define('chess.BishopBlack', {\n    size: { width: 38, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <g style=\"fill:#000000; stroke:#000000; stroke-linecap:butt;\">       <path        d=\"M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z\" />      <path        d=\"M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z\" />      <path        d=\"M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z\" />    </g>    <path       d=\"M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18\"       style=\"fill:none; stroke:#ffffff; stroke-linejoin:miter;\" />  </g></g></g>'\n});\n\nexport const KnightWhite = Generic.define('chess.KnightWhite', {\n    size: { width: 38, height: 37 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path      d=\"M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18\"      style=\"fill:#ffffff; stroke:#000000;\" />    <path      d=\"M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10\"      style=\"fill:#ffffff; stroke:#000000;\" />    <path      d=\"M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z\"      style=\"fill:#000000; stroke:#000000;\" />    <path      d=\"M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z\"      transform=\"matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)\"      style=\"fill:#000000; stroke:#000000;\" />  </g></g></g>'\n});\n\nexport const KnightBlack = Generic.define('chess.KnightBlack', {\n    size: { width: 38, height: 37 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path      d=\"M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18\"      style=\"fill:#000000; stroke:#000000;\" />    <path      d=\"M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10\"      style=\"fill:#000000; stroke:#000000;\" />    <path      d=\"M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z\"      style=\"fill:#ffffff; stroke:#ffffff;\" />    <path      d=\"M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z\"      transform=\"matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)\"      style=\"fill:#ffffff; stroke:#ffffff;\" />    <path      d=\"M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z \"      style=\"fill:#ffffff; stroke:none;\" />  </g></g></g>'\n});\n\nexport const PawnWhite = Generic.define('chess.PawnWhite', {\n    size: { width: 28, height: 33 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><path d=\"M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z \"  style=\"opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\" /></g></g>'\n});\n\nexport const PawnBlack = Generic.define('chess.PawnBlack', {\n    size: { width: 28, height: 33 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><path d=\"M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z \"  style=\"opacity:1; fill:#000000; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\" /></g></g>'\n});\n\n","import { Element } from '../dia/Element.mjs';\nimport { Link } from '../dia/Link.mjs';\n\nexport const Entity = Element.define('erd.Entity', {\n    size: { width: 150, height: 60 },\n    attrs: {\n        '.outer': {\n            fill: '#2ECC71', stroke: '#27AE60', 'stroke-width': 2,\n            points: '100,0 100,60 0,60 0,0'\n        },\n        '.inner': {\n            fill: '#2ECC71', stroke: '#27AE60', 'stroke-width': 2,\n            points: '95,5 95,55 5,55 5,5',\n            display: 'none'\n        },\n        text: {\n            text: 'Entity',\n            'font-family': 'Arial', 'font-size': 14,\n            'ref-x': .5, 'ref-y': .5,\n            'y-alignment': 'middle', 'text-anchor': 'middle'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><polygon class=\"outer\"/><polygon class=\"inner\"/></g><text/></g>',\n});\n\nexport const WeakEntity = Entity.define('erd.WeakEntity', {\n    attrs: {\n        '.inner': { display: 'auto' },\n        text: { text: 'Weak Entity' }\n    }\n});\n\nexport const Relationship = Element.define('erd.Relationship', {\n    size: { width: 80, height: 80 },\n    attrs: {\n        '.outer': {\n            fill: '#3498DB', stroke: '#2980B9', 'stroke-width': 2,\n            points: '40,0 80,40 40,80 0,40'\n        },\n        '.inner': {\n            fill: '#3498DB', stroke: '#2980B9', 'stroke-width': 2,\n            points: '40,5 75,40 40,75 5,40',\n            display: 'none'\n        },\n        text: {\n            text: 'Relationship',\n            'font-family': 'Arial', 'font-size': 12,\n            'ref-x': .5, 'ref-y': .5,\n            'y-alignment': 'middle', 'text-anchor': 'middle'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><polygon class=\"outer\"/><polygon class=\"inner\"/></g><text/></g>',\n});\n\nexport const IdentifyingRelationship = Relationship.define('erd.IdentifyingRelationship', {\n    attrs: {\n        '.inner': { display: 'auto' },\n        text: { text: 'Identifying' }\n    }\n});\n\nexport const Attribute = Element.define('erd.Attribute', {\n    size: { width: 100, height: 50 },\n    attrs: {\n        'ellipse': {\n            transform: 'translate(50, 25)'\n        },\n        '.outer': {\n            stroke: '#D35400', 'stroke-width': 2,\n            cx: 0, cy: 0, rx: 50, ry: 25,\n            fill: '#E67E22'\n        },\n        '.inner': {\n            stroke: '#D35400', 'stroke-width': 2,\n            cx: 0, cy: 0, rx: 45, ry: 20,\n            fill: '#E67E22', display: 'none'\n        },\n        text: {\n            'font-family': 'Arial', 'font-size': 14,\n            'ref-x': .5, 'ref-y': .5,\n            'y-alignment': 'middle', 'text-anchor': 'middle'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><ellipse class=\"outer\"/><ellipse class=\"inner\"/></g><text/></g>',\n});\n\nexport const Multivalued = Attribute.define('erd.Multivalued', {\n    attrs: {\n        '.inner': { display: 'block' },\n        text: { text: 'multivalued' }\n    }\n});\n\nexport const Derived = Attribute.define('erd.Derived', {\n    attrs: {\n        '.outer': { 'stroke-dasharray': '3,5' },\n        text: { text: 'derived' }\n    }\n});\n\nexport const Key = Attribute.define('erd.Key', {\n    attrs: {\n        ellipse: { 'stroke-width': 4 },\n        text: { text: 'key', 'font-weight': '800', 'text-decoration': 'underline' }\n    }\n});\n\nexport const Normal = Attribute.define('erd.Normal', {\n    attrs: { text: { text: 'Normal' }}\n});\n\nexport const ISA = Element.define('erd.ISA', {\n    type: 'erd.ISA',\n    size: { width: 100, height: 50 },\n    attrs: {\n        polygon: {\n            points: '0,0 50,50 100,0',\n            fill: '#F1C40F', stroke: '#F39C12', 'stroke-width': 2\n        },\n        text: {\n            text: 'ISA', 'font-size': 18,\n            'ref-x': .5, 'ref-y': .3,\n            'y-alignment': 'middle', 'text-anchor': 'middle'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><polygon/></g><text/></g>',\n});\n\nexport const Line = Link.define('erd.Line', {}, {\n    cardinality: function(value) {\n        this.set('labels', [{ position: -20, attrs: { text: { dy: -8, text: value }}}]);\n    }\n});\n","import { Circle } from './basic.mjs';\nimport { Element } from '../dia/Element.mjs';\nimport { Link } from '../dia/Link.mjs';\n\nexport const State = Circle.define('fsa.State', {\n    attrs: {\n        circle: { 'stroke-width': 3 },\n        text: { 'font-weight': '800' }\n    }\n});\n\nexport const StartState = Element.define('fsa.StartState', {\n    size: { width: 20, height: 20 },\n    attrs: {\n        circle: {\n            transform: 'translate(10, 10)',\n            r: 10,\n            fill: '#000000'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><circle/></g></g>',\n});\n\nexport const EndState = Element.define('fsa.EndState', {\n    size: { width: 20, height: 20 },\n    attrs: {\n        '.outer': {\n            transform: 'translate(10, 10)',\n            r: 10,\n            fill: '#ffffff',\n            stroke: '#000000'\n        },\n\n        '.inner': {\n            transform: 'translate(10, 10)',\n            r: 6,\n            fill: '#000000'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><circle class=\"outer\"/><circle class=\"inner\"/></g></g>',\n});\n\nexport const Arrow = Link.define('fsa.Arrow', {\n    attrs: { '.marker-target': { d: 'M 10 0 L 0 5 L 10 10 z' }},\n    smooth: true\n});\n\n\n","import { Element } from '../dia/Element.mjs';\nimport { Link } from '../dia/Link.mjs';\n\nexport const Member = Element.define('org.Member', {\n    size: { width: 180, height: 70 },\n    attrs: {\n        rect: { width: 170, height: 60 },\n\n        '.card': {\n            fill: '#FFFFFF', stroke: '#000000', 'stroke-width': 2,\n            'pointer-events': 'visiblePainted', rx: 10, ry: 10\n        },\n\n        image: {\n            width: 48, height: 48,\n            ref: '.card', 'ref-x': 10, 'ref-y': 5\n        },\n\n        '.rank': {\n            'text-decoration': 'underline',\n            ref: '.card', 'ref-x': 0.9, 'ref-y': 0.2,\n            'font-family': 'Courier New', 'font-size': 14,\n            'text-anchor': 'end'\n        },\n\n        '.name': {\n            'font-weight': '800',\n            ref: '.card', 'ref-x': 0.9, 'ref-y': 0.6,\n            'font-family': 'Courier New', 'font-size': 14,\n            'text-anchor': 'end'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><rect class=\"card\"/><image/></g><text class=\"rank\"/><text class=\"name\"/></g>',\n});\n\nexport const Arrow = Link.define('org.Arrow', {\n    source: { selector: '.card' }, target: { selector: '.card' },\n    attrs: { '.connection': { stroke: '#585858', 'stroke-width': 3 }},\n    z: -1\n});\n\n","import { Generic } from './basic.mjs';\nimport { ElementView } from '../dia/ElementView.mjs';\nimport V from '../V/index.mjs';\nimport { Link as diaLink } from '../dia/Link.mjs';\n\nexport const Place = Generic.define('pn.Place', {\n    size: { width: 50, height: 50 },\n    attrs: {\n        '.root': {\n            r: 25,\n            fill: '#ffffff',\n            stroke: '#000000',\n            transform: 'translate(25, 25)'\n        },\n        '.label': {\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-y': -20,\n            ref: '.root',\n            fill: '#000000',\n            'font-size': 12\n        },\n        '.tokens > circle': {\n            fill: '#000000',\n            r: 5\n        },\n        '.tokens.one > circle': { transform: 'translate(25, 25)' },\n\n        '.tokens.two > circle:nth-child(1)': { transform: 'translate(19, 25)' },\n        '.tokens.two > circle:nth-child(2)': { transform: 'translate(31, 25)' },\n\n        '.tokens.three > circle:nth-child(1)': { transform: 'translate(18, 29)' },\n        '.tokens.three > circle:nth-child(2)': { transform: 'translate(25, 19)' },\n        '.tokens.three > circle:nth-child(3)': { transform: 'translate(32, 29)' },\n\n        '.tokens.alot > text': {\n            transform: 'translate(25, 18)',\n            'text-anchor': 'middle',\n            fill: '#000000'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><circle class=\"root\"/><g class=\"tokens\" /></g><text class=\"label\"/></g>',\n});\n\nexport const PlaceView = ElementView.extend({\n\n    presentationAttributes: ElementView.addPresentationAttributes({\n        tokens: ['TOKENS']\n    }),\n\n    initFlag: ElementView.prototype.initFlag.concat(['TOKENS']),\n\n    confirmUpdate: function(...args) {\n        let flags = ElementView.prototype.confirmUpdate.call(this, ...args);\n        if (this.hasFlag(flags, 'TOKENS')) {\n            this.renderTokens();\n            this.update();\n            flags = this.removeFlag(flags, 'TOKENS');\n        }\n        return flags;\n    },\n\n    renderTokens: function() {\n\n        const vTokens = this.vel.findOne('.tokens').empty();\n        ['one', 'two', 'three', 'alot'].forEach(function(className) {\n            vTokens.removeClass(className);\n        });\n\n        var tokens = this.model.get('tokens');\n        if (!tokens) return;\n\n        switch (tokens) {\n\n            case 1:\n                vTokens.addClass('one');\n                vTokens.append(V('circle'));\n                break;\n\n            case 2:\n                vTokens.addClass('two');\n                vTokens.append([V('circle'), V('circle')]);\n                break;\n\n            case 3:\n                vTokens.addClass('three');\n                vTokens.append([V('circle'), V('circle'), V('circle')]);\n                break;\n\n            default:\n                vTokens.addClass('alot');\n                vTokens.append(V('text').text(tokens + ''));\n                break;\n        }\n    }\n});\n\nexport const Transition = Generic.define('pn.Transition', {\n    size: { width: 12, height: 50 },\n    attrs: {\n        'rect': {\n            width: 12,\n            height: 50,\n            fill: '#000000',\n            stroke: '#000000'\n        },\n        '.label': {\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-y': -20,\n            ref: 'rect',\n            fill: '#000000',\n            'font-size': 12\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><rect class=\"root\"/></g></g><text class=\"label\"/>',\n});\n\nexport const Link = diaLink.define('pn.Link', {\n    attrs: { '.marker-target': { d: 'M 10 0 L 0 5 L 10 10 z' }}\n});\n","import { ElementView } from '../dia/ElementView.mjs';\nimport { Link } from '../dia/Link.mjs';\nimport { Generic, Circle } from './basic.mjs';\n\nexport const Class = Generic.define('uml.Class', {\n    attrs: {\n        rect: { 'width': 200 },\n\n        '.uml-class-name-rect': { 'stroke': 'black', 'stroke-width': 2, 'fill': '#3498db' },\n        '.uml-class-attrs-rect': { 'stroke': 'black', 'stroke-width': 2, 'fill': '#2980b9' },\n        '.uml-class-methods-rect': { 'stroke': 'black', 'stroke-width': 2, 'fill': '#2980b9' },\n\n        '.uml-class-name-text': {\n            'ref': '.uml-class-name-rect',\n            'ref-y': .5,\n            'ref-x': .5,\n            'text-anchor': 'middle',\n            'y-alignment': 'middle',\n            'font-weight': 'bold',\n            'fill': 'black',\n            'font-size': 12,\n            'font-family': 'Times New Roman'\n        },\n        '.uml-class-attrs-text': {\n            'ref': '.uml-class-attrs-rect', 'ref-y': 5, 'ref-x': 5,\n            'fill': 'black', 'font-size': 12, 'font-family': 'Times New Roman'\n        },\n        '.uml-class-methods-text': {\n            'ref': '.uml-class-methods-rect', 'ref-y': 5, 'ref-x': 5,\n            'fill': 'black', 'font-size': 12, 'font-family': 'Times New Roman'\n        }\n    },\n\n    name: [],\n    attributes: [],\n    methods: []\n}, {\n    markup: [\n        '<g class=\"rotatable\">',\n        '<g class=\"scalable\">',\n        '<rect class=\"uml-class-name-rect\"/><rect class=\"uml-class-attrs-rect\"/><rect class=\"uml-class-methods-rect\"/>',\n        '</g>',\n        '<text class=\"uml-class-name-text\"/><text class=\"uml-class-attrs-text\"/><text class=\"uml-class-methods-text\"/>',\n        '</g>'\n    ].join(''),\n\n    initialize: function() {\n\n        this.on('change:name change:attributes change:methods', function() {\n            this.updateRectangles();\n            this.trigger('uml-update');\n        }, this);\n\n        this.updateRectangles();\n\n        Generic.prototype.initialize.apply(this, arguments);\n    },\n\n    getClassName: function() {\n        return this.get('name');\n    },\n\n    updateRectangles: function() {\n\n        var attrs = this.get('attrs');\n\n        var rects = [\n            { type: 'name', text: this.getClassName() },\n            { type: 'attrs', text: this.get('attributes') },\n            { type: 'methods', text: this.get('methods') }\n        ];\n\n        var offsetY = 0;\n\n        rects.forEach(function(rect) {\n\n            var lines = Array.isArray(rect.text) ? rect.text : [rect.text];\n            var rectHeight = lines.length * 20 + 20;\n\n            attrs['.uml-class-' + rect.type + '-text'].text = lines.join('\\n');\n            attrs['.uml-class-' + rect.type + '-rect'].height = rectHeight;\n            attrs['.uml-class-' + rect.type + '-rect'].transform = 'translate(0,' + offsetY + ')';\n\n            offsetY += rectHeight;\n        });\n    }\n\n});\n\nexport const ClassView = ElementView.extend({\n\n    initialize: function() {\n\n        ElementView.prototype.initialize.apply(this, arguments);\n\n        this.listenTo(this.model, 'uml-update', function() {\n            this.update();\n            this.resize();\n        });\n    }\n});\n\nexport const Abstract = Class.define('uml.Abstract', {\n    attrs: {\n        '.uml-class-name-rect': { fill: '#e74c3c' },\n        '.uml-class-attrs-rect': { fill: '#c0392b' },\n        '.uml-class-methods-rect': { fill: '#c0392b' }\n    }\n}, {\n\n    getClassName: function() {\n        return ['<<Abstract>>', this.get('name')];\n    }\n\n});\nexport const AbstractView = ClassView;\n\nexport const Interface = Class.define('uml.Interface', {\n    attrs: {\n        '.uml-class-name-rect': { fill: '#f1c40f' },\n        '.uml-class-attrs-rect': { fill: '#f39c12' },\n        '.uml-class-methods-rect': { fill: '#f39c12' }\n    }\n}, {\n    getClassName: function() {\n        return ['<<Interface>>', this.get('name')];\n    }\n});\nexport const InterfaceView = ClassView;\n\nexport const Generalization = Link.define('uml.Generalization', {\n    attrs: { '.marker-target': { d: 'M 20 0 L 0 10 L 20 20 z', fill: 'white' }}\n});\n\nexport const Implementation = Link.define('uml.Implementation', {\n    attrs: {\n        '.marker-target': { d: 'M 20 0 L 0 10 L 20 20 z', fill: 'white' },\n        '.connection': { 'stroke-dasharray': '3,3' }\n    }\n});\n\nexport const Aggregation = Link.define('uml.Aggregation', {\n    attrs: { '.marker-target': { d: 'M 40 10 L 20 20 L 0 10 L 20 0 z', fill: 'white' }}\n});\n\nexport const Composition = Link.define('uml.Composition', {\n    attrs: { '.marker-target': { d: 'M 40 10 L 20 20 L 0 10 L 20 0 z', fill: 'black' }}\n});\n\nexport const Association = Link.define('uml.Association');\n\n// Statechart\n\nexport const State = Generic.define('uml.State', {\n    attrs: {\n        '.uml-state-body': {\n            'width': 200, 'height': 200, 'rx': 10, 'ry': 10,\n            'fill': '#ecf0f1', 'stroke': '#bdc3c7', 'stroke-width': 3\n        },\n        '.uml-state-separator': {\n            'stroke': '#bdc3c7', 'stroke-width': 2\n        },\n        '.uml-state-name': {\n            'ref': '.uml-state-body', 'ref-x': .5, 'ref-y': 5, 'text-anchor': 'middle',\n            'fill': '#000000', 'font-family': 'Courier New', 'font-size': 14\n        },\n        '.uml-state-events': {\n            'ref': '.uml-state-separator', 'ref-x': 5, 'ref-y': 5,\n            'fill': '#000000', 'font-family': 'Courier New', 'font-size': 14\n        }\n    },\n\n    name: 'State',\n    events: []\n\n}, {\n    markup: [\n        '<g class=\"rotatable\">',\n        '<g class=\"scalable\">',\n        '<rect class=\"uml-state-body\"/>',\n        '</g>',\n        '<path class=\"uml-state-separator\"/>',\n        '<text class=\"uml-state-name\"/>',\n        '<text class=\"uml-state-events\"/>',\n        '</g>'\n    ].join(''),\n\n    initialize: function() {\n\n        this.on({\n            'change:name': this.updateName,\n            'change:events': this.updateEvents,\n            'change:size': this.updatePath\n        }, this);\n\n        this.updateName();\n        this.updateEvents();\n        this.updatePath();\n\n        Generic.prototype.initialize.apply(this, arguments);\n    },\n\n    updateName: function() {\n\n        this.attr('.uml-state-name/text', this.get('name'));\n    },\n\n    updateEvents: function() {\n\n        this.attr('.uml-state-events/text', this.get('events').join('\\n'));\n    },\n\n    updatePath: function() {\n\n        var d = 'M 0 20 L ' + this.get('size').width + ' 20';\n\n        // We are using `silent: true` here because updatePath() is meant to be called\n        // on resize and there's no need to to update the element twice (`change:size`\n        // triggers also an update).\n        this.attr('.uml-state-separator/d', d, { silent: true });\n    }\n});\n\nexport const StartState = Circle.define('uml.StartState', {\n    type: 'uml.StartState',\n    attrs: { circle: { 'fill': '#34495e', 'stroke': '#2c3e50', 'stroke-width': 2, 'rx': 1 }}\n});\n\nexport const EndState = Generic.define('uml.EndState', {\n    size: { width: 20, height: 20 },\n    attrs: {\n        'circle.outer': {\n            transform: 'translate(10, 10)',\n            r: 10,\n            fill: '#ffffff',\n            stroke: '#2c3e50'\n        },\n\n        'circle.inner': {\n            transform: 'translate(10, 10)',\n            r: 6,\n            fill: '#34495e'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><circle class=\"outer\"/><circle class=\"inner\"/></g></g>',\n});\n\nexport const Transition = Link.define('uml.Transition', {\n    attrs: {\n        '.marker-target': { d: 'M 10 0 L 0 5 L 10 10 z', fill: '#34495e', stroke: '#2c3e50' },\n        '.connection': { stroke: '#2c3e50' }\n    }\n});\n","import * as connectionStrategies from '../connectionStrategies/index.mjs';\n\nexport function getViewBBox(view, useModelGeometry) {\n    const { model } = view;\n    if (useModelGeometry) return model.getBBox();\n    return (model.isLink()) ? view.getConnection().bbox() : view.getNodeUnrotatedBBox(view.el);\n}\n\nexport function getAnchor(coords, view, magnet) {\n    // take advantage of an existing logic inside of the\n    // pin relative connection strategy\n    var end = connectionStrategies.pinRelative.call(\n        this.paper,\n        {},\n        view,\n        magnet,\n        coords,\n        this.model\n    );\n    return end.anchor;\n}\n\nexport function snapAnchor(coords, view, magnet, type, relatedView, toolView) {\n    var snapRadius = toolView.options.snapRadius;\n    var isSource = (type === 'source');\n    var refIndex = (isSource ? 0 : -1);\n    var ref = this.model.vertex(refIndex) || this.getEndAnchor(isSource ? 'target' : 'source');\n    if (ref) {\n        if (Math.abs(ref.x - coords.x) < snapRadius) coords.x = ref.x;\n        if (Math.abs(ref.y - coords.y) < snapRadius) coords.y = ref.y;\n    }\n    return coords;\n}\n","\nimport * as util from '../util/index.mjs';\nimport { ToolView } from '../dia/ToolView.mjs';\nimport { getViewBBox } from './helpers.mjs';\n\nexport const Boundary = ToolView.extend({\n    name: 'boundary',\n    tagName: 'rect',\n    options: {\n        padding: 10,\n        useModelGeometry: false,\n    },\n    attributes: {\n        'fill': 'none',\n        'stroke': '#33334F',\n        'stroke-width': .5,\n        'stroke-dasharray': '5, 5',\n        'pointer-events': 'none'\n    },\n    onRender: function() {\n        this.update();\n    },\n    update: function() {\n        const { relatedView: view, options, vel } = this;\n        const { useModelGeometry, rotate } = options;\n        const padding = util.normalizeSides(options.padding);\n        let bbox = getViewBBox(view, useModelGeometry).moveAndExpand({\n            x: -padding.left,\n            y: -padding.top,\n            width: padding.left + padding.right,\n            height: padding.top + padding.bottom\n        });\n        var model = view.model;\n        if (model.isElement()) {\n            var angle = model.angle();\n            if (angle) {\n                if (rotate) {\n                    var origin = model.getBBox().center();\n                    vel.rotate(angle, origin.x, origin.y, { absolute: true });\n                } else {\n                    bbox = bbox.bbox(angle);\n                }\n            }\n        }\n        vel.attr(bbox.toJSON());\n        return this;\n    }\n});\n","import { dia, elementTools, linkTools, shapes } from \"jointjs\";\r\nimport { NormalResizeTool, RotateTool, updateLabelText } from \"./tools\";\r\n\r\nexport function defineNamespace() {\r\n  const Path = dia.Element.define(\r\n    \"bleuon.Path\",\r\n    {\r\n      attrs: {\r\n        body: {\r\n          width: \"calc(w)\",\r\n          height: \"calc(h)\",\r\n          fill: \"#fcfcfc\",\r\n          stroke: \"#333333\",\r\n          strokeWidth: 1.5,\r\n          cursor: \"grab\",\r\n          \"stroke-dasharray\": \"none\"\r\n        },\r\n        label: {\r\n          text: \"\",\r\n          textVerticalAnchor: \"middle\",\r\n          textAnchor: \"middle\",\r\n          fill: \"#333333\",\r\n          fontWeight: \"normal\",\r\n          fontSize: 18,\r\n          fontFamily: \"\",\r\n          refX: \"50%\",\r\n          refY: \"50%\"\r\n        }\r\n      }\r\n    },\r\n    {\r\n      updateLabelText,\r\n      addClickedTools(elementView: dia.ElementView) {\r\n        const boundaryTool = new elementTools.Boundary();\r\n        const resizeTool = new NormalResizeTool();\r\n        const rotateTool = new RotateTool();\r\n\r\n        elementView.addTools(\r\n          new dia.ToolsView({\r\n            name: \"path-clicked-tools\",\r\n            tools: [boundaryTool, resizeTool, rotateTool]\r\n          })\r\n        );\r\n      },\r\n      removeClickedTools(elementView: dia.ElementView) {\r\n        if (elementView.hasTools(\"path-clicked-tools\")) {\r\n          elementView.removeTools();\r\n        }\r\n      }\r\n    }\r\n  );\r\n\r\n  const Link = shapes.standard.Link.define(\r\n    \"bleuon.Link\",\r\n    {\r\n      router: { name: \"manhattan\" },\r\n      attrs: {\r\n        line: {\r\n          fill: \"none\",\r\n          stroke: \"#333333\",\r\n          strokeWidth: 2\r\n        }\r\n      }\r\n    },\r\n    {\r\n      updateLabelText(linkView: dia.LinkView, textInput: HTMLInputElement) {\r\n        // @ts-ignore\r\n        const { model } = linkView;\r\n        const label = model.label(0);\r\n        const cellText = label?.attrs?.text?.text || \"\";\r\n\r\n        const bbox = linkView.getBBox();\r\n        const centerX = bbox.x + bbox.width / 2;\r\n        const centerY = bbox.y + bbox.height / 2;\r\n        const oneThirdWidth = bbox.width / 3;\r\n        textInput.value = cellText;\r\n\r\n        textInput.style.top = centerY - 10 + \"px\";\r\n        textInput.style.left = centerX - oneThirdWidth / 2 + \"px\";\r\n        textInput.style.width = oneThirdWidth + \"px\";\r\n        textInput.style.height = 20 + \"px\";\r\n        textInput.style.display = \"block\";\r\n\r\n        function handleKeydownEvent(event: any) {\r\n          if (event.key === \"Enter\") {\r\n            let newCellText = textInput.value;\r\n\r\n            model.label(0, {\r\n              position: 0.5,\r\n              attrs: { text: { text: newCellText } }\r\n            });\r\n\r\n            textInput.style.display = \"none\";\r\n            textInput.removeEventListener(\"keydown\", handleKeydownEvent);\r\n          }\r\n        }\r\n\r\n        textInput.value = \"\";\r\n        textInput.addEventListener(\"keydown\", handleKeydownEvent);\r\n        textInput.focus();\r\n      },\r\n      addClickedTools(linkView: any) {\r\n        // const verticesTool = new linkTools.Vertices();\r\n        // const segmentsTool = new linkTools.Segments();\r\n        // const sourceArrowheadTool = new linkTools.SourceArrowhead();\r\n        // const targetArrowheadTool = new linkTools.TargetArrowhead();\r\n        // const sourceAnchorTool = new linkTools.SourceAnchor();\r\n        // const targetAnchorTool = new linkTools.TargetAnchor();\r\n        const boundaryTool = new linkTools.Boundary();\r\n\r\n        linkView.addTools(\r\n          new dia.ToolsView({\r\n            name: \"link-tools\",\r\n            tools: [\r\n              // verticesTool,\r\n              // segmentsTool,\r\n              boundaryTool\r\n              // sourceArrowheadTool,\r\n              // targetArrowheadTool,\r\n              // sourceAnchorTool,\r\n              // targetAnchorTool\r\n            ]\r\n          })\r\n        );\r\n      },\r\n      removeClickedTools(linkView: any) {\r\n        if (linkView.hasTools(\"link-tools\")) {\r\n          linkView.removeTools();\r\n        }\r\n      }\r\n    }\r\n  );\r\n\r\n  return Object.assign(shapes, {\r\n    bleuon: {\r\n      Path,\r\n      Link\r\n    }\r\n  });\r\n}\r\n","/**\r\n * @description jointjs \r\n * @author zheng\r\n * @since 2023/9/9\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n\r\nimport { dia, shapes } from \"jointjs\";\r\nimport { defineNamespace } from \"./namespace\";\r\n\r\n/**\r\n *  jointjs\r\n *\r\n * @param config  jointjs\r\n * @returns paper, graph\r\n */\r\nexport function initJointJs(config: {\r\n  el: string;\r\n  bgColor: string;\r\n  height: string;\r\n  width: string;\r\n  gridSize: number;\r\n  drawGrid: boolean | dia.Paper.GridOptions | dia.Paper.GridOptions[];\r\n  isPreventLinkFromInputPorts?: boolean;\r\n  isPreventLinkFromOutputToInputWithinOneElement?: boolean;\r\n  isPreventLinkToOutputPorts?: boolean;\r\n}) {\r\n  const namespace = defineNamespace();\r\n  const graph = new dia.Graph({}, { cellNamespace: namespace });\r\n  const paper = new dia.Paper({\r\n    el: document.getElementById(config.el),\r\n    model: graph,\r\n    height: config.height,\r\n    width: config.width,\r\n    gridSize: config.gridSize,\r\n    drawGrid: config.drawGrid,\r\n    background: {\r\n      color: config.bgColor\r\n    },\r\n    snapLabels: true,\r\n    snapLinks: { radius: 5 },\r\n    interactive: {\r\n      linkMove: false,\r\n      labelMove: true,\r\n      arrowheadMove: false,\r\n      vertexMove: false,\r\n      vertexAdd: false,\r\n      vertexRemove: false,\r\n      useLinkTools: false\r\n    },\r\n    cellViewNamespace: namespace,\r\n    // @ts-ignore\r\n    defaultLink: () => new shapes.bleuon.Link(),\r\n    defaultConnectionPoint: { name: \"boundary\" },\r\n    validateConnection: function (cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\r\n      if (config.isPreventLinkFromInputPorts || false) {\r\n        if (magnetS && magnetS.getAttribute(\"port-group\") === \"in\") return false;\r\n      }\r\n\r\n      if (config.isPreventLinkFromOutputToInputWithinOneElement || false) {\r\n        if (cellViewS === cellViewT) return false;\r\n      }\r\n\r\n      if (config.isPreventLinkToOutputPorts || false) {\r\n        return magnetT && magnetT.getAttribute(\"port-group\") === \"in\";\r\n      }\r\n\r\n      return true;\r\n    }\r\n  });\r\n\r\n  return {\r\n    paper,\r\n    graph\r\n  };\r\n}\r\n","/**\r\n * @description Diagraming \r\n * @author zheng\r\n * @since 2023/9/18\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n\r\n/**\r\n * Link \r\n */\r\nexport const linkConnectorOptions = [\r\n  {\r\n    value: \"straight\",\r\n    label: \"straight\"\r\n  },\r\n  {\r\n    value: \"jumpover\",\r\n    label: \"jumpover\"\r\n  },\r\n  {\r\n    value: \"normal\",\r\n    label: \"normal\"\r\n  },\r\n  {\r\n    value: \"rounded\",\r\n    label: \"rounded\"\r\n  },\r\n  {\r\n    value: \"smooth\",\r\n    label: \"smooth\"\r\n  },\r\n  {\r\n    value: \"curve\",\r\n    label: \"curve\"\r\n  }\r\n];\r\n\r\n/**\r\n * Link \r\n */\r\nexport const linkConnectorConfig = ref({\r\n  name: \"normal\"\r\n});\r\n\r\n/**\r\n * Link  name \r\n */\r\nexport const linkRouterOptions = [\r\n  {\r\n    value: \"manhattan\",\r\n    label: \"manhattan\"\r\n  },\r\n  {\r\n    value: \"metro\",\r\n    label: \"metro\"\r\n  },\r\n  {\r\n    value: \"normal\",\r\n    label: \"normal\"\r\n  },\r\n  {\r\n    value: \"orthogonal\",\r\n    label: \"orthogonal\"\r\n  },\r\n  {\r\n    value: \"rightAngle\",\r\n    label: \"rightAngle\"\r\n  }\r\n];\r\n\r\n/**\r\n * Link \r\n */\r\nexport const linkRouterConfig = ref({\r\n  name: \"normal\"\r\n});\r\n\r\n/**\r\n *  View View  model \r\n */\r\nexport const clickedLastView = ref({\r\n  view: null,\r\n  model: null\r\n});\r\n\r\n/**\r\n *  View\r\n */\r\nexport const clickedCurrView = ref(null);\r\n\r\n/**\r\n * \r\n */\r\nexport const textColor = ref(\"\");\r\n\r\n/**\r\n * \r\n */\r\nexport const textSize = ref(14);\r\n\r\n/**\r\n * \r\n */\r\nexport const fontFamilyOptions = [\r\n  {\r\n    value: \"\",\r\n    label: \"\"\r\n  },\r\n  {\r\n    value: \"Arial\",\r\n    label: \"Arial\"\r\n  },\r\n  {\r\n    value: \"Bahnschrift\",\r\n    label: \"Bahnschrift\"\r\n  },\r\n  {\r\n    value: \"BIZ UDGothic\",\r\n    label: \"BIZ UDGothic\"\r\n  },\r\n  {\r\n    value: \"Calibri\",\r\n    label: \"Calibri\"\r\n  },\r\n  {\r\n    value: \"Cambria\",\r\n    label: \"Cambria\"\r\n  },\r\n  {\r\n    value: \"Candara\",\r\n    label: \"Candara\"\r\n  },\r\n  {\r\n    value: \"Comic Sans MS\",\r\n    label: \"Comic Sans MS\"\r\n  },\r\n  {\r\n    value: \"Consolas\",\r\n    label: \"Consolas\"\r\n  },\r\n  {\r\n    value: \"Constantia\",\r\n    label: \"Constantia\"\r\n  },\r\n  {\r\n    value: \"Corbel\",\r\n    label: \"Corbel\"\r\n  }\r\n];\r\n\r\n// \r\nexport const fontFamily = ref(\"\");\r\n\r\n/**\r\n * \r\n */\r\nexport const shapeStrokeWidthOptions = [\r\n  {\r\n    value: 0,\r\n    label: \"0px\"\r\n  },\r\n  {\r\n    value: 0.5,\r\n    label: \"0.5px\"\r\n  },\r\n  {\r\n    value: 1,\r\n    label: \"1px\"\r\n  },\r\n  {\r\n    value: 1.5,\r\n    label: \"1.5px\"\r\n  },\r\n  {\r\n    value: 2,\r\n    label: \"2px\"\r\n  },\r\n  {\r\n    value: 3,\r\n    label: \"3px\"\r\n  },\r\n  {\r\n    value: 4,\r\n    label: \"4px\"\r\n  },\r\n  {\r\n    value: 5,\r\n    label: \"5px\"\r\n  },\r\n  {\r\n    value: 6,\r\n    label: \"6px\"\r\n  },\r\n  {\r\n    value: 8,\r\n    label: \"8px\"\r\n  },\r\n  {\r\n    value: 10,\r\n    label: \"10px\"\r\n  }\r\n];\r\n\r\n/**\r\n *  stroke \r\n */\r\nexport const shapeStrokeWidth = ref(1.5);\r\n\r\n/**\r\n * \r\n */\r\nexport const shapeBackground = ref(\"white\");\r\n\r\n/**\r\n *  stroke \r\n */\r\nexport const shapeBorderStyle = ref(\"solid\");\r\n\r\n/**\r\n *  paper \r\n */\r\nexport const currentScale = ref(1);\r\n\r\n/**\r\n *  slider \r\n */\r\nexport const calcCurrentScale = computed({\r\n  get() {\r\n    return Number((currentScale.value * 100).toFixed(0));\r\n  },\r\n  set(value) {\r\n    currentScale.value = value / 100;\r\n  }\r\n});\r\n\r\n/**\r\n *  paper \r\n */\r\nexport const currentOffsetX = ref(0);\r\n\r\n/**\r\n *  paper \r\n */\r\nexport const currentOffsetY = ref(0);\r\n\r\n/**\r\n *  Link \r\n */\r\nexport const isClickedLink = ref(false);\r\n\r\n/**\r\n *  Element \r\n */\r\nexport const isClickedElement = ref(false);\r\n","/**\r\n * @description jointjs  change \r\n * @author zheng\r\n * @since 2023/9/24\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n\r\nimport { dia } from \"@mainapp/lib\";\r\nimport * as Data from \"@mainapp/data/diagraming/flowchart\";\r\n\r\n/**\r\n *  Link \r\n *\r\n * @param currView  Link\r\n */\r\nexport function mountToolsLink(\r\n  currView: dia.LinkView,\r\n  clickedLastView: Ref<{ model: any; view: dia.LinkView }>\r\n) {\r\n  clickedLastView.value.model?.removeClickedTools(clickedLastView.value.view);\r\n\r\n  // @ts-ignore\r\n  currView.model.addClickedTools(currView);\r\n\r\n  clickedLastView.value = {\r\n    // @ts-ignore\r\n    model: currView.model,\r\n    view: currView\r\n  };\r\n}\r\n\r\n/**\r\n *  Link \r\n *\r\n * @param clickedLastView  Link\r\n */\r\nexport function unmountToolsLink(clickedLastView: Ref<{ model: any; view: dia.ElementView }>) {\r\n  clickedLastView.value.model?.removeClickedTools(clickedLastView.value.view);\r\n\r\n  clickedLastView.value = {\r\n    model: null,\r\n    view: null\r\n  };\r\n}\r\n\r\n/**\r\n * \r\n *\r\n * @param currView \r\n * @param clickedLastView \r\n */\r\nexport function mountToolsElement(\r\n  currView: dia.ElementView,\r\n  clickedLastView: Ref<{ model: any; view: dia.ElementView }>\r\n) {\r\n  clickedLastView.value.model?.removeClickedTools(clickedLastView.value.view);\r\n\r\n  // @ts-ignore\r\n  currView.model.addClickedTools(currView);\r\n\r\n  clickedLastView.value = {\r\n    // @ts-ignore\r\n    model: currView.model,\r\n    view: currView\r\n  };\r\n}\r\n\r\n/**\r\n * \r\n *\r\n * @param clickedLastView \r\n */\r\nexport function unmountToolsElement(clickedLastView: Ref<{ model: any; view: dia.ElementView }>) {\r\n  clickedLastView.value.model?.removeClickedTools(clickedLastView.value.view);\r\n\r\n  clickedLastView.value = {\r\n    model: null,\r\n    view: null\r\n  };\r\n}\r\n\r\n/**\r\n *  paper  Link \r\n */\r\nexport function onPointerClickBlank() {\r\n  //  disabled\r\n  Data.isClickedElement.value = false;\r\n  Data.isClickedLink.value = false;\r\n\r\n  unmountToolsLink(Data.clickedLastView);\r\n  unmountToolsElement(Data.clickedLastView);\r\n}\r\n\r\n/**\r\n *  Link \r\n *\r\n * @param view\r\n */\r\nexport function onPointerClickElement(view: dia.ElementView) {\r\n  //  disabled\r\n  Data.isClickedElement.value = true;\r\n  Data.isClickedLink.value = false;\r\n\r\n  // \r\n  Data.clickedCurrView.value = view;\r\n\r\n  // \r\n  mountToolsElement(view, Data.clickedLastView);\r\n}\r\n\r\n/**\r\n *  Link \r\n *\r\n * @param view\r\n */\r\nexport function onPointerClickLink(view: dia.LinkView) {\r\n  //  disabled\r\n  Data.isClickedLink.value = true;\r\n  Data.isClickedElement.value = false;\r\n\r\n  // \r\n  Data.clickedCurrView.value = view;\r\n  //  link \r\n  mountToolsLink(view, Data.clickedLastView);\r\n}\r\n\r\n/**\r\n *  paper \r\n *\r\n * @param evt\r\n * @param paper\r\n */\r\nexport function onMousewheelBlank(evt: any, paper: dia.Paper) {\r\n  evt.preventDefault(); // \r\n  const delta = evt.originalEvent.deltaY; // \r\n  const scrollFactor = 30; // \r\n  const scaleFactor = 0.1; // \r\n\r\n  if (evt.ctrlKey) {\r\n    if (delta > 0) {\r\n      // \r\n      Data.currentScale.value -= scaleFactor;\r\n      if (Data.currentScale.value < 0.2) {\r\n        Data.currentScale.value = 0.2;\r\n      }\r\n    } else {\r\n      // \r\n      Data.currentScale.value += scaleFactor;\r\n      if (Data.currentScale.value > 2) {\r\n        Data.currentScale.value = 2;\r\n      }\r\n    }\r\n\r\n    paper.scale(Data.currentScale.value, Data.currentScale.value);\r\n  } else if (evt.shiftKey) {\r\n    if (delta > 0) {\r\n      // \r\n      Data.currentOffsetX.value += scrollFactor;\r\n    } else {\r\n      // \r\n      Data.currentOffsetX.value -= scrollFactor;\r\n    }\r\n  } else {\r\n    if (delta > 0) {\r\n      // \r\n      Data.currentOffsetY.value -= scrollFactor;\r\n    } else {\r\n      // \r\n      Data.currentOffsetY.value += scrollFactor;\r\n    }\r\n  }\r\n\r\n  paper.setOrigin(Data.currentOffsetX.value, Data.currentOffsetY.value); // \r\n}\r\n\r\n/**\r\n * \r\n *\r\n *  delete \r\n *  Ctrl+S \r\n */\r\nexport function onKeydown(shortcutKey: { ctrlS: Function }) {\r\n  document.addEventListener(\"keydown\", event => {\r\n    if (event.ctrlKey) {\r\n      if (event.key === \"s\") {\r\n        event.preventDefault();\r\n        shortcutKey.ctrlS();\r\n      }\r\n    }\r\n\r\n    if (event.key === \"Backspace\" || event.key === \"Delete\") {\r\n      if (Data.clickedCurrView.value?.model) {\r\n        Data.isClickedElement.value = false;\r\n        Data.isClickedLink.value = false;\r\n        Data.clickedCurrView.value.model.remove();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * \r\n *\r\n * @param currView\r\n * @param input\r\n */\r\nexport function onPointerDbclickElement(\r\n  currView: dia.ElementView | dia.LinkView,\r\n  input: HTMLInputElement\r\n) {\r\n  Data.clickedCurrView.value = null;\r\n\r\n  // @ts-ignore\r\n  const { model } = currView;\r\n  if (model?.updateLabelText) {\r\n    model.updateLabelText(currView, input);\r\n  }\r\n}\r\n"],"names":["props","propsList","key","numberPattern","findSpacesRegex","parseExpressionRegExp","throwInvalid","expression","evalCalcExpression","bbox","match","multiply","property","divide","add","x","y","width","height","value","evalAddExpression","addExpression","sign","isCalcAttribute","calcStart","calcStartOffset","evalCalcAttribute","attributeValue","refBBox","startSearchIndex","calcIndex","calcEndIndex","brackets","findClosingBracket","calcValue","cloneCells","cells","uniq","cloneMap","toArray","map","cell","clone","source","target","parent","embeds","newEmbeds","embed","isEmpty","validPropertiesList","validProperties","acc","properties","isPlainObject","_","node","option","index","props$1","setWrapper","attrName","dimension","isValuePercentage","isPercentage","attrs","attrValue","positionWrapper","axis","origin","valuePercentage","delta","refOrigin","point","Point","offsetWrapper","corner","nodeBBox","shapeWrapper","shapeConstructor","opt","cacheName","resetOffset","$node","$","cache","cachedShape","shape","shapeBBox","shapeOrigin","fitScale","sx","sy","dWrapper","pathConstructor","Path","V","path","pointsWrapper","Polyline","polyline","atConnectionWrapper","method","zeroVector","p","angle","tangent","setIfChangedWrapper","attribute","vel","isTextInUse","_value","_node","isLinkView","contextMarker","context","marker","stroke","strokeOpacity","setPaintURL","def","paper","attributesNS","filter","assign","_text","text","textAttrs","pick","fontSizeAttr","fontSize","textHash","textPath","isObject","pathSelector","pathNode","size","wrappedText","breakTextFn","breakText","title","firstChild","titleNode","port","styles","html","widthFn","heightFn","fn","diagonalLength","rValue","val","stubs","d","offset","segmentSubdivisions","sourceParts","targetParts","attributes","Cell","Backbone","options","defaults","uniqueId","result","merge","dx","dy","defaultAttrs","finalAttrs","forIn","attr","selector","defaultAttr","name","value2","name2","isEqual","cloneDeep","omit","idAttribute","uuid","previousPorts","ports","removedPorts","id","inboundLinks","link","outboundLinks","graph","collection","parentCell","embeddedCells","i","n","sortedCells","sortBy","z","shouldUpdate","c","batchName","without","parentId","ancestors","embeddedIds","sortSiblings","queue","current","stack","cellId","isString","delim","_isString","pathArray","pathArrayLength","update","initializer","prevProperty","pathItem","isArrayIndex","setByPath","baseAttributes","unsetByPath","getByPath","nestedPath","propertyValue","args","timing","interpolate","firstFrameTime","interpolatingFunction","setter","runtime","progress","nextFrame","_scheduledTransitionIds","initialId","initiator","callback","union","transitions","transitionId","_transitionIds","cancelFrame","flag","g.Point","g.Rect","defNS","globalDefNS","type","protoProps","staticProps","defaultsDeep","has","wrapWith","object","methods","wrapper","wrappers","isFunction","Positions","getRectPoint","rect","position","r","portTransformAttrs","trans","util.defaults","lineLayout","p1","p2","elBBox","argTransform","g.line","ellipseLayout","startAngle","stepFn","center","ratio","ellipse","g.Ellipse","theta","util.isPercentage","argPoint","absolute","transformation","line","start","end","left","right","top","bottom","ellipseSpread","stepAngle","count","labelAttributes","opt1","opt2","util.defaultsDeep","getBBoxAngles","tl","bl","br","tr","outsideLayout","portPosition","autoOrient","tx","ty","textAnchor","orientAngle","topLeftAngle","bottomLeftAngle","bottomRightAngle","topRightAngle","round","insideLayout","radialLayout","portCenterOffset","g.point","manual","_portPosition","_elBBox","outsideOriented","outside","insideOriented","inside","radial","radialOriented","Link","setSource","setOpt","isCellProvided","isPointProvided","setTarget","router","isRouterProvided","localRouter","localOpt","connector","isConnectorProvided","localConnector","idx","label","labels","vertex","vertices","setVertex","setVertices","sourceCell","targetCell","points","newParent","prevParent","sourceId","targetId","loop","sourceElement","targetElement","visited","connectionAncestor","item","isNumber","ancestor","defaultLabel","a","b","portsEqual","PortData","data","clonedData","util.cloneDeep","Port","PortLabel","groupName","group","groupPosition","groupPositionName","namespace","groupArgs","portsArgs","groupPortTransformations","accumulator","util.toArray","res","portTransformation","labelPosition","util.isObject","groups","j","m","util.merge","evaluated","util.assign","util.isNumber","setDefault","positionName","util.isFunction","util.isString","setDefaults","ret","elementPortPrototype","currentItemsMap","previous","removed","util.isEmpty","groupPorts","portsMetrics","Rect","positions","metrics","before","portId","util.isPlainObject","portsAttr","errorMessages","util.uniq","portsForRemoval","newPorts","cp","rp","rpId","err","prevPortData","curPortData","added","prevPort","curPort","elementViewPortPrototype","elementReferences","elem","portsGropsByZ","util.groupBy","withoutZKey","portElement","groupNames","k","refs","containerElement","portElements","portCache","portRoot","portSelectors","groupsNames","util.invoke","labelElement","labelSelectors","portContainerElement","portMarkup","portDoc","portFragment","labelMarkupDef","fragment","selectors","childCount","portContainerSelectors","portRootSelector","labelRootSelector","labelTextSelector","labelNode","labelTextNode","elementBBox","cached","labelTransformation","element","transformData","initialAngle","matrix","Element","isSetter","parentRelative","deep","restrictedArea","parentPosition","x0","y0","elementPosition","ra","newPosition","translatedPosition","invoke","currentSize","normalizeAngle","quadrant","fixedPoint","imageFixedPoint","radius","alpha","toRad","scaledBBox","childElements","parentElement","siblingElements","elementsBBox","expandOnly","shrinkOnly","normalizeSides","resultBBox","intersectionBBox","rotate","elements","endType","endDef","portGroup","portsPositions","portCenter","GraphCells","models","util.has","ModelClass","util.getByPath","model","Graph","prevSource","prevTarget","json","util.omit","firstCell","lastCell","util.flattenDeep","preparedCells","indirect","inbound","outbound","links","edges","addOutbounds","addInbounds","util.forIn","edge","outCell","inCell","embeddedElements","exists","edgeCell","neighbors","cellsAncestors","commonAncestor","cellAncestors","el","subgraph","cellMap","iteratee","distance","next","neighbor","lastIndex","sources","sinks","elementA","elementB","isSuccessor","isPredecessor","isNeighbor","strict","searchBy","util.getRectPoint","memo","batches","names","batch","sourceModel","connectedLinks","sameLinks","_link","_source","_target","_graph","LayersNames","PaperLayer","View","addClassNamePrefix","pivotNodes","pivotNode","neighborZ","currentZ","neighborPivot","obj","HighlighterView","mvc.View","cellView","nodeSelector","isLink","layer","rotatableNode","nodeMatrix","MOUNTABLE","transformGroup","detachedTransformGroup","postponedUpdate","cellViewRoot","layerName","vGroup","updateRequested","translateMatrix","rotateMatrix","transformMatrix","prevNode","constructor","_cellView","cid","_views","views","hid","ref","previousView","view","dirty","HighlightingTypes","Flags","CellView","classNames","list","flags","shift","presentationAttributes","initFlag","guid","markup","root","doc","parseDOMJSON","rootSelector","feature","interactive","isBoolean","nodes","eventName","magnet","magnetMatrix","mt","mr","cx","cy","rootNode","magnetAttribute","isMagnetRoot","proxyNode","prevSelector","nthChild","connectionStrategy","strategy","evt","linkView","magnetThreshold","currentTarget","targetMagnet","attrVal","normalAttrs","setAttrs","positionAttrs","offsetAttrs","relatives","toKebabCase","rawAttrs","nodeAttrs","setResult","nodeTransform","nodePosition","translation","nodeScale","positioned","offseted","nodeBoundingRect","scalableNode","scale","selectorCache","nodeId","nodesAttrs","mergeIds","selected","unique","prevNodeAttrs","selectedLength","sortIndex","sortedIndex","clientX","clientY","bboxCache","relativeItems","relativeRefItems","nodeData","processedAttrs","roAttrs","nodesAllAttrs","nodeAllAttrs","refSelector","refNode","itemIndex","refNodeId","getCommonAncestorNode","roProcessedAttrs","transform","isInitialMount","toolsView","event","defaultInteractionPrevented","sourceView","targetView","node1","node2","DragActions","ElementView","useCSSSelectors","config","transformHighlighters","updateHighlighters","renderingOnlyAttrs","modelAttrs","rotateString","scalable","recursive","scalableBBox","rotatable","rotation","rotatableBBox","initialZIndices","maxZ","max","findParentBy","frontParentOnly","validateEmbedding","candidates","newCandidateView","prevCandidateView","candidate","candidateView","validateUnembedding","initialParentId","whenNotAllowed","initialPosition","proxyPortNode","action","delegatedView","isPropagationAlreadyStopped","grid","pointerOffset","embedding","elX","snapToGrid","elY","normal","oneSide","side","padding","util.normalizeSides","sourceBBox","targetBBox","sourcePoint","targetPoint","coordinate","direction","opposites","radians","freeJoin","getBBoxSize","bearing","getBearing","from","to","getPointBox","getPaddingBox","sides","getSourceBBox","getTargetBBox","getSourceAnchor","getTargetAnchor","vertexVertex","d1","d2","opposite","elementVertex","fromBBox","vertexElement","toBBox","route","freePoints","pt","freeBearingPoints","util.difference","elementElement","fromBorder","toBorder","mid","g.Line","startRoute","endRoute","insideElement","boundary","reversed","p3","g.toRad","orthogonal","sourceAnchor","targetAnchor","orthogonalVertices","isOrthogonal","isOrthogonalLoop","step","cost","ObstacleMap","excludedEnds","excludedAncestors","util.union","mapGridSize","isExcludedType","isExcludedEnd","excluded","isExcludedAncestor","isExcluded","gridKey","mapKey","obstacle","SortedSet","util.sortedIndex","getDirectionAngle","numDirections","angleTheta","fixAngleEnd","normalizedAngle","g.normalizeAngle","diffX","diffY","gridStepsX","gridStepsY","distanceX","distanceY","getDirectionChange","angle1","angle2","directionChange","getGridOffsets","directions","getGrid","getGridDimension","diff","absDiff","numSteps","roundedDiff","remainder","stepCorrection","snappedX","g.snapToGrid","snappedY","precision","align","getKey","normalizePoint","reconstructRoute","parents","tailPoint","prevDiff","currentKey","leadPoint","fromDiff","estimateCost","endPoints","min","len","getRectPoints","anchor","directionList","directionMap","anchorCenterVector","keys","dirList","rectPoints","endpoint","intersectionLine","intersections","numIntersections","farthestIntersectionDistance","farthestIntersection","currentIntersection","findRoute","isPointObstacle","startPoints","openSet","costs","startPoint","previousRouteDirectionAngle","isPathBeginning","endPointsKeys","endPoint","loopsRemaining","currentPoint","currentParent","currentCost","isRouteBeginning","isStart","previousDirectionAngle","samePoints","skipEndCheck","directionAngle","neighborPoint","neighborKey","isNeighborEnd","endDirectionAngle","endDirectionChange","neighborCost","neighborPenalty","costFromStart","resolveOptions","util.result","point1","point2","oldVertices","newVertices","partialRoute","isEndingAtPoint","dragFrom","dragTo","manhattan","diagonalCost","t","l1","l2","intersectionPoint","directionFrom","metro","Directions","DEFINED_DIRECTIONS","getDirectionForLinkConnection","linkOrigin","connectionPoint","rightAngleRouter","_vertices","margin","sourceDirection","targetDirection","isSourcePort","isTargetPort","sx0","sy0","sourceWidth","sourceHeight","tx0","ty0","targetWidth","targetHeight","tx1","ty1","sx1","sy1","smx0","smx1","smy0","smy1","tmx0","tmx1","tmy0","tmy1","sourceOutsidePoint","sourceSide","sourceLinkAnchorBBox","targetOutsidePoint","targetSide","targetLinkAnchorBBox","sox","soy","tox","toy","tcx","tcy","scx","scy","middleOfVerticalSides","middleOfHorizontalSides","y1","y2","x1","x2","rightAngle","CornerTypes","DEFINED_CORNER_TYPES","CORNER_RADIUS","PRECISION","straight","routePoints","cornerType","cornerRadius","cornerPreserveAspectRatio","raw","g.Polyline","g.Path","nextDistance","routePointsLength","curr","prev","prevDistance","startMove","endMove","cornerStart","cornerEnd","_13","_23","control1","control2","JUMP_SIZE","JUMP_TYPES","RADIUS","CLOSE_PROXIMITY_PADDING","IGNORED_CONNECTORS","sortPointsAscending","swap","overlapExists","line1","line2","x3","y3","x4","y4","xMatch","yMatch","createLines","resultLines","nextPoint","setupUpdating","jumpOverLinkView","updateList","updateJumpOver","updateFlag","findLineIntersections","crossCheckLines","crossCheckLine","intersection","sortPoints","createJumps","jumpSize","lastLine","jumpStart","jumpEnd","endDistance","startDistance","jumpLine","buildPath","lines","jumpType","segment","xAxisRotate","midpoint","centerLine","halfLine","xOffset","yOffset","nextLine","buildRoundedSegment","roundedStart","roundedEnd","jumpover","ignoreConnectors","allLinks","thisModel","thisIndex","defaultConnector","linkViews","thisLines","linkLines","jumpingLines","thisLine","linkLinesToTest","overlapIndex","lineIntersections","rounded","smooth","curves","g.Curve","controlPointX","controlPointY","TangentDirections","curve","completeRoute","sourceTangent","getSourceTangentDirection","tangentLength","pointsVector","angleBetweenVectors","updatedLength","targetTangent","getTargetTangentDirection","last","bezierCurves","createCatmullRomCurves","catmullRomToBezier","getHorizontalSourceDirection","unrotatedBBox","getHorizontalTargetDirection","getVerticalSourceDirection","getVerticalTargetDirection","getAutoSourceDirection","getAutoTargetDirection","getClosestPointSourceDirection","getClosestPointTargetDirection","getOutwardsSourceDirection","sourceCenter","getOutwardsTargetDirection","targetCenter","rotateVector","vector","cos","sin","v1","v2","determinant","tau","coeff","distances","tangents","catmullRomCurves","tpPrev","tpNext","vAngle","rot","vectorDeterminant","pointsDeterminant","t1","t2","scaleFactor1","scaleFactor2","p0","bcp1","bcp2","Curve","LinkView","updateLabels","updateLegacyTools","updateAll","updateConnector","previousLabels","pathLength","labelExists","_labels","children","child","className","removeClassNamePrefix","labelMarkup","currentChild","vNode","childNodes","vLabels","labelCache","labelsCount","builtinDefaultLabel","builtinDefaultLabelMarkup","defaultLabelMarkup","defaultMarkup","_V","labelIndex","labelRoot","hasCustomMarkup","labelAttrs","defaultLabelAttrs","builtinDefaultLabelAttrs","labelSize","defaultLabelSize","canLabelMove","$tools","toolTemplate","template","tool","tool2","$markerVertices","markupTemplate","$markerArrowheads","numRoutePoints","polylinePoints","numPolylinePoints","anchors","connectionPoints","markerPoints","firstWaypoint","lastWaypoint","sourceMarkerPoint","targetMarkerPoint","firstEndType","firstRef","secondEndType","secondRef","firstAnchor","secondAnchor","firstAnchorRef","secondAnchorRef","firstDef","secondDef","firstView","secondView","firstMagnet","secondMagnet","firstVertex","lastVertex","sourceDef","targetDef","paperOptions","sourceMagnet","sourceConnectionPointDef","sourcePointRef","sourceLine","Line","targetConnectionPointDef","targetPointRef","targetLine","anchorDef","isConnection","anchorFn","anchorName","anchorNamespace","connectionPointDef","linkConnectionMagnet","connectionPointFn","connectionPointName","builtinDefaultLabelPosition","defaultLabelPosition","normalizedLabelPosition","normalizedDefaultLabelPosition","transformationMatrix","_labelSelectors","connectionLength","toolPosition","doubleLinkToolsOffset","endViewProperty","endId","endModel","endView","endMagnetProperty","connectedMagnet","sourceArrow","targetArrow","labelPositionArgs","defaultLabelPositionArgs","p4","localX","localY","localAngle","positionArgs","token","onAnimationEnd","vToken","duration","isReversed","animationAttributes","connection","routers","defaultRouter","routerFn","connectors","connectorFn","subdivisions","length","isDistanceRelative","isDistanceAbsoluteReverse","isOffsetAbsolute","pathOpt","labelPoint","labelDistance","labelOffset","closestPoint","labelOffsetDiff","labelAngle","labelOffsetCoordinates","positionOffset","isKeepGradient","isEnsureLegibility","vertexLength","currentVertex","currentVertexLength","dragData","linkTool","stopPropagation","vertexIdx","labelIdx","initialLabelPosition","coords","positionAngle","vertexNode","removeNode","arrowheadNode","arrowheadType","setOptions","arrowhead","initialEnd","currentEnd","endChanged","snapPoint","closestPointX","closestDistanceX","closestPointY","closestDistanceY","distX","distY","snapLinksSelf","snapLinks","isSnapped","viewsInArea","prevClosestView","prevClosestMagnet","prevMagnetProxy","minDistance","pointer","magnetProxy","closestView","closestMagnet","newClosestMagnet","prevEnd","prevX","prevY","viewUnderPointer","magnetUnderPointer","style","oppositeArrowhead","validateConnectionArgs","isMagnetAvailable","validate","magnets","availableMagnets","markedKeys","markedMagnets","useFirstSubpath","secondSubpathIndex","highlightMatrix","paddingMatrix","MASK_CLIP","forEachDescendant","descendants","descendant","mask","childEl","MASK_CHILD_ATTRIBUTE_BLACKLIST","MASK_REPLACE_TAGS","MASK_REMOVE_TAGS","childTagName","originalChild","originalNode","childBBox","replacement","ox","oy","rootEl","MASK_ROOT_ATTRIBUTE_BLACKLIST","tagName","maskRoot","maskChild","VISIBLE","INVISIBLE","strokeWidth","hasNodeFill","magnetStrokeWidth","minStrokeWidth","maxStrokeWidth","maskEl","maskNode","maskClip","color","highlighterBBox","opacity","util.addClassNamePrefix","addClass","elementView","gap","normalizedSize","isRowDirection","itemWidth","items","prevItems","comparison","unchanged","prevEls","itemsEls","prevEl","itemEl","itemsCount","listSize","connectionRatio","_magnet","_refPoint","_connectionPerpendicular","refPoint","OFFSET","verticalLine","horizontalLine","verticalIntersections","horizontalIntersections","getPointAtLink","connectionClosest","_connectionClosest","_opt","resolveRef","refView","parsedValue","connectionPerpendicular","offsetPoint","alignLine","anchorConnectionPoint","_view","alignOffset","bboxIntersection","rectangleIntersection","bboxWORotation","lineWORotation","findShapeNode","BNDR_SUBDIVISIONS","BNDR_SHAPE_BBOX","boundaryIntersection","localShape","targetMatrix","localMatrix","localLine","localRef","localBBox","cpOffset","rectangle","bboxWrapper","dxPercentage","dyPercentage","_perpendicular","topLeft","bottomRight","_midSide","_modelCenter","topRight","bottomLeft","perpendicular","midSide","modelCenter","sortingTypes","WHEEL_CAP","WHEEL_WAIT_MS","MOUNT_BATCH_SIZE","UPDATE_BATCH_SIZE","MIN_PRIORITY","defaultHighlighting","defaultLayers","Paper","_evt","cellViewS","_magnetS","cellViewT","_magnetT","_linkView","childView","parentView","priority","highlighters","linkAnchors","updateDelayingBatches","sortDelayingBatches","defaultConnectionPoint","defaultAnchor","defaultLinkAnchor","highlighting","cellViewNamespace","ns","_layers","svg","defs","layers","background","sorted","layerView","cellsLayerView","toolsLayerView","labelsLayerView","ctm","viewport","transformString","ctmString","flagLabels","nextPriority","dumpOptions","sourceFlag","targetFlag","isAsync","stats","updates","FLAG_REMOVE","FLAG_INSERT","UPDATE_PRIORITY","priorityUpdates","prevPriorityUpdates","currentType","viewUpdateFn","shouldNotify","leftover","FLAG_INIT","isInitialInsert","passingOpt","batchStats","updateCount","batchCount","priorities","priorityIndexes","_key","checkStats","unmountCount","mountCount","processed","total","progressFn","beforeFn","afterFn","batchSize","postponeCount","maxPriority","empty","viewportFn","postponeViewFn","main","currentFlag","isDetached","leftoverFlag","unmountedCids","unmountedViews","mountedCids","mountedViews","unmounted","mounted","visible","isUnmounted","isMounted","unmountedCount","mountedCount","isFrozen","freezeKey","w","h","currentWidth","currentHeight","computedSize","gridWidth","gridHeight","minWidth","minHeight","maxWidth","maxHeight","newOrigin","area","calcWidth","calcHeight","contentBBox","contentLocalOrigin","contentArea","minScaleX","maxScaleX","minScaleY","maxScaleY","fittingBBox","currentTranslate","currentScale","newSx","newSy","gridSize","scaleDiff","newOx","newOy","restrictTranslate","optionalViewClass","defaultViewClass","namespaceViewClass","ViewClass","_updates","create","$cells","sortElements","cellA","cellB","zA","zB","translate","newTx","newTy","drawGrid","$el","localPoint","paperPoint","localRect","paperRect","clientPoint","clientRect","pagePoint","pageOffset","highlighterDef","highlighterNamespace","highlighter","magnetEl","highlighterDescriptor","normalizeEvent","button","isContextMenu","isTargetFormNode","rootViewEl","eventNode","eventEvt","magnetNode","magnetEvt","contextmenuEvt","mousemoved","normalizedEvt","relatedTarget","relatedView","debounce","deltas","deltaY","cap","originalEvent","deltaX","normalizeWheel","pinchHandlers","handler","magnetValue","optionsList","isArray","pattern","localOptions","gridLayerSetting","patternDefVel","patternUri","backgroundPosition","backgroundSize","img","backgroundImage","backgroundRepeat","backgroundOpacity","backgroundQuality","backgroundPattern","camelCase","canvas","defId","filterId","hashCode","_filter","filterSVGString","filterAttrs","gradient","stops","stopVEls","gradientVEl","patternVEl","markerUnits","markerVEl","markerContentVEl","markupVEl","markerAttrs","markupValue","imgWidth","imgHeight","ctx","stepX","stepY","thickness","ToolsView","tools","ToolView","isRendered","focusedTool","blurredTool","env","Generic","TextView","Text","Circle","Ellipse","Polygon","Image","Rhombus","svgForeignObjectSupported","TextBlock","content","sanitizeHTML","TextBlockView","noTextAttrs","Rectangle","BorderedImage","EmbeddedImage","InscribedImage","HeaderedRectangle","CYLINDER_TILT","Cylinder","isPercentageSetter","bodyAttrs","topAttrs","rx","ry","kappa","xLeft","xCenter","xRight","ySideTop","yCurveTop","ySideBottom","yCurveBottom","foLabelMarkup","svgLabelMarkup","wrapValue","wrapAttrs","LinkBase","DoubleLink","ShadowLink","Model","changed","inPorts","outPorts","difference","inPortItems","outPortItems","Atomic","Coupled","Gate","IO","Input","Output","Gate11","Gate21","Repeater","input","Not","Or","input1","input2","And","Nor","Nand","Xor","Xnor","Wire","KingWhite","KingBlack","QueenWhite","QueenBlack","RookWhite","RookBlack","BishopWhite","BishopBlack","KnightWhite","KnightBlack","PawnWhite","PawnBlack","Entity","WeakEntity","Relationship","IdentifyingRelationship","Attribute","Multivalued","Derived","Key","Normal","ISA","State","StartState","EndState","Arrow","Member","Place","PlaceView","vTokens","tokens","Transition","diaLink","Class","rects","offsetY","rectHeight","ClassView","Abstract","AbstractView","Interface","InterfaceView","Generalization","Implementation","Aggregation","Composition","Association","getViewBBox","useModelGeometry","Boundary","defineNamespace","dia.Element","updateLabelText","boundaryTool","elementTools.Boundary","resizeTool","NormalResizeTool","rotateTool","RotateTool","dia.ToolsView","shapes.standard.Link","textInput","cellText","_b","_a","centerX","centerY","oneThirdWidth","handleKeydownEvent","newCellText","linkTools.Boundary","shapes","initJointJs","dia.Graph","dia.Paper","shapes.bleuon","magnetS","magnetT","linkConnectorOptions","linkConnectorConfig","linkRouterOptions","linkRouterConfig","clickedLastView","clickedCurrView","textColor","textSize","fontFamilyOptions","fontFamily","shapeStrokeWidthOptions","shapeStrokeWidth","shapeBackground","shapeBorderStyle","calcCurrentScale","computed","currentOffsetX","currentOffsetY","isClickedLink","isClickedElement","mountToolsLink","currView","unmountToolsLink","mountToolsElement","unmountToolsElement","onPointerClickBlank","Data.isClickedElement","Data.isClickedLink","Data.clickedLastView","onPointerClickElement","Data.clickedCurrView","onPointerClickLink","onMousewheelBlank","scrollFactor","scaleFactor","Data.currentScale","Data.currentOffsetX","Data.currentOffsetY","onKeydown","shortcutKey","onPointerDbclickElement"],"mappings":"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CACE,MAAO,QACP,MAAO,OACT,CACF,EAKaC,GAAsB/qC,GAAI,CACrC,KAAM,QACR,CAAC,EAKYgrC,GAAoB,CAC/B,CACE,MAAO,YACP,MAAO,WACT,EACA,CACE,MAAO,QACP,MAAO,OACT,EACA,CACE,MAAO,SACP,MAAO,QACT,EACA,CACE,MAAO,aACP,MAAO,YACT,EACA,CACE,MAAO,aACP,MAAO,YACT,CACF,EAKaC,GAAmBjrC,GAAI,CAClC,KAAM,QACR,CAAC,EAKYkrC,GAAkBlrC,GAAI,CACjC,KAAM,KACN,MAAO,IACT,CAAC,EAKYmrC,GAAkBnrC,GAAI,IAAI,EAK1BorC,GAAYprC,GAAI,EAAE,EAKlBqrC,GAAWrrC,GAAI,EAAE,EAKjBsrC,GAAoB,CAC/B,CACE,MAAO,OACP,MAAO,MACT,EACA,CACE,MAAO,QACP,MAAO,OACT,EACA,CACE,MAAO,cACP,MAAO,aACT,EACA,CACE,MAAO,eACP,MAAO,cACT,EACA,CACE,MAAO,UACP,MAAO,SACT,EACA,CACE,MAAO,UACP,MAAO,SACT,EACA,CACE,MAAO,UACP,MAAO,SACT,EACA,CACE,MAAO,gBACP,MAAO,eACT,EACA,CACE,MAAO,WACP,MAAO,UACT,EACA,CACE,MAAO,aACP,MAAO,YACT,EACA,CACE,MAAO,SACP,MAAO,QACT,CACF,EAGaC,GAAavrC,GAAI,MAAM,EAKvBwrC,GAA0B,CACrC,CACE,MAAO,EACP,MAAO,KACT,EACA,CACE,MAAO,GACP,MAAO,OACT,EACA,CACE,MAAO,EACP,MAAO,KACT,EACA,CACE,MAAO,IACP,MAAO,OACT,EACA,CACE,MAAO,EACP,MAAO,KACT,EACA,CACE,MAAO,EACP,MAAO,KACT,EACA,CACE,MAAO,EACP,MAAO,KACT,EACA,CACE,MAAO,EACP,MAAO,KACT,EACA,CACE,MAAO,EACP,MAAO,KACT,EACA,CACE,MAAO,EACP,MAAO,KACT,EACA,CACE,MAAO,GACP,MAAO,MACT,CACF,EAKaC,GAAmBzrC,GAAI,GAAG,EAK1B0rC,GAAkB1rC,GAAI,OAAO,EAK7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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52]}