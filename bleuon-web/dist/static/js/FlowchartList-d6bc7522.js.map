{"version":3,"file":"FlowchartList-d6bc7522.js","sources":["../../../apps/mainapp/views/workbench/FlowchartList.vue"],"sourcesContent":["<script lang=\"ts\" setup>\r\n/**\r\n * @description flowcharts 流程图列表\r\n * @author zheng\r\n * @since 2023/8/23\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n\r\nimport { DateUtil, FormValidatorsUtil } from \"@common/utils\";\r\nimport { FlowchartApi } from \"@mainapp/apis\";\r\nimport { downloadWithDataUri } from \"@mainapp/lib/tools\";\r\n\r\n// components\r\nimport File from \"@mainapp/components/File.vue\";\r\nimport WorkbenchHeader from \"@mainapp/components/WorkbenchHeader.vue\";\r\n\r\nconst clickedIndex = ref(0);\r\nconst flowchartList = ref(await FlowchartApi.findAllByCriteria({}));\r\n\r\nconst dialogVisible = ref(false);\r\nconst isFileNameCorrect = ref(false);\r\nconst fileNameRules = reactive({\r\n  fileName: [\r\n    { validator: FormValidatorsUtil.fileNameValidator(isFileNameCorrect), trigger: \"blur\" },\r\n    { validator: FormValidatorsUtil.fileNameValidator(isFileNameCorrect), trigger: \"change\" }\r\n  ]\r\n});\r\n\r\nfunction renewalFlowchart() {\r\n  FlowchartApi.renewal(flowchartList.value[clickedIndex.value], () => {\r\n    dialogVisible.value = !dialogVisible.value;\r\n  });\r\n}\r\n\r\nfunction resetFlowchart(index: number) {\r\n  dialogVisible.value = !dialogVisible.value;\r\n  clickedIndex.value = index;\r\n}\r\n\r\nfunction downloadFlowchart(data: FlowchartData) {\r\n  downloadWithDataUri(\r\n    data,\r\n    \"jpeg\",\r\n    () => {\r\n      ElMessage.success(\"下载成功！\");\r\n    },\r\n    () => {\r\n      ElMessage.error(\"下载失败！\");\r\n    }\r\n  );\r\n}\r\n\r\nfunction replicateFlowchart(data: FlowchartData) {\r\n  data.fileName = \"复制_\" + data.fileName;\r\n  FlowchartApi.replicate(data, async () => {\r\n    await fetchData({});\r\n  });\r\n}\r\n\r\nfunction deleteFlowchart(id: string, index: number) {\r\n  FlowchartApi.eraseById({ id }, async () => {\r\n    flowchartList.value.splice(index, 1);\r\n  });\r\n}\r\n\r\nasync function fetchData(params: any) {\r\n  flowchartList.value = await FlowchartApi.findAllByCriteria(params);\r\n}\r\n\r\nconst searchVal = ref(\"\");\r\nconst isModifyDateAsc = ref(false);\r\nconst isCreateDateAsc = ref(false);\r\n\r\nfunction allFlowchart() {\r\n  fetchData({\r\n    fileName: searchVal.value\r\n  });\r\n}\r\n\r\nfunction publicFlowchart() {\r\n  fetchData({\r\n    fileName: searchVal.value,\r\n    isPublic: 1\r\n  });\r\n}\r\n\r\nfunction shareFlowchart() {\r\n  fetchData({\r\n    fileName: searchVal.value,\r\n    isShare: 1\r\n  });\r\n}\r\n\r\nfunction legalFlowchart() {\r\n  fetchData({\r\n    fileName: searchVal.value,\r\n    isLegal: 1\r\n  });\r\n}\r\n\r\nfunction modifyDateFlowchart() {\r\n  isModifyDateAsc.value = !isModifyDateAsc.value;\r\n  fetchData({ sequences: [{ col: \"modify_date\", isAsc: isModifyDateAsc.value }] });\r\n}\r\n\r\nfunction createDateFlowchart() {\r\n  isCreateDateAsc.value = !isCreateDateAsc.value;\r\n  fetchData({ sequences: [{ col: \"create_date\", isAsc: isCreateDateAsc.value }] });\r\n}\r\n\r\nasync function searchFiles() {\r\n  fetchData({ fileName: searchVal.value });\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flowchart-list max-h-100vh\">\r\n    <WorkbenchHeader v-model:value=\"searchVal\" @enter-search=\"searchFiles\"></WorkbenchHeader>\r\n    <div class=\"px-10 pb-10\">\r\n      <div class=\"f-c-b\">\r\n        <div>流程图</div>\r\n        <div class=\"f-c-c\">\r\n          <div>\r\n            <el-tooltip content=\"筛选\" placement=\"top\">\r\n              <el-dropdown :hide-on-click=\"false\" :teleported=\"false\" trigger=\"click\">\r\n                <el-button size=\"small\" @click=\"\">\r\n                  <template #icon>\r\n                    <div class=\"i-tabler-filter\"></div>\r\n                  </template>\r\n                </el-button>\r\n                <template #dropdown>\r\n                  <el-dropdown-menu>\r\n                    <el-dropdown-item @click=\"modifyDateFlowchart\">\r\n                      <div class=\"text-0.8rem f-c-s select-none\">\r\n                        <div\r\n                          :class=\"\r\n                            isModifyDateAsc\r\n                              ? 'i-tabler-sort-ascending-2'\r\n                              : 'i-tabler-sort-descending-2'\r\n                          \"\r\n                          class=\"mr-2\"></div>\r\n                        <span>\r\n                          修改日期<span v-if=\"isModifyDateAsc\">升序</span><span v-else>降序</span>\r\n                        </span>\r\n                      </div>\r\n                    </el-dropdown-item>\r\n                    <el-dropdown-item @click=\"createDateFlowchart\">\r\n                      <div class=\"text-0.8rem f-c-s select-none\">\r\n                        <div\r\n                          :class=\"\r\n                            isCreateDateAsc\r\n                              ? 'i-tabler-sort-ascending-2'\r\n                              : 'i-tabler-sort-descending-2'\r\n                          \"\r\n                          class=\"mr-2\"></div>\r\n                        <span>\r\n                          创建日期<span v-if=\"isCreateDateAsc\">升序</span><span v-else>降序</span>\r\n                        </span>\r\n                      </div>\r\n                    </el-dropdown-item>\r\n                    <el-dropdown-item @click=\"allFlowchart\">\r\n                      <div class=\"text-0.8rem f-c-s select-none\">\r\n                        <div class=\"mr-2 i-tabler-border-all\"></div>\r\n                        <span>所有流程图</span>\r\n                      </div>\r\n                    </el-dropdown-item>\r\n                    <el-dropdown-item @click=\"publicFlowchart\">\r\n                      <div class=\"text-0.8rem f-c-s select-none\">\r\n                        <div class=\"mr-2 i-tabler-eye-check\"></div>\r\n                        <span>公开的流程图</span>\r\n                      </div>\r\n                    </el-dropdown-item>\r\n                    <el-dropdown-item @click=\"shareFlowchart\">\r\n                      <div class=\"text-0.8rem f-c-s select-none\">\r\n                        <div class=\"mr-2 i-tabler-brand-stackshare\"></div>\r\n                        <span>分享的流程图</span>\r\n                      </div>\r\n                    </el-dropdown-item>\r\n                    <el-dropdown-item @click=\"legalFlowchart\">\r\n                      <div class=\"text-0.8rem f-c-s select-none\">\r\n                        <div class=\"mr-2 i-tabler-lock-square\"></div>\r\n                        <span>未审核的流程图</span>\r\n                      </div>\r\n                    </el-dropdown-item>\r\n                  </el-dropdown-menu>\r\n                </template>\r\n              </el-dropdown>\r\n            </el-tooltip>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"mt-5 text-text-regular text-0.9rem\">文件</div>\r\n      <div class=\"file-list mt-5 f-c-s flex-wrap flex-gap-1.25rem\">\r\n        <File\r\n          v-for=\"(item, index) in flowchartList\"\r\n          :key=\"item.id\"\r\n          :file-image=\"item.dataUri\"\r\n          :file-name=\"item.fileName\"\r\n          :path=\"'/flowchart/' + item.id\"\r\n          @replicate=\"replicateFlowchart(item)\"\r\n          @delete=\"deleteFlowchart(item.id, index)\"\r\n          @download=\"downloadFlowchart(item)\"\r\n          @reset=\"resetFlowchart(index)\">\r\n          <template #footer>\r\n            <div class=\"f-c-s flex-nowrap mt-4 w-100%\">\r\n              <div class=\"mr-2 i-tabler-chart-bubble text-theme-primary\"></div>\r\n              <div class=\"text-0.9rem text-ellipsis line-clamp-1\">{{ item.fileName }}</div>\r\n            </div>\r\n            <div class=\"text-text-secondary text-0.8rem mt-4 f-c-s\">\r\n              <div class=\"i-tabler-clock-edit mr-1\"></div>\r\n              {{ DateUtil.formatted(\"MM-dd HH:mm:ss\", item.modifyDate) }}\r\n            </div>\r\n          </template>\r\n        </File>\r\n      </div>\r\n      <el-dialog v-model=\"dialogVisible\" title=\"修改文件名称\" width=\"30%\">\r\n        <el-form :model=\"flowchartList[clickedIndex]\" :rules=\"fileNameRules\">\r\n          <el-form-item prop=\"fileName\">\r\n            <el-input\r\n              @keyup.enter=\"renewalFlowchart\"\r\n              v-model=\"flowchartList[clickedIndex].fileName\"\r\n              placeholder=\"请输入文件名称\" />\r\n          </el-form-item>\r\n        </el-form>\r\n        <template #footer>\r\n          <span class=\"dialog-footer\">\r\n            <el-button :disabled=\"!isFileNameCorrect\" type=\"primary\" @click=\"renewalFlowchart\">\r\n              <template #icon>\r\n                <div class=\"i-tabler-check\"></div>\r\n              </template>\r\n              确定\r\n            </el-button>\r\n            <el-button @click=\"dialogVisible = false\">\r\n              <template #icon>\r\n                <div class=\"i-tabler-x\"></div>\r\n              </template>\r\n              取消\r\n            </el-button>\r\n          </span>\r\n        </template>\r\n      </el-dialog>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n"],"names":["clickedIndex","ref","flowchartList","__temp","__restore","_withAsyncContext","FlowchartApi.findAllByCriteria","dialogVisible","isFileNameCorrect","fileNameRules","reactive","FormValidatorsUtil.fileNameValidator","renewalFlowchart","FlowchartApi.renewal","resetFlowchart","index","downloadFlowchart","data","downloadWithDataUri","ElMessage","replicateFlowchart","FlowchartApi.replicate","fetchData","deleteFlowchart","id","FlowchartApi.eraseById","params","searchVal","isModifyDateAsc","isCreateDateAsc","allFlowchart","publicFlowchart","shareFlowchart","legalFlowchart","modifyDateFlowchart","createDateFlowchart","searchFiles"],"mappings":"69EAgBA,MAAAA,EAAAC,EAAA,CAAA,EACAC,EAAAD,GAAA,CAAAE,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAA,CAAA,CAAA,CAAA,EAAAH,EAAA,MAAAA,EAAAC,EAAA,EAAAD,IAEAI,EAAAN,EAAA,EAAA,EACAO,EAAAP,EAAA,EAAA,EACAQ,EAAAC,EAAA,CAA+B,SAAA,CACnB,CAAA,UAAAC,EAAAH,CAAA,EAAA,QAAA,MAAA,EAC8E,CAAA,UAAAG,EAAAH,CAAA,EAAA,QAAA,QAAA,CACE,CAC1F,CAAA,EAGF,SAAAI,GAAA,CACEC,GAAAX,EAAA,MAAAF,EAAA,KAAA,EAAA,IAAA,CACEO,EAAA,MAAA,CAAAA,EAAA,KAAqC,CAAA,CACtC,CAGH,SAAAO,EAAAC,EAAA,CACER,EAAA,MAAA,CAAAA,EAAA,MACAP,EAAA,MAAAe,CAAqB,CAGvB,SAAAC,EAAAC,EAAA,CACEC,GAAAD,EACE,OACA,IAAA,CAEEE,EAAA,QAAA,OAAA,CAAyB,EAC3B,IAAA,CAEEA,EAAA,MAAA,OAAA,CAAuB,CACzB,CACF,CAGF,SAAAC,EAAAH,EAAA,CACEA,EAAA,SAAA,MAAAA,EAAA,SACAI,GAAAJ,EAAA,SAAA,CACE,MAAAK,EAAA,CAAA,CAAA,CAAkB,CAAA,CACnB,CAGH,SAAAC,EAAAC,EAAAT,EAAA,CACEU,GAAA,CAAA,GAAAD,CAAA,EAAA,SAAA,CACEtB,EAAA,MAAA,OAAAa,EAAA,CAAA,CAAmC,CAAA,CACpC,CAGH,eAAAO,EAAAI,EAAA,CACExB,EAAA,MAAA,MAAAI,EAAAoB,CAAA,CAAiE,CAGnE,MAAAC,EAAA1B,EAAA,EAAA,EACA2B,EAAA3B,EAAA,EAAA,EACA4B,EAAA5B,EAAA,EAAA,EAEA,SAAA6B,GAAA,CACER,EAAA,CAAU,SAAAK,EAAA,KACY,CAAA,CACrB,CAGH,SAAAI,GAAA,CACET,EAAA,CAAU,SAAAK,EAAA,MACY,SAAA,CACV,CAAA,CACX,CAGH,SAAAK,GAAA,CACEV,EAAA,CAAU,SAAAK,EAAA,MACY,QAAA,CACX,CAAA,CACV,CAGH,SAAAM,GAAA,CACEX,EAAA,CAAU,SAAAK,EAAA,MACY,QAAA,CACX,CAAA,CACV,CAGH,SAAAO,GAAA,CACEN,EAAA,MAAA,CAAAA,EAAA,MACAN,EAAA,CAAA,UAAA,CAAA,CAAA,IAAA,cAAA,MAAAM,EAAA,MAAA,CAAA,CAAA,CAA+E,CAGjF,SAAAO,GAAA,CACEN,EAAA,MAAA,CAAAA,EAAA,MACAP,EAAA,CAAA,UAAA,CAAA,CAAA,IAAA,cAAA,MAAAO,EAAA,MAAA,CAAA,CAAA,CAA+E,CAGjF,eAAAO,GAAA,CACEd,EAAA,CAAA,SAAAK,EAAA,KAAA,CAAA,CAAuC"}