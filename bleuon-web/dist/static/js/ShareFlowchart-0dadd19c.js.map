{"version":3,"file":"ShareFlowchart-0dadd19c.js","sources":["../../../apps/mainapp/views/share/ShareFlowchart.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\n/**\r\n * @description 分享的 Flowchart 流程图\r\n * @author 郑人滏 42020306\r\n * @since 2023/9/30\r\n * @link https://github.com/himmelbleu/bleuon-app\r\n */\r\n\r\n// jointjs css\r\nimport \"jointjs/css/layout.css\";\r\nimport \"jointjs/css/themes/default.css\";\r\n\r\nimport { dia, initJointJs } from \"@mainapp/lib\";\r\nimport { FlowchartApi } from \"@mainapp/apis\";\r\nimport { ListenerService } from \"@mainapp/service/diagraming/flowchart\";\r\nimport * as Data from \"@mainapp/data/diagraming/flowchart\";\r\n\r\n// components\r\nimport HeaderToolsBottom from \"@mainapp/components/diagraming/flowchart/HeaderToolsBottom.vue\";\r\nimport HeaderToolsTop from \"@mainapp/components/diagraming/flowchart/HeaderToolsTop.vue\";\r\nimport FooterTools from \"@mainapp/components/diagraming/flowchart/FooterTools.vue\";\r\n\r\nconst paper = shallowRef<dia.Paper>();\r\nconst graph = shallowRef<dia.Graph>();\r\nconst route = useRoute();\r\nconst router = useRouter();\r\n\r\nconst flowchartData = ref<FlowchartData>({});\r\nconst textInputRef = shallowRef<HTMLInputElement>();\r\n\r\nprovide(KeyVals.BLEUON_FLOWCHART_PAPER, paper);\r\nprovide(KeyVals.BLEUON_FLOWCHART_GRAPH, graph);\r\nprovide(KeyVals.BLEUON_FLOWCHART_DATA, flowchartData);\r\n\r\nasync function fetchData() {\r\n  const data = await FlowchartApi.exposeQueryOne({ id: route.params.id.toString() }, () => {\r\n    router.back();\r\n  });\r\n  flowchartData.value = data;\r\n}\r\n\r\nfunction regainFromJson() {\r\n  if (flowchartData.value.json) {\r\n    paper.value.freeze();\r\n    graph.value.fromJSON(JSON.parse(flowchartData.value.json));\r\n    paper.value.unfreeze();\r\n  }\r\n\r\n  paper.value.options.defaultConnector = JSON.parse(flowchartData.value.connectorDefault);\r\n  paper.value.options.defaultRouter = JSON.parse(flowchartData.value.routerDefault);\r\n}\r\n\r\nawait fetchData();\r\n\r\nonMounted(() => {\r\n  const jointjs = initJointJs({\r\n    el: \"bleuon__flowchart-content\",\r\n    width: \"100vw\",\r\n    height: \"75vh\",\r\n    gridSize: flowchartData.value.gridSize,\r\n    bgColor: flowchartData.value.bgColor,\r\n    drawGrid: {\r\n      name: \"doubleMesh\",\r\n      args: [\r\n        { color: \"#333333\", thickness: 1 },\r\n        { color: \"gray\", scaleFactor: 5, thickness: 5 }\r\n      ]\r\n    }\r\n  });\r\n\r\n  paper.value = jointjs.paper;\r\n  graph.value = jointjs.graph;\r\n\r\n  regainFromJson();\r\n\r\n  paper.value.on({\r\n    \"element:pointerclick\": view => {\r\n      ListenerService.onPointerClickElement(view);\r\n    },\r\n    \"element:pointerdblclick\": view => {\r\n      ListenerService.onPointerDbclickElement(view, textInputRef.value);\r\n    },\r\n    \"link:pointerclick\": view => {\r\n      ListenerService.onPointerClickLink(view);\r\n    },\r\n    \"link:pointerdblclick\": view => {\r\n      ListenerService.onPointerDbclickElement(view, textInputRef.value);\r\n    },\r\n    \"blank:pointerclick\": evt => {\r\n      ListenerService.onPointerClickBlank();\r\n    },\r\n    \"blank:mousewheel\": evt => {\r\n      ListenerService.onMousewheelBlank(evt, paper.value);\r\n    }\r\n  });\r\n});\r\n</script>\r\n\r\n<template>\r\n  <div class=\"bleuon__flowchart-container h-100vh\">\r\n    <div\r\n      class=\"bleuon__flowchart-header h-22vh border-border-primary border-b-1 border-b-solid bg-#f6f7f8 px-4 py-4\">\r\n      <HeaderToolsTop :type=\"'share'\" class=\"mb-4\" />\r\n      <HeaderToolsBottom\r\n        :is-clicked-element=\"Data.isClickedElement.value\"\r\n        :is-clicked-link=\"Data.isClickedLink.value\" />\r\n    </div>\r\n    <div class=\"bleuon__flowchart-wrapper f-c-b\">\r\n      <div class=\"left\"></div>\r\n      <div class=\"right\">\r\n        <div id=\"bleuon__flowchart-content\"></div>\r\n        <FooterTools class=\"h-3vh\" />\r\n      </div>\r\n      <div class=\"bleuon__flowchart-extra\">\r\n        <input ref=\"textInputRef\" type=\"text\" class=\"bleuon__flowchart-input absolute hidden\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.joint-element {\r\n  .joint-port {\r\n    circle {\r\n      fill: transparent;\r\n      stroke: transparent;\r\n      stroke-width: 0;\r\n      stroke-dasharray: none;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["paper","shallowRef","graph","route","useRoute","router","useRouter","flowchartData","ref","textInputRef","provide","KeyVals.BLEUON_FLOWCHART_PAPER","KeyVals.BLEUON_FLOWCHART_GRAPH","KeyVals.BLEUON_FLOWCHART_DATA","fetchData","data","FlowchartApi.exposeQueryOne","regainFromJson","__temp","__restore","_withAsyncContext","onMounted","jointjs","initJointJs","view","ListenerService.onPointerClickElement","ListenerService.onPointerDbclickElement","ListenerService.onPointerClickLink","evt","ListenerService.onPointerClickBlank","ListenerService.onMousewheelBlank"],"mappings":"4iCAsBA,MAAAA,EAAAC,IACAC,EAAAD,IACAE,EAAAC,IACAC,EAAAC,IAEAC,EAAAC,EAAA,CAAA,CAAA,EACAC,EAAAR,IAEAS,EAAAC,EAAAX,CAAA,EACAU,EAAAE,EAAAV,CAAA,EACAQ,EAAAG,EAAAN,CAAA,EAEA,eAAAO,GAAA,CACE,MAAAC,EAAA,MAAAC,EAAA,CAAA,GAAAb,EAAA,OAAA,GAAA,SAAA,CAAA,EAAA,IAAA,CACEE,EAAA,KAAA,CAAY,CAAA,EAEdE,EAAA,MAAAQ,CAAsB,CAGxB,SAAAE,GAAA,CACEV,EAAA,MAAA,OACEP,EAAA,MAAA,SACAE,EAAA,MAAA,SAAA,KAAA,MAAAK,EAAA,MAAA,IAAA,CAAA,EACAP,EAAA,MAAA,YAGFA,EAAA,MAAA,QAAA,iBAAA,KAAA,MAAAO,EAAA,MAAA,gBAAA,EACAP,EAAA,MAAA,QAAA,cAAA,KAAA,MAAAO,EAAA,MAAA,aAAA,CAAgF,CAGlF,OAAAW,EAAAC,CAAA,EAAAC,EAAA,IAAAN,EAAA,CAAA,EAAA,MAAAI,EAAAC,IAEAE,EAAA,IAAA,CACE,MAAAC,EAAAC,EAAA,CAA4B,GAAA,4BACtB,MAAA,QACG,OAAA,OACC,SAAAhB,EAAA,MAAA,SACsB,QAAAA,EAAA,MAAA,QACD,SAAA,CACnB,KAAA,aACF,KAAA,CACA,CAAA,MAAA,UAAA,UAAA,CAAA,EAC6B,CAAA,MAAA,OAAA,YAAA,EAAA,UAAA,CAAA,CACa,CAChD,CACF,CAAA,EAGFP,EAAA,MAAAsB,EAAA,MACApB,EAAA,MAAAoB,EAAA,MAEAL,IAEAjB,EAAA,MAAA,GAAA,CAAe,uBAAAwB,GAAA,CAEXC,EAAAD,CAAA,CAA0C,EAC5C,0BAAAA,GAAA,CAEEE,EAAAF,EAAAf,EAAA,KAAA,CAAgE,EAClE,oBAAAe,GAAA,CAEEG,EAAAH,CAAA,CAAuC,EACzC,uBAAAA,GAAA,CAEEE,EAAAF,EAAAf,EAAA,KAAA,CAAgE,EAClE,qBAAAmB,GAAA,CAEEC,GAAoC,EACtC,mBAAAD,GAAA,CAEEE,EAAAF,EAAA5B,EAAA,KAAA,CAAkD,CACpD,CAAA,CACD,CAAA"}